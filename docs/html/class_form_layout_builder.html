<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>MitosEHR: FormLayoutBuilder Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="logo_medium.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">MitosEHR
   &#160;<span id="projectnumber">Vega v1.0</span>
   </div>
   <div id="projectbrief">PHP Classes Documentation</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="classes.html"><span>Data&#160;Structure&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Data&#160;Fields</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('class_form_layout_builder.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">FormLayoutBuilder Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="FormLayoutBuilder" --><!-- doxytag: inherits="dbHelper" --><div class="dynheader">
Inheritance diagram for FormLayoutBuilder:</div>
<div class="dyncontent">
 <div class="center">
  <img src="class_form_layout_builder.png" usemap="#FormLayoutBuilder_map" alt=""/>
  <map id="FormLayoutBuilder_map" name="FormLayoutBuilder_map">
<area href="classdb_helper.html" title="Database Helper Class." alt="dbHelper" shape="rect" coords="0,0,119,24"/>
</map>
 </div></div>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_form_layout_builder.html#a09d2fcc356ffec482c2288ed3128f55d">addField</a> ($data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_form_layout_builder.html#af1ac76169bfb7bbb995f000d5bb9ac2e">updateField</a> ($data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_form_layout_builder.html#a383f52a44383e21583989705ef0d630d">deleteField</a> ($data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_form_layout_builder.html#afcb5238ce6ce86f873765792f9f18ad8">sortFields</a> ($data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_form_layout_builder.html#a9ff1809bc98bb7a1526eb4e035c1ffa8">getForms</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_form_layout_builder.html#ad7d4c76349c0ed04f32ca58530ffd16b">getParentFields</a> (stdClass $params)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_form_layout_builder.html#ac89522e4c6cb3d293adce3bd72e91827">getFormFieldsTree</a> (stdClass $params)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="_form_layout_builder_8php_source.html#l00023">23</a> of file <a class="el" href="_form_layout_builder_8php_source.html">FormLayoutBuilder.php</a>.</p>
</div><hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a09d2fcc356ffec482c2288ed3128f55d"></a><!-- doxytag: member="FormLayoutBuilder::addField" ref="a09d2fcc356ffec482c2288ed3128f55d" args="($data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_form_layout_builder.html#a09d2fcc356ffec482c2288ed3128f55d">addField</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>lets defines what is a container for later use.</p>
<p>if getFieldDataCol returns true, means there is a colunm in the current database form table. in that case we need to return that error leting the user know there is a duplicated field or duplicated name property. The user has 2 options, verify the form to make sure the the field is not getting duplicated or change the name property to save the field data inside another column.</p>
<p>since now we know the column doesn't exist, lets create one for the new field</p>
<p>sinatizedData check the data array and if the value is empty delete it form the array then checck the value and if is equal to "on" set it to true, and "off" set it to false</p>
<p>if not xtype fieldcontainer and fieldset the add some defaul values.</p>
<p>now lets start creating the field in the database</p>
<p>Exec the new field sql statement and store the its ID in $field_id to then store its options</p>
<p>take each option and insert it in the forms_field_options table using $field_id</p>

<p>Definition at line <a class="el" href="_form_layout_builder_8php_source.html#l00028">28</a> of file <a class="el" href="_form_layout_builder_8php_source.html">FormLayoutBuilder.php</a>.</p>
<div class="fragment"><pre class="fragment">                                   {
        $this-&gt;getFormDataTable($data[<span class="stringliteral">&#39;form_id&#39;</span>]);
        $this-&gt;col  = $data[<span class="stringliteral">&#39;name&#39;</span>];
        $container  = <span class="keyword">false</span>;
        <span class="keywordflow">if</span>( $data[<span class="stringliteral">&#39;xtype&#39;</span>] == <span class="stringliteral">&#39;fieldcontainer&#39;</span> || $data[<span class="stringliteral">&#39;xtype&#39;</span>] == <span class="stringliteral">&#39;fieldset&#39;</span> ) $container = <span class="keyword">true</span>;
        <span class="keywordflow">if</span>($this-&gt;fieldHasColumn() &amp;&amp; $data[<span class="stringliteral">&#39;xtype&#39;</span>] != <span class="stringliteral">&#39;radiofield&#39;</span>) {
            echo <span class="stringliteral">&#39;{ &quot;success&quot;: false, &quot;errors&quot;: { &quot;reason&quot;: &quot;Field \&quot;&#39;</span>.$this-&gt;col.<span class="stringliteral">&#39;\&quot; exist, please verify the form or change the Field \&quot;name\&quot; preoperty&quot; }}&#39;</span>;
        }<span class="keywordflow">else</span>{
            <span class="keywordflow">if</span>(!$container){

                <span class="keywordflow">if</span>(!$this-&gt;fieldHasColumn()){
                    $this-&gt;addColumn(<span class="stringliteral">&#39;VARCHAR(255)&#39;</span>);
                }
            }
            $data = $this-&gt;sinatizedData($data);
            $data = $this-&gt;setDefults($data);
            $field              = array();
            $field[<span class="stringliteral">&#39;form_id&#39;</span>]   = $data[<span class="stringliteral">&#39;form_id&#39;</span>];
            $field[<span class="stringliteral">&#39;xtype&#39;</span>]     = $data[<span class="stringliteral">&#39;xtype&#39;</span>];

            <span class="keywordflow">if</span>(isset($data[<span class="stringliteral">&#39;item_of&#39;</span>])){
                $field[<span class="stringliteral">&#39;item_of&#39;</span>] = $data[<span class="stringliteral">&#39;item_of&#39;</span>];
                unset($data[<span class="stringliteral">&#39;item_of&#39;</span>]);
            }

            unset($data[<span class="stringliteral">&#39;form_id&#39;</span>],$data[<span class="stringliteral">&#39;xtype&#39;</span>]);
            $sql = $this-&gt;<a class="code" href="classdb_helper.html#aa9840bbfb81d2d519994cd0a8e880c4a" title="SQL Bind.">sqlBind</a>($field, <span class="stringliteral">&quot;forms_fields&quot;</span>, <span class="stringliteral">&quot;I&quot;</span>);
            $this-&gt;<a class="code" href="classdb_helper.html#a21e387f778abae898a33b0355e56c095" title="Set the SQL Statement.">setSQL</a>($sql);
            $ret = $this-&gt;<a class="code" href="classdb_helper.html#a75dea4073687142b0b1b6a6819cbb243" title="Execute Log.">execLog</a>();
            $this-&gt;checkError($ret);
            $field_id = $this-&gt;lastInsertId;
            $this-&gt;insertOptions($data, $field_id);

            print <span class="stringliteral">&#39;{&quot;success&quot;:true}&#39;</span>;
        }
    }
</pre></div>
</div>
</div>
<a class="anchor" id="a383f52a44383e21583989705ef0d630d"></a><!-- doxytag: member="FormLayoutBuilder::deleteField" ref="a383f52a44383e21583989705ef0d630d" args="($data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_form_layout_builder.html#a383f52a44383e21583989705ef0d630d">deleteField</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function will delete the field and print success is no error were found along the way.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">$data</td><td></td></tr>
  </table>
  </dd>
</dl>
<p>lets defines what is a container for later use.</p>
<p>check for all kind ao error combination and exit the script if error found. If not, then continue.</p>
<p>for fieldcontainers and fieldsets lets make sure the field does NOT have child items</p>
<p>for all other fields lats check that the item has a column in the database and that the column is empty the user can NOT delete field with data in it.</p>
<p>If the field is NOT a container the remove database column for this field</p>
<p>remove field and field options</p>

<p>Definition at line <a class="el" href="_form_layout_builder_8php_source.html#l00172">172</a> of file <a class="el" href="_form_layout_builder_8php_source.html">FormLayoutBuilder.php</a>.</p>
<div class="fragment"><pre class="fragment">                                      {

        $this-&gt;getFormDataTable($data[<span class="stringliteral">&#39;form_id&#39;</span>]);
        $this-&gt;col = $data[<span class="stringliteral">&#39;name&#39;</span>];
        $container = <span class="keyword">false</span>;
        <span class="keywordflow">if</span>( $data[<span class="stringliteral">&#39;xtype&#39;</span>] == <span class="stringliteral">&#39;fieldcontainer&#39;</span> || $data[<span class="stringliteral">&#39;xtype&#39;</span>] == <span class="stringliteral">&#39;fieldset&#39;</span> ) $container = <span class="keyword">true</span>;

        <span class="keywordflow">if</span>($container){
            <span class="keywordflow">if</span>($this-&gt;fieldHasChild($data[<span class="stringliteral">&#39;id&#39;</span>])){
                echo <span class="stringliteral">&#39;{ &quot;success&quot;: false, &quot;errors&quot;: { &quot;reason&quot;: &quot;This field has one or more child field(s). Please, remove or moved the child fields before removeing this field.&quot; }}&#39;</span>;
                exit;
            }
        }<span class="keywordflow">else</span>{
            <span class="keywordflow">if</span>(!$this-&gt;fieldHasColumn()) {
                echo <span class="stringliteral">&#39;{ &quot;success&quot;: false, &quot;errors&quot;: { &quot;reason&quot;: &quot;This field does NOT have a column in the database.&lt;br&gt; This is very odd... please cotact Technical Support for help&quot; }}&#39;</span>;
                exit;
            }<span class="keywordflow">else</span>{
                <span class="keywordflow">if</span>($this-&gt;filedInUsed()){
                    echo <span class="stringliteral">&#39;{ &quot;success&quot;: false, &quot;errors&quot;: { &quot;reason&quot;: &quot;Can NOT delete this field. This field already has data store in the database.&quot; }}&#39;</span>;
                    exit;
                }
            }
        }

        <span class="keywordflow">if</span>(!$container &amp;&amp; !$this-&gt;fieldHasBrother()){
            $this-&gt;dropColumn();
        }
        $id = $data[<span class="stringliteral">&#39;id&#39;</span>];
        $this-&gt;<a class="code" href="classdb_helper.html#a21e387f778abae898a33b0355e56c095" title="Set the SQL Statement.">setSQL</a>(<span class="stringliteral">&quot;DELETE FROM forms_fields WHERE id=&#39;$id&#39;&quot;</span>);
        $ret = $this-&gt;<a class="code" href="classdb_helper.html#ae033db35138ae80f3b1fd33c5c2c473e" title="Execute Statement &quot;WITHOUT&quot; returning records.">execOnly</a>();
        $this-&gt;checkError($ret);
        $this-&gt;<a class="code" href="classdb_helper.html#a21e387f778abae898a33b0355e56c095" title="Set the SQL Statement.">setSQL</a>(<span class="stringliteral">&quot;DELETE FROM forms_field_options WHERE field_id=&#39;$id&#39;&quot;</span>);
        $ret = $this-&gt;<a class="code" href="classdb_helper.html#ae033db35138ae80f3b1fd33c5c2c473e" title="Execute Statement &quot;WITHOUT&quot; returning records.">execOnly</a>();
        $this-&gt;checkError($ret);

        print <span class="stringliteral">&#39;{&quot;success&quot;:true}&#39;</span>;
    }
</pre></div>
</div>
</div>
<a class="anchor" id="ac89522e4c6cb3d293adce3bd72e91827"></a><!-- doxytag: member="FormLayoutBuilder::getFormFieldsTree" ref="ac89522e4c6cb3d293adce3bd72e91827" args="(stdClass $params)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_form_layout_builder.html#ac89522e4c6cb3d293adce3bd72e91827">getFormFieldsTree</a> </td>
          <td>(</td>
          <td class="paramtype">stdClass $&#160;</td>
          <td class="paramname"><em>params</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramtype">stdClass</td><td class="paramname">$params</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>array </dd></dl>

<p>Definition at line <a class="el" href="_form_layout_builder_8php_source.html#l00485">485</a> of file <a class="el" href="_form_layout_builder_8php_source.html">FormLayoutBuilder.php</a>.</p>
<div class="fragment"><pre class="fragment">                                                       {
        $fields = array();

        $this-&gt;<a class="code" href="classdb_helper.html#a21e387f778abae898a33b0355e56c095" title="Set the SQL Statement.">setSQL</a>(<span class="stringliteral">&quot;Select * FROM forms_fields WHERE form_id = &#39;$params-&gt;currForm&#39; AND (item_of IS NULL OR item_of = &#39;0&#39;) ORDER BY pos ASC, id ASC&quot;</span>);
        $results = $this-&gt;<a class="code" href="classdb_helper.html#a43a2fa1fe095e37df5a641fe1cfc7d9c" title="Execute Statement.">execStatement</a>(PDO::FETCH_ASSOC);
        <span class="keywordflow">foreach</span>($results as $item){
            $opts = $this-&gt;getItmesOptions($item[<span class="stringliteral">&#39;id&#39;</span>]);
            <span class="keywordflow">foreach</span>($opts as $opt =&gt; $val){
                $item[$opt] = $val;
            }
            $item[<span class="stringliteral">&#39;children&#39;</span>] = $this-&gt;getChildItems($item[<span class="stringliteral">&#39;id&#39;</span>]);
            <span class="keywordflow">if</span>($item[<span class="stringliteral">&#39;children&#39;</span>] == null) {
                unset($item[<span class="stringliteral">&#39;children&#39;</span>]);
                <span class="keywordflow">if</span>($item[<span class="stringliteral">&#39;xtype&#39;</span>] != <span class="stringliteral">&#39;fieldset&#39;</span> &amp;&amp; $item[<span class="stringliteral">&#39;xtype&#39;</span>] != <span class="stringliteral">&#39;fieldcontainer&#39;</span>) $item[<span class="stringliteral">&#39;leaf&#39;</span>] = <span class="keyword">true</span>;
            }<span class="keywordflow">else</span>{
                <span class="keywordflow">if</span>($item[<span class="stringliteral">&#39;collapsed&#39;</span>] == <span class="stringliteral">&#39;collapsed&#39;</span>){
                    $item[<span class="stringliteral">&#39;expanded&#39;</span>] = <span class="keyword">false</span>;
                }<span class="keywordflow">else</span>{
                    $item[<span class="stringliteral">&#39;expanded&#39;</span>] = <span class="keyword">true</span>;
                }
            }
            array_push($fields,$item);
        }
        <span class="keywordflow">return</span> $fields;
    }
</pre></div>
</div>
</div>
<a class="anchor" id="a9ff1809bc98bb7a1526eb4e035c1ffa8"></a><!-- doxytag: member="FormLayoutBuilder::getForms" ref="a9ff1809bc98bb7a1526eb4e035c1ffa8" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_form_layout_builder.html#a9ff1809bc98bb7a1526eb4e035c1ffa8">getForms</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="return"><dt><b>Returns:</b></dt><dd>array </dd></dl>

<p>Definition at line <a class="el" href="_form_layout_builder_8php_source.html#l00449">449</a> of file <a class="el" href="_form_layout_builder_8php_source.html">FormLayoutBuilder.php</a>.</p>
<div class="fragment"><pre class="fragment">                              {
        $this-&gt;<a class="code" href="classdb_helper.html#a21e387f778abae898a33b0355e56c095" title="Set the SQL Statement.">setSQL</a>(<span class="stringliteral">&quot;SELECT * FROM forms_layout&quot;</span>);
        $rows = array();
        <span class="keywordflow">foreach</span>($this-&gt;<a class="code" href="classdb_helper.html#a43a2fa1fe095e37df5a641fe1cfc7d9c" title="Execute Statement.">execStatement</a>(PDO::FETCH_ASSOC) as $row){
            array_push($rows, $row);
        }
        <span class="keywordflow">return</span> $rows;
    }
</pre></div>
</div>
</div>
<a class="anchor" id="ad7d4c76349c0ed04f32ca58530ffd16b"></a><!-- doxytag: member="FormLayoutBuilder::getParentFields" ref="ad7d4c76349c0ed04f32ca58530ffd16b" args="(stdClass $params)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_form_layout_builder.html#ad7d4c76349c0ed04f32ca58530ffd16b">getParentFields</a> </td>
          <td>(</td>
          <td class="paramtype">stdClass $&#160;</td>
          <td class="paramname"><em>params</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramtype">stdClass</td><td class="paramname">$params</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>array </dd></dl>

<p>Definition at line <a class="el" href="_form_layout_builder_8php_source.html#l00462">462</a> of file <a class="el" href="_form_layout_builder_8php_source.html">FormLayoutBuilder.php</a>.</p>
<div class="fragment"><pre class="fragment">                                                     {
        $this-&gt;<a class="code" href="classdb_helper.html#a21e387f778abae898a33b0355e56c095" title="Set the SQL Statement.">setSQL</a>(<span class="stringliteral">&quot;Select CONCAT(fo.ovalue, &#39; (&#39;,ff.xtype ,&#39;)&#39; ) AS name, ff.id as value</span>
<span class="stringliteral">                         FROM forms_fields AS ff</span>
<span class="stringliteral">                    LEFT JOIN forms_field_options AS fo</span>
<span class="stringliteral">                           ON ff.id = fo.field_id</span>
<span class="stringliteral">                    LEFT JOIN forms_layout AS fl</span>
<span class="stringliteral">                           ON fl.id = ff.form_id</span>
<span class="stringliteral">                        WHERE (fl.name  = &#39;$params-&gt;currForm&#39; OR fl.id    = &#39;$params-&gt;currForm&#39;)</span>
<span class="stringliteral">                          AND (ff.xtype = &#39;fieldcontainer&#39;    OR ff.xtype = &#39;fieldset&#39;)</span>
<span class="stringliteral">                          AND (fo.oname = &#39;title&#39;             OR fo.oname = &#39;fieldLabel&#39;)</span>
<span class="stringliteral">                     ORDER BY pos&quot;</span>);
        $rows = array();
        array_push($rows, array(<span class="stringliteral">&#39;name&#39;</span> =&gt; <span class="stringliteral">&#39;Root&#39;</span>, <span class="stringliteral">&#39;value&#39;</span> =&gt; 0));
        <span class="keywordflow">foreach</span>($this-&gt;<a class="code" href="classdb_helper.html#a43a2fa1fe095e37df5a641fe1cfc7d9c" title="Execute Statement.">execStatement</a>(PDO::FETCH_ASSOC) as $row){
            array_push($rows, $row);
        }
       <span class="keywordflow">return</span> $rows;
    }
</pre></div>
</div>
</div>
<a class="anchor" id="afcb5238ce6ce86f873765792f9f18ad8"></a><!-- doxytag: member="FormLayoutBuilder::sortFields" ref="afcb5238ce6ce86f873765792f9f18ad8" args="($data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_form_layout_builder.html#afcb5238ce6ce86f873765792f9f18ad8">sortFields</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function sorts the fields when the drag and drop is use and print success if no error found along the way.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">$data</td><td></td></tr>
  </table>
  </dd>
</dl>
<p>set the field item_of to the paretn id and run the sql to update the item item_of column</p>
<p>here we set the pos column value, starting from 10. after updating the item pos, we add 10 to $pos and loop for each child item</p>

<p>Definition at line <a class="el" href="_form_layout_builder_8php_source.html#l00239">239</a> of file <a class="el" href="_form_layout_builder_8php_source.html">FormLayoutBuilder.php</a>.</p>
<div class="fragment"><pre class="fragment">                                     {
        $pos        = 10;
        $field      = array();
        $item       = $data[<span class="stringliteral">&#39;id&#39;</span>];
        $parentItem = $data[<span class="stringliteral">&#39;parentNode&#39;</span>];
        $childItems = $data[<span class="stringliteral">&#39;parentNodeChilds&#39;</span>];
        $field[<span class="stringliteral">&#39;item_of&#39;</span>] = $parentItem;
        $sql = $this-&gt;<a class="code" href="classdb_helper.html#aa9840bbfb81d2d519994cd0a8e880c4a" title="SQL Bind.">sqlBind</a>($field, <span class="stringliteral">&quot;forms_fields&quot;</span>, <span class="stringliteral">&quot;U&quot;</span>, <span class="stringliteral">&quot;id=&#39;$item&#39;&quot;</span>);
        $this-&gt;<a class="code" href="classdb_helper.html#a21e387f778abae898a33b0355e56c095" title="Set the SQL Statement.">setSQL</a>($sql);
        $ret = $this-&gt;<a class="code" href="classdb_helper.html#ae033db35138ae80f3b1fd33c5c2c473e" title="Execute Statement &quot;WITHOUT&quot; returning records.">execOnly</a>();
        $this-&gt;checkError($ret);
        <span class="keywordflow">foreach</span>($childItems as $child){
            $field[<span class="stringliteral">&#39;pos&#39;</span>] = $pos;
            $sql = $this-&gt;<a class="code" href="classdb_helper.html#aa9840bbfb81d2d519994cd0a8e880c4a" title="SQL Bind.">sqlBind</a>($field, <span class="stringliteral">&quot;forms_fields&quot;</span>, <span class="stringliteral">&quot;U&quot;</span>, <span class="stringliteral">&quot;id=&#39;$child&#39;&quot;</span>);
            $this-&gt;<a class="code" href="classdb_helper.html#a21e387f778abae898a33b0355e56c095" title="Set the SQL Statement.">setSQL</a>($sql);
            $ret = $this-&gt;<a class="code" href="classdb_helper.html#ae033db35138ae80f3b1fd33c5c2c473e" title="Execute Statement &quot;WITHOUT&quot; returning records.">execOnly</a>();
            $this-&gt;checkError($ret);
            $pos = $pos + 10;
        }

        print <span class="stringliteral">&#39;{&quot;success&quot;:true}&#39;</span>;
    }
</pre></div>
</div>
</div>
<a class="anchor" id="af1ac76169bfb7bbb995f000d5bb9ac2e"></a><!-- doxytag: member="FormLayoutBuilder::updateField" ref="af1ac76169bfb7bbb995f000d5bb9ac2e" args="($data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_form_layout_builder.html#af1ac76169bfb7bbb995f000d5bb9ac2e">updateField</a> </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function will update the fields and print the success callback if no errors found alog the way</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">$data</td><td></td></tr>
  </table>
  </dd>
</dl>
<p>sinatizedData check the data array and if the value is empty delete it form the array then checck the value and if is equal to "on" set it to true, and "off" set it to false</p>
<p>if not xtype fieldcontainer and fieldset the add some defaul values.</p>
<p>Here we start the $field array and add a few things from the $data array.</p>
<p>The $field arrray is use to update the forms_fields table. with the new xtype, form_id, item_of.</p>
<p>The $data array is use later to update the forms_field_options table.</p>
<p>if item_of is not empty add it the the $field array and remove it from the $data array</p>
<p>Exec the new field sql statement and store the its ID in $field_id to then store its options</p>
<p>delete old field options</p>
<p>take the remaining $data array and insert it in the forms_field_options table one by one.</p>

<p>Definition at line <a class="el" href="_form_layout_builder_8php_source.html#l00106">106</a> of file <a class="el" href="_form_layout_builder_8php_source.html">FormLayoutBuilder.php</a>.</p>
<div class="fragment"><pre class="fragment">                                      {
        $data = $this-&gt;sinatizedData($data);
        $data = $this-&gt;setDefults($data);
        $field              = array();
        $id                 = $data[<span class="stringliteral">&#39;id&#39;</span>];
        $field[<span class="stringliteral">&#39;form_id&#39;</span>]   = $data[<span class="stringliteral">&#39;form_id&#39;</span>];
        $field[<span class="stringliteral">&#39;xtype&#39;</span>]     = $data[<span class="stringliteral">&#39;xtype&#39;</span>];
        <span class="keywordflow">if</span>(isset($data[<span class="stringliteral">&#39;item_of&#39;</span>])){
            $field[<span class="stringliteral">&#39;item_of&#39;</span>] = $data[<span class="stringliteral">&#39;item_of&#39;</span>];
            unset($data[<span class="stringliteral">&#39;item_of&#39;</span>]);
        }

        unset($data[<span class="stringliteral">&#39;form_id&#39;</span>],$data[<span class="stringliteral">&#39;xtype&#39;</span>],$data[<span class="stringliteral">&#39;id&#39;</span>]);
        $sql = $this-&gt;<a class="code" href="classdb_helper.html#aa9840bbfb81d2d519994cd0a8e880c4a" title="SQL Bind.">sqlBind</a>($field, <span class="stringliteral">&quot;forms_fields&quot;</span>, <span class="stringliteral">&quot;U&quot;</span>, <span class="stringliteral">&quot;id=&#39;$id&#39;&quot;</span>);
        $this-&gt;<a class="code" href="classdb_helper.html#a21e387f778abae898a33b0355e56c095" title="Set the SQL Statement.">setSQL</a>($sql);
        $ret = $this-&gt;<a class="code" href="classdb_helper.html#a75dea4073687142b0b1b6a6819cbb243" title="Execute Log.">execLog</a>();
        $this-&gt;checkError($ret);
        $this-&gt;<a class="code" href="classdb_helper.html#a21e387f778abae898a33b0355e56c095" title="Set the SQL Statement.">setSQL</a>(<span class="stringliteral">&quot;DELETE FROM forms_field_options WHERE field_id=&#39;$id&#39;&quot;</span>);
        $ret = $this-&gt;<a class="code" href="classdb_helper.html#ae033db35138ae80f3b1fd33c5c2c473e" title="Execute Statement &quot;WITHOUT&quot; returning records.">execOnly</a>();
        $this-&gt;checkError($ret);
        $this-&gt;insertOptions($data, $id);

        print <span class="stringliteral">&#39;{&quot;success&quot;: true }&#39;</span>;
    }
</pre></div>
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>C:/wamp/www/MitosEHR/classes/<a class="el" href="_form_layout_builder_8php_source.html">FormLayoutBuilder.php</a></li>
</ul>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="class_form_layout_builder.html">FormLayoutBuilder</a>      </li>

    <li class="footer">Generated on Mon Feb 6 2012 14:43:42 for MitosEHR by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
