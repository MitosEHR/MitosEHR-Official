<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>MitosEHR: C:/wamp/www/MitosEHR/lib/phpThumbs-1.7.9/phpthumb.functions.php Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="logo_medium.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">MitosEHR
   &#160;<span id="projectnumber">Vega v1.0</span>
   </div>
   <div id="projectbrief">Electronic Health Record</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('phpthumb_8functions_8php.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">C:/wamp/www/MitosEHR/lib/phpThumbs-1.7.9/phpthumb.functions.php</div>  </div>
</div><!--header-->
<div class="contents">
<a href="phpthumb_8functions_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00004"></a>00004 <span class="comment">//        available at http://phpthumb.sourceforge.net     ///</span>
<a name="l00007"></a>00007 <span class="comment"></span><span class="comment">// phpthumb.functions.php - general support functions       //</span>
<a name="l00008"></a>00008 <span class="comment">//                                                         ///</span>
<a name="l00010"></a>00010 <span class="comment"></span>
<a name="l00011"></a><a class="code" href="classphpthumb__functions.html">00011</a> <span class="keyword">class </span><a class="code" href="classphpthumb__functions.html">phpthumb_functions</a> {
<a name="l00012"></a>00012 
<a name="l00013"></a><a class="code" href="classphpthumb__functions.html#ac2890f15a3ea4a6ea63adca8f7f489a8">00013</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#ac2890f15a3ea4a6ea63adca8f7f489a8">user_function_exists</a>($functionname) {
<a name="l00014"></a>00014                 <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;get_defined_functions&#39;</span>)) {
<a name="l00015"></a>00015                         <span class="keyword">static</span> $get_defined_functions = array();
<a name="l00016"></a>00016                         <span class="keywordflow">if</span> (empty($get_defined_functions)) {
<a name="l00017"></a>00017                                 $get_defined_functions = get_defined_functions();
<a name="l00018"></a>00018                         }
<a name="l00019"></a>00019                         <span class="keywordflow">return</span> in_array(strtolower($functionname), $get_defined_functions[<span class="stringliteral">&#39;user&#39;</span>]);
<a name="l00020"></a>00020                 }
<a name="l00021"></a>00021                 <span class="keywordflow">return</span> function_exists($functionname);
<a name="l00022"></a>00022         }
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 
<a name="l00025"></a><a class="code" href="classphpthumb__functions.html#af8479c23712b7ac1502d1d7fc76b7670">00025</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#af8479c23712b7ac1502d1d7fc76b7670">builtin_function_exists</a>($functionname) {
<a name="l00026"></a>00026                 <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;get_defined_functions&#39;</span>)) {
<a name="l00027"></a>00027                         <span class="keyword">static</span> $get_defined_functions = array();
<a name="l00028"></a>00028                         <span class="keywordflow">if</span> (empty($get_defined_functions)) {
<a name="l00029"></a>00029                                 $get_defined_functions = get_defined_functions();
<a name="l00030"></a>00030                         }
<a name="l00031"></a>00031                         <span class="keywordflow">return</span> in_array(strtolower($functionname), $get_defined_functions[<span class="stringliteral">&#39;internal&#39;</span>]);
<a name="l00032"></a>00032                 }
<a name="l00033"></a>00033                 <span class="keywordflow">return</span> function_exists($functionname);
<a name="l00034"></a>00034         }
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 
<a name="l00037"></a><a class="code" href="classphpthumb__functions.html#a66d2b067747c447ecd3d48dd6830ea78">00037</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#a66d2b067747c447ecd3d48dd6830ea78">version_compare_replacement_sub</a>($version1, $version2, $operator=<span class="stringliteral">&#39;&#39;</span>) {
<a name="l00038"></a>00038                 <span class="comment">// If you specify the third optional operator argument, you can test for a particular relationship.</span>
<a name="l00039"></a>00039                 <span class="comment">// The possible operators are: &lt;, lt, &lt;=, le, &gt;, gt, &gt;=, ge, ==, =, eq, !=, &lt;&gt;, ne respectively.</span>
<a name="l00040"></a>00040                 <span class="comment">// Using this argument, the function will return 1 if the relationship is the one specified by the operator, 0 otherwise.</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042                 <span class="comment">// If a part contains special version strings these are handled in the following order: dev &lt; (alpha = a) &lt; (beta = b) &lt; RC &lt; pl</span>
<a name="l00043"></a>00043                 <span class="keyword">static</span> $versiontype_lookup = array();
<a name="l00044"></a>00044                 <span class="keywordflow">if</span> (empty($versiontype_lookup)) {
<a name="l00045"></a>00045                         $versiontype_lookup[<span class="stringliteral">&#39;dev&#39;</span>]   = 10001;
<a name="l00046"></a>00046                         $versiontype_lookup[<span class="charliteral">&#39;a&#39;</span>]     = 10002;
<a name="l00047"></a>00047                         $versiontype_lookup[<span class="stringliteral">&#39;alpha&#39;</span>] = 10002;
<a name="l00048"></a>00048                         $versiontype_lookup[<span class="charliteral">&#39;b&#39;</span>]     = 10003;
<a name="l00049"></a>00049                         $versiontype_lookup[<span class="stringliteral">&#39;beta&#39;</span>]  = 10003;
<a name="l00050"></a>00050                         $versiontype_lookup[<span class="stringliteral">&#39;RC&#39;</span>]    = 10004;
<a name="l00051"></a>00051                         $versiontype_lookup[<span class="stringliteral">&#39;pl&#39;</span>]    = 10005;
<a name="l00052"></a>00052                 }
<a name="l00053"></a>00053                 <span class="keywordflow">if</span> (isset($versiontype_lookup[$version1])) {
<a name="l00054"></a>00054                         $version1 = $versiontype_lookup[$version1];
<a name="l00055"></a>00055                 }
<a name="l00056"></a>00056                 <span class="keywordflow">if</span> (isset($versiontype_lookup[$version2])) {
<a name="l00057"></a>00057                         $version2 = $versiontype_lookup[$version2];
<a name="l00058"></a>00058                 }
<a name="l00059"></a>00059 
<a name="l00060"></a>00060                 <span class="keywordflow">switch</span> ($operator) {
<a name="l00061"></a>00061                         <span class="keywordflow">case</span> <span class="charliteral">&#39;&lt;&#39;</span>:
<a name="l00062"></a>00062                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;lt&#39;</span>:
<a name="l00063"></a>00063                                 <span class="keywordflow">return</span> intval($version1 &lt; $version2);
<a name="l00064"></a>00064                                 <span class="keywordflow">break</span>;
<a name="l00065"></a>00065                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;&lt;=&#39;</span>:
<a name="l00066"></a>00066                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;le&#39;</span>:
<a name="l00067"></a>00067                                 <span class="keywordflow">return</span> intval($version1 &lt;= $version2);
<a name="l00068"></a>00068                                 <span class="keywordflow">break</span>;
<a name="l00069"></a>00069                         <span class="keywordflow">case</span> <span class="charliteral">&#39;&gt;&#39;</span>:
<a name="l00070"></a>00070                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;gt&#39;</span>:
<a name="l00071"></a>00071                                 <span class="keywordflow">return</span> intval($version1 &gt; $version2);
<a name="l00072"></a>00072                                 <span class="keywordflow">break</span>;
<a name="l00073"></a>00073                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;&gt;=&#39;</span>:
<a name="l00074"></a>00074                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;ge&#39;</span>:
<a name="l00075"></a>00075                                 <span class="keywordflow">return</span> intval($version1 &gt;= $version2);
<a name="l00076"></a>00076                                 <span class="keywordflow">break</span>;
<a name="l00077"></a>00077                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;==&#39;</span>:
<a name="l00078"></a>00078                         <span class="keywordflow">case</span> <span class="charliteral">&#39;=&#39;</span>:
<a name="l00079"></a>00079                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;eq&#39;</span>:
<a name="l00080"></a>00080                                 <span class="keywordflow">return</span> intval($version1 == $version2);
<a name="l00081"></a>00081                                 <span class="keywordflow">break</span>;
<a name="l00082"></a>00082                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;!=&#39;</span>:
<a name="l00083"></a>00083                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;&lt;&gt;&#39;</span>:
<a name="l00084"></a>00084                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;ne&#39;</span>:
<a name="l00085"></a>00085                                 <span class="keywordflow">return</span> intval($version1 != $version2);
<a name="l00086"></a>00086                                 <span class="keywordflow">break</span>;
<a name="l00087"></a>00087                 }
<a name="l00088"></a>00088                 <span class="keywordflow">if</span> ($version1 == $version2) {
<a name="l00089"></a>00089                         <span class="keywordflow">return</span> 0;
<a name="l00090"></a>00090                 } <a class="code" href="php_thumb_8demo_8check_8php.html#af92779326267616cd7c3cdaaa9484bc9">elseif</a> ($version1 &lt; $version2) {
<a name="l00091"></a>00091                         <span class="keywordflow">return</span> -1;
<a name="l00092"></a>00092                 }
<a name="l00093"></a>00093                 <span class="keywordflow">return</span> 1;
<a name="l00094"></a>00094         }
<a name="l00095"></a>00095 
<a name="l00096"></a>00096 
<a name="l00097"></a><a class="code" href="classphpthumb__functions.html#af53f41b3482e6bed2082daa0ebfd96c0">00097</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#af53f41b3482e6bed2082daa0ebfd96c0">version_compare_replacement</a>($version1, $version2, $operator=<span class="stringliteral">&#39;&#39;</span>) {
<a name="l00098"></a>00098                 <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;version_compare&#39;</span>)) {
<a name="l00099"></a>00099                         <span class="comment">// built into PHP v4.1.0+</span>
<a name="l00100"></a>00100                         <span class="keywordflow">return</span> version_compare($version1, $version2, $operator);
<a name="l00101"></a>00101                 }
<a name="l00102"></a>00102 
<a name="l00103"></a>00103                 <span class="comment">// The function first replaces _, - and + with a dot . in the version strings</span>
<a name="l00104"></a>00104                 $version1 = strtr($version1, <span class="stringliteral">&#39;_-+&#39;</span>, <span class="stringliteral">&#39;...&#39;</span>);
<a name="l00105"></a>00105                 $version2 = strtr($version2, <span class="stringliteral">&#39;_-+&#39;</span>, <span class="stringliteral">&#39;...&#39;</span>);
<a name="l00106"></a>00106 
<a name="l00107"></a>00107                 <span class="comment">// and also inserts dots . before and after any non number so that for example &#39;4.3.2RC1&#39; becomes &#39;4.3.2.RC.1&#39;.</span>
<a name="l00108"></a>00108                 <span class="comment">// Then it splits the results like if you were using explode(&#39;.&#39;,$ver). Then it compares the parts starting from left to right.</span>
<a name="l00109"></a>00109                 $version1 = eregi_replace(<span class="stringliteral">&#39;([0-9]+)([A-Z]+)([0-9]+)&#39;</span>, <span class="stringliteral">&#39;\\1.\\2.\\3&#39;</span>, $version1);
<a name="l00110"></a>00110                 $version2 = eregi_replace(<span class="stringliteral">&#39;([0-9]+)([A-Z]+)([0-9]+)&#39;</span>, <span class="stringliteral">&#39;\\1.\\2.\\3&#39;</span>, $version2);
<a name="l00111"></a>00111 
<a name="l00112"></a>00112                 $parts1 = explode(<span class="charliteral">&#39;.&#39;</span>, $version1);
<a name="l00113"></a>00113                 $parts2 = explode(<span class="charliteral">&#39;.&#39;</span>, $version1);
<a name="l00114"></a>00114                 $parts_count = max(count($parts1), count($parts2));
<a name="l00115"></a>00115                 <span class="keywordflow">for</span> ($i = 0; $i &lt; $parts_count; $i++) {
<a name="l00116"></a>00116                         $comparison = <a class="code" href="classphpthumb__functions.html#a66d2b067747c447ecd3d48dd6830ea78">phpthumb_functions::version_compare_replacement_sub</a>($version1, $version2, $operator);
<a name="l00117"></a>00117                         <span class="keywordflow">if</span> ($comparison != 0) {
<a name="l00118"></a>00118                                 <span class="keywordflow">return</span> $comparison;
<a name="l00119"></a>00119                         }
<a name="l00120"></a>00120                 }
<a name="l00121"></a>00121                 <span class="keywordflow">return</span> 0;
<a name="l00122"></a>00122         }
<a name="l00123"></a>00123 
<a name="l00124"></a>00124 
<a name="l00125"></a><a class="code" href="classphpthumb__functions.html#a999167c99797fa10b27c9f9d8d4d6814">00125</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#a999167c99797fa10b27c9f9d8d4d6814">phpinfo_array</a>() {
<a name="l00126"></a>00126                 <span class="keyword">static</span> $phpinfo_array = array();
<a name="l00127"></a>00127                 <span class="keywordflow">if</span> (empty($phpinfo_array)) {
<a name="l00128"></a>00128                         ob_start();
<a name="l00129"></a>00129                         phpinfo();
<a name="l00130"></a>00130                         $phpinfo = ob_get_contents();
<a name="l00131"></a>00131                         ob_end_clean();
<a name="l00132"></a>00132                         $phpinfo_array = explode(<span class="stringliteral">&quot;\n&quot;</span>, $phpinfo);
<a name="l00133"></a>00133                 }
<a name="l00134"></a>00134                 <span class="keywordflow">return</span> $phpinfo_array;
<a name="l00135"></a>00135         }
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 
<a name="l00138"></a><a class="code" href="classphpthumb__functions.html#a6b7e8055a24dbfa6519a817282f5fedb">00138</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#a6b7e8055a24dbfa6519a817282f5fedb">exif_info</a>() {
<a name="l00139"></a>00139                 <span class="keyword">static</span> $exif_info = array();
<a name="l00140"></a>00140                 <span class="keywordflow">if</span> (empty($exif_info)) {
<a name="l00141"></a>00141                         <span class="comment">// based on code by johnschaefer at gmx dot de</span>
<a name="l00142"></a>00142                         <span class="comment">// from PHP help on gd_info()</span>
<a name="l00143"></a>00143                         $exif_info = array(
<a name="l00144"></a>00144                                 <span class="stringliteral">&#39;EXIF Support&#39;</span>           =&gt; <span class="stringliteral">&#39;&#39;</span>,
<a name="l00145"></a>00145                                 <span class="stringliteral">&#39;EXIF Version&#39;</span>           =&gt; <span class="stringliteral">&#39;&#39;</span>,
<a name="l00146"></a>00146                                 <span class="stringliteral">&#39;Supported EXIF Version&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,
<a name="l00147"></a>00147                                 <span class="stringliteral">&#39;Supported filetypes&#39;</span>    =&gt; <span class="stringliteral">&#39;&#39;</span>
<a name="l00148"></a>00148                         );
<a name="l00149"></a>00149                         $phpinfo_array = <a class="code" href="classphpthumb__functions.html#a999167c99797fa10b27c9f9d8d4d6814">phpthumb_functions::phpinfo_array</a>();
<a name="l00150"></a>00150                         <span class="keywordflow">foreach</span> ($phpinfo_array as <a class="code" href="tokenizer__test_8php.html#a52f469b0182d9abac2d0f20548680c9c">$line</a>) {
<a name="l00151"></a>00151                                 $line = trim(strip_tags($line));
<a name="l00152"></a>00152                                 <span class="keywordflow">foreach</span> ($exif_info as $key =&gt; $value) {
<a name="l00153"></a>00153                                         <span class="keywordflow">if</span> (strpos($line, $key) === 0) {
<a name="l00154"></a>00154                                                 $newvalue = trim(str_replace($key, <span class="stringliteral">&#39;&#39;</span>, $line));
<a name="l00155"></a>00155                                                 $exif_info[$key] = $newvalue;
<a name="l00156"></a>00156                                         }
<a name="l00157"></a>00157                                 }
<a name="l00158"></a>00158                         }
<a name="l00159"></a>00159                 }
<a name="l00160"></a>00160                 <span class="keywordflow">return</span> $exif_info;
<a name="l00161"></a>00161         }
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 
<a name="l00164"></a><a class="code" href="classphpthumb__functions.html#af58958c94226ace6fd0facaf44a3cd6d">00164</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#af58958c94226ace6fd0facaf44a3cd6d">ImageTypeToMIMEtype</a>($imagetype) {
<a name="l00165"></a>00165                 <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;image_type_to_mime_type&#39;</span>) &amp;&amp; ($imagetype &gt;= 1) &amp;&amp; ($imagetype &lt;= 16)) {
<a name="l00166"></a>00166                         <span class="comment">// PHP v4.3.0+</span>
<a name="l00167"></a>00167                         <span class="keywordflow">return</span> image_type_to_mime_type($imagetype);
<a name="l00168"></a>00168                 }
<a name="l00169"></a>00169                 <span class="keyword">static</span> $image_type_to_mime_type = array(
<a name="l00170"></a>00170                         1  =&gt; <span class="stringliteral">&#39;image/gif&#39;</span>,                     <span class="comment">// IMAGETYPE_GIF</span>
<a name="l00171"></a>00171                         2  =&gt; <span class="stringliteral">&#39;image/jpeg&#39;</span>,                    <span class="comment">// IMAGETYPE_JPEG</span>
<a name="l00172"></a>00172                         3  =&gt; <span class="stringliteral">&#39;image/png&#39;</span>,                     <span class="comment">// IMAGETYPE_PNG</span>
<a name="l00173"></a>00173                         4  =&gt; <span class="stringliteral">&#39;application/x-shockwave-flash&#39;</span>, <span class="comment">// IMAGETYPE_SWF</span>
<a name="l00174"></a>00174                         5  =&gt; <span class="stringliteral">&#39;image/psd&#39;</span>,                     <span class="comment">// IMAGETYPE_PSD</span>
<a name="l00175"></a>00175                         6  =&gt; <span class="stringliteral">&#39;image/bmp&#39;</span>,                     <span class="comment">// IMAGETYPE_BMP</span>
<a name="l00176"></a>00176                         7  =&gt; <span class="stringliteral">&#39;image/tiff&#39;</span>,                    <span class="comment">// IMAGETYPE_TIFF_II (intel byte order)</span>
<a name="l00177"></a>00177                         8  =&gt; <span class="stringliteral">&#39;image/tiff&#39;</span>,                    <span class="comment">// IMAGETYPE_TIFF_MM (motorola byte order)</span>
<a name="l00178"></a>00178                         9  =&gt; <span class="stringliteral">&#39;application/octet-stream&#39;</span>,      <span class="comment">// IMAGETYPE_JPC</span>
<a name="l00179"></a>00179                         10 =&gt; <span class="stringliteral">&#39;image/jp2&#39;</span>,                     <span class="comment">// IMAGETYPE_JP2</span>
<a name="l00180"></a>00180                         11 =&gt; <span class="stringliteral">&#39;application/octet-stream&#39;</span>,      <span class="comment">// IMAGETYPE_JPX</span>
<a name="l00181"></a>00181                         12 =&gt; <span class="stringliteral">&#39;application/octet-stream&#39;</span>,      <span class="comment">// IMAGETYPE_JB2</span>
<a name="l00182"></a>00182                         13 =&gt; <span class="stringliteral">&#39;application/x-shockwave-flash&#39;</span>, <span class="comment">// IMAGETYPE_SWC</span>
<a name="l00183"></a>00183                         14 =&gt; <span class="stringliteral">&#39;image/iff&#39;</span>,                     <span class="comment">// IMAGETYPE_IFF</span>
<a name="l00184"></a>00184                         15 =&gt; <span class="stringliteral">&#39;image/vnd.wap.wbmp&#39;</span>,            <span class="comment">// IMAGETYPE_WBMP</span>
<a name="l00185"></a>00185                         16 =&gt; <span class="stringliteral">&#39;image/xbm&#39;</span>,                     <span class="comment">// IMAGETYPE_XBM</span>
<a name="l00186"></a>00186 
<a name="l00187"></a>00187                         <span class="stringliteral">&#39;gif&#39;</span>  =&gt; <span class="stringliteral">&#39;image/gif&#39;</span>,                 <span class="comment">// IMAGETYPE_GIF</span>
<a name="l00188"></a>00188                         <span class="stringliteral">&#39;jpg&#39;</span>  =&gt; <span class="stringliteral">&#39;image/jpeg&#39;</span>,                <span class="comment">// IMAGETYPE_JPEG</span>
<a name="l00189"></a>00189                         <span class="stringliteral">&#39;jpeg&#39;</span> =&gt; <span class="stringliteral">&#39;image/jpeg&#39;</span>,                <span class="comment">// IMAGETYPE_JPEG</span>
<a name="l00190"></a>00190                         <span class="stringliteral">&#39;png&#39;</span>  =&gt; <span class="stringliteral">&#39;image/png&#39;</span>,                 <span class="comment">// IMAGETYPE_PNG</span>
<a name="l00191"></a>00191                         <span class="stringliteral">&#39;bmp&#39;</span>  =&gt; <span class="stringliteral">&#39;image/bmp&#39;</span>,                 <span class="comment">// IMAGETYPE_BMP</span>
<a name="l00192"></a>00192                         <span class="stringliteral">&#39;ico&#39;</span>  =&gt; <span class="stringliteral">&#39;image/x-icon&#39;</span>,
<a name="l00193"></a>00193                 );
<a name="l00194"></a>00194 
<a name="l00195"></a>00195                 <span class="keywordflow">return</span> (isset($image_type_to_mime_type[$imagetype]) ? $image_type_to_mime_type[$imagetype] : <span class="keyword">false</span>);
<a name="l00196"></a>00196         }
<a name="l00197"></a>00197 
<a name="l00198"></a>00198 
<a name="l00199"></a><a class="code" href="classphpthumb__functions.html#a9fdbba8c153ac6c99299545f0109dd70">00199</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#a9fdbba8c153ac6c99299545f0109dd70">TranslateWHbyAngle</a>($width, $height, $angle) {
<a name="l00200"></a>00200                 <span class="keywordflow">if</span> (($angle % 180) == 0) {
<a name="l00201"></a>00201                         <span class="keywordflow">return</span> array($width, $height);
<a name="l00202"></a>00202                 }
<a name="l00203"></a>00203                 $newwidth  = (abs(sin(deg2rad($angle))) * $height) + (abs(cos(deg2rad($angle))) * $width);
<a name="l00204"></a>00204                 $newheight = (abs(sin(deg2rad($angle))) * $width)  + (abs(cos(deg2rad($angle))) * $height);
<a name="l00205"></a>00205                 <span class="keywordflow">return</span> array($newwidth, $newheight);
<a name="l00206"></a>00206         }
<a name="l00207"></a>00207 
<a name="l00208"></a><a class="code" href="classphpthumb__functions.html#a990a73d0fe31b520e04251295aeded25">00208</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#a990a73d0fe31b520e04251295aeded25">HexCharDisplay</a>($string) {
<a name="l00209"></a>00209                 $len = strlen($string);
<a name="l00210"></a>00210                 <a class="code" href="create__examples_8php.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00211"></a>00211                 <span class="keywordflow">for</span> ($i = 0; $i &lt; $len; $i++) {
<a name="l00212"></a>00212                         <a class="code" href="create__examples_8php.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> .= <span class="stringliteral">&#39; 0x&#39;</span>.str_pad(dechex(ord($string{$i})), 2, <span class="charliteral">&#39;0&#39;</span>, STR_PAD_LEFT);
<a name="l00213"></a>00213                 }
<a name="l00214"></a>00214                 <span class="keywordflow">return</span> <a class="code" href="create__examples_8php.html#a73004ce9cd673c1bfafd1dc351134797">$output</a>;
<a name="l00215"></a>00215         }
<a name="l00216"></a>00216 
<a name="l00217"></a>00217 
<a name="l00218"></a><a class="code" href="classphpthumb__functions.html#aa88047663adfed917d5fb0bece3913b8">00218</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#aa88047663adfed917d5fb0bece3913b8">IsHexColor</a>($HexColorString) {
<a name="l00219"></a>00219                 <span class="keywordflow">return</span> eregi(<span class="stringliteral">&#39;^[0-9A-F]{6}$&#39;</span>, $HexColorString);
<a name="l00220"></a>00220         }
<a name="l00221"></a>00221 
<a name="l00222"></a>00222 
<a name="l00223"></a><a class="code" href="classphpthumb__functions.html#ab43fe1af0d0c46288c2ffcf3905a7b42">00223</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#ab43fe1af0d0c46288c2ffcf3905a7b42">ImageColorAllocateAlphaSafe</a>(&amp;$gdimg_hexcolorallocate, $R, $G, $B, $alpha=<span class="keyword">false</span>) {
<a name="l00224"></a>00224                 <span class="keywordflow">if</span> (<a class="code" href="classphpthumb__functions.html#af53f41b3482e6bed2082daa0ebfd96c0">phpthumb_functions::version_compare_replacement</a>(phpversion(), <span class="stringliteral">&#39;4.3.2&#39;</span>, <span class="stringliteral">&#39;&gt;=&#39;</span>) &amp;&amp; ($alpha !== <span class="keyword">false</span>)) {
<a name="l00225"></a>00225                         <span class="keywordflow">return</span> ImageColorAllocateAlpha($gdimg_hexcolorallocate, $R, $G, $B, intval($alpha));
<a name="l00226"></a>00226                 } <span class="keywordflow">else</span> {
<a name="l00227"></a>00227                         <span class="keywordflow">return</span> ImageColorAllocate($gdimg_hexcolorallocate, $R, $G, $B);
<a name="l00228"></a>00228                 }
<a name="l00229"></a>00229         }
<a name="l00230"></a>00230 
<a name="l00231"></a><a class="code" href="classphpthumb__functions.html#a9a63d0b70df4136de64ab0cd351e7ff3">00231</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#a9a63d0b70df4136de64ab0cd351e7ff3">ImageHexColorAllocate</a>(&amp;$gdimg_hexcolorallocate, $HexColorString, $dieOnInvalid=<span class="keyword">false</span>, $alpha=<span class="keyword">false</span>) {
<a name="l00232"></a>00232                 <span class="keywordflow">if</span> (!is_resource($gdimg_hexcolorallocate)) {
<a name="l00233"></a>00233                         die(<span class="stringliteral">&#39;$gdimg_hexcolorallocate is not a GD resource in ImageHexColorAllocate()&#39;</span>);
<a name="l00234"></a>00234                 }
<a name="l00235"></a>00235                 <span class="keywordflow">if</span> (<a class="code" href="classphpthumb__functions.html#aa88047663adfed917d5fb0bece3913b8">phpthumb_functions::IsHexColor</a>($HexColorString)) {
<a name="l00236"></a>00236                         $R = hexdec(substr($HexColorString, 0, 2));
<a name="l00237"></a>00237                         $G = hexdec(substr($HexColorString, 2, 2));
<a name="l00238"></a>00238                         $B = hexdec(substr($HexColorString, 4, 2));
<a name="l00239"></a>00239                         <span class="keywordflow">return</span> <a class="code" href="classphpthumb__functions.html#ab43fe1af0d0c46288c2ffcf3905a7b42">phpthumb_functions::ImageColorAllocateAlphaSafe</a>($gdimg_hexcolorallocate, $R, $G, $B, $alpha);
<a name="l00240"></a>00240                 }
<a name="l00241"></a>00241                 <span class="keywordflow">if</span> ($dieOnInvalid) {
<a name="l00242"></a>00242                         die(<span class="stringliteral">&#39;Invalid hex color string: &quot;&#39;</span>.$HexColorString.<span class="charliteral">&#39;&quot;&#39;</span>);
<a name="l00243"></a>00243                 }
<a name="l00244"></a>00244                 <span class="keywordflow">return</span> ImageColorAllocate($gdimg_hexcolorallocate, 0x00, 0x00, 0x00);
<a name="l00245"></a>00245         }
<a name="l00246"></a>00246 
<a name="l00247"></a>00247 
<a name="l00248"></a><a class="code" href="classphpthumb__functions.html#aead056424cb4681dbe161bce8683da3b">00248</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#aead056424cb4681dbe161bce8683da3b">HexColorXOR</a>($hexcolor) {
<a name="l00249"></a>00249                 <span class="keywordflow">return</span> strtoupper(str_pad(dechex(~hexdec($hexcolor) &amp; 0xFFFFFF), 6, <span class="charliteral">&#39;0&#39;</span>, STR_PAD_LEFT));
<a name="l00250"></a>00250         }
<a name="l00251"></a>00251 
<a name="l00252"></a>00252 
<a name="l00253"></a><a class="code" href="classphpthumb__functions.html#ac73caf77553f599f9bdb88c03281b33b">00253</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#ac73caf77553f599f9bdb88c03281b33b">GetPixelColor</a>(&amp;$img, $x, $y) {
<a name="l00254"></a>00254                 <span class="keywordflow">if</span> (!is_resource($img)) {
<a name="l00255"></a>00255                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00256"></a>00256                 }
<a name="l00257"></a>00257                 <span class="keywordflow">return</span> @ImageColorsForIndex($img, @ImageColorAt($img, $x, $y));
<a name="l00258"></a>00258         }
<a name="l00259"></a>00259 
<a name="l00260"></a>00260 
<a name="l00261"></a><a class="code" href="classphpthumb__functions.html#a21903a1bd6f92685f0c3188c9776801a">00261</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#a21903a1bd6f92685f0c3188c9776801a">PixelColorDifferencePercent</a>($currentPixel, $targetPixel) {
<a name="l00262"></a>00262                 $diff = 0;
<a name="l00263"></a>00263                 <span class="keywordflow">foreach</span> ($targetPixel as $channel =&gt; $currentvalue) {
<a name="l00264"></a>00264                         $diff = max($diff, (max($currentPixel[$channel], $targetPixel[$channel]) - min($currentPixel[$channel], $targetPixel[$channel])) / 255);
<a name="l00265"></a>00265                 }
<a name="l00266"></a>00266                 <span class="keywordflow">return</span> $diff * 100;
<a name="l00267"></a>00267         }
<a name="l00268"></a>00268 
<a name="l00269"></a><a class="code" href="classphpthumb__functions.html#af419a3a071e831a2c4de93b73f3e7063">00269</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#af419a3a071e831a2c4de93b73f3e7063">GrayscaleValue</a>($r, $g, $b) {
<a name="l00270"></a>00270                 <span class="keywordflow">return</span> round(($r * 0.30) + ($g * 0.59) + ($b * 0.11));
<a name="l00271"></a>00271         }
<a name="l00272"></a>00272 
<a name="l00273"></a>00273 
<a name="l00274"></a><a class="code" href="classphpthumb__functions.html#a5f3d1f38c5a6c3a5b83a8f96042ffef5">00274</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#a5f3d1f38c5a6c3a5b83a8f96042ffef5">GrayscalePixel</a>($OriginalPixel) {
<a name="l00275"></a>00275                 $gray = <a class="code" href="classphpthumb__functions.html#af419a3a071e831a2c4de93b73f3e7063">phpthumb_functions::GrayscaleValue</a>($OriginalPixel[<span class="stringliteral">&#39;red&#39;</span>], $OriginalPixel[<span class="stringliteral">&#39;green&#39;</span>], $OriginalPixel[<span class="stringliteral">&#39;blue&#39;</span>]);
<a name="l00276"></a>00276                 <span class="keywordflow">return</span> array(<span class="stringliteral">&#39;red&#39;</span>=&gt;$gray, <span class="stringliteral">&#39;green&#39;</span>=&gt;$gray, <span class="stringliteral">&#39;blue&#39;</span>=&gt;$gray);
<a name="l00277"></a>00277         }
<a name="l00278"></a>00278 
<a name="l00279"></a>00279 
<a name="l00280"></a><a class="code" href="classphpthumb__functions.html#a64ab911b4f9a7bf2d8e103ab97c96a8b">00280</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#a64ab911b4f9a7bf2d8e103ab97c96a8b">GrayscalePixelRGB</a>($rgb) {
<a name="l00281"></a>00281                 $r = ($rgb &gt;&gt; 16) &amp; 0xFF;
<a name="l00282"></a>00282                 $g = ($rgb &gt;&gt;  8) &amp; 0xFF;
<a name="l00283"></a>00283                 $b =  $rgb        &amp; 0xFF;
<a name="l00284"></a>00284                 <span class="keywordflow">return</span> ($r * 0.299) + ($g * 0.587) + ($b * 0.114);
<a name="l00285"></a>00285         }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 
<a name="l00288"></a><a class="code" href="classphpthumb__functions.html#a1a6a1a11796857dd739cc463c348192b">00288</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#a1a6a1a11796857dd739cc463c348192b">ScaleToFitInBox</a>($width, $height, $maxwidth=null, $maxheight=null, $allow_enlarge=<span class="keyword">true</span>, $allow_reduce=<span class="keyword">true</span>) {
<a name="l00289"></a>00289                 $maxwidth  = (is_null($maxwidth)  ? $width  : $maxwidth);
<a name="l00290"></a>00290                 $maxheight = (is_null($maxheight) ? $height : $maxheight);
<a name="l00291"></a>00291                 $scale_x = 1;
<a name="l00292"></a>00292                 $scale_y = 1;
<a name="l00293"></a>00293                 <span class="keywordflow">if</span> (($width &gt; $maxwidth) || ($width &lt; $maxwidth)) {
<a name="l00294"></a>00294                         $scale_x = ($maxwidth / $width);
<a name="l00295"></a>00295                 }
<a name="l00296"></a>00296                 <span class="keywordflow">if</span> (($height &gt; $maxheight) || ($height &lt; $maxheight)) {
<a name="l00297"></a>00297                         $scale_y = ($maxheight / $height);
<a name="l00298"></a>00298                 }
<a name="l00299"></a>00299                 $scale = min($scale_x, $scale_y);
<a name="l00300"></a>00300                 <span class="keywordflow">if</span> (!$allow_enlarge) {
<a name="l00301"></a>00301                         $scale = min($scale, 1);
<a name="l00302"></a>00302                 }
<a name="l00303"></a>00303                 <span class="keywordflow">if</span> (!$allow_reduce) {
<a name="l00304"></a>00304                         $scale = max($scale, 1);
<a name="l00305"></a>00305                 }
<a name="l00306"></a>00306                 <span class="keywordflow">return</span> $scale;
<a name="l00307"></a>00307         }
<a name="l00308"></a>00308 
<a name="l00309"></a><a class="code" href="classphpthumb__functions.html#ab359dab758fa1fe794f7ee77bcc6fa57">00309</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#ab359dab758fa1fe794f7ee77bcc6fa57">ImageCopyResampleBicubic</a>($dst_img, $src_img, $dst_x, $dst_y, $src_x, $src_y, $dst_w, $dst_h, $src_w, $src_h) {
<a name="l00310"></a>00310                 <span class="comment">// ron at korving dot demon dot nl</span>
<a name="l00311"></a>00311                 <span class="comment">// http://www.php.net/imagecopyresampled</span>
<a name="l00312"></a>00312 
<a name="l00313"></a>00313                 $scaleX = ($src_w - 1) / $dst_w;
<a name="l00314"></a>00314                 $scaleY = ($src_h - 1) / $dst_h;
<a name="l00315"></a>00315 
<a name="l00316"></a>00316                 $scaleX2 = $scaleX / 2.0;
<a name="l00317"></a>00317                 $scaleY2 = $scaleY / 2.0;
<a name="l00318"></a>00318 
<a name="l00319"></a>00319                 $isTrueColor = ImageIsTrueColor($src_img);
<a name="l00320"></a>00320 
<a name="l00321"></a>00321                 <span class="keywordflow">for</span> ($y = $src_y; $y &lt; $src_y + $dst_h; $y++) {
<a name="l00322"></a>00322                         $sY   = $y * $scaleY;
<a name="l00323"></a>00323                         $siY  = (int) $sY;
<a name="l00324"></a>00324                         $siY2 = (int) $sY + $scaleY2;
<a name="l00325"></a>00325 
<a name="l00326"></a>00326                         <span class="keywordflow">for</span> ($x = $src_x; $x &lt; $src_x + $dst_w; $x++) {
<a name="l00327"></a>00327                                 $sX   = $x * $scaleX;
<a name="l00328"></a>00328                                 $siX  = (int) $sX;
<a name="l00329"></a>00329                                 $siX2 = (int) $sX + $scaleX2;
<a name="l00330"></a>00330 
<a name="l00331"></a>00331                                 <span class="keywordflow">if</span> ($isTrueColor) {
<a name="l00332"></a>00332 
<a name="l00333"></a>00333                                         $c1 = ImageColorAt($src_img, $siX, $siY2);
<a name="l00334"></a>00334                                         $c2 = ImageColorAt($src_img, $siX, $siY);
<a name="l00335"></a>00335                                         $c3 = ImageColorAt($src_img, $siX2, $siY2);
<a name="l00336"></a>00336                                         $c4 = ImageColorAt($src_img, $siX2, $siY);
<a name="l00337"></a>00337 
<a name="l00338"></a>00338                                         $r = (( $c1             +  $c2             +  $c3             +  $c4            ) &gt;&gt; 2) &amp; 0xFF0000;
<a name="l00339"></a>00339                                         $g = ((($c1 &amp; 0x00FF00) + ($c2 &amp; 0x00FF00) + ($c3 &amp; 0x00FF00) + ($c4 &amp; 0x00FF00)) &gt;&gt; 2) &amp; 0x00FF00;
<a name="l00340"></a>00340                                         $b = ((($c1 &amp; 0x0000FF) + ($c2 &amp; 0x0000FF) + ($c3 &amp; 0x0000FF) + ($c4 &amp; 0x0000FF)) &gt;&gt; 2);
<a name="l00341"></a>00341 
<a name="l00342"></a>00342                                 } <span class="keywordflow">else</span> {
<a name="l00343"></a>00343 
<a name="l00344"></a>00344                                         $c1 = ImageColorsForIndex($src_img, ImageColorAt($src_img, $siX, $siY2));
<a name="l00345"></a>00345                                         $c2 = ImageColorsForIndex($src_img, ImageColorAt($src_img, $siX, $siY));
<a name="l00346"></a>00346                                         $c3 = ImageColorsForIndex($src_img, ImageColorAt($src_img, $siX2, $siY2));
<a name="l00347"></a>00347                                         $c4 = ImageColorsForIndex($src_img, ImageColorAt($src_img, $siX2, $siY));
<a name="l00348"></a>00348 
<a name="l00349"></a>00349                                         $r = ($c1[<span class="stringliteral">&#39;red&#39;</span>]   + $c2[<span class="stringliteral">&#39;red&#39;</span>]   + $c3[<span class="stringliteral">&#39;red&#39;</span>]   + $c4[<span class="stringliteral">&#39;red&#39;</span>] )  &lt;&lt; 14;
<a name="l00350"></a>00350                                         $g = ($c1[<span class="stringliteral">&#39;green&#39;</span>] + $c2[<span class="stringliteral">&#39;green&#39;</span>] + $c3[<span class="stringliteral">&#39;green&#39;</span>] + $c4[<span class="stringliteral">&#39;green&#39;</span>]) &lt;&lt;  6;
<a name="l00351"></a>00351                                         $b = ($c1[<span class="stringliteral">&#39;blue&#39;</span>]  + $c2[<span class="stringliteral">&#39;blue&#39;</span>]  + $c3[<span class="stringliteral">&#39;blue&#39;</span>]  + $c4[<span class="stringliteral">&#39;blue&#39;</span>] ) &gt;&gt;  2;
<a name="l00352"></a>00352 
<a name="l00353"></a>00353                                 }
<a name="l00354"></a>00354                                 ImageSetPixel($dst_img, $dst_x + $x - $src_x, $dst_y + $y - $src_y, $r+$g+$b);
<a name="l00355"></a>00355                         }
<a name="l00356"></a>00356                 }
<a name="l00357"></a>00357                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00358"></a>00358         }
<a name="l00359"></a>00359 
<a name="l00360"></a>00360 
<a name="l00361"></a><a class="code" href="classphpthumb__functions.html#a02caac9e703a9c106e3fea3a6215130d">00361</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#a02caac9e703a9c106e3fea3a6215130d">ImageCreateFunction</a>($x_size, $y_size) {
<a name="l00362"></a>00362                 $ImageCreateFunction = <span class="stringliteral">&#39;ImageCreate&#39;</span>;
<a name="l00363"></a>00363                 <span class="keywordflow">if</span> (<a class="code" href="classphpthumb__functions.html#aaaad487d4c5a61befc88ae061f8a64fe">phpthumb_functions::gd_version</a>() &gt;= 2.0) {
<a name="l00364"></a>00364                         $ImageCreateFunction = <span class="stringliteral">&#39;ImageCreateTrueColor&#39;</span>;
<a name="l00365"></a>00365                 }
<a name="l00366"></a>00366                 <span class="keywordflow">if</span> (!function_exists($ImageCreateFunction)) {
<a name="l00367"></a>00367                         <span class="keywordflow">return</span> <a class="code" href="classphpthumb.html#a6ff71b425894fd846790cedf9f9cc97d">phpthumb::ErrorImage</a>($ImageCreateFunction.<span class="stringliteral">&#39;() does not exist - no GD support?&#39;</span>);
<a name="l00368"></a>00368                 }
<a name="l00369"></a>00369                 <span class="keywordflow">if</span> (($x_size &lt;= 0) || ($y_size &lt;= 0)) {
<a name="l00370"></a>00370                         <span class="keywordflow">return</span> <a class="code" href="classphpthumb.html#a6ff71b425894fd846790cedf9f9cc97d">phpthumb::ErrorImage</a>(<span class="stringliteral">&#39;Invalid image dimensions: &#39;</span>.$ImageCreateFunction.<span class="charliteral">&#39;(&#39;</span>.$x_size.<span class="stringliteral">&#39;, &#39;</span>.$y_size.<span class="charliteral">&#39;)&#39;</span>);
<a name="l00371"></a>00371                 }
<a name="l00372"></a>00372                 <span class="keywordflow">return</span> $ImageCreateFunction(round($x_size), round($y_size));
<a name="l00373"></a>00373         }
<a name="l00374"></a>00374 
<a name="l00375"></a>00375 
<a name="l00376"></a><a class="code" href="classphpthumb__functions.html#a3b35e57dd6a7b582dc71d5da44468455">00376</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#a3b35e57dd6a7b582dc71d5da44468455">ImageCopyRespectAlpha</a>(&amp;$dst_im, &amp;$src_im, $dst_x, $dst_y, $src_x, $src_y, $src_w, $src_h, $opacity_pct=100) {
<a name="l00377"></a>00377                 $opacipct = $opacity_pct / 100;
<a name="l00378"></a>00378                 <span class="keywordflow">for</span> ($x = $src_x; $x &lt; $src_w; $x++) {
<a name="l00379"></a>00379                         <span class="keywordflow">for</span> ($y = $src_y; $y &lt; $src_h; $y++) {
<a name="l00380"></a>00380                                 $RealPixel    = <a class="code" href="classphpthumb__functions.html#ac73caf77553f599f9bdb88c03281b33b">phpthumb_functions::GetPixelColor</a>($dst_im, $dst_x + $x, $dst_y + $y);
<a name="l00381"></a>00381                                 $OverlayPixel = <a class="code" href="classphpthumb__functions.html#ac73caf77553f599f9bdb88c03281b33b">phpthumb_functions::GetPixelColor</a>($src_im, $x, $y);
<a name="l00382"></a>00382                                 $alphapct = $OverlayPixel[<span class="stringliteral">&#39;alpha&#39;</span>] / 127;
<a name="l00383"></a>00383                                 $overlaypct = (1 - $alphapct) * $opacipct;
<a name="l00384"></a>00384 
<a name="l00385"></a>00385                                 $newcolor = <a class="code" href="classphpthumb__functions.html#ab43fe1af0d0c46288c2ffcf3905a7b42">phpthumb_functions::ImageColorAllocateAlphaSafe</a>(
<a name="l00386"></a>00386                                         $dst_im,
<a name="l00387"></a>00387                                         round($RealPixel[<span class="stringliteral">&#39;red&#39;</span>]   * (1 - $overlaypct)) + ($OverlayPixel[<span class="stringliteral">&#39;red&#39;</span>]   * $overlaypct),
<a name="l00388"></a>00388                                         round($RealPixel[<span class="stringliteral">&#39;green&#39;</span>] * (1 - $overlaypct)) + ($OverlayPixel[<span class="stringliteral">&#39;green&#39;</span>] * $overlaypct),
<a name="l00389"></a>00389                                         round($RealPixel[<span class="stringliteral">&#39;blue&#39;</span>]  * (1 - $overlaypct)) + ($OverlayPixel[<span class="stringliteral">&#39;blue&#39;</span>]  * $overlaypct),
<a name="l00390"></a>00390                                         <span class="comment">//$RealPixel[&#39;alpha&#39;]);</span>
<a name="l00391"></a>00391                                         0);
<a name="l00392"></a>00392 
<a name="l00393"></a>00393                                 ImageSetPixel($dst_im, $dst_x + $x, $dst_y + $y, $newcolor);
<a name="l00394"></a>00394                         }
<a name="l00395"></a>00395                 }
<a name="l00396"></a>00396                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00397"></a>00397         }
<a name="l00398"></a>00398 
<a name="l00399"></a>00399 
<a name="l00400"></a><a class="code" href="classphpthumb__functions.html#a0b7ce9a69725437b7b71c8c4279d497d">00400</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#a0b7ce9a69725437b7b71c8c4279d497d">ProportionalResize</a>($old_width, $old_height, $new_width=<span class="keyword">false</span>, $new_height=<span class="keyword">false</span>) {
<a name="l00401"></a>00401                 $old_aspect_ratio = $old_width / $old_height;
<a name="l00402"></a>00402                 <span class="keywordflow">if</span> (($new_width === <span class="keyword">false</span>) &amp;&amp; ($new_height === <span class="keyword">false</span>)) {
<a name="l00403"></a>00403                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00404"></a>00404                 } <a class="code" href="php_thumb_8demo_8check_8php.html#af92779326267616cd7c3cdaaa9484bc9">elseif</a> ($new_width === <span class="keyword">false</span>) {
<a name="l00405"></a>00405                         $new_width = $new_height * $old_aspect_ratio;
<a name="l00406"></a>00406                 } <a class="code" href="php_thumb_8demo_8check_8php.html#af92779326267616cd7c3cdaaa9484bc9">elseif</a> ($new_height === <span class="keyword">false</span>) {
<a name="l00407"></a>00407                         $new_height = $new_width / $old_aspect_ratio;
<a name="l00408"></a>00408                 }
<a name="l00409"></a>00409                 $new_aspect_ratio = $new_width / $new_height;
<a name="l00410"></a>00410                 <span class="keywordflow">if</span> ($new_aspect_ratio == $old_aspect_ratio) {
<a name="l00411"></a>00411                         <span class="comment">// great, done</span>
<a name="l00412"></a>00412                 } <a class="code" href="php_thumb_8demo_8check_8php.html#af92779326267616cd7c3cdaaa9484bc9">elseif</a> ($new_aspect_ratio &lt; $old_aspect_ratio) {
<a name="l00413"></a>00413                         <span class="comment">// limited by width</span>
<a name="l00414"></a>00414                         $new_height = $new_width / $old_aspect_ratio;
<a name="l00415"></a>00415                 } <a class="code" href="php_thumb_8demo_8check_8php.html#af92779326267616cd7c3cdaaa9484bc9">elseif</a> ($new_aspect_ratio &gt; $old_aspect_ratio) {
<a name="l00416"></a>00416                         <span class="comment">// limited by height</span>
<a name="l00417"></a>00417                         $new_width = $new_height * $old_aspect_ratio;
<a name="l00418"></a>00418                 }
<a name="l00419"></a>00419                 <span class="keywordflow">return</span> array(intval(round($new_width)), intval(round($new_height)));
<a name="l00420"></a>00420         }
<a name="l00421"></a>00421 
<a name="l00422"></a>00422 
<a name="l00423"></a><a class="code" href="classphpthumb__functions.html#ab83588a52cc1a218c8183f03872e4a25">00423</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#ab83588a52cc1a218c8183f03872e4a25">FunctionIsDisabled</a>($function) {
<a name="l00424"></a>00424                 <span class="keyword">static</span> <a class="code" href="php_thumb_8demo_8check_8php.html#ac9ab9399a05784bc20dcedde7b573593">$DisabledFunctions</a> = null;
<a name="l00425"></a>00425                 <span class="keywordflow">if</span> (is_null(<a class="code" href="php_thumb_8demo_8check_8php.html#ac9ab9399a05784bc20dcedde7b573593">$DisabledFunctions</a>)) {
<a name="l00426"></a>00426                         $disable_functions_local  = explode(<span class="charliteral">&#39;,&#39;</span>,     strtolower(@ini_get(<span class="stringliteral">&#39;disable_functions&#39;</span>)));
<a name="l00427"></a>00427                         $disable_functions_global = explode(<span class="charliteral">&#39;,&#39;</span>, strtolower(@get_cfg_var(<span class="stringliteral">&#39;disable_functions&#39;</span>)));
<a name="l00428"></a>00428                         <span class="keywordflow">foreach</span> ($disable_functions_local as $key =&gt; $value) {
<a name="l00429"></a>00429                                 <a class="code" href="php_thumb_8demo_8check_8php.html#ac9ab9399a05784bc20dcedde7b573593">$DisabledFunctions</a>[trim($value)] = <span class="stringliteral">&#39;local&#39;</span>;
<a name="l00430"></a>00430                         }
<a name="l00431"></a>00431                         <span class="keywordflow">foreach</span> ($disable_functions_global as $key =&gt; $value) {
<a name="l00432"></a>00432                                 <a class="code" href="php_thumb_8demo_8check_8php.html#ac9ab9399a05784bc20dcedde7b573593">$DisabledFunctions</a>[trim($value)] = <span class="stringliteral">&#39;global&#39;</span>;
<a name="l00433"></a>00433                         }
<a name="l00434"></a>00434                         <span class="keywordflow">if</span> (@ini_get(<span class="stringliteral">&#39;safe_mode&#39;</span>)) {
<a name="l00435"></a>00435                                 <a class="code" href="php_thumb_8demo_8check_8php.html#ac9ab9399a05784bc20dcedde7b573593">$DisabledFunctions</a>[<span class="stringliteral">&#39;shell_exec&#39;</span>]     = <span class="stringliteral">&#39;local&#39;</span>;
<a name="l00436"></a>00436                                 <a class="code" href="php_thumb_8demo_8check_8php.html#ac9ab9399a05784bc20dcedde7b573593">$DisabledFunctions</a>[<span class="stringliteral">&#39;set_time_limit&#39;</span>] = <span class="stringliteral">&#39;local&#39;</span>;
<a name="l00437"></a>00437                         }
<a name="l00438"></a>00438                 }
<a name="l00439"></a>00439                 <span class="keywordflow">return</span> isset(<a class="code" href="php_thumb_8demo_8check_8php.html#ac9ab9399a05784bc20dcedde7b573593">$DisabledFunctions</a>[strtolower($function)]);
<a name="l00440"></a>00440         }
<a name="l00441"></a>00441 
<a name="l00442"></a>00442 
<a name="l00443"></a><a class="code" href="classphpthumb__functions.html#a32ab9bd049bb6b7e0352329726a0ab51">00443</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#a32ab9bd049bb6b7e0352329726a0ab51">SafeExec</a>($command) {
<a name="l00444"></a>00444                 <span class="keyword">static</span> $AllowedExecFunctions = array();
<a name="l00445"></a>00445                 <span class="keywordflow">if</span> (empty($AllowedExecFunctions)) {
<a name="l00446"></a>00446                         $AllowedExecFunctions = array(<span class="stringliteral">&#39;shell_exec&#39;</span>=&gt;<span class="keyword">true</span>, <span class="stringliteral">&#39;passthru&#39;</span>=&gt;<span class="keyword">true</span>, <span class="stringliteral">&#39;system&#39;</span>=&gt;<span class="keyword">true</span>, <span class="stringliteral">&#39;exec&#39;</span>=&gt;<span class="keyword">true</span>);
<a name="l00447"></a>00447                         <span class="keywordflow">foreach</span> ($AllowedExecFunctions as $key =&gt; $value) {
<a name="l00448"></a>00448                                 $AllowedExecFunctions[$key] = !<a class="code" href="classphpthumb__functions.html#ab83588a52cc1a218c8183f03872e4a25">phpthumb_functions::FunctionIsDisabled</a>($key);
<a name="l00449"></a>00449                         }
<a name="l00450"></a>00450                 }
<a name="l00451"></a>00451                 $command .= <span class="stringliteral">&#39; 2&gt;&amp;1&#39;</span>; <span class="comment">// force redirect stderr to stdout</span>
<a name="l00452"></a>00452                 <span class="keywordflow">foreach</span> ($AllowedExecFunctions as $execfunction =&gt; $is_allowed) {
<a name="l00453"></a>00453                         <span class="keywordflow">if</span> (!$is_allowed) {
<a name="l00454"></a>00454                                 <span class="keywordflow">continue</span>;
<a name="l00455"></a>00455                         }
<a name="l00456"></a>00456                         $returnvalue = <span class="keyword">false</span>;
<a name="l00457"></a>00457                         <span class="keywordflow">switch</span> ($execfunction) {
<a name="l00458"></a>00458                                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;passthru&#39;</span>:
<a name="l00459"></a>00459                                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;system&#39;</span>:
<a name="l00460"></a>00460                                         ob_start();
<a name="l00461"></a>00461                                         $execfunction($command);
<a name="l00462"></a>00462                                         $returnvalue = ob_get_contents();
<a name="l00463"></a>00463                                         ob_end_clean();
<a name="l00464"></a>00464                                         <span class="keywordflow">break</span>;
<a name="l00465"></a>00465 
<a name="l00466"></a>00466                                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;exec&#39;</span>:
<a name="l00467"></a>00467                                         <a class="code" href="create__examples_8php.html#a73004ce9cd673c1bfafd1dc351134797">$output</a> = array();
<a name="l00468"></a>00468                                         $lastline = $execfunction($command, <a class="code" href="create__examples_8php.html#a73004ce9cd673c1bfafd1dc351134797">$output</a>);
<a name="l00469"></a>00469                                         $returnvalue = implode(<span class="stringliteral">&quot;\n&quot;</span>, <a class="code" href="create__examples_8php.html#a73004ce9cd673c1bfafd1dc351134797">$output</a>);
<a name="l00470"></a>00470                                         <span class="keywordflow">break</span>;
<a name="l00471"></a>00471 
<a name="l00472"></a>00472                                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;shell_exec&#39;</span>:
<a name="l00473"></a>00473                                         ob_start();
<a name="l00474"></a>00474                                         $returnvalue = $execfunction($command);
<a name="l00475"></a>00475                                         ob_end_clean();
<a name="l00476"></a>00476                                         <span class="keywordflow">break</span>;
<a name="l00477"></a>00477                         }
<a name="l00478"></a>00478                         <span class="keywordflow">return</span> $returnvalue;
<a name="l00479"></a>00479                 }
<a name="l00480"></a>00480                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00481"></a>00481         }
<a name="l00482"></a>00482 
<a name="l00483"></a>00483 
<a name="l00484"></a><a class="code" href="classphpthumb__functions.html#acb4fb35a3540b66f2543550e25197a74">00484</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#acb4fb35a3540b66f2543550e25197a74">ApacheLookupURIarray</a>(<a class="code" href="actions_8php.html#a6b7de8d10c540db2f1631e68b2aa0538">$filename</a>) {
<a name="l00485"></a>00485                 <span class="comment">// apache_lookup_uri() only works when PHP is installed as an Apache module.</span>
<a name="l00486"></a>00486                 <span class="keywordflow">if</span> (php_sapi_name() == <span class="stringliteral">&#39;apache&#39;</span>) {
<a name="l00487"></a>00487                         $keys = array(<span class="stringliteral">&#39;status&#39;</span>, <span class="stringliteral">&#39;the_request&#39;</span>, <span class="stringliteral">&#39;status_line&#39;</span>, <span class="stringliteral">&#39;method&#39;</span>, <span class="stringliteral">&#39;content_type&#39;</span>, <span class="stringliteral">&#39;handler&#39;</span>, <span class="stringliteral">&#39;uri&#39;</span>, <span class="stringliteral">&#39;filename&#39;</span>, <span class="stringliteral">&#39;path_info&#39;</span>, <span class="stringliteral">&#39;args&#39;</span>, <span class="stringliteral">&#39;boundary&#39;</span>, <span class="stringliteral">&#39;no_cache&#39;</span>, <span class="stringliteral">&#39;no_local_copy&#39;</span>, <span class="stringliteral">&#39;allowed&#39;</span>, <span class="stringliteral">&#39;send_bodyct&#39;</span>, <span class="stringliteral">&#39;bytes_sent&#39;</span>, <span class="stringliteral">&#39;byterange&#39;</span>, <span class="stringliteral">&#39;clength&#39;</span>, <span class="stringliteral">&#39;unparsed_uri&#39;</span>, <span class="stringliteral">&#39;mtime&#39;</span>, <span class="stringliteral">&#39;request_time&#39;</span>);
<a name="l00488"></a>00488                         <span class="keywordflow">if</span> ($apacheLookupURIobject = @apache_lookup_uri(<a class="code" href="actions_8php.html#a6b7de8d10c540db2f1631e68b2aa0538">$filename</a>)) {
<a name="l00489"></a>00489                                 $apacheLookupURIarray = array();
<a name="l00490"></a>00490                                 <span class="keywordflow">foreach</span> ($keys as $key) {
<a name="l00491"></a>00491                                         $apacheLookupURIarray[$key] = @$apacheLookupURIobject-&gt;$key;
<a name="l00492"></a>00492                                 }
<a name="l00493"></a>00493                                 <span class="keywordflow">return</span> $apacheLookupURIarray;
<a name="l00494"></a>00494                         }
<a name="l00495"></a>00495                 }
<a name="l00496"></a>00496                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00497"></a>00497         }
<a name="l00498"></a>00498 
<a name="l00499"></a>00499 
<a name="l00500"></a><a class="code" href="classphpthumb__functions.html#adfd72c199df2f74f6daeda7c06a18cae">00500</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#adfd72c199df2f74f6daeda7c06a18cae">gd_is_bundled</a>() {
<a name="l00501"></a>00501                 <span class="keyword">static</span> $isbundled = null;
<a name="l00502"></a>00502                 <span class="keywordflow">if</span> (is_null($isbundled)) {
<a name="l00503"></a>00503                         <a class="code" href="php_thumb_8demo_8check_8php.html#af2c7b7086347d2db2cbba6ff28df96e7">$gd_info</a> = gd_info();
<a name="l00504"></a>00504                         $isbundled = (strpos(<a class="code" href="php_thumb_8demo_8check_8php.html#af2c7b7086347d2db2cbba6ff28df96e7">$gd_info</a>[<span class="stringliteral">&#39;GD Version&#39;</span>], <span class="stringliteral">&#39;bundled&#39;</span>) !== <span class="keyword">false</span>);
<a name="l00505"></a>00505                 }
<a name="l00506"></a>00506                 <span class="keywordflow">return</span> $isbundled;
<a name="l00507"></a>00507         }
<a name="l00508"></a>00508 
<a name="l00509"></a>00509 
<a name="l00510"></a><a class="code" href="classphpthumb__functions.html#aaaad487d4c5a61befc88ae061f8a64fe">00510</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#aaaad487d4c5a61befc88ae061f8a64fe">gd_version</a>($fullstring=<span class="keyword">false</span>) {
<a name="l00511"></a>00511                 <span class="keyword">static</span> $cache_gd_version = array();
<a name="l00512"></a>00512                 <span class="keywordflow">if</span> (empty($cache_gd_version)) {
<a name="l00513"></a>00513                         <a class="code" href="php_thumb_8demo_8check_8php.html#af2c7b7086347d2db2cbba6ff28df96e7">$gd_info</a> = gd_info();
<a name="l00514"></a>00514                         <span class="keywordflow">if</span> (eregi(<span class="stringliteral">&#39;bundled \((.+)\)$&#39;</span>, <a class="code" href="php_thumb_8demo_8check_8php.html#af2c7b7086347d2db2cbba6ff28df96e7">$gd_info</a>[<span class="stringliteral">&#39;GD Version&#39;</span>], $matches)) {
<a name="l00515"></a>00515                                 $cache_gd_version[1] = <a class="code" href="php_thumb_8demo_8check_8php.html#af2c7b7086347d2db2cbba6ff28df96e7">$gd_info</a>[<span class="stringliteral">&#39;GD Version&#39;</span>];  <span class="comment">// e.g. &quot;bundled (2.0.15 compatible)&quot;</span>
<a name="l00516"></a>00516                                 $cache_gd_version[0] = (float) $matches[1];     <span class="comment">// e.g. &quot;2.0&quot; (not &quot;bundled (2.0.15 compatible)&quot;)</span>
<a name="l00517"></a>00517                         } <span class="keywordflow">else</span> {
<a name="l00518"></a>00518                                 $cache_gd_version[1] = <a class="code" href="php_thumb_8demo_8check_8php.html#af2c7b7086347d2db2cbba6ff28df96e7">$gd_info</a>[<span class="stringliteral">&#39;GD Version&#39;</span>];                       <span class="comment">// e.g. &quot;1.6.2 or higher&quot;</span>
<a name="l00519"></a>00519                                 $cache_gd_version[0] = (float) substr(<a class="code" href="php_thumb_8demo_8check_8php.html#af2c7b7086347d2db2cbba6ff28df96e7">$gd_info</a>[<span class="stringliteral">&#39;GD Version&#39;</span>], 0, 3); <span class="comment">// e.g. &quot;1.6&quot; (not &quot;1.6.2 or higher&quot;)</span>
<a name="l00520"></a>00520                         }
<a name="l00521"></a>00521                 }
<a name="l00522"></a>00522                 <span class="keywordflow">return</span> $cache_gd_version[intval($fullstring)];
<a name="l00523"></a>00523         }
<a name="l00524"></a>00524 
<a name="l00525"></a>00525 
<a name="l00526"></a><a class="code" href="classphpthumb__functions.html#a509475456ea11addf53c89bc1d930934">00526</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#a509475456ea11addf53c89bc1d930934">filesize_remote</a>($remotefile, $timeout=10) {
<a name="l00527"></a>00527                 $size = <span class="keyword">false</span>;
<a name="l00528"></a>00528                 <a class="code" href="miscellaneous_2websearch_2data__read_8ejs_8php.html#a8d5b9b337ab7c5f5a8c5f8d774e0c6b5">$url</a> = <a class="code" href="classphpthumb__functions.html#ad7ede725cfcb053c5dbd50308deca6cd">phpthumb_functions::ParseURLbetter</a>($remotefile);
<a name="l00529"></a>00529                 <span class="keywordflow">if</span> ($fp = @fsockopen(<a class="code" href="miscellaneous_2websearch_2data__read_8ejs_8php.html#a8d5b9b337ab7c5f5a8c5f8d774e0c6b5">$url</a>[<span class="stringliteral">&#39;host&#39;</span>], (<a class="code" href="miscellaneous_2websearch_2data__read_8ejs_8php.html#a8d5b9b337ab7c5f5a8c5f8d774e0c6b5">$url</a>[<span class="stringliteral">&#39;port&#39;</span>] ? <a class="code" href="miscellaneous_2websearch_2data__read_8ejs_8php.html#a8d5b9b337ab7c5f5a8c5f8d774e0c6b5">$url</a>[<span class="stringliteral">&#39;port&#39;</span>] : 80), $errno, $errstr, $timeout)) {
<a name="l00530"></a>00530                         fwrite($fp, <span class="stringliteral">&#39;HEAD &#39;</span>.@$url[<span class="stringliteral">&#39;path&#39;</span>].@$url[<span class="stringliteral">&#39;query&#39;</span>].<span class="stringliteral">&#39; HTTP/1.0&#39;</span>.<span class="stringliteral">&quot;\r\n&quot;</span>.<span class="stringliteral">&#39;Host: &#39;</span>.@$url[<span class="stringliteral">&#39;host&#39;</span>].<span class="stringliteral">&quot;\r\n\r\n&quot;</span>);
<a name="l00531"></a>00531                         <span class="keywordflow">if</span> (<a class="code" href="classphpthumb__functions.html#af53f41b3482e6bed2082daa0ebfd96c0">phpthumb_functions::version_compare_replacement</a>(phpversion(), <span class="stringliteral">&#39;4.3.0&#39;</span>, <span class="stringliteral">&#39;&gt;=&#39;</span>)) {
<a name="l00532"></a>00532                                 stream_set_timeout($fp, $timeout);
<a name="l00533"></a>00533                         }
<a name="l00534"></a>00534                         <span class="keywordflow">while</span> (!feof($fp)) {
<a name="l00535"></a>00535                                 $headerline = fgets($fp, 4096);
<a name="l00536"></a>00536                                 <span class="keywordflow">if</span> (eregi(<span class="stringliteral">&#39;^Content-Length: (.*)&#39;</span>, $headerline, $matches)) {
<a name="l00537"></a>00537                                         $size = intval($matches[1]);
<a name="l00538"></a>00538                                         <span class="keywordflow">break</span>;
<a name="l00539"></a>00539                                 }
<a name="l00540"></a>00540                         }
<a name="l00541"></a>00541                         fclose ($fp);
<a name="l00542"></a>00542                 }
<a name="l00543"></a>00543                 <span class="keywordflow">return</span> $size;
<a name="l00544"></a>00544         }
<a name="l00545"></a>00545 
<a name="l00546"></a>00546 
<a name="l00547"></a><a class="code" href="classphpthumb__functions.html#aba89973c12394df012c7cf7ceb283cec">00547</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#aba89973c12394df012c7cf7ceb283cec">filedate_remote</a>($remotefile, $timeout=10) {
<a name="l00548"></a>00548                 $date = <span class="keyword">false</span>;
<a name="l00549"></a>00549                 <a class="code" href="miscellaneous_2websearch_2data__read_8ejs_8php.html#a8d5b9b337ab7c5f5a8c5f8d774e0c6b5">$url</a> = <a class="code" href="classphpthumb__functions.html#ad7ede725cfcb053c5dbd50308deca6cd">phpthumb_functions::ParseURLbetter</a>($remotefile);
<a name="l00550"></a>00550                 <span class="keywordflow">if</span> ($fp = @fsockopen(<a class="code" href="miscellaneous_2websearch_2data__read_8ejs_8php.html#a8d5b9b337ab7c5f5a8c5f8d774e0c6b5">$url</a>[<span class="stringliteral">&#39;host&#39;</span>], (<a class="code" href="miscellaneous_2websearch_2data__read_8ejs_8php.html#a8d5b9b337ab7c5f5a8c5f8d774e0c6b5">$url</a>[<span class="stringliteral">&#39;port&#39;</span>] ? <a class="code" href="miscellaneous_2websearch_2data__read_8ejs_8php.html#a8d5b9b337ab7c5f5a8c5f8d774e0c6b5">$url</a>[<span class="stringliteral">&#39;port&#39;</span>] : 80), $errno, $errstr, $timeout)) {
<a name="l00551"></a>00551                         fwrite($fp, <span class="stringliteral">&#39;HEAD &#39;</span>.@$url[<span class="stringliteral">&#39;path&#39;</span>].@$url[<span class="stringliteral">&#39;query&#39;</span>].<span class="stringliteral">&#39; HTTP/1.0&#39;</span>.<span class="stringliteral">&quot;\r\n&quot;</span>.<span class="stringliteral">&#39;Host: &#39;</span>.@$url[<span class="stringliteral">&#39;host&#39;</span>].<span class="stringliteral">&quot;\r\n\r\n&quot;</span>);
<a name="l00552"></a>00552                         <span class="keywordflow">if</span> (<a class="code" href="classphpthumb__functions.html#af53f41b3482e6bed2082daa0ebfd96c0">phpthumb_functions::version_compare_replacement</a>(phpversion(), <span class="stringliteral">&#39;4.3.0&#39;</span>, <span class="stringliteral">&#39;&gt;=&#39;</span>)) {
<a name="l00553"></a>00553                                 stream_set_timeout($fp, $timeout);
<a name="l00554"></a>00554                         }
<a name="l00555"></a>00555                         <span class="keywordflow">while</span> (!feof($fp)) {
<a name="l00556"></a>00556                                 $headerline = fgets($fp, 4096);
<a name="l00557"></a>00557                                 <span class="keywordflow">if</span> (eregi(<span class="stringliteral">&#39;^Last-Modified: (.*)&#39;</span>, $headerline, $matches)) {
<a name="l00558"></a>00558                                         $date = strtotime($matches[1]) - date(<span class="charliteral">&#39;Z&#39;</span>);
<a name="l00559"></a>00559                                         <span class="keywordflow">break</span>;
<a name="l00560"></a>00560                                 }
<a name="l00561"></a>00561                         }
<a name="l00562"></a>00562                         fclose ($fp);
<a name="l00563"></a>00563                 }
<a name="l00564"></a>00564                 <span class="keywordflow">return</span> $date;
<a name="l00565"></a>00565         }
<a name="l00566"></a>00566 
<a name="l00567"></a>00567 
<a name="l00568"></a><a class="code" href="classphpthumb__functions.html#a992583009b07598f893b8b6773513926">00568</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#a992583009b07598f893b8b6773513926">md5_file_safe</a>(<a class="code" href="actions_8php.html#a6b7de8d10c540db2f1631e68b2aa0538">$filename</a>) {
<a name="l00569"></a>00569                 <span class="comment">// md5_file() doesn&#39;t exist in PHP &lt; 4.2.0</span>
<a name="l00570"></a>00570                 <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;md5_file&#39;</span>)) {
<a name="l00571"></a>00571                         <span class="keywordflow">return</span> md5_file(<a class="code" href="actions_8php.html#a6b7de8d10c540db2f1631e68b2aa0538">$filename</a>);
<a name="l00572"></a>00572                 }
<a name="l00573"></a>00573                 <span class="keywordflow">if</span> ($fp = @fopen(<a class="code" href="actions_8php.html#a6b7de8d10c540db2f1631e68b2aa0538">$filename</a>, <span class="stringliteral">&#39;rb&#39;</span>)) {
<a name="l00574"></a>00574                         <a class="code" href="administration_2lists_2data_8php.html#ad66cfed6c1f454fbc3f3c6fdc8842a7b">$rawData</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00575"></a>00575                         <span class="keywordflow">do</span> {
<a name="l00576"></a>00576                                 $buffer = fread($fp, 8192);
<a name="l00577"></a>00577                                 <a class="code" href="administration_2lists_2data_8php.html#ad66cfed6c1f454fbc3f3c6fdc8842a7b">$rawData</a> .= $buffer;
<a name="l00578"></a>00578                         } <span class="keywordflow">while</span> (strlen($buffer) &gt; 0);
<a name="l00579"></a>00579                         fclose($fp);
<a name="l00580"></a>00580                         <span class="keywordflow">return</span> md5(<a class="code" href="administration_2lists_2data_8php.html#ad66cfed6c1f454fbc3f3c6fdc8842a7b">$rawData</a>);
<a name="l00581"></a>00581                 }
<a name="l00582"></a>00582                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00583"></a>00583         }
<a name="l00584"></a>00584 
<a name="l00585"></a>00585 
<a name="l00586"></a><a class="code" href="classphpthumb__functions.html#a0c2feb0df02b7a87435be3645fee8224">00586</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#a0c2feb0df02b7a87435be3645fee8224">nonempty_min</a>() {
<a name="l00587"></a>00587                 $arg_list = func_get_args();
<a name="l00588"></a>00588                 $acceptable = array();
<a name="l00589"></a>00589                 <span class="keywordflow">foreach</span> ($arg_list as $arg) {
<a name="l00590"></a>00590                         <span class="keywordflow">if</span> ($arg) {
<a name="l00591"></a>00591                                 $acceptable[] = $arg;
<a name="l00592"></a>00592                         }
<a name="l00593"></a>00593                 }
<a name="l00594"></a>00594                 <span class="keywordflow">return</span> min($acceptable);
<a name="l00595"></a>00595         }
<a name="l00596"></a>00596 
<a name="l00597"></a>00597 
<a name="l00598"></a><a class="code" href="classphpthumb__functions.html#ac7fc6323d3639f4244b23d462d0fbdcb">00598</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#ac7fc6323d3639f4244b23d462d0fbdcb">LittleEndian2String</a>($number, $minbytes=1) {
<a name="l00599"></a>00599                 $intstring = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00600"></a>00600                 <span class="keywordflow">while</span> ($number &gt; 0) {
<a name="l00601"></a>00601                         $intstring = $intstring.chr($number &amp; 255);
<a name="l00602"></a>00602                         $number &gt;&gt;= 8;
<a name="l00603"></a>00603                 }
<a name="l00604"></a>00604                 <span class="keywordflow">return</span> str_pad($intstring, $minbytes, <span class="stringliteral">&quot;\x00&quot;</span>, STR_PAD_RIGHT);
<a name="l00605"></a>00605         }
<a name="l00606"></a>00606 
<a name="l00607"></a><a class="code" href="classphpthumb__functions.html#ada951f9ad225b459c5f4d5974aa82765">00607</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#ada951f9ad225b459c5f4d5974aa82765">OneOfThese</a>() {
<a name="l00608"></a>00608                 <span class="comment">// return the first useful (non-empty/non-zero/non-false) value from those passed</span>
<a name="l00609"></a>00609                 $arg_list = func_get_args();
<a name="l00610"></a>00610                 <span class="keywordflow">foreach</span> ($arg_list as $key =&gt; $value) {
<a name="l00611"></a>00611                         <span class="keywordflow">if</span> ($value) {
<a name="l00612"></a>00612                                 <span class="keywordflow">return</span> $value;
<a name="l00613"></a>00613                         }
<a name="l00614"></a>00614                 }
<a name="l00615"></a>00615                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00616"></a>00616         }
<a name="l00617"></a>00617 
<a name="l00618"></a><a class="code" href="classphpthumb__functions.html#ad364cc6286f8223df18cc27695c8db4b">00618</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#ad364cc6286f8223df18cc27695c8db4b">CaseInsensitiveInArray</a>($needle, $haystack) {
<a name="l00619"></a>00619                 $needle = strtolower($needle);
<a name="l00620"></a>00620                 <span class="keywordflow">foreach</span> ($haystack as $key =&gt; $value) {
<a name="l00621"></a>00621                         <span class="keywordflow">if</span> (is_array($value)) {
<a name="l00622"></a>00622                                 <span class="comment">// skip?</span>
<a name="l00623"></a>00623                         } <a class="code" href="php_thumb_8demo_8check_8php.html#af92779326267616cd7c3cdaaa9484bc9">elseif</a> ($needle == strtolower($value)) {
<a name="l00624"></a>00624                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00625"></a>00625                         }
<a name="l00626"></a>00626                 }
<a name="l00627"></a>00627                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00628"></a>00628         }
<a name="l00629"></a>00629 
<a name="l00630"></a><a class="code" href="classphpthumb__functions.html#a53dae9e5e9604e546f0e4f836fc69240">00630</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#a53dae9e5e9604e546f0e4f836fc69240">URLreadFsock</a>($host, <a class="code" href="tokenizer__test_8php.html#aa1bfbd27060176201b271918dff57e8f">$file</a>, &amp;$errstr, $successonly=<span class="keyword">true</span>, $port=80, $timeout=10) {
<a name="l00631"></a>00631                 <span class="keywordflow">if</span> (!function_exists(<span class="stringliteral">&#39;fsockopen&#39;</span>) || <a class="code" href="classphpthumb__functions.html#ab83588a52cc1a218c8183f03872e4a25">phpthumb_functions::FunctionIsDisabled</a>(<span class="stringliteral">&#39;fsockopen&#39;</span>)) {
<a name="l00632"></a>00632                         $errstr = <span class="stringliteral">&#39;fsockopen() unavailable&#39;</span>;
<a name="l00633"></a>00633                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00634"></a>00634                 }
<a name="l00635"></a>00635                 <span class="keywordflow">if</span> ($fp = @fsockopen($host, 80, $errno, $errstr, $timeout)) {
<a name="l00636"></a>00636                         $out  = <span class="stringliteral">&#39;GET &#39;</span>.$file.<span class="stringliteral">&#39; HTTP/1.0&#39;</span>.<span class="stringliteral">&quot;\r\n&quot;</span>;
<a name="l00637"></a>00637                         $out .= <span class="stringliteral">&#39;Host: &#39;</span>.$host.<span class="stringliteral">&quot;\r\n&quot;</span>;
<a name="l00638"></a>00638                         $out .= <span class="stringliteral">&#39;Connection: Close&#39;</span>.<span class="stringliteral">&quot;\r\n\r\n&quot;</span>;
<a name="l00639"></a>00639                         fwrite($fp, $out);
<a name="l00640"></a>00640 
<a name="l00641"></a>00641                         $isHeader = <span class="keyword">true</span>;
<a name="l00642"></a>00642                         $Data_header = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00643"></a>00643                         $Data_body   = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00644"></a>00644                         $header_newlocation = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00645"></a>00645                         <span class="keywordflow">while</span> (!feof($fp)) {
<a name="l00646"></a>00646                                 <a class="code" href="tokenizer__test_8php.html#a52f469b0182d9abac2d0f20548680c9c">$line</a> = fgets($fp, 1024);
<a name="l00647"></a>00647                                 <span class="keywordflow">if</span> ($isHeader) {
<a name="l00648"></a>00648                                         $Data_header .= <a class="code" href="tokenizer__test_8php.html#a52f469b0182d9abac2d0f20548680c9c">$line</a>;
<a name="l00649"></a>00649                                 } <span class="keywordflow">else</span> {
<a name="l00650"></a>00650                                         $Data_body .= <a class="code" href="tokenizer__test_8php.html#a52f469b0182d9abac2d0f20548680c9c">$line</a>;
<a name="l00651"></a>00651                                 }
<a name="l00652"></a>00652                                 <span class="keywordflow">if</span> (eregi(<span class="stringliteral">&#39;^HTTP/[\\.0-9]+ ([0-9]+) (.+)$&#39;</span>, rtrim(<a class="code" href="tokenizer__test_8php.html#a52f469b0182d9abac2d0f20548680c9c">$line</a>), $matches)) {
<a name="l00653"></a>00653                                         list($dummy, $errno, $errstr) = $matches;
<a name="l00654"></a>00654                                         $errno = intval($errno);
<a name="l00655"></a>00655                                 } <a class="code" href="php_thumb_8demo_8check_8php.html#af92779326267616cd7c3cdaaa9484bc9">elseif</a> (eregi(<span class="stringliteral">&#39;^Location: (.*)$&#39;</span>, rtrim(<a class="code" href="tokenizer__test_8php.html#a52f469b0182d9abac2d0f20548680c9c">$line</a>), $matches)) {
<a name="l00656"></a>00656                                         $header_newlocation = $matches[1];
<a name="l00657"></a>00657                                 }
<a name="l00658"></a>00658                                 <span class="keywordflow">if</span> ($isHeader &amp;&amp; (<a class="code" href="tokenizer__test_8php.html#a52f469b0182d9abac2d0f20548680c9c">$line</a> == <span class="stringliteral">&quot;\r\n&quot;</span>)) {
<a name="l00659"></a>00659                                         $isHeader = <span class="keyword">false</span>;
<a name="l00660"></a>00660                                         <span class="keywordflow">if</span> ($successonly) {
<a name="l00661"></a>00661                                                 <span class="keywordflow">switch</span> ($errno) {
<a name="l00662"></a>00662                                                         <span class="keywordflow">case</span> 200:
<a name="l00663"></a>00663                                                                 <span class="comment">// great, continue</span>
<a name="l00664"></a>00664                                                                 <span class="keywordflow">break</span>;
<a name="l00665"></a>00665 
<a name="l00666"></a>00666                                                         <span class="keywordflow">default</span>:
<a name="l00667"></a>00667                                                                 $errstr = $errno.<span class="charliteral">&#39; &#39;</span>.$errstr.($header_newlocation ? <span class="stringliteral">&#39;; Location: &#39;</span>.$header_newlocation : <span class="stringliteral">&#39;&#39;</span>);
<a name="l00668"></a>00668                                                                 fclose($fp);
<a name="l00669"></a>00669                                                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00670"></a>00670                                                                 <span class="keywordflow">break</span>;
<a name="l00671"></a>00671                                                 }
<a name="l00672"></a>00672                                         }
<a name="l00673"></a>00673                                 }
<a name="l00674"></a>00674                         }
<a name="l00675"></a>00675                         fclose($fp);
<a name="l00676"></a>00676                         <span class="keywordflow">return</span> $Data_body;
<a name="l00677"></a>00677                 }
<a name="l00678"></a>00678                 <span class="keywordflow">return</span> null;
<a name="l00679"></a>00679         }
<a name="l00680"></a>00680 
<a name="l00681"></a><a class="code" href="classphpthumb__functions.html#a0ee9ff5a7384b1b204b77ad31f4588f3">00681</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#a0ee9ff5a7384b1b204b77ad31f4588f3">CleanUpURLencoding</a>(<a class="code" href="miscellaneous_2websearch_2data__read_8ejs_8php.html#a8d5b9b337ab7c5f5a8c5f8d774e0c6b5">$url</a>, $queryseperator=<span class="charliteral">&#39;&amp;&#39;</span>) {
<a name="l00682"></a>00682                 <span class="keywordflow">if</span> (!eregi(<span class="stringliteral">&#39;^http&#39;</span>, <a class="code" href="miscellaneous_2websearch_2data__read_8ejs_8php.html#a8d5b9b337ab7c5f5a8c5f8d774e0c6b5">$url</a>)) {
<a name="l00683"></a>00683                         <span class="keywordflow">return</span> <a class="code" href="miscellaneous_2websearch_2data__read_8ejs_8php.html#a8d5b9b337ab7c5f5a8c5f8d774e0c6b5">$url</a>;
<a name="l00684"></a>00684                 }
<a name="l00685"></a>00685                 $parse_url = <a class="code" href="classphpthumb__functions.html#ad7ede725cfcb053c5dbd50308deca6cd">phpthumb_functions::ParseURLbetter</a>(<a class="code" href="miscellaneous_2websearch_2data__read_8ejs_8php.html#a8d5b9b337ab7c5f5a8c5f8d774e0c6b5">$url</a>);
<a name="l00686"></a>00686                 $pathelements = explode(<span class="charliteral">&#39;/&#39;</span>, $parse_url[<span class="stringliteral">&#39;path&#39;</span>]);
<a name="l00687"></a>00687                 $CleanPathElements = array();
<a name="l00688"></a>00688                 $TranslationMatrix = array(<span class="charliteral">&#39; &#39;</span>=&gt;<span class="stringliteral">&#39;%20&#39;</span>);
<a name="l00689"></a>00689                 <span class="keywordflow">foreach</span> ($pathelements as $key =&gt; $pathelement) {
<a name="l00690"></a>00690                         $CleanPathElements[] = strtr($pathelement, $TranslationMatrix);
<a name="l00691"></a>00691                 }
<a name="l00692"></a>00692                 <span class="keywordflow">foreach</span> ($CleanPathElements as $key =&gt; $value) {
<a name="l00693"></a>00693                         <span class="keywordflow">if</span> ($value === <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00694"></a>00694                                 unset($CleanPathElements[$key]);
<a name="l00695"></a>00695                         }
<a name="l00696"></a>00696                 }
<a name="l00697"></a>00697 
<a name="l00698"></a>00698                 $queries = explode($queryseperator, @$parse_url[<span class="stringliteral">&#39;query&#39;</span>]);
<a name="l00699"></a>00699                 $CleanQueries = array();
<a name="l00700"></a>00700                 <span class="keywordflow">foreach</span> ($queries as $key =&gt; $query) {
<a name="l00701"></a>00701                         @list($param, $value) = explode(<span class="charliteral">&#39;=&#39;</span>, $query);
<a name="l00702"></a>00702                         $CleanQueries[] = strtr($param, $TranslationMatrix).($value ? <span class="charliteral">&#39;=&#39;</span>.strtr($value, $TranslationMatrix) : <span class="stringliteral">&#39;&#39;</span>);
<a name="l00703"></a>00703                 }
<a name="l00704"></a>00704                 <span class="keywordflow">foreach</span> ($CleanQueries as $key =&gt; $value) {
<a name="l00705"></a>00705                         <span class="keywordflow">if</span> ($value === <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00706"></a>00706                                 unset($CleanQueries[$key]);
<a name="l00707"></a>00707                         }
<a name="l00708"></a>00708                 }
<a name="l00709"></a>00709 
<a name="l00710"></a>00710                 $cleaned_url  = $parse_url[<span class="stringliteral">&#39;scheme&#39;</span>].<span class="stringliteral">&#39;://&#39;</span>;
<a name="l00711"></a>00711                 $cleaned_url .= (@$parse_url[<span class="stringliteral">&#39;username&#39;</span>] ? $parse_url[<span class="stringliteral">&#39;host&#39;</span>].(@$parse_url[<span class="stringliteral">&#39;password&#39;</span>] ? <span class="charliteral">&#39;:&#39;</span>.$parse_url[<span class="stringliteral">&#39;password&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>).<span class="charliteral">&#39;@&#39;</span> : <span class="stringliteral">&#39;&#39;</span>);
<a name="l00712"></a>00712                 $cleaned_url .= $parse_url[<span class="stringliteral">&#39;host&#39;</span>];
<a name="l00713"></a>00713                 $cleaned_url .= <span class="charliteral">&#39;/&#39;</span>.implode(<span class="charliteral">&#39;/&#39;</span>, $CleanPathElements);
<a name="l00714"></a>00714                 $cleaned_url .= (@$CleanQueries ? <span class="charliteral">&#39;?&#39;</span>.implode($queryseperator, $CleanQueries) : <span class="stringliteral">&#39;&#39;</span>);
<a name="l00715"></a>00715                 <span class="keywordflow">return</span> $cleaned_url;
<a name="l00716"></a>00716         }
<a name="l00717"></a>00717 
<a name="l00718"></a><a class="code" href="classphpthumb__functions.html#ad7ede725cfcb053c5dbd50308deca6cd">00718</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#ad7ede725cfcb053c5dbd50308deca6cd">ParseURLbetter</a>(<a class="code" href="miscellaneous_2websearch_2data__read_8ejs_8php.html#a8d5b9b337ab7c5f5a8c5f8d774e0c6b5">$url</a>) {
<a name="l00719"></a>00719                 $parsedURL = @parse_url(<a class="code" href="miscellaneous_2websearch_2data__read_8ejs_8php.html#a8d5b9b337ab7c5f5a8c5f8d774e0c6b5">$url</a>);
<a name="l00720"></a>00720                 <span class="keywordflow">if</span> (!@$parsedURL[<span class="stringliteral">&#39;port&#39;</span>]) {
<a name="l00721"></a>00721                         <span class="keywordflow">switch</span> (strtolower(@$parsedURL[<span class="stringliteral">&#39;scheme&#39;</span>])) {
<a name="l00722"></a>00722                                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;ftp&#39;</span>:
<a name="l00723"></a>00723                                         $parsedURL[<span class="stringliteral">&#39;port&#39;</span>] = 21;
<a name="l00724"></a>00724                                         <span class="keywordflow">break</span>;
<a name="l00725"></a>00725                                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;https&#39;</span>:
<a name="l00726"></a>00726                                         $parsedURL[<span class="stringliteral">&#39;port&#39;</span>] = 443;
<a name="l00727"></a>00727                                         <span class="keywordflow">break</span>;
<a name="l00728"></a>00728                                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;http&#39;</span>:
<a name="l00729"></a>00729                                         $parsedURL[<span class="stringliteral">&#39;port&#39;</span>] = 80;
<a name="l00730"></a>00730                                         <span class="keywordflow">break</span>;
<a name="l00731"></a>00731                         }
<a name="l00732"></a>00732                 }
<a name="l00733"></a>00733                 <span class="keywordflow">return</span> $parsedURL;
<a name="l00734"></a>00734         }
<a name="l00735"></a>00735 
<a name="l00736"></a><a class="code" href="classphpthumb__functions.html#ab3a344937946aa396752b10e457f8d73">00736</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#ab3a344937946aa396752b10e457f8d73">SafeURLread</a>(<a class="code" href="miscellaneous_2websearch_2data__read_8ejs_8php.html#a8d5b9b337ab7c5f5a8c5f8d774e0c6b5">$url</a>, &amp;$error, $timeout=10, $followredirects=<span class="keyword">true</span>) {
<a name="l00737"></a>00737                 $error = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00738"></a>00738 
<a name="l00739"></a>00739                 $parsed_url = <a class="code" href="classphpthumb__functions.html#ad7ede725cfcb053c5dbd50308deca6cd">phpthumb_functions::ParseURLbetter</a>(<a class="code" href="miscellaneous_2websearch_2data__read_8ejs_8php.html#a8d5b9b337ab7c5f5a8c5f8d774e0c6b5">$url</a>);
<a name="l00740"></a>00740                 $alreadyLookedAtURLs[trim(<a class="code" href="miscellaneous_2websearch_2data__read_8ejs_8php.html#a8d5b9b337ab7c5f5a8c5f8d774e0c6b5">$url</a>)] = <span class="keyword">true</span>;
<a name="l00741"></a>00741 
<a name="l00742"></a>00742                 <span class="keywordflow">while</span> (<span class="keyword">true</span>) {
<a name="l00743"></a>00743                         $tryagain = <span class="keyword">false</span>;
<a name="l00744"></a>00744                         <a class="code" href="administration_2lists_2data_8php.html#ad66cfed6c1f454fbc3f3c6fdc8842a7b">$rawData</a> = <a class="code" href="classphpthumb__functions.html#a53dae9e5e9604e546f0e4f836fc69240">phpthumb_functions::URLreadFsock</a>(@$parsed_url[<span class="stringliteral">&#39;host&#39;</span>], @$parsed_url[<span class="stringliteral">&#39;path&#39;</span>].<span class="charliteral">&#39;?&#39;</span>.@$parsed_url[<span class="stringliteral">&#39;query&#39;</span>], $errstr, <span class="keyword">true</span>, (@$parsed_url[<span class="stringliteral">&#39;port&#39;</span>] ? @$parsed_url[<span class="stringliteral">&#39;port&#39;</span>] : 80), $timeout);
<a name="l00745"></a>00745                         <span class="keywordflow">if</span> (eregi(<span class="stringliteral">&#39;302 [a-z ]+; Location\\: (http.*)&#39;</span>, $errstr, $matches)) {
<a name="l00746"></a>00746                                 $matches[1] = trim(@$matches[1]);
<a name="l00747"></a>00747                                 <span class="keywordflow">if</span> (!@$alreadyLookedAtURLs[$matches[1]]) {
<a name="l00748"></a>00748                                         <span class="comment">// loop through and examine new URL</span>
<a name="l00749"></a>00749                                         $error .= <span class="stringliteral">&#39;URL &quot;&#39;</span>.$url.<span class="stringliteral">&#39;&quot; redirected to &quot;&#39;</span>.$matches[1].<span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l00750"></a>00750 
<a name="l00751"></a>00751                                         $tryagain = <span class="keyword">true</span>;
<a name="l00752"></a>00752                                         $alreadyLookedAtURLs[$matches[1]] = <span class="keyword">true</span>;
<a name="l00753"></a>00753                                         $parsed_url = <a class="code" href="classphpthumb__functions.html#ad7ede725cfcb053c5dbd50308deca6cd">phpthumb_functions::ParseURLbetter</a>($matches[1]);
<a name="l00754"></a>00754                                 }
<a name="l00755"></a>00755                         }
<a name="l00756"></a>00756                         <span class="keywordflow">if</span> (!$tryagain) {
<a name="l00757"></a>00757                                 <span class="keywordflow">break</span>;
<a name="l00758"></a>00758                         }
<a name="l00759"></a>00759                 }
<a name="l00760"></a>00760 
<a name="l00761"></a>00761                 <span class="keywordflow">if</span> (<a class="code" href="administration_2lists_2data_8php.html#ad66cfed6c1f454fbc3f3c6fdc8842a7b">$rawData</a> === <span class="keyword">false</span>) {
<a name="l00762"></a>00762                         $error .= <span class="stringliteral">&#39;Error opening &quot;&#39;</span>.$url.<span class="stringliteral">&#39;&quot;:&#39;</span>.<span class="stringliteral">&quot;\n\n&quot;</span>.$errstr;
<a name="l00763"></a>00763                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00764"></a>00764                 } <a class="code" href="php_thumb_8demo_8check_8php.html#af92779326267616cd7c3cdaaa9484bc9">elseif</a> (<a class="code" href="administration_2lists_2data_8php.html#ad66cfed6c1f454fbc3f3c6fdc8842a7b">$rawData</a> === null) {
<a name="l00765"></a>00765                         <span class="comment">// fall through</span>
<a name="l00766"></a>00766                         $error .= <span class="stringliteral">&#39;Error opening &quot;&#39;</span>.$url.<span class="stringliteral">&#39;&quot;:&#39;</span>.<span class="stringliteral">&quot;\n\n&quot;</span>.$errstr;
<a name="l00767"></a>00767                 } <span class="keywordflow">else</span> {
<a name="l00768"></a>00768                         <span class="keywordflow">return</span> <a class="code" href="administration_2lists_2data_8php.html#ad66cfed6c1f454fbc3f3c6fdc8842a7b">$rawData</a>;
<a name="l00769"></a>00769                 }
<a name="l00770"></a>00770 
<a name="l00771"></a>00771                 <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;curl_version&#39;</span>) &amp;&amp; !<a class="code" href="classphpthumb__functions.html#ab83588a52cc1a218c8183f03872e4a25">phpthumb_functions::FunctionIsDisabled</a>(<span class="stringliteral">&#39;curl_exec&#39;</span>)) {
<a name="l00772"></a>00772                         $ch = curl_init();
<a name="l00773"></a>00773                         curl_setopt($ch, CURLOPT_URL, <a class="code" href="miscellaneous_2websearch_2data__read_8ejs_8php.html#a8d5b9b337ab7c5f5a8c5f8d774e0c6b5">$url</a>);
<a name="l00774"></a>00774                         curl_setopt($ch, CURLOPT_HEADER, <span class="keyword">false</span>);
<a name="l00775"></a>00775                         curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="keyword">true</span>);
<a name="l00776"></a>00776                         curl_setopt($ch, CURLOPT_BINARYTRANSFER, <span class="keyword">true</span>);
<a name="l00777"></a>00777                         curl_setopt($ch, CURLOPT_TIMEOUT, $timeout);
<a name="l00778"></a>00778                         <a class="code" href="administration_2lists_2data_8php.html#ad66cfed6c1f454fbc3f3c6fdc8842a7b">$rawData</a> = curl_exec($ch);
<a name="l00779"></a>00779                         curl_close($ch);
<a name="l00780"></a>00780                         <span class="keywordflow">if</span> (strlen(<a class="code" href="administration_2lists_2data_8php.html#ad66cfed6c1f454fbc3f3c6fdc8842a7b">$rawData</a>) &gt; 0) {
<a name="l00781"></a>00781                                 $error .= <span class="stringliteral">&#39;CURL succeeded (&#39;</span>.strlen(<a class="code" href="administration_2lists_2data_8php.html#ad66cfed6c1f454fbc3f3c6fdc8842a7b">$rawData</a>).<span class="stringliteral">&#39; bytes); &#39;</span>;
<a name="l00782"></a>00782                                 <span class="keywordflow">return</span> <a class="code" href="administration_2lists_2data_8php.html#ad66cfed6c1f454fbc3f3c6fdc8842a7b">$rawData</a>;
<a name="l00783"></a>00783                         }
<a name="l00784"></a>00784                         $error .= <span class="stringliteral">&#39;CURL available but returned no data; &#39;</span>;
<a name="l00785"></a>00785                 } <span class="keywordflow">else</span> {
<a name="l00786"></a>00786                         $error .= <span class="stringliteral">&#39;CURL unavailable; &#39;</span>;
<a name="l00787"></a>00787                 }
<a name="l00788"></a>00788 
<a name="l00789"></a>00789                 $BrokenURLfopenPHPversions = array(<span class="stringliteral">&#39;4.4.2&#39;</span>);
<a name="l00790"></a>00790                 <span class="keywordflow">if</span> (in_array(phpversion(), $BrokenURLfopenPHPversions)) {
<a name="l00791"></a>00791                         $error .= <span class="stringliteral">&#39;fopen(URL) broken in PHP v&#39;</span>.phpversion().<span class="stringliteral">&#39;; &#39;</span>;
<a name="l00792"></a>00792                 } <a class="code" href="php_thumb_8demo_8check_8php.html#af92779326267616cd7c3cdaaa9484bc9">elseif</a> (@ini_get(<span class="stringliteral">&#39;allow_url_fopen&#39;</span>)) {
<a name="l00793"></a>00793                         <a class="code" href="administration_2lists_2data_8php.html#ad66cfed6c1f454fbc3f3c6fdc8842a7b">$rawData</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00794"></a>00794                         $error_fopen = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00795"></a>00795                         ob_start();
<a name="l00796"></a>00796                         <span class="keywordflow">if</span> ($fp = fopen(<a class="code" href="miscellaneous_2websearch_2data__read_8ejs_8php.html#a8d5b9b337ab7c5f5a8c5f8d774e0c6b5">$url</a>, <span class="stringliteral">&#39;rb&#39;</span>)) {
<a name="l00797"></a>00797                                 <span class="keywordflow">do</span> {
<a name="l00798"></a>00798                                         $buffer = fread($fp, 8192);
<a name="l00799"></a>00799                                         <a class="code" href="administration_2lists_2data_8php.html#ad66cfed6c1f454fbc3f3c6fdc8842a7b">$rawData</a> .= $buffer;
<a name="l00800"></a>00800                                 } <span class="keywordflow">while</span> (strlen($buffer) &gt; 0);
<a name="l00801"></a>00801                                 fclose($fp);
<a name="l00802"></a>00802                         } <span class="keywordflow">else</span> {
<a name="l00803"></a>00803                                 $error_fopen .= trim(strip_tags(ob_get_contents()));
<a name="l00804"></a>00804                         }
<a name="l00805"></a>00805                         ob_end_clean();
<a name="l00806"></a>00806                         $error .= $error_fopen;
<a name="l00807"></a>00807                         <span class="keywordflow">if</span> (!$error_fopen) {
<a name="l00808"></a>00808                                 $error .= <span class="stringliteral">&#39;; &quot;allow_url_fopen&quot; succeeded (&#39;</span>.strlen(<a class="code" href="administration_2lists_2data_8php.html#ad66cfed6c1f454fbc3f3c6fdc8842a7b">$rawData</a>).<span class="stringliteral">&#39; bytes); &#39;</span>;
<a name="l00809"></a>00809                                 <span class="keywordflow">return</span> <a class="code" href="administration_2lists_2data_8php.html#ad66cfed6c1f454fbc3f3c6fdc8842a7b">$rawData</a>;
<a name="l00810"></a>00810                         }
<a name="l00811"></a>00811                         $error .= <span class="stringliteral">&#39;; &quot;allow_url_fopen&quot; enabled but returned no data (&#39;</span>.$error_fopen.<span class="stringliteral">&#39;); &#39;</span>;
<a name="l00812"></a>00812                 } <span class="keywordflow">else</span> {
<a name="l00813"></a>00813                         $error .= <span class="stringliteral">&#39;&quot;allow_url_fopen&quot; disabled; &#39;</span>;
<a name="l00814"></a>00814                 }
<a name="l00815"></a>00815 
<a name="l00816"></a>00816                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00817"></a>00817         }
<a name="l00818"></a>00818 
<a name="l00819"></a><a class="code" href="classphpthumb__functions.html#a224289e3e7fff1ccd097aae04b3ed181">00819</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#a224289e3e7fff1ccd097aae04b3ed181">EnsureDirectoryExists</a>($dirname) {
<a name="l00820"></a>00820                 $directory_elements = explode(DIRECTORY_SEPARATOR, $dirname);
<a name="l00821"></a>00821                 $startoffset = (!$directory_elements[0] ? 2 : 1);  <span class="comment">// unix with leading &quot;/&quot; then start with 2nd element; Windows with leading &quot;c:\&quot; then start with 1st element</span>
<a name="l00822"></a>00822                 $open_basedirs = split(<span class="stringliteral">&#39;[;:]&#39;</span>, ini_get(<span class="stringliteral">&#39;open_basedir&#39;</span>));
<a name="l00823"></a>00823                 <span class="keywordflow">foreach</span> ($open_basedirs as $key =&gt; $open_basedir) {
<a name="l00824"></a>00824                         <span class="keywordflow">if</span> (ereg(<span class="charliteral">&#39;^&#39;</span>.preg_quote($open_basedir), $dirname) &amp;&amp; (strlen($dirname) &gt; strlen($open_basedir))) {
<a name="l00825"></a>00825                                 $startoffset = count(explode(DIRECTORY_SEPARATOR, $open_basedir));
<a name="l00826"></a>00826                                 <span class="keywordflow">break</span>;
<a name="l00827"></a>00827                         }
<a name="l00828"></a>00828                 }
<a name="l00829"></a>00829                 $i = $startoffset;
<a name="l00830"></a>00830                 $endoffset = count($directory_elements);
<a name="l00831"></a>00831                 <span class="keywordflow">for</span> ($i = $startoffset; $i &lt;= $endoffset; $i++) {
<a name="l00832"></a>00832                         $test_directory = implode(DIRECTORY_SEPARATOR, array_slice($directory_elements, 0, $i));
<a name="l00833"></a>00833                         <span class="keywordflow">if</span> (!$test_directory) {
<a name="l00834"></a>00834                                 <span class="keywordflow">continue</span>;
<a name="l00835"></a>00835                         }
<a name="l00836"></a>00836                         <span class="keywordflow">if</span> (!@is_dir($test_directory)) {
<a name="l00837"></a>00837                                 <span class="keywordflow">if</span> (@file_exists($test_directory)) {
<a name="l00838"></a>00838                                         <span class="comment">// directory name already exists as a file</span>
<a name="l00839"></a>00839                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00840"></a>00840                                 }
<a name="l00841"></a>00841                                 @mkdir($test_directory, 0755);
<a name="l00842"></a>00842                                 @chmod($test_directory, 0755);
<a name="l00843"></a>00843                                 <span class="keywordflow">if</span> (!@is_dir($test_directory) || !@is_writeable($test_directory)) {
<a name="l00844"></a>00844                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00845"></a>00845                                 }
<a name="l00846"></a>00846                         }
<a name="l00847"></a>00847                 }
<a name="l00848"></a>00848                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00849"></a>00849         }
<a name="l00850"></a>00850 
<a name="l00851"></a>00851 
<a name="l00852"></a><a class="code" href="classphpthumb__functions.html#a6334e519682ebb7db2d1201f4682edc4">00852</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#a6334e519682ebb7db2d1201f4682edc4">GetAllFilesInSubfolders</a>($dirname) {
<a name="l00853"></a>00853                 $AllFiles = array();
<a name="l00854"></a>00854                 $dirname = rtrim(realpath($dirname), <span class="stringliteral">&#39;/\\&#39;</span>);
<a name="l00855"></a>00855                 <span class="keywordflow">if</span> ($dirhandle = @opendir($dirname)) {
<a name="l00856"></a>00856                         <span class="keywordflow">while</span> ((<a class="code" href="tokenizer__test_8php.html#aa1bfbd27060176201b271918dff57e8f">$file</a> = readdir($dirhandle)) !== <span class="keyword">false</span>) {
<a name="l00857"></a>00857                                 $fullfilename = $dirname.DIRECTORY_SEPARATOR.$file;
<a name="l00858"></a>00858                                 <span class="keywordflow">if</span> (is_file($fullfilename)) {
<a name="l00859"></a>00859                                         $AllFiles[] = $fullfilename;
<a name="l00860"></a>00860                                 } <a class="code" href="php_thumb_8demo_8check_8php.html#af92779326267616cd7c3cdaaa9484bc9">elseif</a> (is_dir($fullfilename)) {
<a name="l00861"></a>00861                                         <span class="keywordflow">switch</span> (<a class="code" href="tokenizer__test_8php.html#aa1bfbd27060176201b271918dff57e8f">$file</a>) {
<a name="l00862"></a>00862                                                 <span class="keywordflow">case</span> <span class="charliteral">&#39;.&#39;</span>:
<a name="l00863"></a>00863                                                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;..&#39;</span>:
<a name="l00864"></a>00864                                                         <span class="keywordflow">break</span>;
<a name="l00865"></a>00865 
<a name="l00866"></a>00866                                                 <span class="keywordflow">default</span>:
<a name="l00867"></a>00867                                                         $AllFiles[] = $fullfilename;
<a name="l00868"></a>00868                                                         $subfiles = <a class="code" href="classphpthumb__functions.html#a6334e519682ebb7db2d1201f4682edc4">phpthumb_functions::GetAllFilesInSubfolders</a>($fullfilename);
<a name="l00869"></a>00869                                                         <span class="keywordflow">foreach</span> ($subfiles as <a class="code" href="actions_8php.html#a6b7de8d10c540db2f1631e68b2aa0538">$filename</a>) {
<a name="l00870"></a>00870                                                                 $AllFiles[] = <a class="code" href="actions_8php.html#a6b7de8d10c540db2f1631e68b2aa0538">$filename</a>;
<a name="l00871"></a>00871                                                         }
<a name="l00872"></a>00872                                                         <span class="keywordflow">break</span>;
<a name="l00873"></a>00873                                         }
<a name="l00874"></a>00874                                 } <span class="keywordflow">else</span> {
<a name="l00875"></a>00875                                         <span class="comment">// ignore?</span>
<a name="l00876"></a>00876                                 }
<a name="l00877"></a>00877                         }
<a name="l00878"></a>00878                         closedir($dirhandle);
<a name="l00879"></a>00879                 }
<a name="l00880"></a>00880                 sort($AllFiles);
<a name="l00881"></a>00881                 <span class="keywordflow">return</span> array_unique($AllFiles);
<a name="l00882"></a>00882         }
<a name="l00883"></a>00883 
<a name="l00884"></a>00884 
<a name="l00885"></a><a class="code" href="classphpthumb__functions.html#a110676c86529253850f744796baeb62d">00885</a>         <span class="keyword">function</span> <a class="code" href="classphpthumb__functions.html#a110676c86529253850f744796baeb62d">SanitizeFilename</a>(<a class="code" href="actions_8php.html#a6b7de8d10c540db2f1631e68b2aa0538">$filename</a>) {
<a name="l00886"></a>00886                 <a class="code" href="actions_8php.html#a6b7de8d10c540db2f1631e68b2aa0538">$filename</a> = ereg_replace(<span class="stringliteral">&#39;[^&#39;</span>.preg_quote(<span class="stringliteral">&#39; !#$%^()+,-.;&lt;&gt;=@[]_{}&#39;</span>).<span class="stringliteral">&#39;a-zA-Z0-9]&#39;</span>, <span class="charliteral">&#39;_&#39;</span>, <a class="code" href="actions_8php.html#a6b7de8d10c540db2f1631e68b2aa0538">$filename</a>);
<a name="l00887"></a>00887                 <span class="keywordflow">if</span> (<a class="code" href="classphpthumb__functions.html#af53f41b3482e6bed2082daa0ebfd96c0">phpthumb_functions::version_compare_replacement</a>(phpversion(), <span class="stringliteral">&#39;4.1.0&#39;</span>, <span class="stringliteral">&#39;&gt;=&#39;</span>)) {
<a name="l00888"></a>00888                         <a class="code" href="actions_8php.html#a6b7de8d10c540db2f1631e68b2aa0538">$filename</a> = trim(<a class="code" href="actions_8php.html#a6b7de8d10c540db2f1631e68b2aa0538">$filename</a>, <span class="charliteral">&#39;.&#39;</span>);
<a name="l00889"></a>00889                 }
<a name="l00890"></a>00890                 <span class="keywordflow">return</span> <a class="code" href="actions_8php.html#a6b7de8d10c540db2f1631e68b2aa0538">$filename</a>;
<a name="l00891"></a>00891         }
<a name="l00892"></a>00892 
<a name="l00893"></a>00893 }
<a name="l00894"></a>00894 
<a name="l00895"></a>00895 
<a name="l00897"></a>00897 
<a name="l00898"></a>00898 
<a name="l00899"></a>00899 <span class="keywordflow">if</span> (!function_exists(<span class="stringliteral">&#39;gd_info&#39;</span>)) {
<a name="l00900"></a>00900         <span class="comment">// built into PHP v4.3.0+ (with bundled GD2 library)</span>
<a name="l00901"></a>00901         <span class="keyword">function</span> gd_info() {
<a name="l00902"></a>00902                 <span class="keyword">static</span> <a class="code" href="php_thumb_8demo_8check_8php.html#af2c7b7086347d2db2cbba6ff28df96e7">$gd_info</a> = array();
<a name="l00903"></a>00903                 <span class="keywordflow">if</span> (empty(<a class="code" href="php_thumb_8demo_8check_8php.html#af2c7b7086347d2db2cbba6ff28df96e7">$gd_info</a>)) {
<a name="l00904"></a>00904                         <span class="comment">// based on code by johnschaefer at gmx dot de</span>
<a name="l00905"></a>00905                         <span class="comment">// from PHP help on gd_info()</span>
<a name="l00906"></a>00906                         <a class="code" href="php_thumb_8demo_8check_8php.html#af2c7b7086347d2db2cbba6ff28df96e7">$gd_info</a> = array(
<a name="l00907"></a>00907                                 <span class="stringliteral">&#39;GD Version&#39;</span>         =&gt; <span class="stringliteral">&#39;&#39;</span>,
<a name="l00908"></a>00908                                 <span class="stringliteral">&#39;FreeType Support&#39;</span>   =&gt; <span class="keyword">false</span>,
<a name="l00909"></a>00909                                 <span class="stringliteral">&#39;FreeType Linkage&#39;</span>   =&gt; <span class="stringliteral">&#39;&#39;</span>,
<a name="l00910"></a>00910                                 <span class="stringliteral">&#39;T1Lib Support&#39;</span>      =&gt; <span class="keyword">false</span>,
<a name="l00911"></a>00911                                 <span class="stringliteral">&#39;GIF Read Support&#39;</span>   =&gt; <span class="keyword">false</span>,
<a name="l00912"></a>00912                                 <span class="stringliteral">&#39;GIF Create Support&#39;</span> =&gt; <span class="keyword">false</span>,
<a name="l00913"></a>00913                                 <span class="stringliteral">&#39;JPG Support&#39;</span>        =&gt; <span class="keyword">false</span>,
<a name="l00914"></a>00914                                 <span class="stringliteral">&#39;PNG Support&#39;</span>        =&gt; <span class="keyword">false</span>,
<a name="l00915"></a>00915                                 <span class="stringliteral">&#39;WBMP Support&#39;</span>       =&gt; <span class="keyword">false</span>,
<a name="l00916"></a>00916                                 <span class="stringliteral">&#39;XBM Support&#39;</span>        =&gt; <span class="keyword">false</span>
<a name="l00917"></a>00917                         );
<a name="l00918"></a>00918                         $phpinfo_array = <a class="code" href="classphpthumb__functions.html#a999167c99797fa10b27c9f9d8d4d6814">phpthumb_functions::phpinfo_array</a>();
<a name="l00919"></a>00919                         <span class="keywordflow">foreach</span> ($phpinfo_array as <a class="code" href="tokenizer__test_8php.html#a52f469b0182d9abac2d0f20548680c9c">$line</a>) {
<a name="l00920"></a>00920                                 $line = trim(strip_tags($line));
<a name="l00921"></a>00921                                 <span class="keywordflow">foreach</span> (<a class="code" href="php_thumb_8demo_8check_8php.html#af2c7b7086347d2db2cbba6ff28df96e7">$gd_info</a> as $key =&gt; $value) {
<a name="l00922"></a>00922                                         <span class="comment">//if (strpos($line, $key) !== false) {</span>
<a name="l00923"></a>00923                                         <span class="keywordflow">if</span> (strpos($line, $key) === 0) {
<a name="l00924"></a>00924                                                 $newvalue = trim(str_replace($key, <span class="stringliteral">&#39;&#39;</span>, $line));
<a name="l00925"></a>00925                                                 <a class="code" href="php_thumb_8demo_8check_8php.html#af2c7b7086347d2db2cbba6ff28df96e7">$gd_info</a>[$key] = $newvalue;
<a name="l00926"></a>00926                                         }
<a name="l00927"></a>00927                                 }
<a name="l00928"></a>00928                         }
<a name="l00929"></a>00929                         <span class="keywordflow">if</span> (empty(<a class="code" href="php_thumb_8demo_8check_8php.html#af2c7b7086347d2db2cbba6ff28df96e7">$gd_info</a>[<span class="stringliteral">&#39;GD Version&#39;</span>])) {
<a name="l00930"></a>00930                                 <span class="comment">// probable cause: &quot;phpinfo() disabled for security reasons&quot;</span>
<a name="l00931"></a>00931                                 <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;ImageTypes&#39;</span>)) {
<a name="l00932"></a>00932                                         $imagetypes = ImageTypes();
<a name="l00933"></a>00933                                         <span class="keywordflow">if</span> ($imagetypes &amp; IMG_PNG) {
<a name="l00934"></a>00934                                                 <a class="code" href="php_thumb_8demo_8check_8php.html#af2c7b7086347d2db2cbba6ff28df96e7">$gd_info</a>[<span class="stringliteral">&#39;PNG Support&#39;</span>] = <span class="keyword">true</span>;
<a name="l00935"></a>00935                                         }
<a name="l00936"></a>00936                                         <span class="keywordflow">if</span> ($imagetypes &amp; IMG_GIF) {
<a name="l00937"></a>00937                                                 <a class="code" href="php_thumb_8demo_8check_8php.html#af2c7b7086347d2db2cbba6ff28df96e7">$gd_info</a>[<span class="stringliteral">&#39;GIF Create Support&#39;</span>] = <span class="keyword">true</span>;
<a name="l00938"></a>00938                                         }
<a name="l00939"></a>00939                                         <span class="keywordflow">if</span> ($imagetypes &amp; IMG_JPG) {
<a name="l00940"></a>00940                                                 <a class="code" href="php_thumb_8demo_8check_8php.html#af2c7b7086347d2db2cbba6ff28df96e7">$gd_info</a>[<span class="stringliteral">&#39;JPG Support&#39;</span>] = <span class="keyword">true</span>;
<a name="l00941"></a>00941                                         }
<a name="l00942"></a>00942                                         <span class="keywordflow">if</span> ($imagetypes &amp; IMG_WBMP) {
<a name="l00943"></a>00943                                                 <a class="code" href="php_thumb_8demo_8check_8php.html#af2c7b7086347d2db2cbba6ff28df96e7">$gd_info</a>[<span class="stringliteral">&#39;WBMP Support&#39;</span>] = <span class="keyword">true</span>;
<a name="l00944"></a>00944                                         }
<a name="l00945"></a>00945                                 }
<a name="l00946"></a>00946                                 <span class="comment">// to determine capability of GIF creation, try to use ImageCreateFromGIF on a 1px GIF</span>
<a name="l00947"></a>00947                                 <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;ImageCreateFromGIF&#39;</span>)) {
<a name="l00948"></a>00948                                         <span class="keywordflow">if</span> ($tempfilename = <a class="code" href="classphpthumb.html#ad1351cd5e7f10718ff06ae752d23349c">phpthumb::phpThumb_tempnam</a>()) {
<a name="l00949"></a>00949                                                 <span class="keywordflow">if</span> ($fp_tempfile = @fopen($tempfilename, <span class="stringliteral">&#39;wb&#39;</span>)) {
<a name="l00950"></a>00950                                                         fwrite($fp_tempfile, base64_decode(<span class="stringliteral">&#39;R0lGODlhAQABAIAAAH//AP///ywAAAAAAQABAAACAUQAOw==&#39;</span>)); <span class="comment">// very simple 1px GIF file base64-encoded as string</span>
<a name="l00951"></a>00951                                                         fclose($fp_tempfile);
<a name="l00952"></a>00952 
<a name="l00953"></a>00953                                                         <span class="comment">// if we can convert the GIF file to a GD image then GIF create support must be enabled, otherwise it&#39;s not</span>
<a name="l00954"></a>00954                                                         <a class="code" href="php_thumb_8demo_8check_8php.html#af2c7b7086347d2db2cbba6ff28df96e7">$gd_info</a>[<span class="stringliteral">&#39;GIF Read Support&#39;</span>] = (bool) @ImageCreateFromGIF($tempfilename);
<a name="l00955"></a>00955                                                 }
<a name="l00956"></a>00956                                                 unlink($tempfilename);
<a name="l00957"></a>00957                                         }
<a name="l00958"></a>00958                                 }
<a name="l00959"></a>00959                                 <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;ImageCreateTrueColor&#39;</span>) &amp;&amp; @ImageCreateTrueColor(1, 1)) {
<a name="l00960"></a>00960                                         <a class="code" href="php_thumb_8demo_8check_8php.html#af2c7b7086347d2db2cbba6ff28df96e7">$gd_info</a>[<span class="stringliteral">&#39;GD Version&#39;</span>] = <span class="stringliteral">&#39;2.0.1 or higher (assumed)&#39;</span>;
<a name="l00961"></a>00961                                 } <a class="code" href="php_thumb_8demo_8check_8php.html#af92779326267616cd7c3cdaaa9484bc9">elseif</a> (function_exists(<span class="stringliteral">&#39;ImageCreate&#39;</span>) &amp;&amp; @ImageCreate(1, 1)) {
<a name="l00962"></a>00962                                         <a class="code" href="php_thumb_8demo_8check_8php.html#af2c7b7086347d2db2cbba6ff28df96e7">$gd_info</a>[<span class="stringliteral">&#39;GD Version&#39;</span>] = <span class="stringliteral">&#39;1.6.0 or higher (assumed)&#39;</span>;
<a name="l00963"></a>00963                                 }
<a name="l00964"></a>00964                         }
<a name="l00965"></a>00965                 }
<a name="l00966"></a>00966                 <span class="keywordflow">return</span> <a class="code" href="php_thumb_8demo_8check_8php.html#af2c7b7086347d2db2cbba6ff28df96e7">$gd_info</a>;
<a name="l00967"></a>00967         }
<a name="l00968"></a>00968 }
<a name="l00969"></a>00969 
<a name="l00970"></a>00970 
<a name="l00971"></a>00971 <span class="keywordflow">if</span> (!function_exists(<span class="stringliteral">&#39;is_executable&#39;</span>)) {
<a name="l00972"></a>00972         <span class="comment">// in PHP v3+, but v5.0+ for Windows</span>
<a name="l00973"></a>00973         <span class="keyword">function</span> is_executable(<a class="code" href="actions_8php.html#a6b7de8d10c540db2f1631e68b2aa0538">$filename</a>) {
<a name="l00974"></a>00974                 <span class="comment">// poor substitute, but better than nothing</span>
<a name="l00975"></a>00975                 <span class="keywordflow">return</span> file_exists(<a class="code" href="actions_8php.html#a6b7de8d10c540db2f1631e68b2aa0538">$filename</a>);
<a name="l00976"></a>00976         }
<a name="l00977"></a>00977 }
<a name="l00978"></a>00978 
<a name="l00979"></a>00979 
<a name="l00980"></a>00980 <span class="keywordflow">if</span> (!function_exists(<span class="stringliteral">&#39;preg_quote&#39;</span>)) {
<a name="l00981"></a>00981         <span class="comment">// included in PHP v3.0.9+, but may be unavailable if not compiled in</span>
<a name="l00982"></a>00982         <span class="keyword">function</span> preg_quote($string, $delimiter=<span class="charliteral">&#39;\\&#39;</span>) {
<a name="l00983"></a>00983                 <span class="keyword">static</span> $preg_quote_array = array();
<a name="l00984"></a>00984                 <span class="keywordflow">if</span> (empty($preg_quote_array)) {
<a name="l00985"></a>00985                         $escapeables = <span class="stringliteral">&#39;.\\+*?[^]$(){}=!&lt;&gt;|:&#39;</span>;
<a name="l00986"></a>00986                         <span class="keywordflow">for</span> ($i = 0; $i &lt; strlen($escapeables); $i++) {
<a name="l00987"></a>00987                                 $strtr_preg_quote[$escapeables{$i}] = $delimiter.$escapeables{$i};
<a name="l00988"></a>00988                         }
<a name="l00989"></a>00989                 }
<a name="l00990"></a>00990                 <span class="keywordflow">return</span> strtr($string, $strtr_preg_quote);
<a name="l00991"></a>00991         }
<a name="l00992"></a>00992 }
<a name="l00993"></a>00993 
<a name="l00994"></a>00994 <span class="keywordflow">if</span> (!function_exists(<span class="stringliteral">&#39;file_get_contents&#39;</span>)) {
<a name="l00995"></a>00995         <span class="comment">// included in PHP v4.3.0+</span>
<a name="l00996"></a>00996         <span class="keyword">function</span> file_get_contents(<a class="code" href="actions_8php.html#a6b7de8d10c540db2f1631e68b2aa0538">$filename</a>) {
<a name="l00997"></a>00997                 <span class="keywordflow">if</span> (eregi(<span class="stringliteral">&#39;^(f|ht)tp\://&#39;</span>, <a class="code" href="actions_8php.html#a6b7de8d10c540db2f1631e68b2aa0538">$filename</a>)) {
<a name="l00998"></a>00998                         <span class="keywordflow">return</span> SafeURLread(<a class="code" href="actions_8php.html#a6b7de8d10c540db2f1631e68b2aa0538">$filename</a>, $error);
<a name="l00999"></a>00999                 }
<a name="l01000"></a>01000                 <span class="keywordflow">if</span> ($fp = @fopen(<a class="code" href="actions_8php.html#a6b7de8d10c540db2f1631e68b2aa0538">$filename</a>, <span class="stringliteral">&#39;rb&#39;</span>)) {
<a name="l01001"></a>01001                         <a class="code" href="administration_2lists_2data_8php.html#ad66cfed6c1f454fbc3f3c6fdc8842a7b">$rawData</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01002"></a>01002                         <span class="keywordflow">do</span> {
<a name="l01003"></a>01003                                 $buffer = fread($fp, 8192);
<a name="l01004"></a>01004                                 <a class="code" href="administration_2lists_2data_8php.html#ad66cfed6c1f454fbc3f3c6fdc8842a7b">$rawData</a> .= $buffer;
<a name="l01005"></a>01005                         } <span class="keywordflow">while</span> (strlen($buffer) &gt; 0);
<a name="l01006"></a>01006                         fclose($fp);
<a name="l01007"></a>01007                         <span class="keywordflow">return</span> <a class="code" href="administration_2lists_2data_8php.html#ad66cfed6c1f454fbc3f3c6fdc8842a7b">$rawData</a>;
<a name="l01008"></a>01008                 }
<a name="l01009"></a>01009                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01010"></a>01010         }
<a name="l01011"></a>01011 }
<a name="l01012"></a>01012 
<a name="l01013"></a>01013 
<a name="l01014"></a>01014 <span class="keywordflow">if</span> (!function_exists(<span class="stringliteral">&#39;file_put_contents&#39;</span>)) {
<a name="l01015"></a>01015         <span class="comment">// included in PHP v5.0.0+</span>
<a name="l01016"></a>01016         <span class="keyword">function</span> file_put_contents(<a class="code" href="actions_8php.html#a6b7de8d10c540db2f1631e68b2aa0538">$filename</a>, $filedata) {
<a name="l01017"></a>01017                 <span class="keywordflow">if</span> ($fp = @fopen(<a class="code" href="actions_8php.html#a6b7de8d10c540db2f1631e68b2aa0538">$filename</a>, <span class="stringliteral">&#39;wb&#39;</span>)) {
<a name="l01018"></a>01018                         fwrite($fp, $filedata);
<a name="l01019"></a>01019                         fclose($fp);
<a name="l01020"></a>01020                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01021"></a>01021                 }
<a name="l01022"></a>01022                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01023"></a>01023         }
<a name="l01024"></a>01024 }
<a name="l01025"></a>01025 
<a name="l01026"></a>01026 <span class="keywordflow">if</span> (!function_exists(<span class="stringliteral">&#39;imagealphablending&#39;</span>)) {
<a name="l01027"></a>01027         <span class="comment">// built-in function requires PHP v4.0.6+ *and* GD v2.0.1+</span>
<a name="l01028"></a>01028         <span class="keyword">function</span> imagealphablending(&amp;$img, $blendmode=<span class="keyword">true</span>) {
<a name="l01029"></a>01029                 <span class="comment">// do nothing, this function is declared here just to</span>
<a name="l01030"></a>01030                 <span class="comment">// prevent runtime errors if GD2 is not available</span>
<a name="l01031"></a>01031                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01032"></a>01032         }
<a name="l01033"></a>01033 }
<a name="l01034"></a>01034 
<a name="l01035"></a>01035 <span class="keywordflow">if</span> (!function_exists(<span class="stringliteral">&#39;imagesavealpha&#39;</span>)) {
<a name="l01036"></a>01036         <span class="comment">// built-in function requires PHP v4.3.2+ *and* GD v2.0.1+</span>
<a name="l01037"></a>01037         <span class="keyword">function</span> imagesavealpha(&amp;$img, $blendmode=<span class="keyword">true</span>) {
<a name="l01038"></a>01038                 <span class="comment">// do nothing, this function is declared here just to</span>
<a name="l01039"></a>01039                 <span class="comment">// prevent runtime errors if GD2 is not available</span>
<a name="l01040"></a>01040                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01041"></a>01041         }
<a name="l01042"></a>01042 }
<a name="l01043"></a>01043 
<a name="l01044"></a>01044 ?&gt;
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="phpthumb_8functions_8php.html">phpthumb.functions.php</a>      </li>

    <li class="footer">Generated on Mon Feb 6 2012 00:16:21 for MitosEHR by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
