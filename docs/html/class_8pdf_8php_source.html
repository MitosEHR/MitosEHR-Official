<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>MitosEHR: C:/wamp/www/MitosEHR/lib/PhpDocumentor/phpDocumentor/Converters/PDF/default/class.pdf.php Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="logo_medium.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">MitosEHR
   &#160;<span id="projectnumber">Vega v1.0</span>
   </div>
   <div id="projectbrief">Electronic Health Record</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('class_8pdf_8php.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">C:/wamp/www/MitosEHR/lib/PhpDocumentor/phpDocumentor/Converters/PDF/default/class.pdf.php</div>  </div>
</div><!--header-->
<div class="contents">
<a href="class_8pdf_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00026"></a><a class="code" href="class_cpdf.html">00026</a> <span class="keyword">class </span><a class="code" href="class_cpdf.html">Cpdf</a> {
<a name="l00027"></a>00027 
<a name="l00031"></a><a class="code" href="class_cpdf.html#a46f3313956a33faef75586addfc256a3">00031</a> var <a class="code" href="class_cpdf.html#a46f3313956a33faef75586addfc256a3">$numObj</a>=0;
<a name="l00035"></a><a class="code" href="class_cpdf.html#a255f6b6db4c45b1418e9c15cf4e2bcdd">00035</a> var <a class="code" href="class_cpdf.html#a255f6b6db4c45b1418e9c15cf4e2bcdd">$objects</a> = array();
<a name="l00039"></a><a class="code" href="class_cpdf.html#ab73b03ba4d8210e1551ba6b4277c4735">00039</a> var <a class="code" href="class_cpdf.html#ab73b03ba4d8210e1551ba6b4277c4735">$catalogId</a>;
<a name="l00044"></a><a class="code" href="class_cpdf.html#ac330cfe6dbddd6c5d814439f97fbaf69">00044</a> var <a class="code" href="class_cpdf.html#ac330cfe6dbddd6c5d814439f97fbaf69">$fonts</a>=array(); 
<a name="l00048"></a><a class="code" href="class_cpdf.html#a2d5823c32698fc3761bb1254a0282b5e">00048</a> var <a class="code" href="class_cpdf.html#a2d5823c32698fc3761bb1254a0282b5e">$currentFont</a>=<span class="stringliteral">&#39;&#39;</span>;
<a name="l00052"></a><a class="code" href="class_cpdf.html#afe5d6644791e89099b37ce806592903a">00052</a> var <a class="code" href="class_cpdf.html#afe5d6644791e89099b37ce806592903a">$currentBaseFont</a>=<span class="stringliteral">&#39;&#39;</span>;
<a name="l00056"></a><a class="code" href="class_cpdf.html#a40d5e19fffea92115faffb8a58d5c6d6">00056</a> var <a class="code" href="class_cpdf.html#a40d5e19fffea92115faffb8a58d5c6d6">$currentFontNum</a>=0;
<a name="l00060"></a><a class="code" href="class_cpdf.html#a640e9f9a022022672baf0926e7b079ef">00060</a> var <a class="code" href="class_cpdf.html#a640e9f9a022022672baf0926e7b079ef">$currentNode</a>;
<a name="l00064"></a><a class="code" href="class_cpdf.html#af64cef3e8e7fe1dc79ff3293c12fb4cb">00064</a> var <a class="code" href="class_cpdf.html#af64cef3e8e7fe1dc79ff3293c12fb4cb">$currentPage</a>;
<a name="l00068"></a><a class="code" href="class_cpdf.html#a39303dffdd053136f221e31bb18ccd6b">00068</a> var <a class="code" href="class_cpdf.html#a39303dffdd053136f221e31bb18ccd6b">$currentContents</a>;
<a name="l00072"></a><a class="code" href="class_cpdf.html#a78cfbb4859f40b0d205596bf7542bc10">00072</a> var <a class="code" href="class_cpdf.html#a78cfbb4859f40b0d205596bf7542bc10">$numFonts</a>=0;
<a name="l00076"></a><a class="code" href="class_cpdf.html#a9c9591fc5b60e6bc98bc8898232d4844">00076</a> var <a class="code" href="class_cpdf.html#a9c9591fc5b60e6bc98bc8898232d4844">$currentColour</a>=array(<span class="charliteral">&#39;r&#39;</span>=&gt;-1,<span class="charliteral">&#39;g&#39;</span>=&gt;-1,<span class="charliteral">&#39;b&#39;</span>=&gt;-1);
<a name="l00080"></a><a class="code" href="class_cpdf.html#a9320b72ab89c1d8aeb76a607560f85a7">00080</a> var <a class="code" href="class_cpdf.html#a9320b72ab89c1d8aeb76a607560f85a7">$currentStrokeColour</a>=array(<span class="charliteral">&#39;r&#39;</span>=&gt;-1,<span class="charliteral">&#39;g&#39;</span>=&gt;-1,<span class="charliteral">&#39;b&#39;</span>=&gt;-1);
<a name="l00084"></a><a class="code" href="class_cpdf.html#a6e74a726b7c21bfd7d927955ae767188">00084</a> var <a class="code" href="class_cpdf.html#a6e74a726b7c21bfd7d927955ae767188">$currentLineStyle</a>=<span class="stringliteral">&#39;&#39;</span>;
<a name="l00089"></a><a class="code" href="class_cpdf.html#af19bb712a3b92c4f0fbcdf1add3f0bdd">00089</a> var <a class="code" href="class_cpdf.html#af19bb712a3b92c4f0fbcdf1add3f0bdd">$stateStack</a> = array();
<a name="l00093"></a><a class="code" href="class_cpdf.html#a45de2d60d68c9dcdd4aff475303520f3">00093</a> var <a class="code" href="class_cpdf.html#a45de2d60d68c9dcdd4aff475303520f3">$nStateStack</a> = 0;
<a name="l00097"></a><a class="code" href="class_cpdf.html#ab340b7e706b6bd02b4f70ff942898102">00097</a> var <a class="code" href="class_cpdf.html#ab340b7e706b6bd02b4f70ff942898102">$numPages</a>=0;
<a name="l00101"></a><a class="code" href="class_cpdf.html#a6a0169b26b5301f906b1ec481b3f1eea">00101</a> var <a class="code" href="class_cpdf.html#a6a0169b26b5301f906b1ec481b3f1eea">$stack</a>=array();
<a name="l00105"></a><a class="code" href="class_cpdf.html#a9de4b5d2209348f2e4479bdfbaa81c6a">00105</a> var <a class="code" href="class_cpdf.html#a9de4b5d2209348f2e4479bdfbaa81c6a">$nStack</a>=0;
<a name="l00110"></a><a class="code" href="class_cpdf.html#aedb3e9d19ff1ebfaa5added699a9671d">00110</a> var <a class="code" href="class_cpdf.html#aedb3e9d19ff1ebfaa5added699a9671d">$looseObjects</a>=array();
<a name="l00114"></a><a class="code" href="class_cpdf.html#a8f094bbb6c6f5db373d4b4e3c4ed0595">00114</a> var <a class="code" href="class_cpdf.html#a8f094bbb6c6f5db373d4b4e3c4ed0595">$addLooseObjects</a>=array();
<a name="l00119"></a><a class="code" href="class_cpdf.html#ae60fb73fb55ea5cf46351c519f2e16fd">00119</a> var <a class="code" href="class_cpdf.html#ae60fb73fb55ea5cf46351c519f2e16fd">$infoObject</a>=0;
<a name="l00123"></a><a class="code" href="class_cpdf.html#afa03e46e7e7be49ab81a9a3599af2871">00123</a> var <a class="code" href="class_cpdf.html#afa03e46e7e7be49ab81a9a3599af2871">$numImages</a>=0;
<a name="l00128"></a><a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">00128</a> var <a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>=array(<span class="stringliteral">&#39;compression&#39;</span>=&gt;1);
<a name="l00132"></a><a class="code" href="class_cpdf.html#a6f59caca64a9cd3619591fde1bfd443f">00132</a> var <a class="code" href="class_cpdf.html#a6f59caca64a9cd3619591fde1bfd443f">$firstPageId</a>;
<a name="l00137"></a><a class="code" href="class_cpdf.html#a32de4c103af0783f44fd568d74c6454b">00137</a> var <a class="code" href="class_cpdf.html#a32de4c103af0783f44fd568d74c6454b">$wordSpaceAdjust</a>=0;
<a name="l00141"></a><a class="code" href="class_cpdf.html#a39e9c2190f8061439c35f7d2a8240318">00141</a> var <a class="code" href="class_cpdf.html#a39e9c2190f8061439c35f7d2a8240318">$procsetObjectId</a>;
<a name="l00147"></a><a class="code" href="class_cpdf.html#a3632d1cfb98c70776f2bf64fefeb1292">00147</a> var <a class="code" href="class_cpdf.html#a3632d1cfb98c70776f2bf64fefeb1292">$fontFamilies</a> = array();
<a name="l00151"></a><a class="code" href="class_cpdf.html#ac7a9fec297babb986a440fa02032be15">00151</a> var <a class="code" href="class_cpdf.html#ac7a9fec297babb986a440fa02032be15">$currentTextState</a> = <span class="stringliteral">&#39;&#39;</span>; 
<a name="l00155"></a><a class="code" href="class_cpdf.html#a21a183f927a6d243fe6b4ba3a6c4d4c8">00155</a> var <a class="code" href="class_cpdf.html#a21a183f927a6d243fe6b4ba3a6c4d4c8">$messages</a>=<span class="stringliteral">&#39;&#39;</span>;
<a name="l00159"></a><a class="code" href="class_cpdf.html#a8b0d646c9b1820820ea01f0db2c22339">00159</a> var <a class="code" href="class_cpdf.html#a8b0d646c9b1820820ea01f0db2c22339">$arc4</a>=<span class="stringliteral">&#39;&#39;</span>;
<a name="l00163"></a><a class="code" href="class_cpdf.html#a7da30b74291ccb1aa4f0368140a36018">00163</a> var <a class="code" href="class_cpdf.html#a7da30b74291ccb1aa4f0368140a36018">$arc4_objnum</a>=0;
<a name="l00167"></a><a class="code" href="class_cpdf.html#aaf05a37af8d9a97b51844158c9f04981">00167</a> var <a class="code" href="class_cpdf.html#aaf05a37af8d9a97b51844158c9f04981">$fileIdentifier</a>=<span class="stringliteral">&#39;&#39;</span>;
<a name="l00171"></a><a class="code" href="class_cpdf.html#a4ac37790931818c0ac730fa8b4e58760">00171</a> var <a class="code" href="class_cpdf.html#a4ac37790931818c0ac730fa8b4e58760">$encrypted</a>=0;
<a name="l00175"></a><a class="code" href="class_cpdf.html#a730bbd8ecf60f264748611532e4c6f01">00175</a> var <a class="code" href="class_cpdf.html#a730bbd8ecf60f264748611532e4c6f01">$encryptionKey</a>=<span class="stringliteral">&#39;&#39;</span>;
<a name="l00179"></a><a class="code" href="class_cpdf.html#abc7c2ac0d93d22f71221e8b60512c860">00179</a> var <a class="code" href="class_cpdf.html#abc7c2ac0d93d22f71221e8b60512c860">$callback</a> = array();
<a name="l00183"></a><a class="code" href="class_cpdf.html#a894ee84a4cce4aed0afd68456ef6685d">00183</a> var <a class="code" href="class_cpdf.html#a894ee84a4cce4aed0afd68456ef6685d">$nCallback</a> = 0;
<a name="l00188"></a><a class="code" href="class_cpdf.html#a122da4689a596dd289cea157977eb02c">00188</a> var <a class="code" href="class_cpdf.html#a122da4689a596dd289cea157977eb02c">$destinations</a> = array();
<a name="l00194"></a><a class="code" href="class_cpdf.html#aeb2b7ad87c29b9898f9f05782a5de508">00194</a> var <a class="code" href="class_cpdf.html#aeb2b7ad87c29b9898f9f05782a5de508">$checkpoint</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00200"></a><a class="code" href="class_cpdf.html#a9cc0b020830361e9584150763b9995ae">00200</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a9cc0b020830361e9584150763b9995ae">Cpdf</a> ($pageSize=array(0,0,612,792)){
<a name="l00201"></a>00201   $this-&gt;<a class="code" href="class_cpdf.html#ab3114927075d9643a6ce7bcffb2bb8ac">newDocument</a>($pageSize);
<a name="l00202"></a>00202   
<a name="l00203"></a>00203   <span class="comment">// also initialize the font families that are known about already</span>
<a name="l00204"></a>00204   $this-&gt;<a class="code" href="class_cpdf.html#a5ddaeab8f233dcdc13d1f3f13fa53367">setFontFamily</a>(<span class="stringliteral">&#39;init&#39;</span>);
<a name="l00205"></a>00205 <span class="comment">//  $this-&gt;fileIdentifier = md5(&#39;xxxxxxxx&#39;.time());</span>
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 }
<a name="l00208"></a>00208 
<a name="l00227"></a><a class="code" href="class_cpdf.html#a2432dc753eab2f8786f3b6c97cfdca59">00227</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a2432dc753eab2f8786f3b6c97cfdca59">o_destination</a>($id,$action,<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>=<span class="stringliteral">&#39;&#39;</span>){
<a name="l00228"></a>00228   <span class="keywordflow">if</span> ($action!=<span class="stringliteral">&#39;new&#39;</span>){
<a name="l00229"></a>00229     $o =&amp; $this-&gt;objects[$id];
<a name="l00230"></a>00230   }
<a name="l00231"></a>00231   <span class="keywordflow">switch</span>($action){
<a name="l00232"></a>00232     <span class="keywordflow">case</span> <span class="stringliteral">&#39;new&#39;</span>:
<a name="l00233"></a>00233       $this-&gt;objects[$id]=array(<span class="charliteral">&#39;t&#39;</span>=&gt;<span class="stringliteral">&#39;destination&#39;</span>,<span class="stringliteral">&#39;info&#39;</span>=&gt;array());
<a name="l00234"></a>00234       $tmp = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00235"></a>00235       <span class="keywordflow">switch</span> (<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;type&#39;</span>]){
<a name="l00236"></a>00236         <span class="keywordflow">case</span> <span class="stringliteral">&#39;XYZ&#39;</span>:
<a name="l00237"></a>00237         <span class="keywordflow">case</span> <span class="stringliteral">&#39;FitR&#39;</span>:
<a name="l00238"></a>00238           $tmp =  <span class="charliteral">&#39; &#39;</span>.$options[<span class="stringliteral">&#39;p3&#39;</span>].$tmp;
<a name="l00239"></a>00239         <span class="keywordflow">case</span> <span class="stringliteral">&#39;FitH&#39;</span>:
<a name="l00240"></a>00240         <span class="keywordflow">case</span> <span class="stringliteral">&#39;FitV&#39;</span>:
<a name="l00241"></a>00241         <span class="keywordflow">case</span> <span class="stringliteral">&#39;FitBH&#39;</span>:
<a name="l00242"></a>00242         <span class="keywordflow">case</span> <span class="stringliteral">&#39;FitBV&#39;</span>:
<a name="l00243"></a>00243           $tmp =  <span class="charliteral">&#39; &#39;</span>.$options[<span class="stringliteral">&#39;p1&#39;</span>].<span class="charliteral">&#39; &#39;</span>.<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;p2&#39;</span>].$tmp;
<a name="l00244"></a>00244         <span class="keywordflow">case</span> <span class="stringliteral">&#39;Fit&#39;</span>:
<a name="l00245"></a>00245         <span class="keywordflow">case</span> <span class="stringliteral">&#39;FitB&#39;</span>:
<a name="l00246"></a>00246           $tmp =  <a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;type&#39;</span>].$tmp;
<a name="l00247"></a>00247           $this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;string&#39;</span>]=$tmp;
<a name="l00248"></a>00248           $this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;page&#39;</span>]=<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;page&#39;</span>];
<a name="l00249"></a>00249       }
<a name="l00250"></a>00250       <span class="keywordflow">break</span>;
<a name="l00251"></a>00251     <span class="keywordflow">case</span> <span class="stringliteral">&#39;out&#39;</span>:
<a name="l00252"></a>00252       $tmp = $o[<span class="stringliteral">&#39;info&#39;</span>];
<a name="l00253"></a>00253       $res=<span class="stringliteral">&quot;\n&quot;</span>.$id.<span class="stringliteral">&quot; 0 obj\n&quot;</span>.<span class="charliteral">&#39;[&#39;</span>.$tmp[<span class="stringliteral">&#39;page&#39;</span>].<span class="stringliteral">&#39; 0 R /&#39;</span>.$tmp[<span class="stringliteral">&#39;string&#39;</span>].<span class="stringliteral">&quot;]\nendobj\n&quot;</span>;
<a name="l00254"></a>00254       <span class="keywordflow">return</span> $res;
<a name="l00255"></a>00255       <span class="keywordflow">break</span>;
<a name="l00256"></a>00256   }
<a name="l00257"></a>00257 }
<a name="l00258"></a>00258 
<a name="l00262"></a><a class="code" href="class_cpdf.html#a37a4d12fd4fe6536921eabccfc55bae3">00262</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a37a4d12fd4fe6536921eabccfc55bae3">o_viewerPreferences</a>($id,$action,<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>=<span class="stringliteral">&#39;&#39;</span>){
<a name="l00263"></a>00263   <span class="keywordflow">if</span> ($action!=<span class="stringliteral">&#39;new&#39;</span>){
<a name="l00264"></a>00264     $o =&amp; $this-&gt;objects[$id];
<a name="l00265"></a>00265   }
<a name="l00266"></a>00266   <span class="keywordflow">switch</span> ($action){
<a name="l00267"></a>00267     <span class="keywordflow">case</span> <span class="stringliteral">&#39;new&#39;</span>:
<a name="l00268"></a>00268       $this-&gt;objects[$id]=array(<span class="charliteral">&#39;t&#39;</span>=&gt;<span class="stringliteral">&#39;viewerPreferences&#39;</span>,<span class="stringliteral">&#39;info&#39;</span>=&gt;array());
<a name="l00269"></a>00269       <span class="keywordflow">break</span>;
<a name="l00270"></a>00270     <span class="keywordflow">case</span> <span class="stringliteral">&#39;add&#39;</span>:
<a name="l00271"></a>00271       <span class="keywordflow">foreach</span>(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a> as $k=&gt;$v){
<a name="l00272"></a>00272         <span class="keywordflow">switch</span> ($k){
<a name="l00273"></a>00273           <span class="keywordflow">case</span> <span class="stringliteral">&#39;HideToolbar&#39;</span>:
<a name="l00274"></a>00274           <span class="keywordflow">case</span> <span class="stringliteral">&#39;HideMenubar&#39;</span>:
<a name="l00275"></a>00275           <span class="keywordflow">case</span> <span class="stringliteral">&#39;HideWindowUI&#39;</span>:
<a name="l00276"></a>00276           <span class="keywordflow">case</span> <span class="stringliteral">&#39;FitWindow&#39;</span>:
<a name="l00277"></a>00277           <span class="keywordflow">case</span> <span class="stringliteral">&#39;CenterWindow&#39;</span>:
<a name="l00278"></a>00278           <span class="keywordflow">case</span> <span class="stringliteral">&#39;NonFullScreenPageMode&#39;</span>:
<a name="l00279"></a>00279           <span class="keywordflow">case</span> <span class="stringliteral">&#39;Direction&#39;</span>:
<a name="l00280"></a>00280             $o[<span class="stringliteral">&#39;info&#39;</span>][$k]=$v;
<a name="l00281"></a>00281           <span class="keywordflow">break</span>;
<a name="l00282"></a>00282         }
<a name="l00283"></a>00283       }
<a name="l00284"></a>00284       <span class="keywordflow">break</span>;
<a name="l00285"></a>00285     <span class="keywordflow">case</span> <span class="stringliteral">&#39;out&#39;</span>:
<a name="l00286"></a>00286 
<a name="l00287"></a>00287       $res=<span class="stringliteral">&quot;\n&quot;</span>.$id.<span class="stringliteral">&quot; 0 obj\n&quot;</span>.<span class="stringliteral">&#39;&lt;&lt; &#39;</span>;
<a name="l00288"></a>00288       <span class="keywordflow">foreach</span>($o[<span class="stringliteral">&#39;info&#39;</span>] as $k=&gt;$v){
<a name="l00289"></a>00289         $res.=<span class="stringliteral">&quot;\n/&quot;</span>.$k.<span class="charliteral">&#39; &#39;</span>.$v;
<a name="l00290"></a>00290       }
<a name="l00291"></a>00291       $res.=<span class="stringliteral">&quot;\n&gt;&gt;\n&quot;</span>;
<a name="l00292"></a>00292       <span class="keywordflow">return</span> $res;
<a name="l00293"></a>00293       <span class="keywordflow">break</span>;
<a name="l00294"></a>00294   }
<a name="l00295"></a>00295 }
<a name="l00296"></a>00296 
<a name="l00300"></a><a class="code" href="class_cpdf.html#ad5269fc1648ba039f9ab1d372b89aa55">00300</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#ad5269fc1648ba039f9ab1d372b89aa55">o_catalog</a>($id,$action,<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>=<span class="stringliteral">&#39;&#39;</span>){
<a name="l00301"></a>00301   <span class="keywordflow">if</span> ($action!=<span class="stringliteral">&#39;new&#39;</span>){
<a name="l00302"></a>00302     $o =&amp; $this-&gt;objects[$id];
<a name="l00303"></a>00303   }
<a name="l00304"></a>00304   <span class="keywordflow">switch</span> ($action){
<a name="l00305"></a>00305     <span class="keywordflow">case</span> <span class="stringliteral">&#39;new&#39;</span>:
<a name="l00306"></a>00306       $this-&gt;objects[$id]=array(<span class="charliteral">&#39;t&#39;</span>=&gt;<span class="stringliteral">&#39;catalog&#39;</span>,<span class="stringliteral">&#39;info&#39;</span>=&gt;array());
<a name="l00307"></a>00307       $this-&gt;catalogId=$id;
<a name="l00308"></a>00308       <span class="keywordflow">break</span>;
<a name="l00309"></a>00309     <span class="keywordflow">case</span> <span class="stringliteral">&#39;outlines&#39;</span>:
<a name="l00310"></a>00310     <span class="keywordflow">case</span> <span class="stringliteral">&#39;pages&#39;</span>:
<a name="l00311"></a>00311     <span class="keywordflow">case</span> <span class="stringliteral">&#39;openHere&#39;</span>:
<a name="l00312"></a>00312       $o[<span class="stringliteral">&#39;info&#39;</span>][$action]=<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>;
<a name="l00313"></a>00313       <span class="keywordflow">break</span>;
<a name="l00314"></a>00314     <span class="keywordflow">case</span> <span class="stringliteral">&#39;viewerPreferences&#39;</span>:
<a name="l00315"></a>00315       <span class="keywordflow">if</span> (!isset($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;viewerPreferences&#39;</span>])){
<a name="l00316"></a>00316         $this-&gt;numObj++;
<a name="l00317"></a>00317         $this-&gt;<a class="code" href="class_cpdf.html#a37a4d12fd4fe6536921eabccfc55bae3">o_viewerPreferences</a>($this-&gt;numObj,<span class="stringliteral">&#39;new&#39;</span>);
<a name="l00318"></a>00318         $o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;viewerPreferences&#39;</span>]=$this-&gt;numObj;
<a name="l00319"></a>00319       }
<a name="l00320"></a>00320       $vp = $o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;viewerPreferences&#39;</span>];
<a name="l00321"></a>00321       $this-&gt;<a class="code" href="class_cpdf.html#a37a4d12fd4fe6536921eabccfc55bae3">o_viewerPreferences</a>($vp,<span class="stringliteral">&#39;add&#39;</span>,<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>);
<a name="l00322"></a>00322       <span class="keywordflow">break</span>;
<a name="l00323"></a>00323     <span class="keywordflow">case</span> <span class="stringliteral">&#39;out&#39;</span>:
<a name="l00324"></a>00324       $res=<span class="stringliteral">&quot;\n&quot;</span>.$id.<span class="stringliteral">&quot; 0 obj\n&quot;</span>.<span class="stringliteral">&#39;&lt;&lt; /Type /Catalog&#39;</span>;
<a name="l00325"></a>00325       <span class="keywordflow">foreach</span>($o[<span class="stringliteral">&#39;info&#39;</span>] as $k=&gt;$v){
<a name="l00326"></a>00326         <span class="keywordflow">switch</span>($k){
<a name="l00327"></a>00327           <span class="keywordflow">case</span> <span class="stringliteral">&#39;outlines&#39;</span>:
<a name="l00328"></a>00328             $res.=<span class="stringliteral">&quot;\n&quot;</span>.<span class="stringliteral">&#39;/Outlines &#39;</span>.$v.<span class="stringliteral">&#39; 0 R&#39;</span>;
<a name="l00329"></a>00329             <span class="keywordflow">break</span>;
<a name="l00330"></a>00330           <span class="keywordflow">case</span> <span class="stringliteral">&#39;pages&#39;</span>:
<a name="l00331"></a>00331             $res.=<span class="stringliteral">&quot;\n&quot;</span>.<span class="stringliteral">&#39;/Pages &#39;</span>.$v.<span class="stringliteral">&#39; 0 R&#39;</span>;
<a name="l00332"></a>00332             <span class="keywordflow">break</span>;
<a name="l00333"></a>00333           <span class="keywordflow">case</span> <span class="stringliteral">&#39;viewerPreferences&#39;</span>:
<a name="l00334"></a>00334             $res.=<span class="stringliteral">&quot;\n&quot;</span>.<span class="stringliteral">&#39;/ViewerPreferences &#39;</span>.$o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;viewerPreferences&#39;</span>].<span class="stringliteral">&#39; 0 R&#39;</span>;
<a name="l00335"></a>00335             <span class="keywordflow">break</span>;
<a name="l00336"></a>00336           <span class="keywordflow">case</span> <span class="stringliteral">&#39;openHere&#39;</span>:
<a name="l00337"></a>00337             $res.=<span class="stringliteral">&quot;\n&quot;</span>.<span class="stringliteral">&#39;/OpenAction &#39;</span>.$o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;openHere&#39;</span>].<span class="stringliteral">&#39; 0 R&#39;</span>;
<a name="l00338"></a>00338             <span class="keywordflow">break</span>;
<a name="l00339"></a>00339         }
<a name="l00340"></a>00340       }
<a name="l00341"></a>00341       $res.=<span class="stringliteral">&quot; &gt;&gt;\nendobj&quot;</span>;
<a name="l00342"></a>00342       <span class="keywordflow">return</span> $res;
<a name="l00343"></a>00343       <span class="keywordflow">break</span>;
<a name="l00344"></a>00344   }
<a name="l00345"></a>00345 }
<a name="l00346"></a>00346 
<a name="l00350"></a><a class="code" href="class_cpdf.html#a81c56aa681c1462c1a2d29a4b164e1c9">00350</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a81c56aa681c1462c1a2d29a4b164e1c9">o_pages</a>($id,$action,<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>=<span class="stringliteral">&#39;&#39;</span>){
<a name="l00351"></a>00351   <span class="keywordflow">if</span> ($action!=<span class="stringliteral">&#39;new&#39;</span>){
<a name="l00352"></a>00352     $o =&amp; $this-&gt;objects[$id];
<a name="l00353"></a>00353   }
<a name="l00354"></a>00354   <span class="keywordflow">switch</span> ($action){
<a name="l00355"></a>00355     <span class="keywordflow">case</span> <span class="stringliteral">&#39;new&#39;</span>:
<a name="l00356"></a>00356       $this-&gt;objects[$id]=array(<span class="charliteral">&#39;t&#39;</span>=&gt;<span class="stringliteral">&#39;pages&#39;</span>,<span class="stringliteral">&#39;info&#39;</span>=&gt;array());
<a name="l00357"></a>00357       $this-&gt;<a class="code" href="class_cpdf.html#ad5269fc1648ba039f9ab1d372b89aa55">o_catalog</a>($this-&gt;catalogId,<span class="stringliteral">&#39;pages&#39;</span>,$id);
<a name="l00358"></a>00358       <span class="keywordflow">break</span>;
<a name="l00359"></a>00359     <span class="keywordflow">case</span> <span class="stringliteral">&#39;page&#39;</span>:
<a name="l00360"></a>00360       <span class="keywordflow">if</span> (!is_array(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>)){
<a name="l00361"></a>00361         <span class="comment">// then it will just be the id of the new page</span>
<a name="l00362"></a>00362         $o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;pages&#39;</span>][]=<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>;
<a name="l00363"></a>00363       } <span class="keywordflow">else</span> {
<a name="l00364"></a>00364         <span class="comment">// then it should be an array having &#39;id&#39;,&#39;rid&#39;,&#39;pos&#39;, where rid=the page to which this one will be placed relative</span>
<a name="l00365"></a>00365         <span class="comment">// and pos is either &#39;before&#39; or &#39;after&#39;, saying where this page will fit.</span>
<a name="l00366"></a>00366         <span class="keywordflow">if</span> (isset(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;id&#39;</span>]) &amp;&amp; isset(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;rid&#39;</span>]) &amp;&amp; isset(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;pos&#39;</span>])){
<a name="l00367"></a>00367           $i = array_search(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;rid&#39;</span>],$o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;pages&#39;</span>]);
<a name="l00368"></a>00368           <span class="keywordflow">if</span> (isset($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;pages&#39;</span>][$i]) &amp;&amp; $o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;pages&#39;</span>][$i]==<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;rid&#39;</span>]){
<a name="l00369"></a>00369             <span class="comment">// then there is a match</span>
<a name="l00370"></a>00370             <span class="comment">// make a space</span>
<a name="l00371"></a>00371             <span class="keywordflow">switch</span> (<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;pos&#39;</span>]){
<a name="l00372"></a>00372               <span class="keywordflow">case</span> <span class="stringliteral">&#39;before&#39;</span>:
<a name="l00373"></a>00373                 $k = $i;
<a name="l00374"></a>00374                 <span class="keywordflow">break</span>;
<a name="l00375"></a>00375               <span class="keywordflow">case</span> <span class="stringliteral">&#39;after&#39;</span>:
<a name="l00376"></a>00376                 $k=$i+1;
<a name="l00377"></a>00377                 <span class="keywordflow">break</span>;
<a name="l00378"></a>00378               <span class="keywordflow">default</span>:
<a name="l00379"></a>00379                 $k=-1;
<a name="l00380"></a>00380                 <span class="keywordflow">break</span>;
<a name="l00381"></a>00381             }
<a name="l00382"></a>00382             <span class="keywordflow">if</span> ($k&gt;=0){
<a name="l00383"></a>00383               <span class="keywordflow">for</span> ($j=count($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;pages&#39;</span>])-1;$j&gt;=$k;$j--){
<a name="l00384"></a>00384                 $o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;pages&#39;</span>][$j+1]=$o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;pages&#39;</span>][$j];
<a name="l00385"></a>00385               }
<a name="l00386"></a>00386               $o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;pages&#39;</span>][$k]=<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;id&#39;</span>];
<a name="l00387"></a>00387             }
<a name="l00388"></a>00388           }
<a name="l00389"></a>00389         } 
<a name="l00390"></a>00390       }
<a name="l00391"></a>00391       <span class="keywordflow">break</span>;
<a name="l00392"></a>00392     <span class="keywordflow">case</span> <span class="stringliteral">&#39;procset&#39;</span>:
<a name="l00393"></a>00393       $o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;procset&#39;</span>]=<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>;
<a name="l00394"></a>00394       <span class="keywordflow">break</span>;
<a name="l00395"></a>00395     <span class="keywordflow">case</span> <span class="stringliteral">&#39;mediaBox&#39;</span>:
<a name="l00396"></a>00396       $o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;mediaBox&#39;</span>]=<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>; <span class="comment">// which should be an array of 4 numbers</span>
<a name="l00397"></a>00397       <span class="keywordflow">break</span>;
<a name="l00398"></a>00398     <span class="keywordflow">case</span> <span class="stringliteral">&#39;font&#39;</span>:
<a name="l00399"></a>00399       $o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;fonts&#39;</span>][]=array(<span class="stringliteral">&#39;objNum&#39;</span>=&gt;<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;objNum&#39;</span>],<span class="stringliteral">&#39;fontNum&#39;</span>=&gt;<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;fontNum&#39;</span>]);
<a name="l00400"></a>00400       <span class="keywordflow">break</span>;
<a name="l00401"></a>00401     <span class="keywordflow">case</span> <span class="stringliteral">&#39;xObject&#39;</span>:
<a name="l00402"></a>00402       $o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;xObjects&#39;</span>][]=array(<span class="stringliteral">&#39;objNum&#39;</span>=&gt;<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;objNum&#39;</span>],<span class="stringliteral">&#39;label&#39;</span>=&gt;<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;label&#39;</span>]);
<a name="l00403"></a>00403       <span class="keywordflow">break</span>;
<a name="l00404"></a>00404     <span class="keywordflow">case</span> <span class="stringliteral">&#39;out&#39;</span>:
<a name="l00405"></a>00405       <span class="keywordflow">if</span> (count($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;pages&#39;</span>])){
<a name="l00406"></a>00406         $res=<span class="stringliteral">&quot;\n&quot;</span>.$id.<span class="stringliteral">&quot; 0 obj\n&lt;&lt; /Type /Pages\n/Kids [&quot;</span>;
<a name="l00407"></a>00407         <span class="keywordflow">foreach</span>($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;pages&#39;</span>] as $k=&gt;$v){
<a name="l00408"></a>00408           $res.=$v.<span class="stringliteral">&quot; 0 R\n&quot;</span>;
<a name="l00409"></a>00409         }
<a name="l00410"></a>00410         $res.=<span class="stringliteral">&quot;]\n/Count &quot;</span>.count($this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;pages&#39;</span>]);
<a name="l00411"></a>00411         <span class="keywordflow">if</span> ((isset($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;fonts&#39;</span>]) &amp;&amp; count($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;fonts&#39;</span>])) || isset($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;procset&#39;</span>])){
<a name="l00412"></a>00412           $res.=<span class="stringliteral">&quot;\n/Resources &lt;&lt;&quot;</span>;
<a name="l00413"></a>00413           <span class="keywordflow">if</span> (isset($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;procset&#39;</span>])){
<a name="l00414"></a>00414             $res.=<span class="stringliteral">&quot;\n/ProcSet &quot;</span>.$o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;procset&#39;</span>].<span class="stringliteral">&quot; 0 R&quot;</span>;
<a name="l00415"></a>00415           }
<a name="l00416"></a>00416           <span class="keywordflow">if</span> (isset($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;fonts&#39;</span>]) &amp;&amp; count($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;fonts&#39;</span>])){
<a name="l00417"></a>00417             $res.=<span class="stringliteral">&quot;\n/Font &lt;&lt; &quot;</span>;
<a name="l00418"></a>00418             <span class="keywordflow">foreach</span>($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;fonts&#39;</span>] as $finfo){
<a name="l00419"></a>00419               $res.=<span class="stringliteral">&quot;\n/F&quot;</span>.$finfo[<span class="stringliteral">&#39;fontNum&#39;</span>].<span class="stringliteral">&quot; &quot;</span>.$finfo[<span class="stringliteral">&#39;objNum&#39;</span>].<span class="stringliteral">&quot; 0 R&quot;</span>;
<a name="l00420"></a>00420             }
<a name="l00421"></a>00421             $res.=<span class="stringliteral">&quot; &gt;&gt;&quot;</span>;
<a name="l00422"></a>00422           }
<a name="l00423"></a>00423           <span class="keywordflow">if</span> (isset($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;xObjects&#39;</span>]) &amp;&amp; count($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;xObjects&#39;</span>])){
<a name="l00424"></a>00424             $res.=<span class="stringliteral">&quot;\n/XObject &lt;&lt; &quot;</span>;
<a name="l00425"></a>00425             <span class="keywordflow">foreach</span>($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;xObjects&#39;</span>] as $finfo){
<a name="l00426"></a>00426               $res.=<span class="stringliteral">&quot;\n/&quot;</span>.$finfo[<span class="stringliteral">&#39;label&#39;</span>].<span class="stringliteral">&quot; &quot;</span>.$finfo[<span class="stringliteral">&#39;objNum&#39;</span>].<span class="stringliteral">&quot; 0 R&quot;</span>;
<a name="l00427"></a>00427             }
<a name="l00428"></a>00428             $res.=<span class="stringliteral">&quot; &gt;&gt;&quot;</span>;
<a name="l00429"></a>00429           }
<a name="l00430"></a>00430           $res.=<span class="stringliteral">&quot;\n&gt;&gt;&quot;</span>;
<a name="l00431"></a>00431           <span class="keywordflow">if</span> (isset($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;mediaBox&#39;</span>])){
<a name="l00432"></a>00432             $tmp=$o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;mediaBox&#39;</span>];
<a name="l00433"></a>00433             $res.=<span class="stringliteral">&quot;\n/MediaBox [&quot;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$tmp[0]).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$tmp[1]).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$tmp[2]).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$tmp[3]).<span class="charliteral">&#39;]&#39;</span>;
<a name="l00434"></a>00434           }
<a name="l00435"></a>00435         }
<a name="l00436"></a>00436         $res.=<span class="stringliteral">&quot;\n &gt;&gt;\nendobj&quot;</span>;
<a name="l00437"></a>00437       } <span class="keywordflow">else</span> {
<a name="l00438"></a>00438         $res=<span class="stringliteral">&quot;\n&quot;</span>.$id.<span class="stringliteral">&quot; 0 obj\n&lt;&lt; /Type /Pages\n/Count 0\n&gt;&gt;\nendobj&quot;</span>;
<a name="l00439"></a>00439       }
<a name="l00440"></a>00440       <span class="keywordflow">return</span> $res;
<a name="l00441"></a>00441     <span class="keywordflow">break</span>;
<a name="l00442"></a>00442   }
<a name="l00443"></a>00443 }
<a name="l00444"></a>00444 
<a name="l00448"></a><a class="code" href="class_cpdf.html#a5e6a4d8146f8dc8424c01107deae2363">00448</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a5e6a4d8146f8dc8424c01107deae2363">o_outlines</a>($id,$action,<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>=<span class="stringliteral">&#39;&#39;</span>){
<a name="l00449"></a>00449   <span class="keywordflow">if</span> ($action!=<span class="stringliteral">&#39;new&#39;</span>){
<a name="l00450"></a>00450     $o =&amp; $this-&gt;objects[$id];
<a name="l00451"></a>00451   }
<a name="l00452"></a>00452   <span class="keywordflow">switch</span> ($action){
<a name="l00453"></a>00453     <span class="keywordflow">case</span> <span class="stringliteral">&#39;new&#39;</span>:
<a name="l00454"></a>00454       $this-&gt;objects[$id]=array(<span class="charliteral">&#39;t&#39;</span>=&gt;<span class="stringliteral">&#39;outlines&#39;</span>,<span class="stringliteral">&#39;info&#39;</span>=&gt;array(<span class="stringliteral">&#39;outlines&#39;</span>=&gt;array()));
<a name="l00455"></a>00455       $this-&gt;<a class="code" href="class_cpdf.html#ad5269fc1648ba039f9ab1d372b89aa55">o_catalog</a>($this-&gt;catalogId,<span class="stringliteral">&#39;outlines&#39;</span>,$id);
<a name="l00456"></a>00456       <span class="keywordflow">break</span>;
<a name="l00457"></a>00457     <span class="keywordflow">case</span> <span class="stringliteral">&#39;outline&#39;</span>:
<a name="l00458"></a>00458       $o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;outlines&#39;</span>][]=<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>;
<a name="l00459"></a>00459       <span class="keywordflow">break</span>;
<a name="l00460"></a>00460     <span class="keywordflow">case</span> <span class="stringliteral">&#39;out&#39;</span>:
<a name="l00461"></a>00461       <span class="keywordflow">if</span> (count($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;outlines&#39;</span>])){
<a name="l00462"></a>00462         $res=<span class="stringliteral">&quot;\n&quot;</span>.$id.<span class="stringliteral">&quot; 0 obj\n&lt;&lt; /Type /Outlines /Kids [&quot;</span>;
<a name="l00463"></a>00463         <span class="keywordflow">foreach</span>($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;outlines&#39;</span>] as $k=&gt;$v){
<a name="l00464"></a>00464           $res.=$v.<span class="stringliteral">&quot; 0 R &quot;</span>;
<a name="l00465"></a>00465         }
<a name="l00466"></a>00466         $res.=<span class="stringliteral">&quot;] /Count &quot;</span>.count($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;outlines&#39;</span>]).<span class="stringliteral">&quot; &gt;&gt;\nendobj&quot;</span>;
<a name="l00467"></a>00467       } <span class="keywordflow">else</span> {
<a name="l00468"></a>00468         $res=<span class="stringliteral">&quot;\n&quot;</span>.$id.<span class="stringliteral">&quot; 0 obj\n&lt;&lt; /Type /Outlines /Count 0 &gt;&gt;\nendobj&quot;</span>;
<a name="l00469"></a>00469       }
<a name="l00470"></a>00470       <span class="keywordflow">return</span> $res;
<a name="l00471"></a>00471       <span class="keywordflow">break</span>;
<a name="l00472"></a>00472   }
<a name="l00473"></a>00473 }
<a name="l00474"></a>00474 
<a name="l00478"></a><a class="code" href="class_cpdf.html#a607aaa24e2d8b46f8c387d0d5144cd9a">00478</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a607aaa24e2d8b46f8c387d0d5144cd9a">o_font</a>($id,$action,<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>=<span class="stringliteral">&#39;&#39;</span>){
<a name="l00479"></a>00479   <span class="keywordflow">if</span> ($action!=<span class="stringliteral">&#39;new&#39;</span>){
<a name="l00480"></a>00480     $o =&amp; $this-&gt;objects[$id];
<a name="l00481"></a>00481   }
<a name="l00482"></a>00482   <span class="keywordflow">switch</span> ($action){
<a name="l00483"></a>00483     <span class="keywordflow">case</span> <span class="stringliteral">&#39;new&#39;</span>:
<a name="l00484"></a>00484       $this-&gt;objects[$id]=array(<span class="charliteral">&#39;t&#39;</span>=&gt;<span class="stringliteral">&#39;font&#39;</span>,<span class="stringliteral">&#39;info&#39;</span>=&gt;array(<span class="stringliteral">&#39;name&#39;</span>=&gt;<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;name&#39;</span>],<span class="stringliteral">&#39;SubType&#39;</span>=&gt;<span class="stringliteral">&#39;Type1&#39;</span>));
<a name="l00485"></a>00485       $fontNum=$this-&gt;numFonts;
<a name="l00486"></a>00486       $this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;fontNum&#39;</span>]=$fontNum;
<a name="l00487"></a>00487       <span class="comment">// deal with the encoding and the differences</span>
<a name="l00488"></a>00488       <span class="keywordflow">if</span> (isset(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;differences&#39;</span>])){
<a name="l00489"></a>00489         <span class="comment">// then we&#39;ll need an encoding dictionary</span>
<a name="l00490"></a>00490         $this-&gt;numObj++;
<a name="l00491"></a>00491         $this-&gt;<a class="code" href="class_cpdf.html#aedda68b5afe6900c14375f2fe4c63bd5">o_fontEncoding</a>($this-&gt;numObj,<span class="stringliteral">&#39;new&#39;</span>,<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>);
<a name="l00492"></a>00492         $this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;encodingDictionary&#39;</span>]=$this-&gt;numObj;
<a name="l00493"></a>00493       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isset(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;encoding&#39;</span>])){
<a name="l00494"></a>00494         <span class="comment">// we can specify encoding here</span>
<a name="l00495"></a>00495         <span class="keywordflow">switch</span>(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;encoding&#39;</span>]){
<a name="l00496"></a>00496           <span class="keywordflow">case</span> <span class="stringliteral">&#39;WinAnsiEncoding&#39;</span>:
<a name="l00497"></a>00497           <span class="keywordflow">case</span> <span class="stringliteral">&#39;MacRomanEncoding&#39;</span>:
<a name="l00498"></a>00498           <span class="keywordflow">case</span> <span class="stringliteral">&#39;MacExpertEncoding&#39;</span>:
<a name="l00499"></a>00499             $this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;encoding&#39;</span>]=<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;encoding&#39;</span>];
<a name="l00500"></a>00500             <span class="keywordflow">break</span>;
<a name="l00501"></a>00501           <span class="keywordflow">case</span> <span class="stringliteral">&#39;none&#39;</span>:
<a name="l00502"></a>00502             <span class="keywordflow">break</span>;
<a name="l00503"></a>00503           <span class="keywordflow">default</span>:
<a name="l00504"></a>00504             $this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;encoding&#39;</span>]=<span class="stringliteral">&#39;WinAnsiEncoding&#39;</span>;
<a name="l00505"></a>00505             <span class="keywordflow">break</span>;
<a name="l00506"></a>00506         }
<a name="l00507"></a>00507       } <span class="keywordflow">else</span> {
<a name="l00508"></a>00508         $this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;encoding&#39;</span>]=<span class="stringliteral">&#39;WinAnsiEncoding&#39;</span>;
<a name="l00509"></a>00509       }
<a name="l00510"></a>00510       <span class="comment">// also tell the pages node about the new font</span>
<a name="l00511"></a>00511       $this-&gt;<a class="code" href="class_cpdf.html#a81c56aa681c1462c1a2d29a4b164e1c9">o_pages</a>($this-&gt;currentNode,<span class="stringliteral">&#39;font&#39;</span>,array(<span class="stringliteral">&#39;fontNum&#39;</span>=&gt;$fontNum,<span class="stringliteral">&#39;objNum&#39;</span>=&gt;$id));
<a name="l00512"></a>00512       <span class="keywordflow">break</span>;
<a name="l00513"></a>00513     <span class="keywordflow">case</span> <span class="stringliteral">&#39;add&#39;</span>:
<a name="l00514"></a>00514       <span class="keywordflow">foreach</span> (<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a> as $k=&gt;$v){
<a name="l00515"></a>00515         <span class="keywordflow">switch</span> ($k){
<a name="l00516"></a>00516           <span class="keywordflow">case</span> <span class="stringliteral">&#39;BaseFont&#39;</span>:
<a name="l00517"></a>00517             $o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;name&#39;</span>] = $v;
<a name="l00518"></a>00518             <span class="keywordflow">break</span>;
<a name="l00519"></a>00519           <span class="keywordflow">case</span> <span class="stringliteral">&#39;FirstChar&#39;</span>:
<a name="l00520"></a>00520           <span class="keywordflow">case</span> <span class="stringliteral">&#39;LastChar&#39;</span>:
<a name="l00521"></a>00521           <span class="keywordflow">case</span> <span class="stringliteral">&#39;Widths&#39;</span>:
<a name="l00522"></a>00522           <span class="keywordflow">case</span> <span class="stringliteral">&#39;FontDescriptor&#39;</span>:
<a name="l00523"></a>00523           <span class="keywordflow">case</span> <span class="stringliteral">&#39;SubType&#39;</span>:
<a name="l00524"></a>00524           $this-&gt;<a class="code" href="class_cpdf.html#a0fe60161c19f81f49f76a2dcb95d48e4">addMessage</a>(<span class="stringliteral">&#39;o_font &#39;</span>.$k.<span class="stringliteral">&quot; : &quot;</span>.$v);
<a name="l00525"></a>00525             $o[<span class="stringliteral">&#39;info&#39;</span>][$k] = $v;
<a name="l00526"></a>00526             <span class="keywordflow">break</span>;
<a name="l00527"></a>00527         }
<a name="l00528"></a>00528      }
<a name="l00529"></a>00529       <span class="keywordflow">break</span>;
<a name="l00530"></a>00530     <span class="keywordflow">case</span> <span class="stringliteral">&#39;out&#39;</span>:
<a name="l00531"></a>00531       $res=<span class="stringliteral">&quot;\n&quot;</span>.$id.<span class="stringliteral">&quot; 0 obj\n&lt;&lt; /Type /Font\n/Subtype /&quot;</span>.$o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;SubType&#39;</span>].<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00532"></a>00532       $res.=<span class="stringliteral">&quot;/Name /F&quot;</span>.$o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;fontNum&#39;</span>].<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00533"></a>00533       $res.=<span class="stringliteral">&quot;/BaseFont /&quot;</span>.$o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;name&#39;</span>].<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00534"></a>00534       <span class="keywordflow">if</span> (isset($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;encodingDictionary&#39;</span>])){
<a name="l00535"></a>00535         <span class="comment">// then place a reference to the dictionary</span>
<a name="l00536"></a>00536         $res.=<span class="stringliteral">&quot;/Encoding &quot;</span>.$o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;encodingDictionary&#39;</span>].<span class="stringliteral">&quot; 0 R\n&quot;</span>;
<a name="l00537"></a>00537       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isset($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;encoding&#39;</span>])){
<a name="l00538"></a>00538         <span class="comment">// use the specified encoding</span>
<a name="l00539"></a>00539         $res.=<span class="stringliteral">&quot;/Encoding /&quot;</span>.$o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;encoding&#39;</span>].<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00540"></a>00540       }
<a name="l00541"></a>00541       <span class="keywordflow">if</span> (isset($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;FirstChar&#39;</span>])){
<a name="l00542"></a>00542         $res.=<span class="stringliteral">&quot;/FirstChar &quot;</span>.$o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;FirstChar&#39;</span>].<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00543"></a>00543       }
<a name="l00544"></a>00544       <span class="keywordflow">if</span> (isset($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;LastChar&#39;</span>])){
<a name="l00545"></a>00545         $res.=<span class="stringliteral">&quot;/LastChar &quot;</span>.$o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;LastChar&#39;</span>].<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00546"></a>00546       }
<a name="l00547"></a>00547       <span class="keywordflow">if</span> (isset($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;Widths&#39;</span>])){
<a name="l00548"></a>00548         $res.=<span class="stringliteral">&quot;/Widths &quot;</span>.$o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;Widths&#39;</span>].<span class="stringliteral">&quot; 0 R\n&quot;</span>;
<a name="l00549"></a>00549       }
<a name="l00550"></a>00550       <span class="keywordflow">if</span> (isset($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;FontDescriptor&#39;</span>])){
<a name="l00551"></a>00551         $res.=<span class="stringliteral">&quot;/FontDescriptor &quot;</span>.$o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;FontDescriptor&#39;</span>].<span class="stringliteral">&quot; 0 R\n&quot;</span>;
<a name="l00552"></a>00552       }
<a name="l00553"></a>00553       $res.=<span class="stringliteral">&quot;&gt;&gt;\nendobj&quot;</span>;
<a name="l00554"></a>00554       <span class="keywordflow">return</span> $res;
<a name="l00555"></a>00555       <span class="keywordflow">break</span>;
<a name="l00556"></a>00556   }
<a name="l00557"></a>00557 }
<a name="l00558"></a>00558 
<a name="l00562"></a><a class="code" href="class_cpdf.html#ab2907958d0d7da9764c61510b32a3e76">00562</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#ab2907958d0d7da9764c61510b32a3e76">o_fontDescriptor</a>($id,$action,<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>=<span class="stringliteral">&#39;&#39;</span>){
<a name="l00563"></a>00563   <span class="keywordflow">if</span> ($action!=<span class="stringliteral">&#39;new&#39;</span>){
<a name="l00564"></a>00564     $o =&amp; $this-&gt;objects[$id];
<a name="l00565"></a>00565   }
<a name="l00566"></a>00566   <span class="keywordflow">switch</span> ($action){
<a name="l00567"></a>00567     <span class="keywordflow">case</span> <span class="stringliteral">&#39;new&#39;</span>:
<a name="l00568"></a>00568       $this-&gt;objects[$id]=array(<span class="charliteral">&#39;t&#39;</span>=&gt;<span class="stringliteral">&#39;fontDescriptor&#39;</span>,<span class="stringliteral">&#39;info&#39;</span>=&gt;<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>);
<a name="l00569"></a>00569       <span class="keywordflow">break</span>;
<a name="l00570"></a>00570     <span class="keywordflow">case</span> <span class="stringliteral">&#39;out&#39;</span>:
<a name="l00571"></a>00571       $res=<span class="stringliteral">&quot;\n&quot;</span>.$id.<span class="stringliteral">&quot; 0 obj\n&lt;&lt; /Type /FontDescriptor\n&quot;</span>;
<a name="l00572"></a>00572       <span class="keywordflow">foreach</span> ($o[<span class="stringliteral">&#39;info&#39;</span>] as $label =&gt; $value){
<a name="l00573"></a>00573         <span class="keywordflow">switch</span> ($label){
<a name="l00574"></a>00574           <span class="keywordflow">case</span> <span class="stringliteral">&#39;Ascent&#39;</span>:
<a name="l00575"></a>00575           <span class="keywordflow">case</span> <span class="stringliteral">&#39;CapHeight&#39;</span>:
<a name="l00576"></a>00576           <span class="keywordflow">case</span> <span class="stringliteral">&#39;Descent&#39;</span>:
<a name="l00577"></a>00577           <span class="keywordflow">case</span> <span class="stringliteral">&#39;Flags&#39;</span>:
<a name="l00578"></a>00578           <span class="keywordflow">case</span> <span class="stringliteral">&#39;ItalicAngle&#39;</span>:
<a name="l00579"></a>00579           <span class="keywordflow">case</span> <span class="stringliteral">&#39;StemV&#39;</span>:
<a name="l00580"></a>00580           <span class="keywordflow">case</span> <span class="stringliteral">&#39;AvgWidth&#39;</span>:
<a name="l00581"></a>00581           <span class="keywordflow">case</span> <span class="stringliteral">&#39;Leading&#39;</span>:
<a name="l00582"></a>00582           <span class="keywordflow">case</span> <span class="stringliteral">&#39;MaxWidth&#39;</span>:
<a name="l00583"></a>00583           <span class="keywordflow">case</span> <span class="stringliteral">&#39;MissingWidth&#39;</span>:
<a name="l00584"></a>00584           <span class="keywordflow">case</span> <span class="stringliteral">&#39;StemH&#39;</span>:
<a name="l00585"></a>00585           <span class="keywordflow">case</span> <span class="stringliteral">&#39;XHeight&#39;</span>:
<a name="l00586"></a>00586           <span class="keywordflow">case</span> <span class="stringliteral">&#39;CharSet&#39;</span>:
<a name="l00587"></a>00587             <span class="keywordflow">if</span> (strlen($value)){
<a name="l00588"></a>00588               $res.=<span class="charliteral">&#39;/&#39;</span>.$label.<span class="charliteral">&#39; &#39;</span>.$value.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00589"></a>00589             }
<a name="l00590"></a>00590             <span class="keywordflow">break</span>;
<a name="l00591"></a>00591           <span class="keywordflow">case</span> <span class="stringliteral">&#39;FontFile&#39;</span>:
<a name="l00592"></a>00592           <span class="keywordflow">case</span> <span class="stringliteral">&#39;FontFile2&#39;</span>:
<a name="l00593"></a>00593           <span class="keywordflow">case</span> <span class="stringliteral">&#39;FontFile3&#39;</span>:
<a name="l00594"></a>00594             $res.=<span class="charliteral">&#39;/&#39;</span>.$label.<span class="charliteral">&#39; &#39;</span>.$value.<span class="stringliteral">&quot; 0 R\n&quot;</span>;
<a name="l00595"></a>00595             <span class="keywordflow">break</span>;
<a name="l00596"></a>00596           <span class="keywordflow">case</span> <span class="stringliteral">&#39;FontBBox&#39;</span>:
<a name="l00597"></a>00597             $res.=<span class="charliteral">&#39;/&#39;</span>.$label.<span class="stringliteral">&#39; [&#39;</span>.$value[0].<span class="charliteral">&#39; &#39;</span>.$value[1].<span class="charliteral">&#39; &#39;</span>.$value[2].<span class="charliteral">&#39; &#39;</span>.$value[3].<span class="stringliteral">&quot;]\n&quot;</span>;
<a name="l00598"></a>00598             <span class="keywordflow">break</span>;
<a name="l00599"></a>00599           <span class="keywordflow">case</span> <span class="stringliteral">&#39;FontName&#39;</span>:
<a name="l00600"></a>00600             $res.=<span class="charliteral">&#39;/&#39;</span>.$label.<span class="stringliteral">&#39; /&#39;</span>.$value.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00601"></a>00601             <span class="keywordflow">break</span>;
<a name="l00602"></a>00602         }
<a name="l00603"></a>00603       }
<a name="l00604"></a>00604       $res.=<span class="stringliteral">&quot;&gt;&gt;\nendobj&quot;</span>;
<a name="l00605"></a>00605       <span class="keywordflow">return</span> $res;
<a name="l00606"></a>00606       <span class="keywordflow">break</span>;
<a name="l00607"></a>00607   }
<a name="l00608"></a>00608 }
<a name="l00609"></a>00609 
<a name="l00613"></a><a class="code" href="class_cpdf.html#aedda68b5afe6900c14375f2fe4c63bd5">00613</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#aedda68b5afe6900c14375f2fe4c63bd5">o_fontEncoding</a>($id,$action,<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>=<span class="stringliteral">&#39;&#39;</span>){
<a name="l00614"></a>00614   <span class="keywordflow">if</span> ($action!=<span class="stringliteral">&#39;new&#39;</span>){
<a name="l00615"></a>00615     $o =&amp; $this-&gt;objects[$id];
<a name="l00616"></a>00616   }
<a name="l00617"></a>00617   <span class="keywordflow">switch</span> ($action){
<a name="l00618"></a>00618     <span class="keywordflow">case</span> <span class="stringliteral">&#39;new&#39;</span>:
<a name="l00619"></a>00619       <span class="comment">// the options array should contain &#39;differences&#39; and maybe &#39;encoding&#39;</span>
<a name="l00620"></a>00620       $this-&gt;objects[$id]=array(<span class="charliteral">&#39;t&#39;</span>=&gt;<span class="stringliteral">&#39;fontEncoding&#39;</span>,<span class="stringliteral">&#39;info&#39;</span>=&gt;<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>);
<a name="l00621"></a>00621       <span class="keywordflow">break</span>;
<a name="l00622"></a>00622     <span class="keywordflow">case</span> <span class="stringliteral">&#39;out&#39;</span>:
<a name="l00623"></a>00623       $res=<span class="stringliteral">&quot;\n&quot;</span>.$id.<span class="stringliteral">&quot; 0 obj\n&lt;&lt; /Type /Encoding\n&quot;</span>;
<a name="l00624"></a>00624       <span class="keywordflow">if</span> (!isset($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;encoding&#39;</span>])){
<a name="l00625"></a>00625         $o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;encoding&#39;</span>]=<span class="stringliteral">&#39;WinAnsiEncoding&#39;</span>;
<a name="l00626"></a>00626       }
<a name="l00627"></a>00627       <span class="keywordflow">if</span> ($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;encoding&#39;</span>]!=<span class="stringliteral">&#39;none&#39;</span>){
<a name="l00628"></a>00628         $res.=<span class="stringliteral">&quot;/BaseEncoding /&quot;</span>.$o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;encoding&#39;</span>].<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00629"></a>00629       }
<a name="l00630"></a>00630       $res.=<span class="stringliteral">&quot;/Differences \n[&quot;</span>;
<a name="l00631"></a>00631       $onum=-100;
<a name="l00632"></a>00632       <span class="keywordflow">foreach</span>($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;differences&#39;</span>] as $num=&gt;$label){
<a name="l00633"></a>00633         <span class="keywordflow">if</span> ($num!=$onum+1){
<a name="l00634"></a>00634           <span class="comment">// we cannot make use of consecutive numbering</span>
<a name="l00635"></a>00635           $res.= <span class="stringliteral">&quot;\n&quot;</span>.$num.<span class="stringliteral">&quot; /&quot;</span>.$label;
<a name="l00636"></a>00636         } <span class="keywordflow">else</span> {
<a name="l00637"></a>00637           $res.= <span class="stringliteral">&quot; /&quot;</span>.$label;
<a name="l00638"></a>00638         }
<a name="l00639"></a>00639         $onum=$num;
<a name="l00640"></a>00640       }
<a name="l00641"></a>00641       $res.=<span class="stringliteral">&quot;\n]\n&gt;&gt;\nendobj&quot;</span>;
<a name="l00642"></a>00642       <span class="keywordflow">return</span> $res;
<a name="l00643"></a>00643       <span class="keywordflow">break</span>;
<a name="l00644"></a>00644   }
<a name="l00645"></a>00645 }
<a name="l00646"></a>00646 
<a name="l00650"></a><a class="code" href="class_cpdf.html#a8c957eb8366fe5b89727c7ec68700afc">00650</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a8c957eb8366fe5b89727c7ec68700afc">o_procset</a>($id,$action,<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>=<span class="stringliteral">&#39;&#39;</span>){
<a name="l00651"></a>00651   <span class="keywordflow">if</span> ($action!=<span class="stringliteral">&#39;new&#39;</span>){
<a name="l00652"></a>00652     $o =&amp; $this-&gt;objects[$id];
<a name="l00653"></a>00653   }
<a name="l00654"></a>00654   <span class="keywordflow">switch</span> ($action){
<a name="l00655"></a>00655     <span class="keywordflow">case</span> <span class="stringliteral">&#39;new&#39;</span>:
<a name="l00656"></a>00656       $this-&gt;objects[$id]=array(<span class="charliteral">&#39;t&#39;</span>=&gt;<span class="stringliteral">&#39;procset&#39;</span>,<span class="stringliteral">&#39;info&#39;</span>=&gt;array(<span class="stringliteral">&#39;PDF&#39;</span>=&gt;1,<span class="stringliteral">&#39;Text&#39;</span>=&gt;1));
<a name="l00657"></a>00657       $this-&gt;<a class="code" href="class_cpdf.html#a81c56aa681c1462c1a2d29a4b164e1c9">o_pages</a>($this-&gt;currentNode,<span class="stringliteral">&#39;procset&#39;</span>,$id);
<a name="l00658"></a>00658       $this-&gt;procsetObjectId=$id;
<a name="l00659"></a>00659       <span class="keywordflow">break</span>;
<a name="l00660"></a>00660     <span class="keywordflow">case</span> <span class="stringliteral">&#39;add&#39;</span>:
<a name="l00661"></a>00661       <span class="comment">// this is to add new items to the procset list, despite the fact that this is considered</span>
<a name="l00662"></a>00662       <span class="comment">// obselete, the items are required for printing to some postscript printers</span>
<a name="l00663"></a>00663       <span class="keywordflow">switch</span> (<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>) {
<a name="l00664"></a>00664         <span class="keywordflow">case</span> <span class="stringliteral">&#39;ImageB&#39;</span>:
<a name="l00665"></a>00665         <span class="keywordflow">case</span> <span class="stringliteral">&#39;ImageC&#39;</span>:
<a name="l00666"></a>00666         <span class="keywordflow">case</span> <span class="stringliteral">&#39;ImageI&#39;</span>:
<a name="l00667"></a>00667           $o[<span class="stringliteral">&#39;info&#39;</span>][<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>]=1;
<a name="l00668"></a>00668           <span class="keywordflow">break</span>;
<a name="l00669"></a>00669       }
<a name="l00670"></a>00670       <span class="keywordflow">break</span>;
<a name="l00671"></a>00671     <span class="keywordflow">case</span> <span class="stringliteral">&#39;out&#39;</span>:
<a name="l00672"></a>00672       $res=<span class="stringliteral">&quot;\n&quot;</span>.$id.<span class="stringliteral">&quot; 0 obj\n[&quot;</span>;
<a name="l00673"></a>00673       <span class="keywordflow">foreach</span> ($o[<span class="stringliteral">&#39;info&#39;</span>] as $label=&gt;$val){
<a name="l00674"></a>00674         $res.=<span class="charliteral">&#39;/&#39;</span>.$label.<span class="charliteral">&#39; &#39;</span>;
<a name="l00675"></a>00675       }
<a name="l00676"></a>00676       $res.=<span class="stringliteral">&quot;]\nendobj&quot;</span>;
<a name="l00677"></a>00677       <span class="keywordflow">return</span> $res;
<a name="l00678"></a>00678       <span class="keywordflow">break</span>;
<a name="l00679"></a>00679   }
<a name="l00680"></a>00680 }
<a name="l00681"></a>00681 
<a name="l00685"></a><a class="code" href="class_cpdf.html#a1b15589e09e12f423f87d8ba3b1b1be4">00685</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a1b15589e09e12f423f87d8ba3b1b1be4">o_info</a>($id,$action,<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>=<span class="stringliteral">&#39;&#39;</span>){
<a name="l00686"></a>00686   <span class="keywordflow">if</span> ($action!=<span class="stringliteral">&#39;new&#39;</span>){
<a name="l00687"></a>00687     $o =&amp; $this-&gt;objects[$id];
<a name="l00688"></a>00688   }
<a name="l00689"></a>00689   <span class="keywordflow">switch</span> ($action){
<a name="l00690"></a>00690     <span class="keywordflow">case</span> <span class="stringliteral">&#39;new&#39;</span>:
<a name="l00691"></a>00691       $this-&gt;infoObject=$id;
<a name="l00692"></a>00692       $date=<span class="stringliteral">&#39;D:&#39;</span>.date(<span class="stringliteral">&#39;Ymd&#39;</span>);
<a name="l00693"></a>00693       $this-&gt;objects[$id]=array(<span class="charliteral">&#39;t&#39;</span>=&gt;<span class="stringliteral">&#39;info&#39;</span>,<span class="stringliteral">&#39;info&#39;</span>=&gt;array(<span class="stringliteral">&#39;Creator&#39;</span>=&gt;<span class="stringliteral">&#39;R and OS php pdf writer, http://www.ros.co.nz&#39;</span>,<span class="stringliteral">&#39;CreationDate&#39;</span>=&gt;$date));
<a name="l00694"></a>00694       <span class="keywordflow">break</span>;
<a name="l00695"></a>00695     <span class="keywordflow">case</span> <span class="stringliteral">&#39;Title&#39;</span>:
<a name="l00696"></a>00696     <span class="keywordflow">case</span> <span class="stringliteral">&#39;Author&#39;</span>:
<a name="l00697"></a>00697     <span class="keywordflow">case</span> <span class="stringliteral">&#39;Subject&#39;</span>:
<a name="l00698"></a>00698     <span class="keywordflow">case</span> <span class="stringliteral">&#39;Keywords&#39;</span>:
<a name="l00699"></a>00699     <span class="keywordflow">case</span> <span class="stringliteral">&#39;Creator&#39;</span>:
<a name="l00700"></a>00700     <span class="keywordflow">case</span> <span class="stringliteral">&#39;Producer&#39;</span>:
<a name="l00701"></a>00701     <span class="keywordflow">case</span> <span class="stringliteral">&#39;CreationDate&#39;</span>:
<a name="l00702"></a>00702     <span class="keywordflow">case</span> <span class="stringliteral">&#39;ModDate&#39;</span>:
<a name="l00703"></a>00703     <span class="keywordflow">case</span> <span class="stringliteral">&#39;Trapped&#39;</span>:
<a name="l00704"></a>00704       $o[<span class="stringliteral">&#39;info&#39;</span>][$action]=<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>;
<a name="l00705"></a>00705       <span class="keywordflow">break</span>;
<a name="l00706"></a>00706     <span class="keywordflow">case</span> <span class="stringliteral">&#39;out&#39;</span>:
<a name="l00707"></a>00707       <span class="keywordflow">if</span> ($this-&gt;encrypted){
<a name="l00708"></a>00708         $this-&gt;<a class="code" href="class_cpdf.html#a593c690c9c88459001b8fee0c1e02b60">encryptInit</a>($id);
<a name="l00709"></a>00709       }
<a name="l00710"></a>00710       $res=<span class="stringliteral">&quot;\n&quot;</span>.$id.<span class="stringliteral">&quot; 0 obj\n&lt;&lt;\n&quot;</span>;
<a name="l00711"></a>00711       <span class="keywordflow">foreach</span> ($o[<span class="stringliteral">&#39;info&#39;</span>]  as $k=&gt;$v){
<a name="l00712"></a>00712         $res.=<span class="charliteral">&#39;/&#39;</span>.$k.<span class="stringliteral">&#39; (&#39;</span>;
<a name="l00713"></a>00713         <span class="keywordflow">if</span> ($this-&gt;encrypted){
<a name="l00714"></a>00714           $res.=$this-&gt;<a class="code" href="class_cpdf.html#a984113695ea977929b4b7795fbf41cd2">filterText</a>($this-&gt;<a class="code" href="class_cpdf.html#a1720331693e5f6fa093806517a79f0d6">ARC4</a>($v));
<a name="l00715"></a>00715         } <span class="keywordflow">else</span> {
<a name="l00716"></a>00716           $res.=$this-&gt;<a class="code" href="class_cpdf.html#a984113695ea977929b4b7795fbf41cd2">filterText</a>($v);
<a name="l00717"></a>00717         }
<a name="l00718"></a>00718         $res.=<span class="stringliteral">&quot;)\n&quot;</span>;
<a name="l00719"></a>00719       }
<a name="l00720"></a>00720       $res.=<span class="stringliteral">&quot;&gt;&gt;\nendobj&quot;</span>;
<a name="l00721"></a>00721       <span class="keywordflow">return</span> $res;
<a name="l00722"></a>00722       <span class="keywordflow">break</span>;
<a name="l00723"></a>00723   }
<a name="l00724"></a>00724 }
<a name="l00725"></a>00725 
<a name="l00729"></a><a class="code" href="class_cpdf.html#ab01e4e5dac06bdd7480879a215fe552d">00729</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#ab01e4e5dac06bdd7480879a215fe552d">o_action</a>($id,$action,<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>=<span class="stringliteral">&#39;&#39;</span>){
<a name="l00730"></a>00730   <span class="keywordflow">if</span> ($action!=<span class="stringliteral">&#39;new&#39;</span>){
<a name="l00731"></a>00731     $o =&amp; $this-&gt;objects[$id];
<a name="l00732"></a>00732   }
<a name="l00733"></a>00733   <span class="keywordflow">switch</span> ($action){
<a name="l00734"></a>00734     <span class="keywordflow">case</span> <span class="stringliteral">&#39;new&#39;</span>:
<a name="l00735"></a>00735       <span class="keywordflow">if</span> (is_array(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>)){
<a name="l00736"></a>00736         $this-&gt;objects[$id]=array(<span class="charliteral">&#39;t&#39;</span>=&gt;<span class="stringliteral">&#39;action&#39;</span>,<span class="stringliteral">&#39;info&#39;</span>=&gt;<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>,<span class="stringliteral">&#39;type&#39;</span>=&gt;<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;type&#39;</span>]);
<a name="l00737"></a>00737       } <span class="keywordflow">else</span> {
<a name="l00738"></a>00738         <span class="comment">// then assume a URI action</span>
<a name="l00739"></a>00739         $this-&gt;objects[$id]=array(<span class="charliteral">&#39;t&#39;</span>=&gt;<span class="stringliteral">&#39;action&#39;</span>,<span class="stringliteral">&#39;info&#39;</span>=&gt;<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>,<span class="stringliteral">&#39;type&#39;</span>=&gt;<span class="stringliteral">&#39;URI&#39;</span>);
<a name="l00740"></a>00740       }
<a name="l00741"></a>00741       <span class="keywordflow">break</span>;
<a name="l00742"></a>00742     <span class="keywordflow">case</span> <span class="stringliteral">&#39;out&#39;</span>:
<a name="l00743"></a>00743       <span class="keywordflow">if</span> ($this-&gt;encrypted){
<a name="l00744"></a>00744         $this-&gt;<a class="code" href="class_cpdf.html#a593c690c9c88459001b8fee0c1e02b60">encryptInit</a>($id);
<a name="l00745"></a>00745       }
<a name="l00746"></a>00746       $res=<span class="stringliteral">&quot;\n&quot;</span>.$id.<span class="stringliteral">&quot; 0 obj\n&lt;&lt; /Type /Action&quot;</span>;
<a name="l00747"></a>00747       <span class="keywordflow">switch</span>($o[<span class="stringliteral">&#39;type&#39;</span>]){
<a name="l00748"></a>00748         <span class="keywordflow">case</span> <span class="stringliteral">&#39;ilink&#39;</span>:
<a name="l00749"></a>00749           <span class="comment">// there will be an &#39;label&#39; setting, this is the name of the destination</span>
<a name="l00750"></a>00750           $res.=<span class="stringliteral">&quot;\n/S /GoTo\n/D &quot;</span>.$this-&gt;destinations[(string)$o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;label&#39;</span>]].<span class="stringliteral">&quot; 0 R&quot;</span>;
<a name="l00751"></a>00751           <span class="keywordflow">break</span>;
<a name="l00752"></a>00752         <span class="keywordflow">case</span> <span class="stringliteral">&#39;URI&#39;</span>:
<a name="l00753"></a>00753           $res.=<span class="stringliteral">&quot;\n/S /URI\n/URI (&quot;</span>;
<a name="l00754"></a>00754           <span class="keywordflow">if</span> ($this-&gt;encrypted){
<a name="l00755"></a>00755             $res.=$this-&gt;<a class="code" href="class_cpdf.html#a984113695ea977929b4b7795fbf41cd2">filterText</a>($this-&gt;<a class="code" href="class_cpdf.html#a1720331693e5f6fa093806517a79f0d6">ARC4</a>($o[<span class="stringliteral">&#39;info&#39;</span>]));
<a name="l00756"></a>00756           } <span class="keywordflow">else</span> {
<a name="l00757"></a>00757             $res.=$this-&gt;<a class="code" href="class_cpdf.html#a984113695ea977929b4b7795fbf41cd2">filterText</a>($o[<span class="stringliteral">&#39;info&#39;</span>]);
<a name="l00758"></a>00758           }
<a name="l00759"></a>00759           $res.=<span class="stringliteral">&quot;)&quot;</span>;
<a name="l00760"></a>00760           <span class="keywordflow">break</span>;
<a name="l00761"></a>00761       }
<a name="l00762"></a>00762       $res.=<span class="stringliteral">&quot;\n&gt;&gt;\nendobj&quot;</span>;
<a name="l00763"></a>00763       <span class="keywordflow">return</span> $res;
<a name="l00764"></a>00764       <span class="keywordflow">break</span>;
<a name="l00765"></a>00765   }
<a name="l00766"></a>00766 }
<a name="l00767"></a>00767 
<a name="l00772"></a><a class="code" href="class_cpdf.html#aef859651290d314f10fbb2aee0a3785b">00772</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#aef859651290d314f10fbb2aee0a3785b">o_annotation</a>($id,$action,<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>=<span class="stringliteral">&#39;&#39;</span>){
<a name="l00773"></a>00773   <span class="keywordflow">if</span> ($action!=<span class="stringliteral">&#39;new&#39;</span>){
<a name="l00774"></a>00774     $o =&amp; $this-&gt;objects[$id];
<a name="l00775"></a>00775   }
<a name="l00776"></a>00776   <span class="keywordflow">switch</span> ($action){
<a name="l00777"></a>00777     <span class="keywordflow">case</span> <span class="stringliteral">&#39;new&#39;</span>:
<a name="l00778"></a>00778       <span class="comment">// add the annotation to the current page</span>
<a name="l00779"></a>00779       $pageId = $this-&gt;currentPage;
<a name="l00780"></a>00780       $this-&gt;<a class="code" href="class_cpdf.html#aa8f8c9faae6d2ef10e350675dde97f8d">o_page</a>($pageId,<span class="stringliteral">&#39;annot&#39;</span>,$id);
<a name="l00781"></a>00781       <span class="comment">// and add the action object which is going to be required</span>
<a name="l00782"></a>00782       <span class="keywordflow">switch</span>(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;type&#39;</span>]){
<a name="l00783"></a>00783         <span class="keywordflow">case</span> <span class="stringliteral">&#39;link&#39;</span>:
<a name="l00784"></a>00784           $this-&gt;objects[$id]=array(<span class="charliteral">&#39;t&#39;</span>=&gt;<span class="stringliteral">&#39;annotation&#39;</span>,<span class="stringliteral">&#39;info&#39;</span>=&gt;<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>);
<a name="l00785"></a>00785           $this-&gt;numObj++;
<a name="l00786"></a>00786           $this-&gt;<a class="code" href="class_cpdf.html#ab01e4e5dac06bdd7480879a215fe552d">o_action</a>($this-&gt;numObj,<span class="stringliteral">&#39;new&#39;</span>,<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;url&#39;</span>]);
<a name="l00787"></a>00787           $this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;actionId&#39;</span>]=$this-&gt;numObj;
<a name="l00788"></a>00788           <span class="keywordflow">break</span>;
<a name="l00789"></a>00789         <span class="keywordflow">case</span> <span class="stringliteral">&#39;ilink&#39;</span>:
<a name="l00790"></a>00790           <span class="comment">// this is to a named internal link</span>
<a name="l00791"></a>00791           $label = <a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;label&#39;</span>];
<a name="l00792"></a>00792           $this-&gt;objects[$id]=array(<span class="charliteral">&#39;t&#39;</span>=&gt;<span class="stringliteral">&#39;annotation&#39;</span>,<span class="stringliteral">&#39;info&#39;</span>=&gt;<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>);
<a name="l00793"></a>00793           $this-&gt;numObj++;
<a name="l00794"></a>00794           $this-&gt;<a class="code" href="class_cpdf.html#ab01e4e5dac06bdd7480879a215fe552d">o_action</a>($this-&gt;numObj,<span class="stringliteral">&#39;new&#39;</span>,array(<span class="stringliteral">&#39;type&#39;</span>=&gt;<span class="stringliteral">&#39;ilink&#39;</span>,<span class="stringliteral">&#39;label&#39;</span>=&gt;$label));
<a name="l00795"></a>00795           $this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;actionId&#39;</span>]=$this-&gt;numObj;
<a name="l00796"></a>00796           <span class="keywordflow">break</span>;
<a name="l00797"></a>00797       }
<a name="l00798"></a>00798       <span class="keywordflow">break</span>;
<a name="l00799"></a>00799     <span class="keywordflow">case</span> <span class="stringliteral">&#39;out&#39;</span>:
<a name="l00800"></a>00800       $res=<span class="stringliteral">&quot;\n&quot;</span>.$id.<span class="stringliteral">&quot; 0 obj\n&lt;&lt; /Type /Annot&quot;</span>;
<a name="l00801"></a>00801       <span class="keywordflow">switch</span>($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>]){
<a name="l00802"></a>00802         <span class="keywordflow">case</span> <span class="stringliteral">&#39;link&#39;</span>:
<a name="l00803"></a>00803         <span class="keywordflow">case</span> <span class="stringliteral">&#39;ilink&#39;</span>:
<a name="l00804"></a>00804           $res.= <span class="stringliteral">&quot;\n/Subtype /Link&quot;</span>;
<a name="l00805"></a>00805           <span class="keywordflow">break</span>;
<a name="l00806"></a>00806       }
<a name="l00807"></a>00807       $res.=<span class="stringliteral">&quot;\n/A &quot;</span>.$o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;actionId&#39;</span>].<span class="stringliteral">&quot; 0 R&quot;</span>;
<a name="l00808"></a>00808       $res.=<span class="stringliteral">&quot;\n/Border [0 0 0]&quot;</span>;
<a name="l00809"></a>00809       $res.=<span class="stringliteral">&quot;\n/H /I&quot;</span>;
<a name="l00810"></a>00810       $res.=<span class="stringliteral">&quot;\n/Rect [ &quot;</span>;
<a name="l00811"></a>00811       <span class="keywordflow">foreach</span>($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;rect&#39;</span>] as $v){
<a name="l00812"></a>00812         $res.= sprintf(<span class="stringliteral">&quot;%.4f &quot;</span>,$v);
<a name="l00813"></a>00813       }
<a name="l00814"></a>00814       $res.=<span class="stringliteral">&quot;]&quot;</span>;
<a name="l00815"></a>00815       $res.=<span class="stringliteral">&quot;\n&gt;&gt;\nendobj&quot;</span>;
<a name="l00816"></a>00816       <span class="keywordflow">return</span> $res;
<a name="l00817"></a>00817       <span class="keywordflow">break</span>;
<a name="l00818"></a>00818   }
<a name="l00819"></a>00819 }
<a name="l00820"></a>00820 
<a name="l00824"></a><a class="code" href="class_cpdf.html#aa8f8c9faae6d2ef10e350675dde97f8d">00824</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#aa8f8c9faae6d2ef10e350675dde97f8d">o_page</a>($id,$action,<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>=<span class="stringliteral">&#39;&#39;</span>){
<a name="l00825"></a>00825   <span class="keywordflow">if</span> ($action!=<span class="stringliteral">&#39;new&#39;</span>){
<a name="l00826"></a>00826     $o =&amp; $this-&gt;objects[$id];
<a name="l00827"></a>00827   }
<a name="l00828"></a>00828   <span class="keywordflow">switch</span> ($action){
<a name="l00829"></a>00829     <span class="keywordflow">case</span> <span class="stringliteral">&#39;new&#39;</span>:
<a name="l00830"></a>00830       $this-&gt;numPages++;
<a name="l00831"></a>00831       $this-&gt;objects[$id]=array(<span class="charliteral">&#39;t&#39;</span>=&gt;<span class="stringliteral">&#39;page&#39;</span>,<span class="stringliteral">&#39;info&#39;</span>=&gt;array(<span class="stringliteral">&#39;parent&#39;</span>=&gt;$this-&gt;currentNode,<span class="stringliteral">&#39;pageNum&#39;</span>=&gt;$this-&gt;numPages));
<a name="l00832"></a>00832       <span class="keywordflow">if</span> (is_array(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>)){
<a name="l00833"></a>00833         <span class="comment">// then this must be a page insertion, array shoudl contain &#39;rid&#39;,&#39;pos&#39;=[before|after]</span>
<a name="l00834"></a>00834         <a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;id&#39;</span>]=$id;
<a name="l00835"></a>00835         $this-&gt;<a class="code" href="class_cpdf.html#a81c56aa681c1462c1a2d29a4b164e1c9">o_pages</a>($this-&gt;currentNode,<span class="stringliteral">&#39;page&#39;</span>,<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>);
<a name="l00836"></a>00836       } <span class="keywordflow">else</span> {
<a name="l00837"></a>00837         $this-&gt;<a class="code" href="class_cpdf.html#a81c56aa681c1462c1a2d29a4b164e1c9">o_pages</a>($this-&gt;currentNode,<span class="stringliteral">&#39;page&#39;</span>,$id);
<a name="l00838"></a>00838       }
<a name="l00839"></a>00839       $this-&gt;currentPage=$id;
<a name="l00840"></a>00840       <span class="comment">//make a contents object to go with this page</span>
<a name="l00841"></a>00841       $this-&gt;numObj++;
<a name="l00842"></a>00842       $this-&gt;<a class="code" href="class_cpdf.html#ac8729d6b851615394c82bda391f37adb">o_contents</a>($this-&gt;numObj,<span class="stringliteral">&#39;new&#39;</span>,$id);
<a name="l00843"></a>00843       $this-&gt;currentContents=$this-&gt;numObj;
<a name="l00844"></a>00844       $this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;contents&#39;</span>]=array();
<a name="l00845"></a>00845       $this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;contents&#39;</span>][]=$this-&gt;numObj;
<a name="l00846"></a>00846       $match = ($this-&gt;numPages%2 ? <span class="stringliteral">&#39;odd&#39;</span> : <span class="stringliteral">&#39;even&#39;</span>);
<a name="l00847"></a>00847       <span class="keywordflow">foreach</span>($this-&gt;addLooseObjects as $oId=&gt;$target){
<a name="l00848"></a>00848         <span class="keywordflow">if</span> ($target==<span class="stringliteral">&#39;all&#39;</span> || $match==$target){
<a name="l00849"></a>00849           $this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;contents&#39;</span>][]=$oId;
<a name="l00850"></a>00850         }
<a name="l00851"></a>00851       }
<a name="l00852"></a>00852       <span class="keywordflow">break</span>;
<a name="l00853"></a>00853     <span class="keywordflow">case</span> <span class="stringliteral">&#39;content&#39;</span>:
<a name="l00854"></a>00854       $o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;contents&#39;</span>][]=<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>;
<a name="l00855"></a>00855       <span class="keywordflow">break</span>;
<a name="l00856"></a>00856     <span class="keywordflow">case</span> <span class="stringliteral">&#39;annot&#39;</span>:
<a name="l00857"></a>00857       <span class="comment">// add an annotation to this page</span>
<a name="l00858"></a>00858       <span class="keywordflow">if</span> (!isset($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;annot&#39;</span>])){
<a name="l00859"></a>00859         $o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;annot&#39;</span>]=array();
<a name="l00860"></a>00860       }
<a name="l00861"></a>00861       <span class="comment">// $options should contain the id of the annotation dictionary</span>
<a name="l00862"></a>00862       $o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;annot&#39;</span>][]=<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>;
<a name="l00863"></a>00863       <span class="keywordflow">break</span>;
<a name="l00864"></a>00864     <span class="keywordflow">case</span> <span class="stringliteral">&#39;out&#39;</span>:
<a name="l00865"></a>00865       $res=<span class="stringliteral">&quot;\n&quot;</span>.$id.<span class="stringliteral">&quot; 0 obj\n&lt;&lt; /Type /Page&quot;</span>;
<a name="l00866"></a>00866       $res.=<span class="stringliteral">&quot;\n/Parent &quot;</span>.$o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;parent&#39;</span>].<span class="stringliteral">&quot; 0 R&quot;</span>;
<a name="l00867"></a>00867       <span class="keywordflow">if</span> (isset($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;annot&#39;</span>])){
<a name="l00868"></a>00868         $res.=<span class="stringliteral">&quot;\n/Annots [&quot;</span>;
<a name="l00869"></a>00869         <span class="keywordflow">foreach</span>($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;annot&#39;</span>] as $aId){
<a name="l00870"></a>00870           $res.=<span class="stringliteral">&quot; &quot;</span>.$aId.<span class="stringliteral">&quot; 0 R&quot;</span>;
<a name="l00871"></a>00871         }
<a name="l00872"></a>00872         $res.=<span class="stringliteral">&quot; ]&quot;</span>;
<a name="l00873"></a>00873       }
<a name="l00874"></a>00874       <a class="code" href="administration_2log_2data_8php.html#af789423037bbc89dc7c850e761177570">$count</a> = count($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;contents&#39;</span>]);
<a name="l00875"></a>00875       <span class="keywordflow">if</span> (<a class="code" href="administration_2log_2data_8php.html#af789423037bbc89dc7c850e761177570">$count</a>==1){
<a name="l00876"></a>00876         $res.=<span class="stringliteral">&quot;\n/Contents &quot;</span>.$o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;contents&#39;</span>][0].<span class="stringliteral">&quot; 0 R&quot;</span>;
<a name="l00877"></a>00877       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="administration_2log_2data_8php.html#af789423037bbc89dc7c850e761177570">$count</a>&gt;1){
<a name="l00878"></a>00878         $res.=<span class="stringliteral">&quot;\n/Contents [\n&quot;</span>;
<a name="l00879"></a>00879         <span class="keywordflow">foreach</span> ($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;contents&#39;</span>] as $cId){
<a name="l00880"></a>00880           $res.=$cId.<span class="stringliteral">&quot; 0 R\n&quot;</span>;
<a name="l00881"></a>00881         }
<a name="l00882"></a>00882         $res.=<span class="stringliteral">&quot;]&quot;</span>;
<a name="l00883"></a>00883       }
<a name="l00884"></a>00884       $res.=<span class="stringliteral">&quot;\n&gt;&gt;\nendobj&quot;</span>;
<a name="l00885"></a>00885       <span class="keywordflow">return</span> $res;
<a name="l00886"></a>00886       <span class="keywordflow">break</span>;
<a name="l00887"></a>00887   }
<a name="l00888"></a>00888 }
<a name="l00889"></a>00889 
<a name="l00893"></a><a class="code" href="class_cpdf.html#ac8729d6b851615394c82bda391f37adb">00893</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#ac8729d6b851615394c82bda391f37adb">o_contents</a>($id,$action,<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>=<span class="stringliteral">&#39;&#39;</span>){
<a name="l00894"></a>00894   <span class="keywordflow">if</span> ($action!=<span class="stringliteral">&#39;new&#39;</span>){
<a name="l00895"></a>00895     $o =&amp; $this-&gt;objects[$id];
<a name="l00896"></a>00896   }
<a name="l00897"></a>00897   <span class="keywordflow">switch</span> ($action){
<a name="l00898"></a>00898     <span class="keywordflow">case</span> <span class="stringliteral">&#39;new&#39;</span>:
<a name="l00899"></a>00899       $this-&gt;objects[$id]=array(<span class="charliteral">&#39;t&#39;</span>=&gt;<span class="stringliteral">&#39;contents&#39;</span>,<span class="charliteral">&#39;c&#39;</span>=&gt;<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;info&#39;</span>=&gt;array());
<a name="l00900"></a>00900       <span class="keywordflow">if</span> (strlen(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>) &amp;&amp; intval(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>)){
<a name="l00901"></a>00901         <span class="comment">// then this contents is the primary for a page</span>
<a name="l00902"></a>00902         $this-&gt;objects[$id][<span class="stringliteral">&#39;onPage&#39;</span>]=<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>;
<a name="l00903"></a>00903       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>==<span class="stringliteral">&#39;raw&#39;</span>){
<a name="l00904"></a>00904         <span class="comment">// then this page contains some other type of system object</span>
<a name="l00905"></a>00905         $this-&gt;objects[$id][<span class="stringliteral">&#39;raw&#39;</span>]=1;
<a name="l00906"></a>00906       }
<a name="l00907"></a>00907       <span class="keywordflow">break</span>;
<a name="l00908"></a>00908     <span class="keywordflow">case</span> <span class="stringliteral">&#39;add&#39;</span>:
<a name="l00909"></a>00909       <span class="comment">// add more options to the decleration</span>
<a name="l00910"></a>00910       <span class="keywordflow">foreach</span> (<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a> as $k=&gt;$v){
<a name="l00911"></a>00911         $o[<span class="stringliteral">&#39;info&#39;</span>][$k]=$v;
<a name="l00912"></a>00912       }
<a name="l00913"></a>00913     <span class="keywordflow">case</span> <span class="stringliteral">&#39;out&#39;</span>:
<a name="l00914"></a>00914       $tmp=$o[<span class="charliteral">&#39;c&#39;</span>];
<a name="l00915"></a>00915       $res= <span class="stringliteral">&quot;\n&quot;</span>.$id.<span class="stringliteral">&quot; 0 obj\n&quot;</span>;
<a name="l00916"></a>00916       <span class="keywordflow">if</span> (isset($this-&gt;objects[$id][<span class="stringliteral">&#39;raw&#39;</span>])){
<a name="l00917"></a>00917         $res.=$tmp;
<a name="l00918"></a>00918       } <span class="keywordflow">else</span> {
<a name="l00919"></a>00919         $res.= <span class="stringliteral">&quot;&lt;&lt;&quot;</span>;
<a name="l00920"></a>00920         <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;gzcompress&#39;</span>) &amp;&amp; $this-&gt;options[<span class="stringliteral">&#39;compression&#39;</span>]){
<a name="l00921"></a>00921           <span class="comment">// then implement ZLIB based compression on this content stream</span>
<a name="l00922"></a>00922           $res.=<span class="stringliteral">&quot; /Filter /FlateDecode&quot;</span>;
<a name="l00923"></a>00923           $tmp = gzcompress($tmp);
<a name="l00924"></a>00924         }
<a name="l00925"></a>00925         <span class="keywordflow">if</span> ($this-&gt;encrypted){
<a name="l00926"></a>00926           $this-&gt;<a class="code" href="class_cpdf.html#a593c690c9c88459001b8fee0c1e02b60">encryptInit</a>($id);
<a name="l00927"></a>00927           $tmp = $this-&gt;<a class="code" href="class_cpdf.html#a1720331693e5f6fa093806517a79f0d6">ARC4</a>($tmp);
<a name="l00928"></a>00928         }
<a name="l00929"></a>00929         <span class="keywordflow">foreach</span>($o[<span class="stringliteral">&#39;info&#39;</span>] as $k=&gt;$v){
<a name="l00930"></a>00930           $res .= <span class="stringliteral">&quot;\n/&quot;</span>.$k.<span class="charliteral">&#39; &#39;</span>.$v;
<a name="l00931"></a>00931         }
<a name="l00932"></a>00932         $res.=<span class="stringliteral">&quot;\n/Length &quot;</span>.strlen($tmp).<span class="stringliteral">&quot; &gt;&gt;\nstream\n&quot;</span>.$tmp.<span class="stringliteral">&quot;\nendstream&quot;</span>;
<a name="l00933"></a>00933       }
<a name="l00934"></a>00934       $res.=<span class="stringliteral">&quot;\nendobj\n&quot;</span>;
<a name="l00935"></a>00935       <span class="keywordflow">return</span> $res;
<a name="l00936"></a>00936       <span class="keywordflow">break</span>;
<a name="l00937"></a>00937   }
<a name="l00938"></a>00938 }
<a name="l00939"></a>00939 
<a name="l00943"></a><a class="code" href="class_cpdf.html#ac2199fd5ae0ff08a49c57dc48cea87be">00943</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#ac2199fd5ae0ff08a49c57dc48cea87be">o_image</a>($id,$action,<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>=<span class="stringliteral">&#39;&#39;</span>){
<a name="l00944"></a>00944   <span class="keywordflow">if</span> ($action!=<span class="stringliteral">&#39;new&#39;</span>){
<a name="l00945"></a>00945     $o =&amp; $this-&gt;objects[$id];
<a name="l00946"></a>00946   }
<a name="l00947"></a>00947   <span class="keywordflow">switch</span>($action){
<a name="l00948"></a>00948     <span class="keywordflow">case</span> <span class="stringliteral">&#39;new&#39;</span>:
<a name="l00949"></a>00949       <span class="comment">// make the new object</span>
<a name="l00950"></a>00950       $this-&gt;objects[$id]=array(<span class="charliteral">&#39;t&#39;</span>=&gt;<span class="stringliteral">&#39;image&#39;</span>,<span class="stringliteral">&#39;data&#39;</span>=&gt;<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;data&#39;</span>],<span class="stringliteral">&#39;info&#39;</span>=&gt;array());
<a name="l00951"></a>00951       $this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;Type&#39;</span>]=<span class="stringliteral">&#39;/XObject&#39;</span>;
<a name="l00952"></a>00952       $this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;Subtype&#39;</span>]=<span class="stringliteral">&#39;/Image&#39;</span>;
<a name="l00953"></a>00953       $this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;Width&#39;</span>]=<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;iw&#39;</span>];
<a name="l00954"></a>00954       $this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;Height&#39;</span>]=<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;ih&#39;</span>];
<a name="l00955"></a>00955       <span class="keywordflow">if</span> (!isset(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;type&#39;</span>]) || <a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;type&#39;</span>]==<span class="stringliteral">&#39;jpg&#39;</span>){
<a name="l00956"></a>00956         <span class="keywordflow">if</span> (!isset(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;channels&#39;</span>])){
<a name="l00957"></a>00957           <a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;channels&#39;</span>]=3;
<a name="l00958"></a>00958         }
<a name="l00959"></a>00959         <span class="keywordflow">switch</span>(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;channels&#39;</span>]){
<a name="l00960"></a>00960           <span class="keywordflow">case</span> 1:
<a name="l00961"></a>00961             $this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;ColorSpace&#39;</span>]=<span class="stringliteral">&#39;/DeviceGray&#39;</span>;
<a name="l00962"></a>00962             <span class="keywordflow">break</span>;
<a name="l00963"></a>00963           <span class="keywordflow">default</span>:
<a name="l00964"></a>00964             $this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;ColorSpace&#39;</span>]=<span class="stringliteral">&#39;/DeviceRGB&#39;</span>;
<a name="l00965"></a>00965             <span class="keywordflow">break</span>;
<a name="l00966"></a>00966         }
<a name="l00967"></a>00967         $this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;Filter&#39;</span>]=<span class="stringliteral">&#39;/DCTDecode&#39;</span>;
<a name="l00968"></a>00968         $this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;BitsPerComponent&#39;</span>]=8;
<a name="l00969"></a>00969       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;type&#39;</span>]==<span class="stringliteral">&#39;png&#39;</span>){
<a name="l00970"></a>00970         $this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;Filter&#39;</span>]=<span class="stringliteral">&#39;/FlateDecode&#39;</span>;
<a name="l00971"></a>00971         $this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;DecodeParms&#39;</span>]=<span class="stringliteral">&#39;&lt;&lt; /Predictor 15 /Colors &#39;</span>.$options[<span class="stringliteral">&#39;ncolor&#39;</span>].<span class="stringliteral">&#39; /Columns &#39;</span>.<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;iw&#39;</span>].<span class="stringliteral">&#39; /BitsPerComponent &#39;</span>.<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;bitsPerComponent&#39;</span>].<span class="stringliteral">&#39;&gt;&gt;&#39;</span>;
<a name="l00972"></a>00972         <span class="keywordflow">if</span> (strlen(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;pdata&#39;</span>])){
<a name="l00973"></a>00973           $tmp = <span class="stringliteral">&#39; [ /Indexed /DeviceRGB &#39;</span>.(strlen(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;pdata&#39;</span>])/3-1).<span class="charliteral">&#39; &#39;</span>;
<a name="l00974"></a>00974           $this-&gt;numObj++;
<a name="l00975"></a>00975           $this-&gt;<a class="code" href="class_cpdf.html#ac8729d6b851615394c82bda391f37adb">o_contents</a>($this-&gt;numObj,<span class="stringliteral">&#39;new&#39;</span>);
<a name="l00976"></a>00976           $this-&gt;objects[$this-&gt;numObj][<span class="charliteral">&#39;c&#39;</span>]=<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;pdata&#39;</span>];
<a name="l00977"></a>00977           $tmp.=$this-&gt;numObj.<span class="stringliteral">&#39; 0 R&#39;</span>;
<a name="l00978"></a>00978           $tmp .=<span class="stringliteral">&#39; ]&#39;</span>;
<a name="l00979"></a>00979           $this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;ColorSpace&#39;</span>] = $tmp;
<a name="l00980"></a>00980           <span class="keywordflow">if</span> (isset(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;transparency&#39;</span>])){
<a name="l00981"></a>00981             <span class="keywordflow">switch</span>(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;transparency&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>]){
<a name="l00982"></a>00982               <span class="keywordflow">case</span> <span class="stringliteral">&#39;indexed&#39;</span>:
<a name="l00983"></a>00983                 $tmp=<span class="stringliteral">&#39; [ &#39;</span>.$options[<span class="stringliteral">&#39;transparency&#39;</span>][<span class="stringliteral">&#39;data&#39;</span>].<span class="charliteral">&#39; &#39;</span>.<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;transparency&#39;</span>][<span class="stringliteral">&#39;data&#39;</span>].<span class="stringliteral">&#39;] &#39;</span>;
<a name="l00984"></a>00984                 $this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;Mask&#39;</span>] = $tmp;
<a name="l00985"></a>00985                 <span class="keywordflow">break</span>;
<a name="l00986"></a>00986             }
<a name="l00987"></a>00987           }
<a name="l00988"></a>00988         } <span class="keywordflow">else</span> {
<a name="l00989"></a>00989           $this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;ColorSpace&#39;</span>]=<span class="charliteral">&#39;/&#39;</span>.$options[<span class="stringliteral">&#39;color&#39;</span>];
<a name="l00990"></a>00990         }
<a name="l00991"></a>00991         $this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;BitsPerComponent&#39;</span>]=<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;bitsPerComponent&#39;</span>];
<a name="l00992"></a>00992       }
<a name="l00993"></a>00993       <span class="comment">// assign it a place in the named resource dictionary as an external object, according to</span>
<a name="l00994"></a>00994       <span class="comment">// the label passed in with it.</span>
<a name="l00995"></a>00995       $this-&gt;<a class="code" href="class_cpdf.html#a81c56aa681c1462c1a2d29a4b164e1c9">o_pages</a>($this-&gt;currentNode,<span class="stringliteral">&#39;xObject&#39;</span>,array(<span class="stringliteral">&#39;label&#39;</span>=&gt;<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;label&#39;</span>],<span class="stringliteral">&#39;objNum&#39;</span>=&gt;$id));
<a name="l00996"></a>00996       <span class="comment">// also make sure that we have the right procset object for it.</span>
<a name="l00997"></a>00997       $this-&gt;<a class="code" href="class_cpdf.html#a8c957eb8366fe5b89727c7ec68700afc">o_procset</a>($this-&gt;procsetObjectId,<span class="stringliteral">&#39;add&#39;</span>,<span class="stringliteral">&#39;ImageC&#39;</span>);
<a name="l00998"></a>00998       <span class="keywordflow">break</span>;
<a name="l00999"></a>00999     <span class="keywordflow">case</span> <span class="stringliteral">&#39;out&#39;</span>:
<a name="l01000"></a>01000       $tmp=$o[<span class="stringliteral">&#39;data&#39;</span>];
<a name="l01001"></a>01001       $res= <span class="stringliteral">&quot;\n&quot;</span>.$id.<span class="stringliteral">&quot; 0 obj\n&lt;&lt;&quot;</span>;
<a name="l01002"></a>01002       <span class="keywordflow">foreach</span>($o[<span class="stringliteral">&#39;info&#39;</span>] as $k=&gt;$v){
<a name="l01003"></a>01003         $res.=<span class="stringliteral">&quot;\n/&quot;</span>.$k.<span class="charliteral">&#39; &#39;</span>.$v;
<a name="l01004"></a>01004       }
<a name="l01005"></a>01005       <span class="keywordflow">if</span> ($this-&gt;encrypted){
<a name="l01006"></a>01006         $this-&gt;<a class="code" href="class_cpdf.html#a593c690c9c88459001b8fee0c1e02b60">encryptInit</a>($id);
<a name="l01007"></a>01007         $tmp = $this-&gt;<a class="code" href="class_cpdf.html#a1720331693e5f6fa093806517a79f0d6">ARC4</a>($tmp);
<a name="l01008"></a>01008       }
<a name="l01009"></a>01009       $res.=<span class="stringliteral">&quot;\n/Length &quot;</span>.strlen($tmp).<span class="stringliteral">&quot; &gt;&gt;\nstream\n&quot;</span>.$tmp.<span class="stringliteral">&quot;\nendstream\nendobj\n&quot;</span>;
<a name="l01010"></a>01010       <span class="keywordflow">return</span> $res;
<a name="l01011"></a>01011       <span class="keywordflow">break</span>;
<a name="l01012"></a>01012   }
<a name="l01013"></a>01013 }
<a name="l01014"></a>01014 
<a name="l01018"></a><a class="code" href="class_cpdf.html#af77067434721b4808184e6d7793fa85c">01018</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#af77067434721b4808184e6d7793fa85c">o_encryption</a>($id,$action,<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>=<span class="stringliteral">&#39;&#39;</span>){
<a name="l01019"></a>01019   <span class="keywordflow">if</span> ($action!=<span class="stringliteral">&#39;new&#39;</span>){
<a name="l01020"></a>01020     $o =&amp; $this-&gt;objects[$id];
<a name="l01021"></a>01021   }
<a name="l01022"></a>01022   <span class="keywordflow">switch</span>($action){
<a name="l01023"></a>01023     <span class="keywordflow">case</span> <span class="stringliteral">&#39;new&#39;</span>:
<a name="l01024"></a>01024       <span class="comment">// make the new object</span>
<a name="l01025"></a>01025       $this-&gt;objects[$id]=array(<span class="charliteral">&#39;t&#39;</span>=&gt;<span class="stringliteral">&#39;encryption&#39;</span>,<span class="stringliteral">&#39;info&#39;</span>=&gt;<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>);
<a name="l01026"></a>01026       $this-&gt;arc4_objnum=$id;
<a name="l01027"></a>01027       <span class="comment">// figure out the additional paramaters required</span>
<a name="l01028"></a>01028       $pad = chr(0x28).chr(0xBF).chr(0x4E).chr(0x5E).chr(0x4E).chr(0x75).chr(0x8A).chr(0x41).chr(0x64).chr(0x00).chr(0x4E).chr(0x56).chr(0xFF).chr(0xFA).chr(0x01).chr(0x08).chr(0x2E).chr(0x2E).chr(0x00).chr(0xB6).chr(0xD0).chr(0x68).chr(0x3E).chr(0x80).chr(0x2F).chr(0x0C).chr(0xA9).chr(0xFE).chr(0x64).chr(0x53).chr(0x69).chr(0x7A);
<a name="l01029"></a>01029       $len = strlen(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;owner&#39;</span>]);
<a name="l01030"></a>01030       <span class="keywordflow">if</span> ($len&gt;32){
<a name="l01031"></a>01031         $owner = substr(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;owner&#39;</span>],0,32);
<a name="l01032"></a>01032       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($len&lt;32){
<a name="l01033"></a>01033         $owner = <a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;owner&#39;</span>].substr($pad,0,32-$len);
<a name="l01034"></a>01034       } <span class="keywordflow">else</span> {
<a name="l01035"></a>01035         $owner = <a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;owner&#39;</span>];
<a name="l01036"></a>01036       }
<a name="l01037"></a>01037       $len = strlen(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;user&#39;</span>]);
<a name="l01038"></a>01038       <span class="keywordflow">if</span> ($len&gt;32){
<a name="l01039"></a>01039         <a class="code" href="miscellaneous_2myaccount_2data__read_8ejs_8php.html#a598ca4e71b15a1313ec95f0df1027ca5">$user</a> = substr(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;user&#39;</span>],0,32);
<a name="l01040"></a>01040       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($len&lt;32){
<a name="l01041"></a>01041         <a class="code" href="miscellaneous_2myaccount_2data__read_8ejs_8php.html#a598ca4e71b15a1313ec95f0df1027ca5">$user</a> = <a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;user&#39;</span>].substr($pad,0,32-$len);
<a name="l01042"></a>01042       } <span class="keywordflow">else</span> {
<a name="l01043"></a>01043         <a class="code" href="miscellaneous_2myaccount_2data__read_8ejs_8php.html#a598ca4e71b15a1313ec95f0df1027ca5">$user</a> = <a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;user&#39;</span>];
<a name="l01044"></a>01044       }
<a name="l01045"></a>01045       $tmp = $this-&gt;<a class="code" href="class_cpdf.html#a7c89968388709b624565f4cd0faaa167">md5_16</a>($owner);
<a name="l01046"></a>01046       $okey = substr($tmp,0,5);
<a name="l01047"></a>01047       $this-&gt;<a class="code" href="class_cpdf.html#ab9ace0c7741193acf9b665f2cac0139e">ARC4_init</a>($okey);
<a name="l01048"></a>01048       $ovalue=$this-&gt;<a class="code" href="class_cpdf.html#a1720331693e5f6fa093806517a79f0d6">ARC4</a>(<a class="code" href="miscellaneous_2myaccount_2data__read_8ejs_8php.html#a598ca4e71b15a1313ec95f0df1027ca5">$user</a>);
<a name="l01049"></a>01049       $this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="charliteral">&#39;O&#39;</span>]=$ovalue;
<a name="l01050"></a>01050       <span class="comment">// now make the u value, phew.</span>
<a name="l01051"></a>01051       $tmp = $this-&gt;<a class="code" href="class_cpdf.html#a7c89968388709b624565f4cd0faaa167">md5_16</a>(<a class="code" href="miscellaneous_2myaccount_2data__read_8ejs_8php.html#a598ca4e71b15a1313ec95f0df1027ca5">$user</a>.$ovalue.chr(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="charliteral">&#39;p&#39;</span>]).chr(255).chr(255).chr(255).$this-&gt;fileIdentifier);
<a name="l01052"></a>01052       $ukey = substr($tmp,0,5);
<a name="l01053"></a>01053 
<a name="l01054"></a>01054       $this-&gt;<a class="code" href="class_cpdf.html#ab9ace0c7741193acf9b665f2cac0139e">ARC4_init</a>($ukey);
<a name="l01055"></a>01055       $this-&gt;encryptionKey = $ukey;
<a name="l01056"></a>01056       $this-&gt;encrypted=1;
<a name="l01057"></a>01057       $uvalue=$this-&gt;<a class="code" href="class_cpdf.html#a1720331693e5f6fa093806517a79f0d6">ARC4</a>($pad);
<a name="l01058"></a>01058 
<a name="l01059"></a>01059       $this-&gt;objects[$id][<span class="stringliteral">&#39;info&#39;</span>][<span class="charliteral">&#39;U&#39;</span>]=$uvalue;
<a name="l01060"></a>01060       $this-&gt;encryptionKey=$ukey;
<a name="l01061"></a>01061      
<a name="l01062"></a>01062       <span class="comment">// initialize the arc4 array</span>
<a name="l01063"></a>01063       <span class="keywordflow">break</span>;
<a name="l01064"></a>01064     <span class="keywordflow">case</span> <span class="stringliteral">&#39;out&#39;</span>:
<a name="l01065"></a>01065       $res= <span class="stringliteral">&quot;\n&quot;</span>.$id.<span class="stringliteral">&quot; 0 obj\n&lt;&lt;&quot;</span>;
<a name="l01066"></a>01066       $res.=<span class="stringliteral">&quot;\n/Filter /Standard&quot;</span>;
<a name="l01067"></a>01067       $res.=<span class="stringliteral">&quot;\n/V 1&quot;</span>;
<a name="l01068"></a>01068       $res.=<span class="stringliteral">&quot;\n/R 2&quot;</span>;
<a name="l01069"></a>01069       $res.=<span class="stringliteral">&quot;\n/O (&quot;</span>.$this-&gt;filterText($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="charliteral">&#39;O&#39;</span>]).<span class="charliteral">&#39;)&#39;</span>;
<a name="l01070"></a>01070       $res.=<span class="stringliteral">&quot;\n/U (&quot;</span>.$this-&gt;filterText($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="charliteral">&#39;U&#39;</span>]).<span class="charliteral">&#39;)&#39;</span>;
<a name="l01071"></a>01071       <span class="comment">// and the p-value needs to be converted to account for the twos-complement approach</span>
<a name="l01072"></a>01072       $o[<span class="stringliteral">&#39;info&#39;</span>][<span class="charliteral">&#39;p&#39;</span>] = (($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="charliteral">&#39;p&#39;</span>]^255)+1)*-1;
<a name="l01073"></a>01073       $res.=<span class="stringliteral">&quot;\n/P &quot;</span>.($o[<span class="stringliteral">&#39;info&#39;</span>][<span class="charliteral">&#39;p&#39;</span>]);
<a name="l01074"></a>01074       $res.=<span class="stringliteral">&quot;\n&gt;&gt;\nendobj\n&quot;</span>;
<a name="l01075"></a>01075       
<a name="l01076"></a>01076       <span class="keywordflow">return</span> $res;
<a name="l01077"></a>01077       <span class="keywordflow">break</span>;
<a name="l01078"></a>01078   }
<a name="l01079"></a>01079 }
<a name="l01080"></a>01080       
<a name="l01089"></a><a class="code" href="class_cpdf.html#a7c89968388709b624565f4cd0faaa167">01089</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a7c89968388709b624565f4cd0faaa167">md5_16</a>($string){
<a name="l01090"></a>01090   $tmp = md5($string);
<a name="l01091"></a>01091   $out=<span class="stringliteral">&#39;&#39;</span>;
<a name="l01092"></a>01092   <span class="keywordflow">for</span> ($i=0;$i&lt;=30;$i=$i+2){
<a name="l01093"></a>01093     $out.=chr(hexdec(substr($tmp,$i,2)));
<a name="l01094"></a>01094   }
<a name="l01095"></a>01095   <span class="keywordflow">return</span> $out;
<a name="l01096"></a>01096 }
<a name="l01097"></a>01097 
<a name="l01101"></a><a class="code" href="class_cpdf.html#a593c690c9c88459001b8fee0c1e02b60">01101</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a593c690c9c88459001b8fee0c1e02b60">encryptInit</a>($id){
<a name="l01102"></a>01102   $tmp = $this-&gt;encryptionKey;
<a name="l01103"></a>01103   $hex = dechex($id);
<a name="l01104"></a>01104   <span class="keywordflow">if</span> (strlen($hex)&lt;6){
<a name="l01105"></a>01105     $hex = substr(<span class="stringliteral">&#39;000000&#39;</span>,0,6-strlen($hex)).$hex;
<a name="l01106"></a>01106   }
<a name="l01107"></a>01107   $tmp.= chr(hexdec(substr($hex,4,2))).chr(hexdec(substr($hex,2,2))).chr(hexdec(substr($hex,0,2))).chr(0).chr(0);
<a name="l01108"></a>01108   $key = $this-&gt;<a class="code" href="class_cpdf.html#a7c89968388709b624565f4cd0faaa167">md5_16</a>($tmp);
<a name="l01109"></a>01109   $this-&gt;<a class="code" href="class_cpdf.html#ab9ace0c7741193acf9b665f2cac0139e">ARC4_init</a>(substr($key,0,10));
<a name="l01110"></a>01110 }
<a name="l01111"></a>01111 
<a name="l01115"></a><a class="code" href="class_cpdf.html#ab9ace0c7741193acf9b665f2cac0139e">01115</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#ab9ace0c7741193acf9b665f2cac0139e">ARC4_init</a>($key=<span class="stringliteral">&#39;&#39;</span>){
<a name="l01116"></a>01116   $this-&gt;arc4 = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01117"></a>01117   <span class="comment">// setup the control array</span>
<a name="l01118"></a>01118   <span class="keywordflow">if</span> (strlen($key)==0){
<a name="l01119"></a>01119     <span class="keywordflow">return</span>;
<a name="l01120"></a>01120   }
<a name="l01121"></a>01121   $k = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01122"></a>01122   <span class="keywordflow">while</span>(strlen($k)&lt;256){
<a name="l01123"></a>01123     $k.=$key;
<a name="l01124"></a>01124   }
<a name="l01125"></a>01125   $k=substr($k,0,256);
<a name="l01126"></a>01126   <span class="keywordflow">for</span> ($i=0;$i&lt;256;$i++){
<a name="l01127"></a>01127     $this-&gt;arc4 .= chr($i);
<a name="l01128"></a>01128   }
<a name="l01129"></a>01129   $j=0;
<a name="l01130"></a>01130   <span class="keywordflow">for</span> ($i=0;$i&lt;256;$i++){
<a name="l01131"></a>01131     $t = $this-&gt;arc4[$i];
<a name="l01132"></a>01132     $j = ($j + ord($t) + ord($k[$i]))%256;
<a name="l01133"></a>01133     $this-&gt;arc4[$i]=$this-&gt;arc4[$j];
<a name="l01134"></a>01134     $this-&gt;arc4[$j]=$t;
<a name="l01135"></a>01135   }    
<a name="l01136"></a>01136 }
<a name="l01137"></a>01137 
<a name="l01141"></a><a class="code" href="class_cpdf.html#a1720331693e5f6fa093806517a79f0d6">01141</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a1720331693e5f6fa093806517a79f0d6">ARC4</a>($text){
<a name="l01142"></a>01142   $len=strlen($text);
<a name="l01143"></a>01143   <a class="code" href="phpdoc_8inc.html#acebf83966ef6d7e5645a6b62ba368f9f">$a</a>=0;
<a name="l01144"></a>01144   $b=0;
<a name="l01145"></a>01145   $c = $this-&gt;arc4;
<a name="l01146"></a>01146   $out=<span class="stringliteral">&#39;&#39;</span>;
<a name="l01147"></a>01147   <span class="keywordflow">for</span> ($i=0;$i&lt;$len;$i++){
<a name="l01148"></a>01148     <a class="code" href="phpdoc_8inc.html#acebf83966ef6d7e5645a6b62ba368f9f">$a</a> = (<a class="code" href="phpdoc_8inc.html#acebf83966ef6d7e5645a6b62ba368f9f">$a</a>+1)%256;
<a name="l01149"></a>01149     $t= $c[<a class="code" href="phpdoc_8inc.html#acebf83966ef6d7e5645a6b62ba368f9f">$a</a>];
<a name="l01150"></a>01150     $b = ($b+ord($t))%256;
<a name="l01151"></a>01151     $c[<a class="code" href="phpdoc_8inc.html#acebf83966ef6d7e5645a6b62ba368f9f">$a</a>]=$c[$b];
<a name="l01152"></a>01152     $c[$b]=$t;
<a name="l01153"></a>01153     $k = ord($c[(ord($c[<a class="code" href="phpdoc_8inc.html#acebf83966ef6d7e5645a6b62ba368f9f">$a</a>])+ord($c[$b]))%256]);
<a name="l01154"></a>01154     $out.=chr(ord($text[$i]) ^ $k);
<a name="l01155"></a>01155   }
<a name="l01156"></a>01156   
<a name="l01157"></a>01157   <span class="keywordflow">return</span> $out;
<a name="l01158"></a>01158 }
<a name="l01159"></a>01159 
<a name="l01167"></a><a class="code" href="class_cpdf.html#a1f48bf2f91aec0960acebcb01548dfb0">01167</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a1f48bf2f91aec0960acebcb01548dfb0">addLink</a>(<a class="code" href="miscellaneous_2websearch_2data__read_8ejs_8php.html#a8d5b9b337ab7c5f5a8c5f8d774e0c6b5">$url</a>,$x0,$y0,$x1,$y1){
<a name="l01168"></a>01168   $this-&gt;numObj++;
<a name="l01169"></a>01169   $info = array(<span class="stringliteral">&#39;type&#39;</span>=&gt;<span class="stringliteral">&#39;link&#39;</span>,<span class="stringliteral">&#39;url&#39;</span>=&gt;<a class="code" href="miscellaneous_2websearch_2data__read_8ejs_8php.html#a8d5b9b337ab7c5f5a8c5f8d774e0c6b5">$url</a>,<span class="stringliteral">&#39;rect&#39;</span>=&gt;array($x0,$y0,$x1,$y1));
<a name="l01170"></a>01170   $this-&gt;<a class="code" href="class_cpdf.html#aef859651290d314f10fbb2aee0a3785b">o_annotation</a>($this-&gt;numObj,<span class="stringliteral">&#39;new&#39;</span>,$info);
<a name="l01171"></a>01171 }
<a name="l01172"></a>01172 
<a name="l01176"></a><a class="code" href="class_cpdf.html#aa47771ad964538a2009e960582ef4439">01176</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#aa47771ad964538a2009e960582ef4439">addInternalLink</a>($label,$x0,$y0,$x1,$y1){
<a name="l01177"></a>01177   $this-&gt;numObj++;
<a name="l01178"></a>01178   $info = array(<span class="stringliteral">&#39;type&#39;</span>=&gt;<span class="stringliteral">&#39;ilink&#39;</span>,<span class="stringliteral">&#39;label&#39;</span>=&gt;$label,<span class="stringliteral">&#39;rect&#39;</span>=&gt;array($x0,$y0,$x1,$y1));
<a name="l01179"></a>01179   $this-&gt;<a class="code" href="class_cpdf.html#aef859651290d314f10fbb2aee0a3785b">o_annotation</a>($this-&gt;numObj,<span class="stringliteral">&#39;new&#39;</span>,$info);
<a name="l01180"></a>01180 }
<a name="l01181"></a>01181 
<a name="l01187"></a><a class="code" href="class_cpdf.html#a2449e87b218d05a506d4ca97fdb6d13a">01187</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a2449e87b218d05a506d4ca97fdb6d13a">setEncryption</a>($userPass=<span class="stringliteral">&#39;&#39;</span>,$ownerPass=<span class="stringliteral">&#39;&#39;</span>,$pc=array()){
<a name="l01188"></a>01188   $p=bindec(11000000);
<a name="l01189"></a>01189 
<a name="l01190"></a>01190   <a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a> = array(
<a name="l01191"></a>01191      <span class="stringliteral">&#39;print&#39;</span>=&gt;4
<a name="l01192"></a>01192     ,<span class="stringliteral">&#39;modify&#39;</span>=&gt;8
<a name="l01193"></a>01193     ,<span class="stringliteral">&#39;copy&#39;</span>=&gt;16
<a name="l01194"></a>01194     ,<span class="stringliteral">&#39;add&#39;</span>=&gt;32
<a name="l01195"></a>01195   );
<a name="l01196"></a>01196   <span class="keywordflow">foreach</span>($pc as $k=&gt;$v){
<a name="l01197"></a>01197     <span class="keywordflow">if</span> ($v &amp;&amp; isset(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[$k])){
<a name="l01198"></a>01198       $p+=<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[$k];
<a name="l01199"></a>01199     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isset(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[$v])){
<a name="l01200"></a>01200       $p+=<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[$v];
<a name="l01201"></a>01201     }
<a name="l01202"></a>01202   }
<a name="l01203"></a>01203   <span class="comment">// implement encryption on the document</span>
<a name="l01204"></a>01204   <span class="keywordflow">if</span> ($this-&gt;arc4_objnum == 0){
<a name="l01205"></a>01205     <span class="comment">// then the block does not exist already, add it.</span>
<a name="l01206"></a>01206     $this-&gt;numObj++;
<a name="l01207"></a>01207     <span class="keywordflow">if</span> (strlen($ownerPass)==0){
<a name="l01208"></a>01208       $ownerPass=$userPass;
<a name="l01209"></a>01209     }
<a name="l01210"></a>01210     $this-&gt;<a class="code" href="class_cpdf.html#af77067434721b4808184e6d7793fa85c">o_encryption</a>($this-&gt;numObj,<span class="stringliteral">&#39;new&#39;</span>,array(<span class="stringliteral">&#39;user&#39;</span>=&gt;$userPass,<span class="stringliteral">&#39;owner&#39;</span>=&gt;$ownerPass,<span class="charliteral">&#39;p&#39;</span>=&gt;$p));
<a name="l01211"></a>01211   }
<a name="l01212"></a>01212 }
<a name="l01213"></a>01213 
<a name="l01217"></a><a class="code" href="class_cpdf.html#a97cd4a04c03ffbf0f9f1dde0670f25c0">01217</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a97cd4a04c03ffbf0f9f1dde0670f25c0">checkAllHere</a>(){
<a name="l01218"></a>01218 }
<a name="l01219"></a>01219 
<a name="l01223"></a><a class="code" href="class_cpdf.html#aa81bf39d5b682bbccdbf75c269b15729">01223</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#aa81bf39d5b682bbccdbf75c269b15729">output</a>($debug=0){
<a name="l01224"></a>01224 
<a name="l01225"></a>01225   <span class="keywordflow">if</span> ($debug){
<a name="l01226"></a>01226     <span class="comment">// turn compression off</span>
<a name="l01227"></a>01227     $this-&gt;options[<span class="stringliteral">&#39;compression&#39;</span>]=0;
<a name="l01228"></a>01228   }
<a name="l01229"></a>01229 
<a name="l01230"></a>01230   <span class="keywordflow">if</span> ($this-&gt;arc4_objnum){
<a name="l01231"></a>01231     $this-&gt;<a class="code" href="class_cpdf.html#ab9ace0c7741193acf9b665f2cac0139e">ARC4_init</a>($this-&gt;encryptionKey);
<a name="l01232"></a>01232   }
<a name="l01233"></a>01233 
<a name="l01234"></a>01234   $this-&gt;<a class="code" href="class_cpdf.html#a97cd4a04c03ffbf0f9f1dde0670f25c0">checkAllHere</a>();
<a name="l01235"></a>01235 
<a name="l01236"></a>01236   $xref=array();
<a name="l01237"></a>01237   $content=<span class="stringliteral">&quot;%PDF-1.3\n%����\n&quot;</span>;
<a name="l01238"></a>01238 <span class="comment">//  $content=&quot;%PDF-1.3\n&quot;;</span>
<a name="l01239"></a>01239   $pos=strlen($content);
<a name="l01240"></a>01240   <span class="keywordflow">foreach</span>($this-&gt;objects as $k=&gt;$v){
<a name="l01241"></a>01241     $tmp=<span class="stringliteral">&#39;o_&#39;</span>.$v[<span class="charliteral">&#39;t&#39;</span>];
<a name="l01242"></a>01242     $cont=$this-&gt;$tmp($k,<span class="stringliteral">&#39;out&#39;</span>);
<a name="l01243"></a>01243     $content.=$cont;
<a name="l01244"></a>01244     $xref[]=$pos;
<a name="l01245"></a>01245     $pos+=strlen($cont);
<a name="l01246"></a>01246   }
<a name="l01247"></a>01247   $content.=<span class="stringliteral">&quot;\nxref\n0 &quot;</span>.(count($xref)+1).<span class="stringliteral">&quot;\n0000000000 65535 f \n&quot;</span>;
<a name="l01248"></a>01248   <span class="keywordflow">foreach</span>($xref as $p){
<a name="l01249"></a>01249     $content.=substr(<span class="stringliteral">&#39;0000000000&#39;</span>,0,10-strlen($p)).$p.<span class="stringliteral">&quot; 00000 n \n&quot;</span>;
<a name="l01250"></a>01250   }
<a name="l01251"></a>01251   $content.=<span class="stringliteral">&quot;\ntrailer\n  &lt;&lt; /Size &quot;</span>.(count($xref)+1).<span class="stringliteral">&quot;\n     /Root 1 0 R\n     /Info &quot;</span>.$this-&gt;infoObject.<span class="stringliteral">&quot; 0 R\n&quot;</span>;
<a name="l01252"></a>01252   <span class="comment">// if encryption has been applied to this document then add the marker for this dictionary</span>
<a name="l01253"></a>01253   <a class="code" href="immunizations_8ejs_8php.html#a8d5a88c29c26abdfa2ad05737bbe0ac9">if</a> ($this-&gt;arc4_objnum &gt; 0){
<a name="l01254"></a>01254     $content .= <span class="stringliteral">&quot;/Encrypt &quot;</span>.$this-&gt;arc4_objnum.<span class="stringliteral">&quot; 0 R\n&quot;</span>;
<a name="l01255"></a>01255   }
<a name="l01256"></a>01256   <span class="keywordflow">if</span> (strlen($this-&gt;fileIdentifier)){
<a name="l01257"></a>01257     $content .= <span class="stringliteral">&quot;/ID[&lt;&quot;</span>.$this-&gt;fileIdentifier.<span class="stringliteral">&quot;&gt;&lt;&quot;</span>.$this-&gt;fileIdentifier.<span class="stringliteral">&quot;&gt;]\n&quot;</span>;
<a name="l01258"></a>01258   }
<a name="l01259"></a>01259   $content .= <span class="stringliteral">&quot;  &gt;&gt;\nstartxref\n&quot;</span>.$pos.<span class="stringliteral">&quot;\n%%EOF\n&quot;</span>;
<a name="l01260"></a>01260   <span class="keywordflow">return</span> $content;
<a name="l01261"></a>01261 }
<a name="l01262"></a>01262 
<a name="l01270"></a><a class="code" href="class_cpdf.html#ab3114927075d9643a6ce7bcffb2bb8ac">01270</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#ab3114927075d9643a6ce7bcffb2bb8ac">newDocument</a>($pageSize=array(0,0,612,792)){
<a name="l01271"></a>01271   $this-&gt;numObj=0;
<a name="l01272"></a>01272   $this-&gt;objects = array();
<a name="l01273"></a>01273 
<a name="l01274"></a>01274   $this-&gt;numObj++;
<a name="l01275"></a>01275   $this-&gt;<a class="code" href="class_cpdf.html#ad5269fc1648ba039f9ab1d372b89aa55">o_catalog</a>($this-&gt;numObj,<span class="stringliteral">&#39;new&#39;</span>);
<a name="l01276"></a>01276 
<a name="l01277"></a>01277   $this-&gt;numObj++;
<a name="l01278"></a>01278   $this-&gt;<a class="code" href="class_cpdf.html#a5e6a4d8146f8dc8424c01107deae2363">o_outlines</a>($this-&gt;numObj,<span class="stringliteral">&#39;new&#39;</span>);
<a name="l01279"></a>01279 
<a name="l01280"></a>01280   $this-&gt;numObj++;
<a name="l01281"></a>01281   $this-&gt;<a class="code" href="class_cpdf.html#a81c56aa681c1462c1a2d29a4b164e1c9">o_pages</a>($this-&gt;numObj,<span class="stringliteral">&#39;new&#39;</span>);
<a name="l01282"></a>01282 
<a name="l01283"></a>01283   $this-&gt;<a class="code" href="class_cpdf.html#a81c56aa681c1462c1a2d29a4b164e1c9">o_pages</a>($this-&gt;numObj,<span class="stringliteral">&#39;mediaBox&#39;</span>,$pageSize);
<a name="l01284"></a>01284   $this-&gt;currentNode = 3;
<a name="l01285"></a>01285 
<a name="l01286"></a>01286   $this-&gt;numObj++;
<a name="l01287"></a>01287   $this-&gt;<a class="code" href="class_cpdf.html#a8c957eb8366fe5b89727c7ec68700afc">o_procset</a>($this-&gt;numObj,<span class="stringliteral">&#39;new&#39;</span>);
<a name="l01288"></a>01288 
<a name="l01289"></a>01289   $this-&gt;numObj++;
<a name="l01290"></a>01290   $this-&gt;<a class="code" href="class_cpdf.html#a1b15589e09e12f423f87d8ba3b1b1be4">o_info</a>($this-&gt;numObj,<span class="stringliteral">&#39;new&#39;</span>);
<a name="l01291"></a>01291 
<a name="l01292"></a>01292   $this-&gt;numObj++;
<a name="l01293"></a>01293   $this-&gt;<a class="code" href="class_cpdf.html#aa8f8c9faae6d2ef10e350675dde97f8d">o_page</a>($this-&gt;numObj,<span class="stringliteral">&#39;new&#39;</span>);
<a name="l01294"></a>01294 
<a name="l01295"></a>01295   <span class="comment">// need to store the first page id as there is no way to get it to the user during </span>
<a name="l01296"></a>01296   <span class="comment">// startup</span>
<a name="l01297"></a>01297   $this-&gt;firstPageId = $this-&gt;currentContents;
<a name="l01298"></a>01298 }
<a name="l01299"></a>01299 
<a name="l01309"></a><a class="code" href="class_cpdf.html#ac9e094a24b03891a8b8e1ef468b535b7">01309</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#ac9e094a24b03891a8b8e1ef468b535b7">openFont</a>($font){
<a name="l01310"></a>01310   <span class="comment">// assume that $font contains both the path and perhaps the extension to the file, split them</span>
<a name="l01311"></a>01311   $pos=strrpos($font,<span class="charliteral">&#39;/&#39;</span>);
<a name="l01312"></a>01312   <span class="keywordflow">if</span> ($pos===<span class="keyword">false</span>){
<a name="l01313"></a>01313     <a class="code" href="add__cvs_8php.html#a1659f0a629d408e0f849dbe4ee061e62">$dir</a> = <span class="stringliteral">&#39;./&#39;</span>;
<a name="l01314"></a>01314     $name = $font;
<a name="l01315"></a>01315   } <span class="keywordflow">else</span> {
<a name="l01316"></a>01316     <a class="code" href="add__cvs_8php.html#a1659f0a629d408e0f849dbe4ee061e62">$dir</a>=substr($font,0,$pos+1);
<a name="l01317"></a>01317     $name=substr($font,$pos+1);
<a name="l01318"></a>01318   }
<a name="l01319"></a>01319 
<a name="l01320"></a>01320   <span class="keywordflow">if</span> (substr($name,-4)==<span class="stringliteral">&#39;.afm&#39;</span>){
<a name="l01321"></a>01321     $name=substr($name,0,strlen($name)-4);
<a name="l01322"></a>01322   }
<a name="l01323"></a>01323   $this-&gt;<a class="code" href="class_cpdf.html#a0fe60161c19f81f49f76a2dcb95d48e4">addMessage</a>(<span class="stringliteral">&#39;openFont: &#39;</span>.$font.<span class="stringliteral">&#39; - &#39;</span>.$name);
<a name="l01324"></a>01324   <span class="keywordflow">if</span> (file_exists(<a class="code" href="add__cvs_8php.html#a1659f0a629d408e0f849dbe4ee061e62">$dir</a>.<span class="stringliteral">&#39;php_&#39;</span>.$name.<span class="stringliteral">&#39;.afm&#39;</span>)){
<a name="l01325"></a>01325     $this-&gt;<a class="code" href="class_cpdf.html#a0fe60161c19f81f49f76a2dcb95d48e4">addMessage</a>(<span class="stringliteral">&#39;openFont: php file exists &#39;</span>.<a class="code" href="add__cvs_8php.html#a1659f0a629d408e0f849dbe4ee061e62">$dir</a>.<span class="stringliteral">&#39;php_&#39;</span>.$name.<span class="stringliteral">&#39;.afm&#39;</span>);
<a name="l01326"></a>01326     $tmp = file(<a class="code" href="add__cvs_8php.html#a1659f0a629d408e0f849dbe4ee061e62">$dir</a>.<span class="stringliteral">&#39;php_&#39;</span>.$name.<span class="stringliteral">&#39;.afm&#39;</span>);
<a name="l01327"></a>01327     $this-&gt;fonts[$font]=unserialize($tmp[0]);
<a name="l01328"></a>01328     <span class="keywordflow">if</span> (!isset($this-&gt;fonts[$font][<span class="stringliteral">&#39;_version_&#39;</span>]) || $this-&gt;fonts[$font][<span class="stringliteral">&#39;_version_&#39;</span>]&lt;1){
<a name="l01329"></a>01329       <span class="comment">// if the font file is old, then clear it out and prepare for re-creation</span>
<a name="l01330"></a>01330       $this-&gt;<a class="code" href="class_cpdf.html#a0fe60161c19f81f49f76a2dcb95d48e4">addMessage</a>(<span class="stringliteral">&#39;openFont: clear out, make way for new version.&#39;</span>);
<a name="l01331"></a>01331       unset($this-&gt;fonts[$font]);
<a name="l01332"></a>01332     }
<a name="l01333"></a>01333   }
<a name="l01334"></a>01334   <span class="keywordflow">if</span> (!isset($this-&gt;fonts[$font]) &amp;&amp; file_exists(<a class="code" href="add__cvs_8php.html#a1659f0a629d408e0f849dbe4ee061e62">$dir</a>.$name.<span class="stringliteral">&#39;.afm&#39;</span>)){
<a name="l01335"></a>01335     <span class="comment">// then rebuild the php_&lt;font&gt;.afm file from the &lt;font&gt;.afm file</span>
<a name="l01336"></a>01336     $this-&gt;<a class="code" href="class_cpdf.html#a0fe60161c19f81f49f76a2dcb95d48e4">addMessage</a>(<span class="stringliteral">&#39;openFont: build php file from &#39;</span>.<a class="code" href="add__cvs_8php.html#a1659f0a629d408e0f849dbe4ee061e62">$dir</a>.$name.<span class="stringliteral">&#39;.afm&#39;</span>);
<a name="l01337"></a>01337     <a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a> = array();
<a name="l01338"></a>01338     <a class="code" href="tokenizer__test_8php.html#aa1bfbd27060176201b271918dff57e8f">$file</a> = file(<a class="code" href="add__cvs_8php.html#a1659f0a629d408e0f849dbe4ee061e62">$dir</a>.$name.<span class="stringliteral">&#39;.afm&#39;</span>);
<a name="l01339"></a>01339     <span class="keywordflow">foreach</span> (<a class="code" href="tokenizer__test_8php.html#aa1bfbd27060176201b271918dff57e8f">$file</a> as $rowA){
<a name="l01340"></a>01340       <a class="code" href="administration_2lists_2data__create_8ejs_8php.html#a76772cd03c99434f33a506cf72f49b4f">$row</a>=trim($rowA);
<a name="l01341"></a>01341       $pos=strpos(<a class="code" href="administration_2lists_2data__create_8ejs_8php.html#a76772cd03c99434f33a506cf72f49b4f">$row</a>,<span class="charliteral">&#39; &#39;</span>);
<a name="l01342"></a>01342       <span class="keywordflow">if</span> ($pos){
<a name="l01343"></a>01343         <span class="comment">// then there must be some keyword</span>
<a name="l01344"></a>01344         $key = substr(<a class="code" href="administration_2lists_2data__create_8ejs_8php.html#a76772cd03c99434f33a506cf72f49b4f">$row</a>,0,$pos);
<a name="l01345"></a>01345         <span class="keywordflow">switch</span> ($key){
<a name="l01346"></a>01346           <span class="keywordflow">case</span> <span class="stringliteral">&#39;FontName&#39;</span>:
<a name="l01347"></a>01347           <span class="keywordflow">case</span> <span class="stringliteral">&#39;FullName&#39;</span>:
<a name="l01348"></a>01348           <span class="keywordflow">case</span> <span class="stringliteral">&#39;FamilyName&#39;</span>:
<a name="l01349"></a>01349           <span class="keywordflow">case</span> <span class="stringliteral">&#39;Weight&#39;</span>:
<a name="l01350"></a>01350           <span class="keywordflow">case</span> <span class="stringliteral">&#39;ItalicAngle&#39;</span>:
<a name="l01351"></a>01351           <span class="keywordflow">case</span> <span class="stringliteral">&#39;IsFixedPitch&#39;</span>:
<a name="l01352"></a>01352           <span class="keywordflow">case</span> <span class="stringliteral">&#39;CharacterSet&#39;</span>:
<a name="l01353"></a>01353           <span class="keywordflow">case</span> <span class="stringliteral">&#39;UnderlinePosition&#39;</span>:
<a name="l01354"></a>01354           <span class="keywordflow">case</span> <span class="stringliteral">&#39;UnderlineThickness&#39;</span>:
<a name="l01355"></a>01355           <span class="keywordflow">case</span> <span class="stringliteral">&#39;Version&#39;</span>:
<a name="l01356"></a>01356           <span class="keywordflow">case</span> <span class="stringliteral">&#39;EncodingScheme&#39;</span>:
<a name="l01357"></a>01357           <span class="keywordflow">case</span> <span class="stringliteral">&#39;CapHeight&#39;</span>:
<a name="l01358"></a>01358           <span class="keywordflow">case</span> <span class="stringliteral">&#39;XHeight&#39;</span>:
<a name="l01359"></a>01359           <span class="keywordflow">case</span> <span class="stringliteral">&#39;Ascender&#39;</span>:
<a name="l01360"></a>01360           <span class="keywordflow">case</span> <span class="stringliteral">&#39;Descender&#39;</span>:
<a name="l01361"></a>01361           <span class="keywordflow">case</span> <span class="stringliteral">&#39;StdHW&#39;</span>:
<a name="l01362"></a>01362           <span class="keywordflow">case</span> <span class="stringliteral">&#39;StdVW&#39;</span>:
<a name="l01363"></a>01363           <span class="keywordflow">case</span> <span class="stringliteral">&#39;StartCharMetrics&#39;</span>:
<a name="l01364"></a>01364             <a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>[$key]=trim(substr(<a class="code" href="administration_2lists_2data__create_8ejs_8php.html#a76772cd03c99434f33a506cf72f49b4f">$row</a>,$pos));
<a name="l01365"></a>01365             <span class="keywordflow">break</span>;
<a name="l01366"></a>01366           <span class="keywordflow">case</span> <span class="stringliteral">&#39;FontBBox&#39;</span>:
<a name="l01367"></a>01367             <a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>[$key]=explode(<span class="charliteral">&#39; &#39;</span>,trim(substr(<a class="code" href="administration_2lists_2data__create_8ejs_8php.html#a76772cd03c99434f33a506cf72f49b4f">$row</a>,$pos)));
<a name="l01368"></a>01368             <span class="keywordflow">break</span>;
<a name="l01369"></a>01369           <span class="keywordflow">case</span> <span class="charliteral">&#39;C&#39;</span>:
<a name="l01370"></a>01370             <span class="comment">//C 39 ; WX 222 ; N quoteright ; B 53 463 157 718 ;</span>
<a name="l01371"></a>01371             $bits=explode(<span class="charliteral">&#39;;&#39;</span>,trim(<a class="code" href="administration_2lists_2data__create_8ejs_8php.html#a76772cd03c99434f33a506cf72f49b4f">$row</a>));
<a name="l01372"></a>01372             $dtmp=array();
<a name="l01373"></a>01373             <span class="keywordflow">foreach</span>($bits as $bit){
<a name="l01374"></a>01374               $bits2 = explode(<span class="charliteral">&#39; &#39;</span>,trim($bit));
<a name="l01375"></a>01375               <span class="keywordflow">if</span> (strlen($bits2[0])){
<a name="l01376"></a>01376                 <span class="keywordflow">if</span> (count($bits2)&gt;2){
<a name="l01377"></a>01377                   $dtmp[$bits2[0]]=array();
<a name="l01378"></a>01378                   <span class="keywordflow">for</span> ($i=1;$i&lt;count($bits2);$i++){
<a name="l01379"></a>01379                     $dtmp[$bits2[0]][]=$bits2[$i];
<a name="l01380"></a>01380                   }
<a name="l01381"></a>01381                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (count($bits2)==2){
<a name="l01382"></a>01382                   $dtmp[$bits2[0]]=$bits2[1];
<a name="l01383"></a>01383                 }
<a name="l01384"></a>01384               }
<a name="l01385"></a>01385             }
<a name="l01386"></a>01386             <span class="keywordflow">if</span> ($dtmp[<span class="charliteral">&#39;C&#39;</span>]&gt;=0){
<a name="l01387"></a>01387               <a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>[<span class="charliteral">&#39;C&#39;</span>][$dtmp[<span class="charliteral">&#39;C&#39;</span>]]=$dtmp;
<a name="l01388"></a>01388               <a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>[<span class="charliteral">&#39;C&#39;</span>][$dtmp[<span class="charliteral">&#39;N&#39;</span>]]=$dtmp;
<a name="l01389"></a>01389             } <span class="keywordflow">else</span> {
<a name="l01390"></a>01390               <a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>[<span class="charliteral">&#39;C&#39;</span>][$dtmp[<span class="charliteral">&#39;N&#39;</span>]]=$dtmp;
<a name="l01391"></a>01391             }
<a name="l01392"></a>01392             <span class="keywordflow">break</span>;
<a name="l01393"></a>01393           <span class="keywordflow">case</span> <span class="stringliteral">&#39;KPX&#39;</span>:
<a name="l01394"></a>01394             <span class="comment">//KPX Adieresis yacute -40</span>
<a name="l01395"></a>01395             $bits=explode(<span class="charliteral">&#39; &#39;</span>,trim(<a class="code" href="administration_2lists_2data__create_8ejs_8php.html#a76772cd03c99434f33a506cf72f49b4f">$row</a>));
<a name="l01396"></a>01396             <a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>[<span class="stringliteral">&#39;KPX&#39;</span>][$bits[1]][$bits[2]]=$bits[3];
<a name="l01397"></a>01397             <span class="keywordflow">break</span>;
<a name="l01398"></a>01398         }
<a name="l01399"></a>01399       }
<a name="l01400"></a>01400     }
<a name="l01401"></a>01401     <a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>[<span class="stringliteral">&#39;_version_&#39;</span>]=1;
<a name="l01402"></a>01402     $this-&gt;fonts[$font]=<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>;
<a name="l01403"></a>01403     $fp = fopen(<a class="code" href="add__cvs_8php.html#a1659f0a629d408e0f849dbe4ee061e62">$dir</a>.<span class="stringliteral">&#39;php_&#39;</span>.$name.<span class="stringliteral">&#39;.afm&#39;</span>,<span class="charliteral">&#39;w&#39;</span>);
<a name="l01404"></a>01404     fwrite($fp,serialize(<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>));
<a name="l01405"></a>01405     fclose($fp);
<a name="l01406"></a>01406   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!isset($this-&gt;fonts[$font])){
<a name="l01407"></a>01407     $this-&gt;<a class="code" href="class_cpdf.html#a0fe60161c19f81f49f76a2dcb95d48e4">addMessage</a>(<span class="stringliteral">&#39;openFont: no font file found&#39;</span>);
<a name="l01408"></a>01408 <span class="comment">//    echo &#39;Font not Found &#39;.$font;</span>
<a name="l01409"></a>01409   }
<a name="l01410"></a>01410 }
<a name="l01411"></a>01411 
<a name="l01420"></a><a class="code" href="class_cpdf.html#a51b2f9f1095c23b3b75a8f7bf4a04533">01420</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a51b2f9f1095c23b3b75a8f7bf4a04533">selectFont</a>($fontName,$encoding=<span class="stringliteral">&#39;&#39;</span>,$set=1){
<a name="l01421"></a>01421   <span class="keywordflow">if</span> (!isset($this-&gt;fonts[$fontName])){
<a name="l01422"></a>01422     <span class="comment">// load the file</span>
<a name="l01423"></a>01423     $this-&gt;<a class="code" href="class_cpdf.html#ac9e094a24b03891a8b8e1ef468b535b7">openFont</a>($fontName);
<a name="l01424"></a>01424     <span class="keywordflow">if</span> (isset($this-&gt;fonts[$fontName])){
<a name="l01425"></a>01425       $this-&gt;numObj++;
<a name="l01426"></a>01426       $this-&gt;numFonts++;
<a name="l01427"></a>01427       $pos=strrpos($fontName,<span class="charliteral">&#39;/&#39;</span>);
<a name="l01428"></a>01428 <span class="comment">//      $dir=substr($fontName,0,$pos+1);</span>
<a name="l01429"></a>01429       $name=substr($fontName,$pos+1);
<a name="l01430"></a>01430       <span class="keywordflow">if</span> (substr($name,-4)==<span class="stringliteral">&#39;.afm&#39;</span>){
<a name="l01431"></a>01431         $name=substr($name,0,strlen($name)-4);
<a name="l01432"></a>01432       }
<a name="l01433"></a>01433       <a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>=array(<span class="stringliteral">&#39;name&#39;</span>=&gt;$name);
<a name="l01434"></a>01434       <span class="keywordflow">if</span> (is_array($encoding)){
<a name="l01435"></a>01435         <span class="comment">// then encoding and differences might be set</span>
<a name="l01436"></a>01436         <span class="keywordflow">if</span> (isset($encoding[<span class="stringliteral">&#39;encoding&#39;</span>])){
<a name="l01437"></a>01437           <a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;encoding&#39;</span>]=$encoding[<span class="stringliteral">&#39;encoding&#39;</span>];
<a name="l01438"></a>01438         }
<a name="l01439"></a>01439         <span class="keywordflow">if</span> (isset($encoding[<span class="stringliteral">&#39;differences&#39;</span>])){
<a name="l01440"></a>01440           <a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;differences&#39;</span>]=$encoding[<span class="stringliteral">&#39;differences&#39;</span>];
<a name="l01441"></a>01441         }
<a name="l01442"></a>01442       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strlen($encoding)){
<a name="l01443"></a>01443         <span class="comment">// then perhaps only the encoding has been set</span>
<a name="l01444"></a>01444         <a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;encoding&#39;</span>]=$encoding;
<a name="l01445"></a>01445       }
<a name="l01446"></a>01446       $fontObj = $this-&gt;numObj;
<a name="l01447"></a>01447       $this-&gt;<a class="code" href="class_cpdf.html#a607aaa24e2d8b46f8c387d0d5144cd9a">o_font</a>($this-&gt;numObj,<span class="stringliteral">&#39;new&#39;</span>,<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>);
<a name="l01448"></a>01448       $this-&gt;fonts[$fontName][<span class="stringliteral">&#39;fontNum&#39;</span>]=$this-&gt;numFonts;
<a name="l01449"></a>01449       <span class="comment">// if this is a &#39;.afm&#39; font, and there is a &#39;.pfa&#39; file to go with it ( as there</span>
<a name="l01450"></a>01450       <span class="comment">// should be for all non-basic fonts), then load it into an object and put the</span>
<a name="l01451"></a>01451       <span class="comment">// references into the font object</span>
<a name="l01452"></a>01452       $basefile = substr($fontName,0,strlen($fontName)-4);
<a name="l01453"></a>01453       <span class="keywordflow">if</span> (file_exists($basefile.<span class="stringliteral">&#39;.pfb&#39;</span>)){
<a name="l01454"></a>01454         $fbtype = <span class="stringliteral">&#39;pfb&#39;</span>;
<a name="l01455"></a>01455       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (file_exists($basefile.<span class="stringliteral">&#39;.ttf&#39;</span>)){
<a name="l01456"></a>01456         $fbtype = <span class="stringliteral">&#39;ttf&#39;</span>;
<a name="l01457"></a>01457       } <span class="keywordflow">else</span> {
<a name="l01458"></a>01458         $fbtype=<span class="stringliteral">&#39;&#39;</span>;
<a name="l01459"></a>01459       }
<a name="l01460"></a>01460       $fbfile = $basefile.<span class="charliteral">&#39;.&#39;</span>.$fbtype;
<a name="l01461"></a>01461       
<a name="l01462"></a>01462 <span class="comment">//      $pfbfile = substr($fontName,0,strlen($fontName)-4).&#39;.pfb&#39;;</span>
<a name="l01463"></a>01463 <span class="comment">//      $ttffile = substr($fontName,0,strlen($fontName)-4).&#39;.ttf&#39;;</span>
<a name="l01464"></a>01464       $this-&gt;<a class="code" href="class_cpdf.html#a0fe60161c19f81f49f76a2dcb95d48e4">addMessage</a>(<span class="stringliteral">&#39;selectFont: checking for - &#39;</span>.$fbfile);
<a name="l01465"></a>01465       <span class="keywordflow">if</span> (substr($fontName,-4)==<span class="stringliteral">&#39;.afm&#39;</span> &amp;&amp; strlen($fbtype) ){
<a name="l01466"></a>01466         $adobeFontName = $this-&gt;fonts[$fontName][<span class="stringliteral">&#39;FontName&#39;</span>];
<a name="l01467"></a>01467 <span class="comment">//        $fontObj = $this-&gt;numObj;</span>
<a name="l01468"></a>01468         $this-&gt;<a class="code" href="class_cpdf.html#a0fe60161c19f81f49f76a2dcb95d48e4">addMessage</a>(<span class="stringliteral">&#39;selectFont: adding font file - &#39;</span>.$fbfile.<span class="stringliteral">&#39; - &#39;</span>.$adobeFontName);
<a name="l01469"></a>01469         <span class="comment">// find the array of fond widths, and put that into an object.</span>
<a name="l01470"></a>01470         $firstChar = -1;
<a name="l01471"></a>01471         $lastChar = 0;
<a name="l01472"></a>01472         $widths = array();
<a name="l01473"></a>01473         <span class="keywordflow">foreach</span> ($this-&gt;fonts[$fontName][<span class="charliteral">&#39;C&#39;</span>] as $num=&gt;<a class="code" href="validator__unit__test_8php.html#a0cf5dd496d9f5ff1edf00d234771dcfe">$d</a>){
<a name="l01474"></a>01474           <span class="keywordflow">if</span> (intval($num)&gt;0 || $num==<span class="charliteral">&#39;0&#39;</span>){
<a name="l01475"></a>01475             <span class="keywordflow">if</span> ($lastChar&gt;0 &amp;&amp; $num&gt;$lastChar+1){
<a name="l01476"></a>01476               <span class="keywordflow">for</span>($i=$lastChar+1;$i&lt;$num;$i++){
<a name="l01477"></a>01477                 $widths[] = 0;
<a name="l01478"></a>01478               }
<a name="l01479"></a>01479             }
<a name="l01480"></a>01480             $widths[] = <a class="code" href="validator__unit__test_8php.html#a0cf5dd496d9f5ff1edf00d234771dcfe">$d</a>[<span class="stringliteral">&#39;WX&#39;</span>];
<a name="l01481"></a>01481             <span class="keywordflow">if</span> ($firstChar==-1){
<a name="l01482"></a>01482               $firstChar = $num;
<a name="l01483"></a>01483             }
<a name="l01484"></a>01484             $lastChar = $num;
<a name="l01485"></a>01485           }
<a name="l01486"></a>01486         }
<a name="l01487"></a>01487         <span class="comment">// also need to adjust the widths for the differences array</span>
<a name="l01488"></a>01488         <span class="keywordflow">if</span> (isset(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;differences&#39;</span>])){
<a name="l01489"></a>01489           <span class="keywordflow">foreach</span>(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;differences&#39;</span>] as $charNum=&gt;$charName){
<a name="l01490"></a>01490             <span class="keywordflow">if</span> ($charNum&gt;$lastChar){
<a name="l01491"></a>01491               <span class="keywordflow">for</span>($i=$lastChar+1;$i&lt;=$charNum;$i++){
<a name="l01492"></a>01492                 $widths[]=0;
<a name="l01493"></a>01493               }
<a name="l01494"></a>01494               $lastChar=$charNum;
<a name="l01495"></a>01495             }
<a name="l01496"></a>01496             <span class="keywordflow">if</span> (isset($this-&gt;fonts[$fontName][<span class="charliteral">&#39;C&#39;</span>][$charName])){
<a name="l01497"></a>01497               $widths[$charNum-$firstChar]=$this-&gt;fonts[$fontName][<span class="charliteral">&#39;C&#39;</span>][$charName][<span class="stringliteral">&#39;WX&#39;</span>];
<a name="l01498"></a>01498             }
<a name="l01499"></a>01499           }
<a name="l01500"></a>01500         }
<a name="l01501"></a>01501         $this-&gt;<a class="code" href="class_cpdf.html#a0fe60161c19f81f49f76a2dcb95d48e4">addMessage</a>(<span class="stringliteral">&#39;selectFont: FirstChar=&#39;</span>.$firstChar);
<a name="l01502"></a>01502         $this-&gt;<a class="code" href="class_cpdf.html#a0fe60161c19f81f49f76a2dcb95d48e4">addMessage</a>(<span class="stringliteral">&#39;selectFont: LastChar=&#39;</span>.$lastChar);
<a name="l01503"></a>01503         $this-&gt;numObj++;
<a name="l01504"></a>01504         $this-&gt;<a class="code" href="class_cpdf.html#ac8729d6b851615394c82bda391f37adb">o_contents</a>($this-&gt;numObj,<span class="stringliteral">&#39;new&#39;</span>,<span class="stringliteral">&#39;raw&#39;</span>);
<a name="l01505"></a>01505         $this-&gt;objects[$this-&gt;numObj][<span class="charliteral">&#39;c&#39;</span>].=<span class="charliteral">&#39;[&#39;</span>;
<a name="l01506"></a>01506         <span class="keywordflow">foreach</span>($widths as $width){
<a name="l01507"></a>01507           $this-&gt;objects[$this-&gt;numObj][<span class="charliteral">&#39;c&#39;</span>].=<span class="charliteral">&#39; &#39;</span>.$width;
<a name="l01508"></a>01508         }
<a name="l01509"></a>01509         $this-&gt;objects[$this-&gt;numObj][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&#39; ]&#39;</span>;
<a name="l01510"></a>01510         $widthid = $this-&gt;numObj;
<a name="l01511"></a>01511 
<a name="l01512"></a>01512         <span class="comment">// load the pfb file, and put that into an object too.</span>
<a name="l01513"></a>01513         <span class="comment">// note that pdf supports only binary format type 1 font files, though there is a </span>
<a name="l01514"></a>01514         <span class="comment">// simple utility to convert them from pfa to pfb.</span>
<a name="l01515"></a>01515         $fp = fopen($fbfile,<span class="stringliteral">&#39;rb&#39;</span>);
<a name="l01516"></a>01516         $tmp = get_magic_quotes_runtime();
<a name="l01517"></a>01517         set_magic_quotes_runtime(0);
<a name="l01518"></a>01518         <a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a> = fread($fp,filesize($fbfile));
<a name="l01519"></a>01519         set_magic_quotes_runtime($tmp);
<a name="l01520"></a>01520         fclose($fp);
<a name="l01521"></a>01521 
<a name="l01522"></a>01522         <span class="comment">// create the font descriptor</span>
<a name="l01523"></a>01523         $this-&gt;numObj++;
<a name="l01524"></a>01524         $fontDescriptorId = $this-&gt;numObj;
<a name="l01525"></a>01525         $this-&gt;numObj++;
<a name="l01526"></a>01526         $pfbid = $this-&gt;numObj;
<a name="l01527"></a>01527         <span class="comment">// determine flags (more than a little flakey, hopefully will not matter much)</span>
<a name="l01528"></a>01528         $flags=0;
<a name="l01529"></a>01529         <span class="keywordflow">if</span> ($this-&gt;fonts[$fontName][<span class="stringliteral">&#39;ItalicAngle&#39;</span>]!=0){ $flags+=pow(2,6); }
<a name="l01530"></a>01530         <span class="keywordflow">if</span> ($this-&gt;fonts[$fontName][<span class="stringliteral">&#39;IsFixedPitch&#39;</span>]==<span class="stringliteral">&#39;true&#39;</span>){ $flags+=1; }
<a name="l01531"></a>01531         $flags+=pow(2,5); <span class="comment">// assume non-sybolic</span>
<a name="l01532"></a>01532 
<a name="l01533"></a>01533         $list = array(<span class="stringliteral">&#39;Ascent&#39;</span>=&gt;<span class="stringliteral">&#39;Ascender&#39;</span>,<span class="stringliteral">&#39;CapHeight&#39;</span>=&gt;<span class="stringliteral">&#39;CapHeight&#39;</span>,<span class="stringliteral">&#39;Descent&#39;</span>=&gt;<span class="stringliteral">&#39;Descender&#39;</span>,<span class="stringliteral">&#39;FontBBox&#39;</span>=&gt;<span class="stringliteral">&#39;FontBBox&#39;</span>,<span class="stringliteral">&#39;ItalicAngle&#39;</span>=&gt;<span class="stringliteral">&#39;ItalicAngle&#39;</span>);
<a name="l01534"></a>01534         $fdopt = array(
<a name="l01535"></a>01535          <span class="stringliteral">&#39;Flags&#39;</span>=&gt;$flags
<a name="l01536"></a>01536          ,<span class="stringliteral">&#39;FontName&#39;</span>=&gt;$adobeFontName
<a name="l01537"></a>01537          ,<span class="stringliteral">&#39;StemV&#39;</span>=&gt;100  <span class="comment">// don&#39;t know what the value for this should be!</span>
<a name="l01538"></a>01538         );
<a name="l01539"></a>01539         <span class="keywordflow">foreach</span>($list as $k=&gt;$v){
<a name="l01540"></a>01540           <span class="keywordflow">if</span> (isset($this-&gt;fonts[$fontName][$v])){
<a name="l01541"></a>01541             $fdopt[$k]=$this-&gt;fonts[$fontName][$v];
<a name="l01542"></a>01542           }
<a name="l01543"></a>01543         }
<a name="l01544"></a>01544 
<a name="l01545"></a>01545         <span class="keywordflow">if</span> ($fbtype==<span class="stringliteral">&#39;pfb&#39;</span>){
<a name="l01546"></a>01546           $fdopt[<span class="stringliteral">&#39;FontFile&#39;</span>]=$pfbid;
<a name="l01547"></a>01547         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($fbtype==<span class="stringliteral">&#39;ttf&#39;</span>){
<a name="l01548"></a>01548           $fdopt[<span class="stringliteral">&#39;FontFile2&#39;</span>]=$pfbid;
<a name="l01549"></a>01549         }
<a name="l01550"></a>01550         $this-&gt;<a class="code" href="class_cpdf.html#ab2907958d0d7da9764c61510b32a3e76">o_fontDescriptor</a>($fontDescriptorId,<span class="stringliteral">&#39;new&#39;</span>,$fdopt);        
<a name="l01551"></a>01551 
<a name="l01552"></a>01552         <span class="comment">// embed the font program</span>
<a name="l01553"></a>01553         $this-&gt;<a class="code" href="class_cpdf.html#ac8729d6b851615394c82bda391f37adb">o_contents</a>($this-&gt;numObj,<span class="stringliteral">&#39;new&#39;</span>);
<a name="l01554"></a>01554         $this-&gt;objects[$pfbid][<span class="charliteral">&#39;c&#39;</span>].=<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>;
<a name="l01555"></a>01555         <span class="comment">// determine the cruicial lengths within this file</span>
<a name="l01556"></a>01556         <span class="keywordflow">if</span> ($fbtype==<span class="stringliteral">&#39;pfb&#39;</span>){
<a name="l01557"></a>01557           $l1 = strpos(<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>,<span class="stringliteral">&#39;eexec&#39;</span>)+6;
<a name="l01558"></a>01558           $l2 = strpos(<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>,<span class="stringliteral">&#39;00000000&#39;</span>)-$l1;
<a name="l01559"></a>01559           $l3 = strlen(<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>)-$l2-$l1;
<a name="l01560"></a>01560           $this-&gt;<a class="code" href="class_cpdf.html#ac8729d6b851615394c82bda391f37adb">o_contents</a>($this-&gt;numObj,<span class="stringliteral">&#39;add&#39;</span>,array(<span class="stringliteral">&#39;Length1&#39;</span>=&gt;$l1,<span class="stringliteral">&#39;Length2&#39;</span>=&gt;$l2,<span class="stringliteral">&#39;Length3&#39;</span>=&gt;$l3));
<a name="l01561"></a>01561         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($fbtype==<span class="stringliteral">&#39;ttf&#39;</span>){
<a name="l01562"></a>01562           $l1 = strlen(<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>);
<a name="l01563"></a>01563           $this-&gt;<a class="code" href="class_cpdf.html#ac8729d6b851615394c82bda391f37adb">o_contents</a>($this-&gt;numObj,<span class="stringliteral">&#39;add&#39;</span>,array(<span class="stringliteral">&#39;Length1&#39;</span>=&gt;$l1));
<a name="l01564"></a>01564         }
<a name="l01565"></a>01565 
<a name="l01566"></a>01566 
<a name="l01567"></a>01567         <span class="comment">// tell the font object about all this new stuff</span>
<a name="l01568"></a>01568         $tmp = array(<span class="stringliteral">&#39;BaseFont&#39;</span>=&gt;$adobeFontName,<span class="stringliteral">&#39;Widths&#39;</span>=&gt;$widthid
<a name="l01569"></a>01569                                       ,<span class="stringliteral">&#39;FirstChar&#39;</span>=&gt;$firstChar,<span class="stringliteral">&#39;LastChar&#39;</span>=&gt;$lastChar
<a name="l01570"></a>01570                                       ,<span class="stringliteral">&#39;FontDescriptor&#39;</span>=&gt;$fontDescriptorId);
<a name="l01571"></a>01571         <span class="keywordflow">if</span> ($fbtype==<span class="stringliteral">&#39;ttf&#39;</span>){
<a name="l01572"></a>01572           $tmp[<span class="stringliteral">&#39;SubType&#39;</span>]=<span class="stringliteral">&#39;TrueType&#39;</span>;
<a name="l01573"></a>01573         }
<a name="l01574"></a>01574         $this-&gt;<a class="code" href="class_cpdf.html#a0fe60161c19f81f49f76a2dcb95d48e4">addMessage</a>(<span class="stringliteral">&#39;adding extra info to font.(&#39;</span>.$fontObj.<span class="charliteral">&#39;)&#39;</span>);
<a name="l01575"></a>01575         <span class="keywordflow">foreach</span>($tmp as $fk=&gt;$fv){
<a name="l01576"></a>01576           $this-&gt;<a class="code" href="class_cpdf.html#a0fe60161c19f81f49f76a2dcb95d48e4">addMessage</a>($fk.<span class="stringliteral">&quot; : &quot;</span>.$fv);
<a name="l01577"></a>01577         }
<a name="l01578"></a>01578         $this-&gt;<a class="code" href="class_cpdf.html#a607aaa24e2d8b46f8c387d0d5144cd9a">o_font</a>($fontObj,<span class="stringliteral">&#39;add&#39;</span>,$tmp);
<a name="l01579"></a>01579 
<a name="l01580"></a>01580       } <span class="keywordflow">else</span> {
<a name="l01581"></a>01581         $this-&gt;<a class="code" href="class_cpdf.html#a0fe60161c19f81f49f76a2dcb95d48e4">addMessage</a>(<span class="stringliteral">&#39;selectFont: pfb or ttf file not found, ok if this is one of the 14 standard fonts&#39;</span>);
<a name="l01582"></a>01582       }
<a name="l01583"></a>01583 
<a name="l01584"></a>01584 
<a name="l01585"></a>01585       <span class="comment">// also set the differences here, note that this means that these will take effect only the </span>
<a name="l01586"></a>01586       <span class="comment">//first time that a font is selected, else they are ignored</span>
<a name="l01587"></a>01587       <span class="keywordflow">if</span> (isset(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;differences&#39;</span>])){
<a name="l01588"></a>01588         $this-&gt;fonts[$fontName][<span class="stringliteral">&#39;differences&#39;</span>]=<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;differences&#39;</span>];
<a name="l01589"></a>01589       }
<a name="l01590"></a>01590     }
<a name="l01591"></a>01591   }
<a name="l01592"></a>01592   <span class="keywordflow">if</span> ($set &amp;&amp; isset($this-&gt;fonts[$fontName])){
<a name="l01593"></a>01593     <span class="comment">// so if for some reason the font was not set in the last one then it will not be selected</span>
<a name="l01594"></a>01594     $this-&gt;currentBaseFont=$fontName;
<a name="l01595"></a>01595     <span class="comment">// the next line means that if a new font is selected, then the current text state will be</span>
<a name="l01596"></a>01596     <span class="comment">// applied to it as well.</span>
<a name="l01597"></a>01597     $this-&gt;<a class="code" href="class_cpdf.html#a7c32053581b4a1c223a8c924bdd888d6">setCurrentFont</a>();
<a name="l01598"></a>01598   }
<a name="l01599"></a>01599   <span class="keywordflow">return</span> $this-&gt;currentFontNum;
<a name="l01600"></a>01600 }
<a name="l01601"></a>01601 
<a name="l01614"></a><a class="code" href="class_cpdf.html#a7c32053581b4a1c223a8c924bdd888d6">01614</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a7c32053581b4a1c223a8c924bdd888d6">setCurrentFont</a>(){
<a name="l01615"></a>01615   <span class="keywordflow">if</span> (strlen($this-&gt;currentBaseFont)==0){
<a name="l01616"></a>01616     <span class="comment">// then assume an initial font</span>
<a name="l01617"></a>01617     $this-&gt;<a class="code" href="class_cpdf.html#a51b2f9f1095c23b3b75a8f7bf4a04533">selectFont</a>(<span class="stringliteral">&#39;./fonts/Helvetica.afm&#39;</span>);
<a name="l01618"></a>01618   }
<a name="l01619"></a>01619   $cf = substr($this-&gt;currentBaseFont,strrpos($this-&gt;currentBaseFont,<span class="charliteral">&#39;/&#39;</span>)+1);
<a name="l01620"></a>01620   <span class="keywordflow">if</span> (strlen($this-&gt;currentTextState)
<a name="l01621"></a>01621     &amp;&amp; isset($this-&gt;fontFamilies[$cf]) 
<a name="l01622"></a>01622       &amp;&amp; isset($this-&gt;fontFamilies[$cf][$this-&gt;currentTextState])){
<a name="l01623"></a>01623     <span class="comment">// then we are in some state or another</span>
<a name="l01624"></a>01624     <span class="comment">// and this font has a family, and the current setting exists within it</span>
<a name="l01625"></a>01625     <span class="comment">// select the font, then return it</span>
<a name="l01626"></a>01626     $nf = substr($this-&gt;currentBaseFont,0,strrpos($this-&gt;currentBaseFont,<span class="charliteral">&#39;/&#39;</span>)+1).$this-&gt;fontFamilies[$cf][$this-&gt;currentTextState];
<a name="l01627"></a>01627     $this-&gt;<a class="code" href="class_cpdf.html#a51b2f9f1095c23b3b75a8f7bf4a04533">selectFont</a>($nf,<span class="stringliteral">&#39;&#39;</span>,0);
<a name="l01628"></a>01628     $this-&gt;currentFont = $nf;
<a name="l01629"></a>01629     $this-&gt;currentFontNum = $this-&gt;fonts[$nf][<span class="stringliteral">&#39;fontNum&#39;</span>];
<a name="l01630"></a>01630   } <span class="keywordflow">else</span> {
<a name="l01631"></a>01631     <span class="comment">// the this font must not have the right family member for the current state</span>
<a name="l01632"></a>01632     <span class="comment">// simply assume the base font</span>
<a name="l01633"></a>01633     $this-&gt;currentFont = $this-&gt;currentBaseFont;
<a name="l01634"></a>01634     $this-&gt;currentFontNum = $this-&gt;fonts[$this-&gt;currentFont][<span class="stringliteral">&#39;fontNum&#39;</span>];    
<a name="l01635"></a>01635   }
<a name="l01636"></a>01636 }
<a name="l01637"></a>01637 
<a name="l01642"></a><a class="code" href="class_cpdf.html#aacf9523fe9f5c860731020f7a49778a1">01642</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#aacf9523fe9f5c860731020f7a49778a1">getFirstPageId</a>(){
<a name="l01643"></a>01643   <span class="keywordflow">return</span> $this-&gt;firstPageId;
<a name="l01644"></a>01644 }
<a name="l01645"></a>01645 
<a name="l01651"></a><a class="code" href="class_cpdf.html#a0063e9338d80979be51981786380eef4">01651</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a0063e9338d80979be51981786380eef4">addContent</a>($content){
<a name="l01652"></a>01652   $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=$content;
<a name="l01653"></a>01653 }
<a name="l01654"></a>01654 
<a name="l01658"></a><a class="code" href="class_cpdf.html#ad6873769b1aeb31e7acbc3be3de671a5">01658</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#ad6873769b1aeb31e7acbc3be3de671a5">setColor</a>($r,$g,$b,$force=0){
<a name="l01659"></a>01659   <span class="keywordflow">if</span> ($r&gt;=0 &amp;&amp; ($force || $r!=$this-&gt;currentColour[<span class="charliteral">&#39;r&#39;</span>] || $g!=$this-&gt;currentColour[<span class="charliteral">&#39;g&#39;</span>] || $b!=$this-&gt;currentColour[<span class="charliteral">&#39;b&#39;</span>])){
<a name="l01660"></a>01660     $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&quot;\n&quot;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$r).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$g).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$b).<span class="stringliteral">&#39; rg&#39;</span>;
<a name="l01661"></a>01661     $this-&gt;currentColour=array(<span class="charliteral">&#39;r&#39;</span>=&gt;$r,<span class="charliteral">&#39;g&#39;</span>=&gt;$g,<span class="charliteral">&#39;b&#39;</span>=&gt;$b);
<a name="l01662"></a>01662   }
<a name="l01663"></a>01663 }
<a name="l01664"></a>01664 
<a name="l01668"></a><a class="code" href="class_cpdf.html#a8d3584e9eee400857cd917984d025db4">01668</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a8d3584e9eee400857cd917984d025db4">setStrokeColor</a>($r,$g,$b,$force=0){
<a name="l01669"></a>01669   <span class="keywordflow">if</span> ($r&gt;=0 &amp;&amp; ($force || $r!=$this-&gt;currentStrokeColour[<span class="charliteral">&#39;r&#39;</span>] || $g!=$this-&gt;currentStrokeColour[<span class="charliteral">&#39;g&#39;</span>] || $b!=$this-&gt;currentStrokeColour[<span class="charliteral">&#39;b&#39;</span>])){
<a name="l01670"></a>01670     $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&quot;\n&quot;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$r).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$g).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$b).<span class="stringliteral">&#39; RG&#39;</span>;
<a name="l01671"></a>01671     $this-&gt;currentStrokeColour=array(<span class="charliteral">&#39;r&#39;</span>=&gt;$r,<span class="charliteral">&#39;g&#39;</span>=&gt;$g,<span class="charliteral">&#39;b&#39;</span>=&gt;$b);
<a name="l01672"></a>01672   }
<a name="l01673"></a>01673 }
<a name="l01674"></a>01674 
<a name="l01678"></a><a class="code" href="class_cpdf.html#af1d651738f85ded800eda901655992be">01678</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#af1d651738f85ded800eda901655992be">line</a>($x1,$y1,$x2,$y2){
<a name="l01679"></a>01679   $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&quot;\n&quot;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$x1).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$y1).<span class="stringliteral">&#39; m &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$x2).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$y2).<span class="stringliteral">&#39; l S&#39;</span>;
<a name="l01680"></a>01680 }
<a name="l01681"></a>01681 
<a name="l01685"></a><a class="code" href="class_cpdf.html#a13c3a2e45741b553d81496482a6a9579">01685</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a13c3a2e45741b553d81496482a6a9579">curve</a>($x0,$y0,$x1,$y1,$x2,$y2,$x3,$y3){
<a name="l01686"></a>01686   <span class="comment">// in the current line style, draw a bezier curve from (x0,y0) to (x3,y3) using the other two points</span>
<a name="l01687"></a>01687   <span class="comment">// as the control points for the curve.</span>
<a name="l01688"></a>01688   $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&quot;\n&quot;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$x0).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$y0).<span class="stringliteral">&#39; m &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$x1).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$y1);
<a name="l01689"></a>01689   $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].= <span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$x2).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$y2).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$x3).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$y3).<span class="stringliteral">&#39; c S&#39;</span>;
<a name="l01690"></a>01690 }
<a name="l01691"></a>01691 
<a name="l01695"></a><a class="code" href="class_cpdf.html#a01283c9d18d281852c058bd6660d75a8">01695</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a01283c9d18d281852c058bd6660d75a8">partEllipse</a>($x0,$y0,$astart,$afinish,$r1,$r2=0,$angle=0,$nSeg=8){
<a name="l01696"></a>01696   $this-&gt;<a class="code" href="class_cpdf.html#ab56f65d9ba54f403a6bd7a007134808a">ellipse</a>($x0,$y0,$r1,$r2,$angle,$nSeg,$astart,$afinish,0);
<a name="l01697"></a>01697 }
<a name="l01698"></a>01698 
<a name="l01702"></a><a class="code" href="class_cpdf.html#a7d14967703e2beb4591ea33187d71f83">01702</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a7d14967703e2beb4591ea33187d71f83">filledEllipse</a>($x0,$y0,$r1,$r2=0,$angle=0,$nSeg=8,$astart=0,$afinish=360){
<a name="l01703"></a>01703   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_cpdf.html#ab56f65d9ba54f403a6bd7a007134808a">ellipse</a>($x0,$y0,$r1,$r2=0,$angle,$nSeg,$astart,$afinish,1,1);
<a name="l01704"></a>01704 }
<a name="l01705"></a>01705 
<a name="l01716"></a><a class="code" href="class_cpdf.html#ab56f65d9ba54f403a6bd7a007134808a">01716</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#ab56f65d9ba54f403a6bd7a007134808a">ellipse</a>($x0,$y0,$r1,$r2=0,$angle=0,$nSeg=8,$astart=0,$afinish=360,$close=1,$fill=0){
<a name="l01717"></a>01717   <span class="keywordflow">if</span> ($r1==0){
<a name="l01718"></a>01718     <span class="keywordflow">return</span>;
<a name="l01719"></a>01719   }
<a name="l01720"></a>01720   <span class="keywordflow">if</span> ($r2==0){
<a name="l01721"></a>01721     $r2=$r1;
<a name="l01722"></a>01722   }
<a name="l01723"></a>01723   <span class="keywordflow">if</span> ($nSeg&lt;2){
<a name="l01724"></a>01724     $nSeg=2;
<a name="l01725"></a>01725   }
<a name="l01726"></a>01726 
<a name="l01727"></a>01727   $astart = deg2rad((<span class="keywordtype">float</span>)$astart);
<a name="l01728"></a>01728   $afinish = deg2rad((<span class="keywordtype">float</span>)$afinish);
<a name="l01729"></a>01729   $totalAngle =$afinish-$astart;
<a name="l01730"></a>01730 
<a name="l01731"></a>01731   $dt = $totalAngle/$nSeg;
<a name="l01732"></a>01732   $dtm = $dt/3;
<a name="l01733"></a>01733 
<a name="l01734"></a>01734   <span class="keywordflow">if</span> ($angle != 0){
<a name="l01735"></a>01735     <a class="code" href="phpdoc_8inc.html#acebf83966ef6d7e5645a6b62ba368f9f">$a</a> = -1*deg2rad((<span class="keywordtype">float</span>)$angle);
<a name="l01736"></a>01736     $tmp = <span class="stringliteral">&quot;\n q &quot;</span>;
<a name="l01737"></a>01737     $tmp .= sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,cos(<a class="code" href="phpdoc_8inc.html#acebf83966ef6d7e5645a6b62ba368f9f">$a</a>)).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,(-1.0*sin(<a class="code" href="phpdoc_8inc.html#acebf83966ef6d7e5645a6b62ba368f9f">$a</a>))).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,sin(<a class="code" href="phpdoc_8inc.html#acebf83966ef6d7e5645a6b62ba368f9f">$a</a>)).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,cos(<a class="code" href="phpdoc_8inc.html#acebf83966ef6d7e5645a6b62ba368f9f">$a</a>)).<span class="charliteral">&#39; &#39;</span>;
<a name="l01738"></a>01738     $tmp .= sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$x0).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$y0).<span class="stringliteral">&#39; cm&#39;</span>;
<a name="l01739"></a>01739     $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].= $tmp;
<a name="l01740"></a>01740     $x0=0;
<a name="l01741"></a>01741     $y0=0;
<a name="l01742"></a>01742   }
<a name="l01743"></a>01743 
<a name="l01744"></a>01744   $t1 = $astart;
<a name="l01745"></a>01745   $a0 = $x0+$r1*cos($t1);
<a name="l01746"></a>01746   $b0 = $y0+$r2*sin($t1);
<a name="l01747"></a>01747   $c0 = -$r1*sin($t1);
<a name="l01748"></a>01748   $d0 = $r2*cos($t1);
<a name="l01749"></a>01749 
<a name="l01750"></a>01750   $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&quot;\n&quot;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$a0).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$b0).<span class="stringliteral">&#39; m &#39;</span>;
<a name="l01751"></a>01751   <span class="keywordflow">for</span> ($i=1;$i&lt;=$nSeg;$i++){
<a name="l01752"></a>01752     <span class="comment">// draw this bit of the total curve</span>
<a name="l01753"></a>01753     $t1 = $i*$dt+$astart;
<a name="l01754"></a>01754     $a1 = $x0+$r1*cos($t1);
<a name="l01755"></a>01755     $b1 = $y0+$r2*sin($t1);
<a name="l01756"></a>01756     $c1 = -$r1*sin($t1);
<a name="l01757"></a>01757     $d1 = $r2*cos($t1);
<a name="l01758"></a>01758     $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&quot;\n&quot;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,($a0+$c0*$dtm)).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,($b0+$d0*$dtm));
<a name="l01759"></a>01759     $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].= <span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,($a1-$c1*$dtm)).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,($b1-$d1*$dtm)).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$a1).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$b1).<span class="stringliteral">&#39; c&#39;</span>;
<a name="l01760"></a>01760     $a0=$a1;
<a name="l01761"></a>01761     $b0=$b1;
<a name="l01762"></a>01762     $c0=$c1;
<a name="l01763"></a>01763     $d0=$d1;    
<a name="l01764"></a>01764   }
<a name="l01765"></a>01765   <span class="keywordflow">if</span> ($fill){
<a name="l01766"></a>01766     $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&#39; f&#39;</span>;
<a name="l01767"></a>01767   } <span class="keywordflow">else</span> {
<a name="l01768"></a>01768     <span class="keywordflow">if</span> ($close){
<a name="l01769"></a>01769       $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&#39; s&#39;</span>; <span class="comment">// small &#39;s&#39; signifies closing the path as well</span>
<a name="l01770"></a>01770     } <span class="keywordflow">else</span> {
<a name="l01771"></a>01771       $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&#39; S&#39;</span>;
<a name="l01772"></a>01772     }
<a name="l01773"></a>01773   }
<a name="l01774"></a>01774   <span class="keywordflow">if</span> ($angle !=0){
<a name="l01775"></a>01775     $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&#39; Q&#39;</span>;
<a name="l01776"></a>01776   }
<a name="l01777"></a>01777 }
<a name="l01778"></a>01778 
<a name="l01792"></a><a class="code" href="class_cpdf.html#a8e3b86cfcb5e8d0ad44fa5196f40a6b1">01792</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a8e3b86cfcb5e8d0ad44fa5196f40a6b1">setLineStyle</a>($width=1,$cap=<span class="stringliteral">&#39;&#39;</span>,$join=<span class="stringliteral">&#39;&#39;</span>,$dash=<span class="stringliteral">&#39;&#39;</span>,$phase=0){
<a name="l01793"></a>01793 
<a name="l01794"></a>01794   <span class="comment">// this is quite inefficient in that it sets all the parameters whenever 1 is changed, but will fix another day</span>
<a name="l01795"></a>01795   $string = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01796"></a>01796   <span class="keywordflow">if</span> ($width&gt;0){
<a name="l01797"></a>01797     $string.= $width.<span class="stringliteral">&#39; w&#39;</span>;
<a name="l01798"></a>01798   }
<a name="l01799"></a>01799   $ca = array(<span class="stringliteral">&#39;butt&#39;</span>=&gt;0,<span class="stringliteral">&#39;round&#39;</span>=&gt;1,<span class="stringliteral">&#39;square&#39;</span>=&gt;2);
<a name="l01800"></a>01800   <span class="keywordflow">if</span> (isset($ca[$cap])){
<a name="l01801"></a>01801     $string.= <span class="charliteral">&#39; &#39;</span>.$ca[$cap].<span class="stringliteral">&#39; J&#39;</span>;
<a name="l01802"></a>01802   }
<a name="l01803"></a>01803   $ja = array(<span class="stringliteral">&#39;miter&#39;</span>=&gt;0,<span class="stringliteral">&#39;round&#39;</span>=&gt;1,<span class="stringliteral">&#39;bevel&#39;</span>=&gt;2);
<a name="l01804"></a>01804   <span class="keywordflow">if</span> (isset($ja[$join])){
<a name="l01805"></a>01805     $string.= <span class="charliteral">&#39; &#39;</span>.$ja[$join].<span class="stringliteral">&#39; j&#39;</span>;
<a name="l01806"></a>01806   }
<a name="l01807"></a>01807   <span class="keywordflow">if</span> (is_array($dash)){
<a name="l01808"></a>01808     $string.= <span class="stringliteral">&#39; [&#39;</span>;
<a name="l01809"></a>01809     <span class="keywordflow">foreach</span> ($dash as $len){
<a name="l01810"></a>01810       $string.=<span class="charliteral">&#39; &#39;</span>.$len;
<a name="l01811"></a>01811     }
<a name="l01812"></a>01812     $string.= <span class="stringliteral">&#39; ] &#39;</span>.$phase.<span class="stringliteral">&#39; d&#39;</span>;
<a name="l01813"></a>01813   }
<a name="l01814"></a>01814   $this-&gt;currentLineStyle = $string;
<a name="l01815"></a>01815   $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&quot;\n&quot;</span>.$string;
<a name="l01816"></a>01816 }
<a name="l01817"></a>01817 
<a name="l01821"></a><a class="code" href="class_cpdf.html#aaf7ac386285317f442a825dd02f49fe9">01821</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#aaf7ac386285317f442a825dd02f49fe9">polygon</a>($p,$np,$f=0){
<a name="l01822"></a>01822   $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01823"></a>01823   $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$p[0]).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$p[1]).<span class="stringliteral">&#39; m &#39;</span>;
<a name="l01824"></a>01824   <span class="keywordflow">for</span> ($i=2;$i&lt;$np*2;$i=$i+2){
<a name="l01825"></a>01825     $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].= sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$p[$i]).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$p[$i+1]).<span class="stringliteral">&#39; l &#39;</span>;
<a name="l01826"></a>01826   }
<a name="l01827"></a>01827   <span class="keywordflow">if</span> ($f==1){
<a name="l01828"></a>01828     $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&#39; f&#39;</span>;
<a name="l01829"></a>01829   } <span class="keywordflow">else</span> {
<a name="l01830"></a>01830     $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&#39; S&#39;</span>;
<a name="l01831"></a>01831   }
<a name="l01832"></a>01832 }
<a name="l01833"></a>01833 
<a name="l01838"></a><a class="code" href="class_cpdf.html#a519df1355cd54eb52caa42650c7fcc2e">01838</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a519df1355cd54eb52caa42650c7fcc2e">filledRectangle</a>($x1,$y1,$width,$height){
<a name="l01839"></a>01839   $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&quot;\n&quot;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$x1).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$y1).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$width).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$height).<span class="stringliteral">&#39; re f&#39;</span>;
<a name="l01840"></a>01840 }
<a name="l01841"></a>01841 
<a name="l01846"></a><a class="code" href="class_cpdf.html#adc6135070daab0159a4c75d04ebbc8ac">01846</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#adc6135070daab0159a4c75d04ebbc8ac">rectangle</a>($x1,$y1,$width,$height){
<a name="l01847"></a>01847   $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&quot;\n&quot;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$x1).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$y1).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$width).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$height).<span class="stringliteral">&#39; re S&#39;</span>;
<a name="l01848"></a>01848 }
<a name="l01849"></a>01849 
<a name="l01854"></a><a class="code" href="class_cpdf.html#ae150a1dceeb483a42acaedbe73ccd692">01854</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#ae150a1dceeb483a42acaedbe73ccd692">newPage</a>($insert=0,$id=0,$pos=<span class="stringliteral">&#39;after&#39;</span>){
<a name="l01855"></a>01855 
<a name="l01856"></a>01856   <span class="comment">// if there is a state saved, then go up the stack closing them</span>
<a name="l01857"></a>01857   <span class="comment">// then on the new page, re-open them with the right setings</span>
<a name="l01858"></a>01858   
<a name="l01859"></a>01859   <span class="keywordflow">if</span> ($this-&gt;nStateStack){
<a name="l01860"></a>01860     <span class="keywordflow">for</span> ($i=$this-&gt;nStateStack;$i&gt;=1;$i--){
<a name="l01861"></a>01861       $this-&gt;<a class="code" href="class_cpdf.html#a2f42f38b51682f8457ee605bb3029dc4">restoreState</a>($i);
<a name="l01862"></a>01862     }
<a name="l01863"></a>01863   }
<a name="l01864"></a>01864 
<a name="l01865"></a>01865   $this-&gt;numObj++;
<a name="l01866"></a>01866   <span class="keywordflow">if</span> ($insert){
<a name="l01867"></a>01867     <span class="comment">// the id from the ezPdf class is the od of the contents of the page, not the page object itself</span>
<a name="l01868"></a>01868     <span class="comment">// query that object to find the parent</span>
<a name="l01869"></a>01869     $rid = $this-&gt;objects[$id][<span class="stringliteral">&#39;onPage&#39;</span>];
<a name="l01870"></a>01870     $opt= array(<span class="stringliteral">&#39;rid&#39;</span>=&gt;$rid,<span class="stringliteral">&#39;pos&#39;</span>=&gt;$pos);
<a name="l01871"></a>01871     $this-&gt;<a class="code" href="class_cpdf.html#aa8f8c9faae6d2ef10e350675dde97f8d">o_page</a>($this-&gt;numObj,<span class="stringliteral">&#39;new&#39;</span>,$opt);
<a name="l01872"></a>01872   } <span class="keywordflow">else</span> {
<a name="l01873"></a>01873     $this-&gt;<a class="code" href="class_cpdf.html#aa8f8c9faae6d2ef10e350675dde97f8d">o_page</a>($this-&gt;numObj,<span class="stringliteral">&#39;new&#39;</span>);
<a name="l01874"></a>01874   }
<a name="l01875"></a>01875   <span class="comment">// if there is a stack saved, then put that onto the page</span>
<a name="l01876"></a>01876   <span class="keywordflow">if</span> ($this-&gt;nStateStack){
<a name="l01877"></a>01877     <span class="keywordflow">for</span> ($i=1;$i&lt;=$this-&gt;nStateStack;$i++){
<a name="l01878"></a>01878       $this-&gt;<a class="code" href="class_cpdf.html#a854f2a9d1250c69b6c2243d5175ddd83">saveState</a>($i);
<a name="l01879"></a>01879     }
<a name="l01880"></a>01880   }  
<a name="l01881"></a>01881   <span class="comment">// and if there has been a stroke or fill colour set, then transfer them</span>
<a name="l01882"></a>01882   <span class="keywordflow">if</span> ($this-&gt;currentColour[<span class="charliteral">&#39;r&#39;</span>]&gt;=0){
<a name="l01883"></a>01883     $this-&gt;<a class="code" href="class_cpdf.html#ad6873769b1aeb31e7acbc3be3de671a5">setColor</a>($this-&gt;currentColour[<span class="charliteral">&#39;r&#39;</span>],$this-&gt;currentColour[<span class="charliteral">&#39;g&#39;</span>],$this-&gt;currentColour[<span class="charliteral">&#39;b&#39;</span>],1);
<a name="l01884"></a>01884   }
<a name="l01885"></a>01885   <span class="keywordflow">if</span> ($this-&gt;currentStrokeColour[<span class="charliteral">&#39;r&#39;</span>]&gt;=0){
<a name="l01886"></a>01886     $this-&gt;<a class="code" href="class_cpdf.html#a8d3584e9eee400857cd917984d025db4">setStrokeColor</a>($this-&gt;currentStrokeColour[<span class="charliteral">&#39;r&#39;</span>],$this-&gt;currentStrokeColour[<span class="charliteral">&#39;g&#39;</span>],$this-&gt;currentStrokeColour[<span class="charliteral">&#39;b&#39;</span>],1);
<a name="l01887"></a>01887   }
<a name="l01888"></a>01888 
<a name="l01889"></a>01889   <span class="comment">// if there is a line style set, then put this in too</span>
<a name="l01890"></a>01890   <span class="keywordflow">if</span> (strlen($this-&gt;currentLineStyle)){
<a name="l01891"></a>01891     $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&quot;\n&quot;</span>.$this-&gt;currentLineStyle;
<a name="l01892"></a>01892   }
<a name="l01893"></a>01893 
<a name="l01894"></a>01894   <span class="comment">// the call to the o_page object set currentContents to the present page, so this can be returned as the page id</span>
<a name="l01895"></a>01895   <span class="keywordflow">return</span> $this-&gt;currentContents;
<a name="l01896"></a>01896 }
<a name="l01897"></a>01897 
<a name="l01902"></a><a class="code" href="class_cpdf.html#a27bdbd15ab2ad7f53187295651b345e7">01902</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a27bdbd15ab2ad7f53187295651b345e7">stream</a>(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>=<span class="stringliteral">&#39;&#39;</span>){
<a name="l01903"></a>01903   <span class="comment">// setting the options allows the adjustment of the headers</span>
<a name="l01904"></a>01904   <span class="comment">// values at the moment are:</span>
<a name="l01905"></a>01905   <span class="comment">// &#39;Content-Disposition&#39;=&gt;&#39;filename&#39;  - sets the filename, though not too sure how well this will </span>
<a name="l01906"></a>01906   <span class="comment">//        work as in my trial the browser seems to use the filename of the php file with .pdf on the end</span>
<a name="l01907"></a>01907   <span class="comment">// &#39;Accept-Ranges&#39;=&gt;1 or 0 - if this is not set to 1, then this header is not included, off by default</span>
<a name="l01908"></a>01908   <span class="comment">//    this header seems to have caused some problems despite tha fact that it is supposed to solve</span>
<a name="l01909"></a>01909   <span class="comment">//    them, so I am leaving it off by default.</span>
<a name="l01910"></a>01910   <span class="comment">// &#39;compress&#39;=&gt; 1 or 0 - apply content stream compression, this is on (1) by default</span>
<a name="l01911"></a>01911   <span class="keywordflow">if</span> (!is_array(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>)){
<a name="l01912"></a>01912     <a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>=array();
<a name="l01913"></a>01913   }
<a name="l01914"></a>01914   <span class="keywordflow">if</span> ( isset(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;compress&#39;</span>]) &amp;&amp; <a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;compress&#39;</span>]==0){
<a name="l01915"></a>01915     $tmp = $this-&gt;<a class="code" href="class_cpdf.html#aa81bf39d5b682bbccdbf75c269b15729">output</a>(1);
<a name="l01916"></a>01916   } <span class="keywordflow">else</span> {
<a name="l01917"></a>01917     $tmp = $this-&gt;<a class="code" href="class_cpdf.html#aa81bf39d5b682bbccdbf75c269b15729">output</a>();
<a name="l01918"></a>01918   }
<a name="l01919"></a>01919   header(<span class="stringliteral">&quot;Content-type: application/pdf&quot;</span>);
<a name="l01920"></a>01920   header(<span class="stringliteral">&quot;Content-Length: &quot;</span>.strlen(ltrim($tmp)));
<a name="l01921"></a>01921   $fileName = (isset(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;Content-Disposition&#39;</span>])?<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;Content-Disposition&#39;</span>]:<span class="stringliteral">&#39;file.pdf&#39;</span>);
<a name="l01922"></a>01922   header(<span class="stringliteral">&quot;Content-Disposition: inline; filename=&quot;</span>.$fileName);
<a name="l01923"></a>01923   <span class="keywordflow">if</span> (isset(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;Accept-Ranges&#39;</span>]) &amp;&amp; <a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;Accept-Ranges&#39;</span>]==1){
<a name="l01924"></a>01924     header(<span class="stringliteral">&quot;Accept-Ranges: &quot;</span>.strlen(ltrim($tmp))); 
<a name="l01925"></a>01925   }
<a name="l01926"></a>01926   <a class="code" href="bug-eofquotes_8php.html#ac4fd59c9ee95bff469a7cd55e16f0449">echo</a> ltrim($tmp);
<a name="l01927"></a>01927 }
<a name="l01928"></a>01928 
<a name="l01932"></a><a class="code" href="class_cpdf.html#a6beae3dc84460fede62c6a0ca8861277">01932</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a6beae3dc84460fede62c6a0ca8861277">getFontHeight</a>($size){
<a name="l01933"></a>01933   <span class="keywordflow">if</span> (!$this-&gt;numFonts){
<a name="l01934"></a>01934     $this-&gt;<a class="code" href="class_cpdf.html#a51b2f9f1095c23b3b75a8f7bf4a04533">selectFont</a>(<span class="stringliteral">&#39;./fonts/Helvetica&#39;</span>);
<a name="l01935"></a>01935   }
<a name="l01936"></a>01936   <span class="comment">// for the current font, and the given size, what is the height of the font in user units</span>
<a name="l01937"></a>01937   $h = $this-&gt;fonts[$this-&gt;currentFont][<span class="stringliteral">&#39;FontBBox&#39;</span>][3]-$this-&gt;fonts[$this-&gt;currentFont][<span class="stringliteral">&#39;FontBBox&#39;</span>][1];
<a name="l01938"></a>01938   <span class="keywordflow">return</span> $size*$h/1000;
<a name="l01939"></a>01939 }
<a name="l01940"></a>01940 
<a name="l01946"></a><a class="code" href="class_cpdf.html#adedb392d14ce7963b05c5ca389181699">01946</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#adedb392d14ce7963b05c5ca389181699">getFontDecender</a>($size){
<a name="l01947"></a>01947   <span class="comment">// note that this will most likely return a negative value</span>
<a name="l01948"></a>01948   <span class="keywordflow">if</span> (!$this-&gt;numFonts){
<a name="l01949"></a>01949     $this-&gt;<a class="code" href="class_cpdf.html#a51b2f9f1095c23b3b75a8f7bf4a04533">selectFont</a>(<span class="stringliteral">&#39;./fonts/Helvetica&#39;</span>);
<a name="l01950"></a>01950   }
<a name="l01951"></a>01951   $h = $this-&gt;fonts[$this-&gt;currentFont][<span class="stringliteral">&#39;FontBBox&#39;</span>][1];
<a name="l01952"></a>01952   <span class="keywordflow">return</span> $size*$h/1000;
<a name="l01953"></a>01953 }
<a name="l01954"></a>01954 
<a name="l01961"></a><a class="code" href="class_cpdf.html#a984113695ea977929b4b7795fbf41cd2">01961</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a984113695ea977929b4b7795fbf41cd2">filterText</a>($text){
<a name="l01962"></a>01962   $text = str_replace(<span class="charliteral">&#39;\\&#39;</span>,<span class="stringliteral">&#39;\\\\&#39;</span>,$text);
<a name="l01963"></a>01963   $text = str_replace(<span class="charliteral">&#39;(&#39;</span>,<span class="charliteral">&#39;\(&#39;</span>,$text);
<a name="l01964"></a>01964   $text = str_replace(<span class="charliteral">&#39;)&#39;</span>,<span class="charliteral">&#39;\)&#39;</span>,$text);
<a name="l01965"></a>01965   $text = str_replace(<span class="stringliteral">&#39;&amp;lt;&#39;</span>,<span class="charliteral">&#39;&lt;&#39;</span>,$text);
<a name="l01966"></a>01966   $text = str_replace(<span class="stringliteral">&#39;&amp;gt;&#39;</span>,<span class="charliteral">&#39;&gt;&#39;</span>,$text);
<a name="l01967"></a>01967   $text = str_replace(<span class="stringliteral">&#39;&amp;#039;&#39;</span>,<span class="charliteral">&#39;\&#39;&#39;</span>,$text);
<a name="l01968"></a>01968   $text = str_replace(<span class="stringliteral">&#39;&amp;quot;&#39;</span>,<span class="charliteral">&#39;&quot;&#39;</span>,$text);
<a name="l01969"></a>01969   $text = str_replace(<span class="stringliteral">&#39;&amp;amp;&#39;</span>,<span class="charliteral">&#39;&amp;&#39;</span>,$text);
<a name="l01970"></a>01970 
<a name="l01971"></a>01971   <span class="keywordflow">return</span> $text;
<a name="l01972"></a>01972 }
<a name="l01973"></a>01973 
<a name="l01980"></a><a class="code" href="class_cpdf.html#ada9e29ddfcdecb498a13811a03bf0716">01980</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#ada9e29ddfcdecb498a13811a03bf0716">PRVTgetTextPosition</a>($x,$y,$angle,$size,$wa,$text){
<a name="l01981"></a>01981   <span class="comment">// given this information return an array containing x and y for the end position as elements 0 and 1</span>
<a name="l01982"></a>01982   $w = $this-&gt;<a class="code" href="class_cpdf.html#af92fe5c611b3feeafd3282ace477345f">getTextWidth</a>($size,$text);
<a name="l01983"></a>01983   <span class="comment">// need to adjust for the number of spaces in this text</span>
<a name="l01984"></a>01984   $words = explode(<span class="charliteral">&#39; &#39;</span>,$text);
<a name="l01985"></a>01985   $nspaces=count($words)-1;
<a name="l01986"></a>01986   $w += $wa*$nspaces;
<a name="l01987"></a>01987   <a class="code" href="phpdoc_8inc.html#acebf83966ef6d7e5645a6b62ba368f9f">$a</a> = deg2rad((<span class="keywordtype">float</span>)$angle);
<a name="l01988"></a>01988   <span class="keywordflow">return</span> array(cos(<a class="code" href="phpdoc_8inc.html#acebf83966ef6d7e5645a6b62ba368f9f">$a</a>)*$w+$x,-sin(<a class="code" href="phpdoc_8inc.html#acebf83966ef6d7e5645a6b62ba368f9f">$a</a>)*$w+$y);
<a name="l01989"></a>01989 }
<a name="l01990"></a>01990 
<a name="l01996"></a><a class="code" href="class_cpdf.html#a74a8799ea1bd2492c8f166c99ab8c588">01996</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a74a8799ea1bd2492c8f166c99ab8c588">PRVTcheckTextDirective</a>(&amp;$text,$i,&amp;$f){
<a name="l01997"></a>01997   $x=0;
<a name="l01998"></a>01998   $y=0;
<a name="l01999"></a>01999   <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_cpdf.html#a0431a00e90c0a4cb96e22e9af5c92927">PRVTcheckTextDirective1</a>($text,$i,$f,0,$x,$y);
<a name="l02000"></a>02000 }
<a name="l02001"></a>02001 
<a name="l02011"></a><a class="code" href="class_cpdf.html#a0431a00e90c0a4cb96e22e9af5c92927">02011</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a0431a00e90c0a4cb96e22e9af5c92927">PRVTcheckTextDirective1</a>(&amp;$text,$i,&amp;$f,$final,&amp;$x,&amp;$y,$size=0,$angle=0,<a class="code" href="class_cpdf.html#a32de4c103af0783f44fd568d74c6454b">$wordSpaceAdjust</a>=0){
<a name="l02012"></a>02012   $directive = 0;
<a name="l02013"></a>02013   $j=$i;
<a name="l02014"></a>02014   <span class="keywordflow">if</span> ($text[$j]==<span class="charliteral">&#39;&lt;&#39;</span>){
<a name="l02015"></a>02015     $j++;
<a name="l02016"></a>02016     <span class="keywordflow">switch</span>($text[$j]){
<a name="l02017"></a>02017       <span class="keywordflow">case</span> <span class="charliteral">&#39;/&#39;</span>:
<a name="l02018"></a>02018         $j++;
<a name="l02019"></a>02019         <span class="keywordflow">if</span> (strlen($text) &lt;= $j){
<a name="l02020"></a>02020           <span class="keywordflow">return</span> $directive;
<a name="l02021"></a>02021         }
<a name="l02022"></a>02022         <span class="keywordflow">switch</span>($text[$j]){
<a name="l02023"></a>02023           <span class="keywordflow">case</span> <span class="charliteral">&#39;b&#39;</span>:
<a name="l02024"></a>02024           <span class="keywordflow">case</span> <span class="charliteral">&#39;i&#39;</span>:
<a name="l02025"></a>02025             $j++;
<a name="l02026"></a>02026             <span class="keywordflow">if</span> ($text[$j]==<span class="charliteral">&#39;&gt;&#39;</span>){
<a name="l02027"></a>02027               $p = strrpos($this-&gt;currentTextState,$text[$j-1]);
<a name="l02028"></a>02028               <span class="keywordflow">if</span> ($p !== <span class="keyword">false</span>){
<a name="l02029"></a>02029                 <span class="comment">// then there is one to remove</span>
<a name="l02030"></a>02030                 $this-&gt;currentTextState = substr($this-&gt;currentTextState,0,$p).substr($this-&gt;currentTextState,$p+1);
<a name="l02031"></a>02031               }
<a name="l02032"></a>02032               $directive=$j-$i+1;
<a name="l02033"></a>02033             }
<a name="l02034"></a>02034             <span class="keywordflow">break</span>;
<a name="l02035"></a>02035           <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>:
<a name="l02036"></a>02036             <span class="comment">// this this might be a callback function</span>
<a name="l02037"></a>02037             $j++;
<a name="l02038"></a>02038             $k = strpos($text,<span class="charliteral">&#39;&gt;&#39;</span>,$j);
<a name="l02039"></a>02039             <span class="keywordflow">if</span> ($k!==<span class="keyword">false</span> &amp;&amp; $text[$j]==<span class="charliteral">&#39;:&#39;</span>){
<a name="l02040"></a>02040               <span class="comment">// then this will be treated as a callback directive</span>
<a name="l02041"></a>02041               $directive = $k-$i+1;
<a name="l02042"></a>02042               $f=0;
<a name="l02043"></a>02043               <span class="comment">// split the remainder on colons to get the function name and the paramater</span>
<a name="l02044"></a>02044               $tmp = substr($text,$j+1,$k-$j-1);
<a name="l02045"></a>02045               $b1 = strpos($tmp,<span class="charliteral">&#39;:&#39;</span>);
<a name="l02046"></a>02046               <span class="keywordflow">if</span> ($b1!==<span class="keyword">false</span>){
<a name="l02047"></a>02047                 $func = substr($tmp,0,$b1);
<a name="l02048"></a>02048                 $parm = substr($tmp,$b1+1);
<a name="l02049"></a>02049               } <span class="keywordflow">else</span> {
<a name="l02050"></a>02050                 $func=$tmp;
<a name="l02051"></a>02051                 $parm=<span class="stringliteral">&#39;&#39;</span>;
<a name="l02052"></a>02052               }
<a name="l02053"></a>02053               <span class="keywordflow">if</span> (!isset($func) || !strlen(trim($func))){
<a name="l02054"></a>02054                 $directive=0;
<a name="l02055"></a>02055               } <span class="keywordflow">else</span> {
<a name="l02056"></a>02056                 <span class="comment">// only call the function if this is the final call</span>
<a name="l02057"></a>02057                 <span class="keywordflow">if</span> ($final){
<a name="l02058"></a>02058                   <span class="comment">// need to assess the text position, calculate the text width to this point</span>
<a name="l02059"></a>02059                   <span class="comment">// can use getTextWidth to find the text width I think</span>
<a name="l02060"></a>02060                   $tmp = $this-&gt;<a class="code" href="class_cpdf.html#ada9e29ddfcdecb498a13811a03bf0716">PRVTgetTextPosition</a>($x,$y,$angle,$size,<a class="code" href="class_cpdf.html#a32de4c103af0783f44fd568d74c6454b">$wordSpaceAdjust</a>,substr($text,0,$i));
<a name="l02061"></a>02061                   $info = array(<span class="charliteral">&#39;x&#39;</span>=&gt;$tmp[0],<span class="charliteral">&#39;y&#39;</span>=&gt;$tmp[1],<span class="stringliteral">&#39;angle&#39;</span>=&gt;$angle,<span class="stringliteral">&#39;status&#39;</span>=&gt;<span class="stringliteral">&#39;end&#39;</span>,<span class="charliteral">&#39;p&#39;</span>=&gt;$parm,<span class="stringliteral">&#39;nCallback&#39;</span>=&gt;$this-&gt;nCallback);
<a name="l02062"></a>02062                   $x=$tmp[0];
<a name="l02063"></a>02063                   $y=$tmp[1];
<a name="l02064"></a>02064                   <a class="code" href="administration_2lists_2data__create_8ejs_8php.html#affd9e3eb0aad0a7ca42912cd925f148c">$ret</a> = $this-&gt;$func($info);
<a name="l02065"></a>02065                   <span class="keywordflow">if</span> (is_array(<a class="code" href="administration_2lists_2data__create_8ejs_8php.html#affd9e3eb0aad0a7ca42912cd925f148c">$ret</a>)){
<a name="l02066"></a>02066                     <span class="comment">// then the return from the callback function could set the position, to start with, later will do font colour, and font</span>
<a name="l02067"></a>02067                     <span class="keywordflow">foreach</span>(<a class="code" href="administration_2lists_2data__create_8ejs_8php.html#affd9e3eb0aad0a7ca42912cd925f148c">$ret</a> as $rk=&gt;$rv){
<a name="l02068"></a>02068                       <span class="keywordflow">switch</span>($rk){
<a name="l02069"></a>02069                         <span class="keywordflow">case</span> <span class="charliteral">&#39;x&#39;</span>:
<a name="l02070"></a>02070                         <span class="keywordflow">case</span> <span class="charliteral">&#39;y&#39;</span>:
<a name="l02071"></a>02071                           $$rk=$rv;
<a name="l02072"></a>02072                           <span class="keywordflow">break</span>;
<a name="l02073"></a>02073                       }
<a name="l02074"></a>02074                     }
<a name="l02075"></a>02075                   }
<a name="l02076"></a>02076                   <span class="comment">// also remove from to the stack</span>
<a name="l02077"></a>02077                   <span class="comment">// for simplicity, just take from the end, fix this another day</span>
<a name="l02078"></a>02078                   $this-&gt;nCallback--;
<a name="l02079"></a>02079                   <span class="keywordflow">if</span> ($this-&gt;nCallback&lt;0){
<a name="l02080"></a>02080                     $this-&gt;nCallBack=0;
<a name="l02081"></a>02081                   }
<a name="l02082"></a>02082                 }
<a name="l02083"></a>02083               }
<a name="l02084"></a>02084             }
<a name="l02085"></a>02085             <span class="keywordflow">break</span>;
<a name="l02086"></a>02086         }
<a name="l02087"></a>02087         <span class="keywordflow">break</span>;
<a name="l02088"></a>02088       <span class="keywordflow">case</span> <span class="charliteral">&#39;b&#39;</span>:
<a name="l02089"></a>02089       <span class="keywordflow">case</span> <span class="charliteral">&#39;i&#39;</span>:
<a name="l02090"></a>02090         $j++;
<a name="l02091"></a>02091         <span class="keywordflow">if</span> ($text[$j]==<span class="charliteral">&#39;&gt;&#39;</span>){
<a name="l02092"></a>02092           $this-&gt;currentTextState.=$text[$j-1];
<a name="l02093"></a>02093           $directive=$j-$i+1;
<a name="l02094"></a>02094         }
<a name="l02095"></a>02095         <span class="keywordflow">break</span>;
<a name="l02096"></a>02096       <span class="keywordflow">case</span> <span class="charliteral">&#39;C&#39;</span>:
<a name="l02097"></a>02097         $noClose=1;
<a name="l02098"></a>02098       <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>:
<a name="l02099"></a>02099         <span class="comment">// this this might be a callback function</span>
<a name="l02100"></a>02100         $j++;
<a name="l02101"></a>02101         $k = strpos($text,<span class="charliteral">&#39;&gt;&#39;</span>,$j);
<a name="l02102"></a>02102         <span class="keywordflow">if</span> ($k!==<span class="keyword">false</span> &amp;&amp; $text[$j]==<span class="charliteral">&#39;:&#39;</span>){
<a name="l02103"></a>02103           <span class="comment">// then this will be treated as a callback directive</span>
<a name="l02104"></a>02104           $directive = $k-$i+1;
<a name="l02105"></a>02105           $f=0;
<a name="l02106"></a>02106           <span class="comment">// split the remainder on colons to get the function name and the paramater</span>
<a name="l02107"></a>02107 <span class="comment">//          $bits = explode(&#39;:&#39;,substr($text,$j+1,$k-$j-1));</span>
<a name="l02108"></a>02108           $tmp = substr($text,$j+1,$k-$j-1);
<a name="l02109"></a>02109           $b1 = strpos($tmp,<span class="charliteral">&#39;:&#39;</span>);
<a name="l02110"></a>02110           <span class="keywordflow">if</span> ($b1!==<span class="keyword">false</span>){
<a name="l02111"></a>02111             $func = substr($tmp,0,$b1);
<a name="l02112"></a>02112             $parm = substr($tmp,$b1+1);
<a name="l02113"></a>02113           } <span class="keywordflow">else</span> {
<a name="l02114"></a>02114             $func=$tmp;
<a name="l02115"></a>02115             $parm=<span class="stringliteral">&#39;&#39;</span>;
<a name="l02116"></a>02116           }
<a name="l02117"></a>02117           <span class="keywordflow">if</span> (!isset($func) || !strlen(trim($func))){
<a name="l02118"></a>02118             $directive=0;
<a name="l02119"></a>02119           } <span class="keywordflow">else</span> {
<a name="l02120"></a>02120             <span class="comment">// only call the function if this is the final call, ie, the one actually doing printing, not measurement</span>
<a name="l02121"></a>02121             <span class="keywordflow">if</span> ($final){
<a name="l02122"></a>02122               <span class="comment">// need to assess the text position, calculate the text width to this point</span>
<a name="l02123"></a>02123               <span class="comment">// can use getTextWidth to find the text width I think</span>
<a name="l02124"></a>02124               <span class="comment">// also add the text height and decender</span>
<a name="l02125"></a>02125               $tmp = $this-&gt;<a class="code" href="class_cpdf.html#ada9e29ddfcdecb498a13811a03bf0716">PRVTgetTextPosition</a>($x,$y,$angle,$size,<a class="code" href="class_cpdf.html#a32de4c103af0783f44fd568d74c6454b">$wordSpaceAdjust</a>,substr($text,0,$i));
<a name="l02126"></a>02126               $info = array(<span class="charliteral">&#39;x&#39;</span>=&gt;$tmp[0],<span class="charliteral">&#39;y&#39;</span>=&gt;$tmp[1],<span class="stringliteral">&#39;angle&#39;</span>=&gt;$angle,<span class="stringliteral">&#39;status&#39;</span>=&gt;<span class="stringliteral">&#39;start&#39;</span>,<span class="charliteral">&#39;p&#39;</span>=&gt;$parm,<span class="charliteral">&#39;f&#39;</span>=&gt;$func,<span class="stringliteral">&#39;height&#39;</span>=&gt;$this-&gt;<a class="code" href="class_cpdf.html#a6beae3dc84460fede62c6a0ca8861277">getFontHeight</a>($size),<span class="stringliteral">&#39;decender&#39;</span>=&gt;$this-&gt;<a class="code" href="class_cpdf.html#adedb392d14ce7963b05c5ca389181699">getFontDecender</a>($size));
<a name="l02127"></a>02127               $x=$tmp[0];
<a name="l02128"></a>02128               $y=$tmp[1];
<a name="l02129"></a>02129               <span class="keywordflow">if</span> (!isset($noClose) || !$noClose){
<a name="l02130"></a>02130                 <span class="comment">// only add to the stack if this is a small &#39;c&#39;, therefore is a start-stop pair</span>
<a name="l02131"></a>02131                 $this-&gt;nCallback++;
<a name="l02132"></a>02132                 $info[<span class="stringliteral">&#39;nCallback&#39;</span>]=$this-&gt;nCallback;
<a name="l02133"></a>02133                 $this-&gt;callback[$this-&gt;nCallback]=$info;
<a name="l02134"></a>02134               }
<a name="l02135"></a>02135               <a class="code" href="administration_2lists_2data__create_8ejs_8php.html#affd9e3eb0aad0a7ca42912cd925f148c">$ret</a> = $this-&gt;$func($info);
<a name="l02136"></a>02136               <span class="keywordflow">if</span> (is_array(<a class="code" href="administration_2lists_2data__create_8ejs_8php.html#affd9e3eb0aad0a7ca42912cd925f148c">$ret</a>)){
<a name="l02137"></a>02137                 <span class="comment">// then the return from the callback function could set the position, to start with, later will do font colour, and font</span>
<a name="l02138"></a>02138                 <span class="keywordflow">foreach</span>(<a class="code" href="administration_2lists_2data__create_8ejs_8php.html#affd9e3eb0aad0a7ca42912cd925f148c">$ret</a> as $rk=&gt;$rv){
<a name="l02139"></a>02139                   <span class="keywordflow">switch</span>($rk){
<a name="l02140"></a>02140                     <span class="keywordflow">case</span> <span class="charliteral">&#39;x&#39;</span>:
<a name="l02141"></a>02141                     <span class="keywordflow">case</span> <span class="charliteral">&#39;y&#39;</span>:
<a name="l02142"></a>02142                       $$rk=$rv;
<a name="l02143"></a>02143                       <span class="keywordflow">break</span>;
<a name="l02144"></a>02144                   }
<a name="l02145"></a>02145                 }
<a name="l02146"></a>02146               }
<a name="l02147"></a>02147             }
<a name="l02148"></a>02148           }
<a name="l02149"></a>02149         }
<a name="l02150"></a>02150         <span class="keywordflow">break</span>;
<a name="l02151"></a>02151     }
<a name="l02152"></a>02152   } 
<a name="l02153"></a>02153   <span class="keywordflow">return</span> $directive;
<a name="l02154"></a>02154 }
<a name="l02155"></a>02155 
<a name="l02159"></a><a class="code" href="class_cpdf.html#a3f30e13975f37e15fbbfe69595cb3731">02159</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a3f30e13975f37e15fbbfe69595cb3731">addText</a>($x,$y,$size,$text,$angle=0,<a class="code" href="class_cpdf.html#a32de4c103af0783f44fd568d74c6454b">$wordSpaceAdjust</a>=0){
<a name="l02160"></a>02160   <span class="keywordflow">if</span> (!$this-&gt;numFonts){$this-&gt;<a class="code" href="class_cpdf.html#a51b2f9f1095c23b3b75a8f7bf4a04533">selectFont</a>(<span class="stringliteral">&#39;./fonts/Helvetica&#39;</span>);}
<a name="l02161"></a>02161 
<a name="l02162"></a>02162   <span class="comment">// if there are any open callbacks, then they should be called, to show the start of the line</span>
<a name="l02163"></a>02163   <span class="keywordflow">if</span> ($this-&gt;nCallback&gt;0){
<a name="l02164"></a>02164     <span class="keywordflow">for</span> ($i=$this-&gt;nCallback;$i&gt;0;$i--){
<a name="l02165"></a>02165       <span class="comment">// call each function</span>
<a name="l02166"></a>02166       $info = array(<span class="charliteral">&#39;x&#39;</span>=&gt;$x,<span class="charliteral">&#39;y&#39;</span>=&gt;$y,<span class="stringliteral">&#39;angle&#39;</span>=&gt;$angle,<span class="stringliteral">&#39;status&#39;</span>=&gt;<span class="stringliteral">&#39;sol&#39;</span>,<span class="charliteral">&#39;p&#39;</span>=&gt;$this-&gt;callback[$i][<span class="charliteral">&#39;p&#39;</span>],<span class="stringliteral">&#39;nCallback&#39;</span>=&gt;$this-&gt;callback[$i][<span class="stringliteral">&#39;nCallback&#39;</span>],<span class="stringliteral">&#39;height&#39;</span>=&gt;$this-&gt;callback[$i][<span class="stringliteral">&#39;height&#39;</span>],<span class="stringliteral">&#39;decender&#39;</span>=&gt;$this-&gt;callback[$i][<span class="stringliteral">&#39;decender&#39;</span>]);
<a name="l02167"></a>02167       $func = $this-&gt;callback[$i][<span class="charliteral">&#39;f&#39;</span>];
<a name="l02168"></a>02168       $this-&gt;$func($info);
<a name="l02169"></a>02169     }
<a name="l02170"></a>02170   }
<a name="l02171"></a>02171   <span class="keywordflow">if</span> ($angle==0){
<a name="l02172"></a>02172     $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&quot;\n&quot;</span>.<span class="stringliteral">&#39;BT &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$x).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$y).<span class="stringliteral">&#39; Td&#39;</span>;
<a name="l02173"></a>02173   } <span class="keywordflow">else</span> {
<a name="l02174"></a>02174     <a class="code" href="phpdoc_8inc.html#acebf83966ef6d7e5645a6b62ba368f9f">$a</a> = deg2rad((<span class="keywordtype">float</span>)$angle);
<a name="l02175"></a>02175     $tmp = <span class="stringliteral">&quot;\n&quot;</span>.<span class="stringliteral">&#39;BT &#39;</span>;
<a name="l02176"></a>02176     $tmp .= sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,cos(<a class="code" href="phpdoc_8inc.html#acebf83966ef6d7e5645a6b62ba368f9f">$a</a>)).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,(-1.0*sin(<a class="code" href="phpdoc_8inc.html#acebf83966ef6d7e5645a6b62ba368f9f">$a</a>))).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,sin(<a class="code" href="phpdoc_8inc.html#acebf83966ef6d7e5645a6b62ba368f9f">$a</a>)).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,cos(<a class="code" href="phpdoc_8inc.html#acebf83966ef6d7e5645a6b62ba368f9f">$a</a>)).<span class="charliteral">&#39; &#39;</span>;
<a name="l02177"></a>02177     $tmp .= sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$x).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$y).<span class="stringliteral">&#39; Tm&#39;</span>;
<a name="l02178"></a>02178     $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>] .= $tmp;
<a name="l02179"></a>02179   }
<a name="l02180"></a>02180   <span class="keywordflow">if</span> (<a class="code" href="class_cpdf.html#a32de4c103af0783f44fd568d74c6454b">$wordSpaceAdjust</a>!=0 || <a class="code" href="class_cpdf.html#a32de4c103af0783f44fd568d74c6454b">$wordSpaceAdjust</a> != $this-&gt;wordSpaceAdjust){
<a name="l02181"></a>02181     $this-&gt;wordSpaceAdjust=<a class="code" href="class_cpdf.html#a32de4c103af0783f44fd568d74c6454b">$wordSpaceAdjust</a>;
<a name="l02182"></a>02182     $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,<a class="code" href="class_cpdf.html#a32de4c103af0783f44fd568d74c6454b">$wordSpaceAdjust</a>).<span class="stringliteral">&#39; Tw&#39;</span>;
<a name="l02183"></a>02183   }
<a name="l02184"></a>02184   $len=strlen($text);
<a name="l02185"></a>02185   <a class="code" href="administration_2lists_2data_8php.html#a50a00e7de77365e00b117e73aa82fb9b">$start</a>=0;
<a name="l02186"></a>02186   <span class="keywordflow">for</span> ($i=0;$i&lt;$len;$i++){
<a name="l02187"></a>02187     $f=1;
<a name="l02188"></a>02188     $directive = $this-&gt;<a class="code" href="class_cpdf.html#a74a8799ea1bd2492c8f166c99ab8c588">PRVTcheckTextDirective</a>($text,$i,$f);
<a name="l02189"></a>02189     <span class="keywordflow">if</span> ($directive){
<a name="l02190"></a>02190       <span class="comment">// then we should write what we need to</span>
<a name="l02191"></a>02191       <span class="keywordflow">if</span> ($i&gt;<a class="code" href="administration_2lists_2data_8php.html#a50a00e7de77365e00b117e73aa82fb9b">$start</a>){
<a name="l02192"></a>02192         $part = substr($text,<a class="code" href="administration_2lists_2data_8php.html#a50a00e7de77365e00b117e73aa82fb9b">$start</a>,$i-<a class="code" href="administration_2lists_2data_8php.html#a50a00e7de77365e00b117e73aa82fb9b">$start</a>);
<a name="l02193"></a>02193         $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&#39; /F&#39;</span>.$this-&gt;currentFontNum.<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.1f&#39;</span>,$size).<span class="stringliteral">&#39; Tf &#39;</span>;
<a name="l02194"></a>02194         $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&#39; (&#39;</span>.$this-&gt;filterText($part).<span class="stringliteral">&#39;) Tj&#39;</span>;
<a name="l02195"></a>02195       }
<a name="l02196"></a>02196       <span class="keywordflow">if</span> ($f){
<a name="l02197"></a>02197         <span class="comment">// then there was nothing drastic done here, restore the contents</span>
<a name="l02198"></a>02198         $this-&gt;<a class="code" href="class_cpdf.html#a7c32053581b4a1c223a8c924bdd888d6">setCurrentFont</a>();
<a name="l02199"></a>02199       } <span class="keywordflow">else</span> {
<a name="l02200"></a>02200         $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>] .= <span class="stringliteral">&#39; ET&#39;</span>;
<a name="l02201"></a>02201         $f=1;
<a name="l02202"></a>02202         $xp=$x;
<a name="l02203"></a>02203         $yp=$y;
<a name="l02204"></a>02204         $directive = $this-&gt;<a class="code" href="class_cpdf.html#a0431a00e90c0a4cb96e22e9af5c92927">PRVTcheckTextDirective1</a>($text,$i,$f,1,$xp,$yp,$size,$angle,<a class="code" href="class_cpdf.html#a32de4c103af0783f44fd568d74c6454b">$wordSpaceAdjust</a>);
<a name="l02205"></a>02205         
<a name="l02206"></a>02206         <span class="comment">// restart the text object</span>
<a name="l02207"></a>02207           <span class="keywordflow">if</span> ($angle==0){
<a name="l02208"></a>02208             $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&quot;\n&quot;</span>.<span class="stringliteral">&#39;BT &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$xp).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$yp).<span class="stringliteral">&#39; Td&#39;</span>;
<a name="l02209"></a>02209           } <span class="keywordflow">else</span> {
<a name="l02210"></a>02210             <a class="code" href="phpdoc_8inc.html#acebf83966ef6d7e5645a6b62ba368f9f">$a</a> = deg2rad((<span class="keywordtype">float</span>)$angle);
<a name="l02211"></a>02211             $tmp = <span class="stringliteral">&quot;\n&quot;</span>.<span class="stringliteral">&#39;BT &#39;</span>;
<a name="l02212"></a>02212             $tmp .= sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,cos(<a class="code" href="phpdoc_8inc.html#acebf83966ef6d7e5645a6b62ba368f9f">$a</a>)).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,(-1.0*sin(<a class="code" href="phpdoc_8inc.html#acebf83966ef6d7e5645a6b62ba368f9f">$a</a>))).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,sin(<a class="code" href="phpdoc_8inc.html#acebf83966ef6d7e5645a6b62ba368f9f">$a</a>)).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,cos(<a class="code" href="phpdoc_8inc.html#acebf83966ef6d7e5645a6b62ba368f9f">$a</a>)).<span class="charliteral">&#39; &#39;</span>;
<a name="l02213"></a>02213             $tmp .= sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$xp).<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$yp).<span class="stringliteral">&#39; Tm&#39;</span>;
<a name="l02214"></a>02214             $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>] .= $tmp;
<a name="l02215"></a>02215           }
<a name="l02216"></a>02216           <span class="keywordflow">if</span> (<a class="code" href="class_cpdf.html#a32de4c103af0783f44fd568d74c6454b">$wordSpaceAdjust</a>!=0 || <a class="code" href="class_cpdf.html#a32de4c103af0783f44fd568d74c6454b">$wordSpaceAdjust</a> != $this-&gt;wordSpaceAdjust){
<a name="l02217"></a>02217             $this-&gt;wordSpaceAdjust=<a class="code" href="class_cpdf.html#a32de4c103af0783f44fd568d74c6454b">$wordSpaceAdjust</a>;
<a name="l02218"></a>02218             $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,<a class="code" href="class_cpdf.html#a32de4c103af0783f44fd568d74c6454b">$wordSpaceAdjust</a>).<span class="stringliteral">&#39; Tw&#39;</span>;
<a name="l02219"></a>02219           }
<a name="l02220"></a>02220       }
<a name="l02221"></a>02221       <span class="comment">// and move the writing point to the next piece of text</span>
<a name="l02222"></a>02222       $i=$i+$directive-1;
<a name="l02223"></a>02223       <a class="code" href="administration_2lists_2data_8php.html#a50a00e7de77365e00b117e73aa82fb9b">$start</a>=$i+1;
<a name="l02224"></a>02224     }
<a name="l02225"></a>02225     
<a name="l02226"></a>02226   }
<a name="l02227"></a>02227   <span class="keywordflow">if</span> (<a class="code" href="administration_2lists_2data_8php.html#a50a00e7de77365e00b117e73aa82fb9b">$start</a>&lt;$len){
<a name="l02228"></a>02228     $part = substr($text,<a class="code" href="administration_2lists_2data_8php.html#a50a00e7de77365e00b117e73aa82fb9b">$start</a>);
<a name="l02229"></a>02229     $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&#39; /F&#39;</span>.$this-&gt;currentFontNum.<span class="charliteral">&#39; &#39;</span>.sprintf(<span class="stringliteral">&#39;%.1f&#39;</span>,$size).<span class="stringliteral">&#39; Tf &#39;</span>;
<a name="l02230"></a>02230     $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&#39; (&#39;</span>.$this-&gt;filterText($part).<span class="stringliteral">&#39;) Tj&#39;</span>;
<a name="l02231"></a>02231   }
<a name="l02232"></a>02232   $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&#39; ET&#39;</span>;
<a name="l02233"></a>02233 
<a name="l02234"></a>02234   <span class="comment">// if there are any open callbacks, then they should be called, to show the end of the line</span>
<a name="l02235"></a>02235   <span class="keywordflow">if</span> ($this-&gt;nCallback&gt;0){
<a name="l02236"></a>02236     <span class="keywordflow">for</span> ($i=$this-&gt;nCallback;$i&gt;0;$i--){
<a name="l02237"></a>02237       <span class="comment">// call each function</span>
<a name="l02238"></a>02238       $tmp = $this-&gt;<a class="code" href="class_cpdf.html#ada9e29ddfcdecb498a13811a03bf0716">PRVTgetTextPosition</a>($x,$y,$angle,$size,<a class="code" href="class_cpdf.html#a32de4c103af0783f44fd568d74c6454b">$wordSpaceAdjust</a>,$text);
<a name="l02239"></a>02239       $info = array(<span class="charliteral">&#39;x&#39;</span>=&gt;$tmp[0],<span class="charliteral">&#39;y&#39;</span>=&gt;$tmp[1],<span class="stringliteral">&#39;angle&#39;</span>=&gt;$angle,<span class="stringliteral">&#39;status&#39;</span>=&gt;<span class="stringliteral">&#39;eol&#39;</span>,<span class="charliteral">&#39;p&#39;</span>=&gt;$this-&gt;callback[$i][<span class="charliteral">&#39;p&#39;</span>],<span class="stringliteral">&#39;nCallback&#39;</span>=&gt;$this-&gt;callback[$i][<span class="stringliteral">&#39;nCallback&#39;</span>],<span class="stringliteral">&#39;height&#39;</span>=&gt;$this-&gt;callback[$i][<span class="stringliteral">&#39;height&#39;</span>],<span class="stringliteral">&#39;decender&#39;</span>=&gt;$this-&gt;callback[$i][<span class="stringliteral">&#39;decender&#39;</span>]);
<a name="l02240"></a>02240       $func = $this-&gt;callback[$i][<span class="charliteral">&#39;f&#39;</span>];
<a name="l02241"></a>02241       $this-&gt;$func($info);
<a name="l02242"></a>02242     }
<a name="l02243"></a>02243   }
<a name="l02244"></a>02244 
<a name="l02245"></a>02245 }
<a name="l02246"></a>02246 
<a name="l02251"></a><a class="code" href="class_cpdf.html#af92fe5c611b3feeafd3282ace477345f">02251</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#af92fe5c611b3feeafd3282ace477345f">getTextWidth</a>($size,$text){
<a name="l02252"></a>02252   <span class="comment">// this function should not change any of the settings, though it will need to</span>
<a name="l02253"></a>02253   <span class="comment">// track any directives which change during calculation, so copy them at the start</span>
<a name="l02254"></a>02254   <span class="comment">// and put them back at the end.</span>
<a name="l02255"></a>02255   $store_currentTextState = $this-&gt;currentTextState;
<a name="l02256"></a>02256 
<a name="l02257"></a>02257   <span class="keywordflow">if</span> (!$this-&gt;numFonts){
<a name="l02258"></a>02258     $this-&gt;<a class="code" href="class_cpdf.html#a51b2f9f1095c23b3b75a8f7bf4a04533">selectFont</a>(<span class="stringliteral">&#39;./fonts/Helvetica&#39;</span>);
<a name="l02259"></a>02259   }
<a name="l02260"></a>02260 
<a name="l02261"></a>02261   <span class="comment">// converts a number or a float to a string so it can get the width</span>
<a name="l02262"></a>02262   $text = <span class="stringliteral">&quot;$text&quot;</span>;
<a name="l02263"></a>02263 
<a name="l02264"></a>02264   <span class="comment">// hmm, this is where it all starts to get tricky - use the font information to</span>
<a name="l02265"></a>02265   <span class="comment">// calculate the width of each character, add them up and convert to user units</span>
<a name="l02266"></a>02266   $w=0;
<a name="l02267"></a>02267   $len=strlen($text);
<a name="l02268"></a>02268   $cf = $this-&gt;currentFont;
<a name="l02269"></a>02269   <span class="keywordflow">for</span> ($i=0;$i&lt;$len;$i++){
<a name="l02270"></a>02270     $f=1;
<a name="l02271"></a>02271     $directive = $this-&gt;<a class="code" href="class_cpdf.html#a74a8799ea1bd2492c8f166c99ab8c588">PRVTcheckTextDirective</a>($text,$i,$f);
<a name="l02272"></a>02272     <span class="keywordflow">if</span> ($directive){
<a name="l02273"></a>02273       <span class="keywordflow">if</span> ($f){
<a name="l02274"></a>02274         $this-&gt;<a class="code" href="class_cpdf.html#a7c32053581b4a1c223a8c924bdd888d6">setCurrentFont</a>();
<a name="l02275"></a>02275         $cf = $this-&gt;currentFont;
<a name="l02276"></a>02276       }
<a name="l02277"></a>02277       $i=$i+$directive-1;
<a name="l02278"></a>02278     } <span class="keywordflow">else</span> {
<a name="l02279"></a>02279       $char=ord($text[$i]);
<a name="l02280"></a>02280       <span class="keywordflow">if</span> (isset($this-&gt;fonts[$cf][<span class="stringliteral">&#39;differences&#39;</span>][$char])){
<a name="l02281"></a>02281         <span class="comment">// then this character is being replaced by another</span>
<a name="l02282"></a>02282         $name = $this-&gt;fonts[$cf][<span class="stringliteral">&#39;differences&#39;</span>][$char];
<a name="l02283"></a>02283         <span class="keywordflow">if</span> (isset($this-&gt;fonts[$cf][<span class="charliteral">&#39;C&#39;</span>][$name][<span class="stringliteral">&#39;WX&#39;</span>])){
<a name="l02284"></a>02284           $w+=$this-&gt;fonts[$cf][<span class="charliteral">&#39;C&#39;</span>][$name][<span class="stringliteral">&#39;WX&#39;</span>];
<a name="l02285"></a>02285         }
<a name="l02286"></a>02286       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isset($this-&gt;fonts[$cf][<span class="charliteral">&#39;C&#39;</span>][$char][<span class="stringliteral">&#39;WX&#39;</span>])){
<a name="l02287"></a>02287         $w+=$this-&gt;fonts[$cf][<span class="charliteral">&#39;C&#39;</span>][$char][<span class="stringliteral">&#39;WX&#39;</span>];
<a name="l02288"></a>02288       }
<a name="l02289"></a>02289     }
<a name="l02290"></a>02290   }
<a name="l02291"></a>02291   
<a name="l02292"></a>02292   $this-&gt;currentTextState = $store_currentTextState;
<a name="l02293"></a>02293   $this-&gt;<a class="code" href="class_cpdf.html#a7c32053581b4a1c223a8c924bdd888d6">setCurrentFont</a>();
<a name="l02294"></a>02294 
<a name="l02295"></a>02295   <span class="keywordflow">return</span> $w*$size/1000;
<a name="l02296"></a>02296 }
<a name="l02297"></a>02297 
<a name="l02303"></a><a class="code" href="class_cpdf.html#aa809699a6b3919f44b4d62e5f685dc8e">02303</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#aa809699a6b3919f44b4d62e5f685dc8e">PRVTadjustWrapText</a>($text,$actual,$width,&amp;$x,&amp;$adjust,$justification){
<a name="l02304"></a>02304   <span class="keywordflow">switch</span> ($justification){
<a name="l02305"></a>02305     <span class="keywordflow">case</span> <span class="stringliteral">&#39;left&#39;</span>:
<a name="l02306"></a>02306       <span class="keywordflow">return</span>;
<a name="l02307"></a>02307       <span class="keywordflow">break</span>;
<a name="l02308"></a>02308     <span class="keywordflow">case</span> <span class="stringliteral">&#39;right&#39;</span>:
<a name="l02309"></a>02309       $x+=$width-$actual;
<a name="l02310"></a>02310       <span class="keywordflow">break</span>;
<a name="l02311"></a>02311     <span class="keywordflow">case</span> <span class="stringliteral">&#39;center&#39;</span>:
<a name="l02312"></a>02312     <span class="keywordflow">case</span> <span class="stringliteral">&#39;centre&#39;</span>:
<a name="l02313"></a>02313       $x+=($width-$actual)/2;
<a name="l02314"></a>02314       <span class="keywordflow">break</span>;
<a name="l02315"></a>02315     <span class="keywordflow">case</span> <span class="stringliteral">&#39;full&#39;</span>:
<a name="l02316"></a>02316       <span class="comment">// count the number of words</span>
<a name="l02317"></a>02317       $words = explode(<span class="charliteral">&#39; &#39;</span>,$text);
<a name="l02318"></a>02318       $nspaces=count($words)-1;
<a name="l02319"></a>02319       <span class="keywordflow">if</span> ($nspaces&gt;0){
<a name="l02320"></a>02320         $adjust = ($width-$actual)/$nspaces;
<a name="l02321"></a>02321       } <span class="keywordflow">else</span> {
<a name="l02322"></a>02322         $adjust=0;
<a name="l02323"></a>02323       }
<a name="l02324"></a>02324       <span class="keywordflow">break</span>;
<a name="l02325"></a>02325   }
<a name="l02326"></a>02326 }
<a name="l02327"></a>02327 
<a name="l02334"></a><a class="code" href="class_cpdf.html#a3addbbcd4f33f737fa3210e38d7c3649">02334</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a3addbbcd4f33f737fa3210e38d7c3649">addTextWrap</a>($x,$y,$width,$size,$text,$justification=<span class="stringliteral">&#39;left&#39;</span>,$angle=0,<a class="code" href="actions_8php.html#a31daebf88fc668f410293e2c70cea3fc">$test</a>=0){
<a name="l02335"></a>02335   <span class="comment">// this will display the text, and if it goes beyond the width $width, will backtrack to the </span>
<a name="l02336"></a>02336   <span class="comment">// previous space or hyphen, and return the remainder of the text.</span>
<a name="l02337"></a>02337 
<a name="l02338"></a>02338   <span class="comment">// $justification can be set to &#39;left&#39;,&#39;right&#39;,&#39;center&#39;,&#39;centre&#39;,&#39;full&#39;</span>
<a name="l02339"></a>02339 
<a name="l02340"></a>02340   <span class="comment">// need to store the initial text state, as this will change during the width calculation</span>
<a name="l02341"></a>02341   <span class="comment">// but will need to be re-set before printing, so that the chars work out right</span>
<a name="l02342"></a>02342   $store_currentTextState = $this-&gt;currentTextState;
<a name="l02343"></a>02343 
<a name="l02344"></a>02344   <span class="keywordflow">if</span> (!$this-&gt;numFonts){$this-&gt;<a class="code" href="class_cpdf.html#a51b2f9f1095c23b3b75a8f7bf4a04533">selectFont</a>(<span class="stringliteral">&#39;./fonts/Helvetica&#39;</span>);}
<a name="l02345"></a>02345   <span class="keywordflow">if</span> ($width&lt;=0){
<a name="l02346"></a>02346     <span class="comment">// error, pretend it printed ok, otherwise risking a loop</span>
<a name="l02347"></a>02347     <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;
<a name="l02348"></a>02348   }
<a name="l02349"></a>02349   $w=0;
<a name="l02350"></a>02350   $break=0;
<a name="l02351"></a>02351   $breakWidth=0;
<a name="l02352"></a>02352   $len=strlen($text);
<a name="l02353"></a>02353   $cf = $this-&gt;currentFont;
<a name="l02354"></a>02354   $tw = $width/$size*1000;
<a name="l02355"></a>02355   <span class="keywordflow">for</span> ($i=0;$i&lt;$len;$i++){
<a name="l02356"></a>02356     $f=1;
<a name="l02357"></a>02357     $directive = $this-&gt;<a class="code" href="class_cpdf.html#a74a8799ea1bd2492c8f166c99ab8c588">PRVTcheckTextDirective</a>($text,$i,$f);
<a name="l02358"></a>02358     <span class="keywordflow">if</span> ($directive){
<a name="l02359"></a>02359       <span class="keywordflow">if</span> ($f){
<a name="l02360"></a>02360         $this-&gt;<a class="code" href="class_cpdf.html#a7c32053581b4a1c223a8c924bdd888d6">setCurrentFont</a>();
<a name="l02361"></a>02361         $cf = $this-&gt;currentFont;
<a name="l02362"></a>02362       }
<a name="l02363"></a>02363       $i=$i+$directive-1;
<a name="l02364"></a>02364     } <span class="keywordflow">else</span> {
<a name="l02365"></a>02365       $cOrd = ord($text[$i]);
<a name="l02366"></a>02366       <span class="keywordflow">if</span> (isset($this-&gt;fonts[$cf][<span class="stringliteral">&#39;differences&#39;</span>][$cOrd])){
<a name="l02367"></a>02367         <span class="comment">// then this character is being replaced by another</span>
<a name="l02368"></a>02368         $cOrd2 = $this-&gt;fonts[$cf][<span class="stringliteral">&#39;differences&#39;</span>][$cOrd];
<a name="l02369"></a>02369       } <span class="keywordflow">else</span> {
<a name="l02370"></a>02370         $cOrd2 = $cOrd;
<a name="l02371"></a>02371       }
<a name="l02372"></a>02372   
<a name="l02373"></a>02373       <span class="keywordflow">if</span> (isset($this-&gt;fonts[$cf][<span class="charliteral">&#39;C&#39;</span>][$cOrd2][<span class="stringliteral">&#39;WX&#39;</span>])){
<a name="l02374"></a>02374         $w+=$this-&gt;fonts[$cf][<span class="charliteral">&#39;C&#39;</span>][$cOrd2][<span class="stringliteral">&#39;WX&#39;</span>];
<a name="l02375"></a>02375       }
<a name="l02376"></a>02376       <span class="keywordflow">if</span> ($w&gt;$tw){
<a name="l02377"></a>02377         <span class="comment">// then we need to truncate this line</span>
<a name="l02378"></a>02378         <span class="keywordflow">if</span> ($break&gt;0){
<a name="l02379"></a>02379           <span class="comment">// then we have somewhere that we can split :)</span>
<a name="l02380"></a>02380           <span class="keywordflow">if</span> ($text[$break]==<span class="charliteral">&#39; &#39;</span>){
<a name="l02381"></a>02381             $tmp = substr($text,0,$break);
<a name="l02382"></a>02382           } <span class="keywordflow">else</span> {
<a name="l02383"></a>02383             $tmp = substr($text,0,$break+1);
<a name="l02384"></a>02384           }
<a name="l02385"></a>02385           $adjust=0;
<a name="l02386"></a>02386           $this-&gt;<a class="code" href="class_cpdf.html#aa809699a6b3919f44b4d62e5f685dc8e">PRVTadjustWrapText</a>($tmp,$breakWidth,$width,$x,$adjust,$justification);
<a name="l02387"></a>02387 
<a name="l02388"></a>02388           <span class="comment">// reset the text state</span>
<a name="l02389"></a>02389           $this-&gt;currentTextState = $store_currentTextState;
<a name="l02390"></a>02390           $this-&gt;<a class="code" href="class_cpdf.html#a7c32053581b4a1c223a8c924bdd888d6">setCurrentFont</a>();
<a name="l02391"></a>02391           <span class="keywordflow">if</span> (!<a class="code" href="actions_8php.html#a31daebf88fc668f410293e2c70cea3fc">$test</a>){
<a name="l02392"></a>02392             $this-&gt;<a class="code" href="class_cpdf.html#a3f30e13975f37e15fbbfe69595cb3731">addText</a>($x,$y,$size,$tmp,$angle,$adjust);
<a name="l02393"></a>02393           }
<a name="l02394"></a>02394           <span class="keywordflow">return</span> substr($text,$break+1);
<a name="l02395"></a>02395         } <span class="keywordflow">else</span> {
<a name="l02396"></a>02396           <span class="comment">// just split before the current character</span>
<a name="l02397"></a>02397           $tmp = substr($text,0,$i);
<a name="l02398"></a>02398           $adjust=0;
<a name="l02399"></a>02399           $ctmp=ord($text[$i]);
<a name="l02400"></a>02400           <span class="keywordflow">if</span> (isset($this-&gt;fonts[$cf][<span class="stringliteral">&#39;differences&#39;</span>][$ctmp])){
<a name="l02401"></a>02401             $ctmp=$this-&gt;fonts[$cf][<span class="stringliteral">&#39;differences&#39;</span>][$ctmp];
<a name="l02402"></a>02402           }
<a name="l02403"></a>02403           $tmpw=($w-$this-&gt;fonts[$cf][<span class="charliteral">&#39;C&#39;</span>][$ctmp][<span class="stringliteral">&#39;WX&#39;</span>])*$size/1000;
<a name="l02404"></a>02404           $this-&gt;<a class="code" href="class_cpdf.html#aa809699a6b3919f44b4d62e5f685dc8e">PRVTadjustWrapText</a>($tmp,$tmpw,$width,$x,$adjust,$justification);
<a name="l02405"></a>02405           <span class="comment">// reset the text state</span>
<a name="l02406"></a>02406           $this-&gt;currentTextState = $store_currentTextState;
<a name="l02407"></a>02407           $this-&gt;<a class="code" href="class_cpdf.html#a7c32053581b4a1c223a8c924bdd888d6">setCurrentFont</a>();
<a name="l02408"></a>02408           <span class="keywordflow">if</span> (!<a class="code" href="actions_8php.html#a31daebf88fc668f410293e2c70cea3fc">$test</a>){
<a name="l02409"></a>02409             $this-&gt;<a class="code" href="class_cpdf.html#a3f30e13975f37e15fbbfe69595cb3731">addText</a>($x,$y,$size,$tmp,$angle,$adjust);
<a name="l02410"></a>02410           }
<a name="l02411"></a>02411           <span class="keywordflow">return</span> substr($text,$i);
<a name="l02412"></a>02412         }
<a name="l02413"></a>02413       }
<a name="l02414"></a>02414       <span class="keywordflow">if</span> ($text[$i]==<span class="charliteral">&#39;-&#39;</span>){
<a name="l02415"></a>02415         $break=$i;
<a name="l02416"></a>02416         $breakWidth = $w*$size/1000;
<a name="l02417"></a>02417       }
<a name="l02418"></a>02418       <span class="keywordflow">if</span> ($text[$i]==<span class="charliteral">&#39; &#39;</span>){
<a name="l02419"></a>02419         $break=$i;
<a name="l02420"></a>02420         $ctmp=ord($text[$i]);
<a name="l02421"></a>02421         <span class="keywordflow">if</span> (isset($this-&gt;fonts[$cf][<span class="stringliteral">&#39;differences&#39;</span>][$ctmp])){
<a name="l02422"></a>02422           $ctmp=$this-&gt;fonts[$cf][<span class="stringliteral">&#39;differences&#39;</span>][$ctmp];
<a name="l02423"></a>02423         }
<a name="l02424"></a>02424         $breakWidth = ($w-$this-&gt;fonts[$cf][<span class="charliteral">&#39;C&#39;</span>][$ctmp][<span class="stringliteral">&#39;WX&#39;</span>])*$size/1000;
<a name="l02425"></a>02425       }
<a name="l02426"></a>02426     }
<a name="l02427"></a>02427   }
<a name="l02428"></a>02428   <span class="comment">// then there was no need to break this line</span>
<a name="l02429"></a>02429   <span class="keywordflow">if</span> ($justification==<span class="stringliteral">&#39;full&#39;</span>){
<a name="l02430"></a>02430     $justification=<span class="stringliteral">&#39;left&#39;</span>;
<a name="l02431"></a>02431   }
<a name="l02432"></a>02432   $adjust=0;
<a name="l02433"></a>02433   $tmpw=$w*$size/1000;
<a name="l02434"></a>02434   $this-&gt;<a class="code" href="class_cpdf.html#aa809699a6b3919f44b4d62e5f685dc8e">PRVTadjustWrapText</a>($text,$tmpw,$width,$x,$adjust,$justification);
<a name="l02435"></a>02435   <span class="comment">// reset the text state</span>
<a name="l02436"></a>02436   $this-&gt;currentTextState = $store_currentTextState;
<a name="l02437"></a>02437   $this-&gt;<a class="code" href="class_cpdf.html#a7c32053581b4a1c223a8c924bdd888d6">setCurrentFont</a>();
<a name="l02438"></a>02438   <span class="keywordflow">if</span> (!<a class="code" href="actions_8php.html#a31daebf88fc668f410293e2c70cea3fc">$test</a>){
<a name="l02439"></a>02439     $this-&gt;<a class="code" href="class_cpdf.html#a3f30e13975f37e15fbbfe69595cb3731">addText</a>($x,$y,$size,$text,$angle,$adjust,$angle);
<a name="l02440"></a>02440   }
<a name="l02441"></a>02441   <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;
<a name="l02442"></a>02442 }
<a name="l02443"></a>02443 
<a name="l02450"></a><a class="code" href="class_cpdf.html#a854f2a9d1250c69b6c2243d5175ddd83">02450</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a854f2a9d1250c69b6c2243d5175ddd83">saveState</a>($pageEnd=0){
<a name="l02451"></a>02451   <span class="keywordflow">if</span> ($pageEnd){
<a name="l02452"></a>02452     <span class="comment">// this will be called at a new page to return the state to what it was on the </span>
<a name="l02453"></a>02453     <span class="comment">// end of the previous page, before the stack was closed down</span>
<a name="l02454"></a>02454     <span class="comment">// This is to get around not being able to have open &#39;q&#39; across pages</span>
<a name="l02455"></a>02455     $opt = $this-&gt;stateStack[$pageEnd]; <span class="comment">// ok to use this as stack starts numbering at 1</span>
<a name="l02456"></a>02456     $this-&gt;<a class="code" href="class_cpdf.html#ad6873769b1aeb31e7acbc3be3de671a5">setColor</a>($opt[<span class="stringliteral">&#39;col&#39;</span>][<span class="charliteral">&#39;r&#39;</span>],$opt[<span class="stringliteral">&#39;col&#39;</span>][<span class="charliteral">&#39;g&#39;</span>],$opt[<span class="stringliteral">&#39;col&#39;</span>][<span class="charliteral">&#39;b&#39;</span>],1);
<a name="l02457"></a>02457     $this-&gt;<a class="code" href="class_cpdf.html#a8d3584e9eee400857cd917984d025db4">setStrokeColor</a>($opt[<span class="stringliteral">&#39;str&#39;</span>][<span class="charliteral">&#39;r&#39;</span>],$opt[<span class="stringliteral">&#39;str&#39;</span>][<span class="charliteral">&#39;g&#39;</span>],$opt[<span class="stringliteral">&#39;str&#39;</span>][<span class="charliteral">&#39;b&#39;</span>],1);
<a name="l02458"></a>02458     $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&quot;\n&quot;</span>.$opt[<span class="stringliteral">&#39;lin&#39;</span>];
<a name="l02459"></a>02459 <span class="comment">//    $this-&gt;currentLineStyle = $opt[&#39;lin&#39;];</span>
<a name="l02460"></a>02460   } <span class="keywordflow">else</span> {
<a name="l02461"></a>02461     $this-&gt;nStateStack++;
<a name="l02462"></a>02462     $this-&gt;stateStack[$this-&gt;nStateStack]=array(
<a name="l02463"></a>02463       <span class="stringliteral">&#39;col&#39;</span>=&gt;$this-&gt;currentColour
<a name="l02464"></a>02464      ,<span class="stringliteral">&#39;str&#39;</span>=&gt;$this-&gt;currentStrokeColour
<a name="l02465"></a>02465      ,<span class="stringliteral">&#39;lin&#39;</span>=&gt;$this-&gt;currentLineStyle
<a name="l02466"></a>02466     );
<a name="l02467"></a>02467   }
<a name="l02468"></a>02468   $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&quot;\nq&quot;</span>;
<a name="l02469"></a>02469 }
<a name="l02470"></a>02470 
<a name="l02474"></a><a class="code" href="class_cpdf.html#a2f42f38b51682f8457ee605bb3029dc4">02474</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a2f42f38b51682f8457ee605bb3029dc4">restoreState</a>($pageEnd=0){
<a name="l02475"></a>02475   <span class="keywordflow">if</span> (!$pageEnd){
<a name="l02476"></a>02476     $n = $this-&gt;nStateStack;
<a name="l02477"></a>02477     $this-&gt;currentColour = $this-&gt;stateStack[$n][<span class="stringliteral">&#39;col&#39;</span>];
<a name="l02478"></a>02478     $this-&gt;currentStrokeColour = $this-&gt;stateStack[$n][<span class="stringliteral">&#39;str&#39;</span>];
<a name="l02479"></a>02479     $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&quot;\n&quot;</span>.$this-&gt;stateStack[$n][<span class="stringliteral">&#39;lin&#39;</span>];
<a name="l02480"></a>02480     $this-&gt;currentLineStyle = $this-&gt;stateStack[$n][<span class="stringliteral">&#39;lin&#39;</span>];
<a name="l02481"></a>02481     unset($this-&gt;stateStack[$n]);
<a name="l02482"></a>02482     $this-&gt;nStateStack--;
<a name="l02483"></a>02483   }
<a name="l02484"></a>02484   $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&quot;\nQ&quot;</span>;
<a name="l02485"></a>02485 }
<a name="l02486"></a>02486 
<a name="l02493"></a><a class="code" href="class_cpdf.html#aa4a5e13c4e4e38cab679bef2100f5a1b">02493</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#aa4a5e13c4e4e38cab679bef2100f5a1b">openObject</a>(){
<a name="l02494"></a>02494   $this-&gt;nStack++;
<a name="l02495"></a>02495   $this-&gt;stack[$this-&gt;nStack]=array(<span class="charliteral">&#39;c&#39;</span>=&gt;$this-&gt;currentContents,<span class="charliteral">&#39;p&#39;</span>=&gt;$this-&gt;currentPage);
<a name="l02496"></a>02496   <span class="comment">// add a new object of the content type, to hold the data flow</span>
<a name="l02497"></a>02497   $this-&gt;numObj++;
<a name="l02498"></a>02498   $this-&gt;<a class="code" href="class_cpdf.html#ac8729d6b851615394c82bda391f37adb">o_contents</a>($this-&gt;numObj,<span class="stringliteral">&#39;new&#39;</span>);
<a name="l02499"></a>02499   $this-&gt;currentContents=$this-&gt;numObj;
<a name="l02500"></a>02500   $this-&gt;looseObjects[$this-&gt;numObj]=1;
<a name="l02501"></a>02501   
<a name="l02502"></a>02502   <span class="keywordflow">return</span> $this-&gt;numObj;
<a name="l02503"></a>02503 }
<a name="l02504"></a>02504 
<a name="l02508"></a><a class="code" href="class_cpdf.html#a42c738c855a15be14e5fe6b07834a6c5">02508</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a42c738c855a15be14e5fe6b07834a6c5">reopenObject</a>($id){
<a name="l02509"></a>02509    $this-&gt;nStack++;
<a name="l02510"></a>02510    $this-&gt;stack[$this-&gt;nStack]=array(<span class="charliteral">&#39;c&#39;</span>=&gt;$this-&gt;currentContents,<span class="charliteral">&#39;p&#39;</span>=&gt;$this-&gt;currentPage);
<a name="l02511"></a>02511    $this-&gt;currentContents=$id;
<a name="l02512"></a>02512    <span class="comment">// also if this object is the primary contents for a page, then set the current page to its parent</span>
<a name="l02513"></a>02513    <span class="keywordflow">if</span> (isset($this-&gt;objects[$id][<span class="stringliteral">&#39;onPage&#39;</span>])){
<a name="l02514"></a>02514      $this-&gt;currentPage = $this-&gt;objects[$id][<span class="stringliteral">&#39;onPage&#39;</span>];
<a name="l02515"></a>02515    }
<a name="l02516"></a>02516 }
<a name="l02517"></a>02517 
<a name="l02521"></a><a class="code" href="class_cpdf.html#afab1d53fba022d6a3cfa2c7ce3168106">02521</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#afab1d53fba022d6a3cfa2c7ce3168106">closeObject</a>(){
<a name="l02522"></a>02522   <span class="comment">// close the object, as long as there was one open in the first place, which will be indicated by</span>
<a name="l02523"></a>02523   <span class="comment">// an objectId on the stack.</span>
<a name="l02524"></a>02524   <span class="keywordflow">if</span> ($this-&gt;nStack&gt;0){
<a name="l02525"></a>02525     $this-&gt;currentContents=$this-&gt;stack[$this-&gt;nStack][<span class="charliteral">&#39;c&#39;</span>];
<a name="l02526"></a>02526     $this-&gt;currentPage=$this-&gt;stack[$this-&gt;nStack][<span class="charliteral">&#39;p&#39;</span>];
<a name="l02527"></a>02527     $this-&gt;nStack--;
<a name="l02528"></a>02528     <span class="comment">// easier to probably not worry about removing the old entries, they will be overwritten</span>
<a name="l02529"></a>02529     <span class="comment">// if there are new ones.</span>
<a name="l02530"></a>02530   }
<a name="l02531"></a>02531 }
<a name="l02532"></a>02532 
<a name="l02536"></a><a class="code" href="class_cpdf.html#ae592038df692dd6d0cfca2f781e6b0ae">02536</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#ae592038df692dd6d0cfca2f781e6b0ae">stopObject</a>($id){
<a name="l02537"></a>02537   <span class="comment">// if an object has been appearing on pages up to now, then stop it, this page will</span>
<a name="l02538"></a>02538   <span class="comment">// be the last one that could contian it.</span>
<a name="l02539"></a>02539   <span class="keywordflow">if</span> (isset($this-&gt;addLooseObjects[$id])){
<a name="l02540"></a>02540     $this-&gt;addLooseObjects[$id]=<span class="stringliteral">&#39;&#39;</span>;
<a name="l02541"></a>02541   }
<a name="l02542"></a>02542 }
<a name="l02543"></a>02543 
<a name="l02547"></a><a class="code" href="class_cpdf.html#a61fb160b67eb6fae0fa444ba22ecb5e0">02547</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a61fb160b67eb6fae0fa444ba22ecb5e0">addObject</a>($id,<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>=<span class="stringliteral">&#39;add&#39;</span>){
<a name="l02548"></a>02548   <span class="comment">// add the specified object to the page</span>
<a name="l02549"></a>02549   <span class="keywordflow">if</span> (isset($this-&gt;looseObjects[$id]) &amp;&amp; $this-&gt;currentContents!=$id){
<a name="l02550"></a>02550     <span class="comment">// then it is a valid object, and it is not being added to itself</span>
<a name="l02551"></a>02551     <span class="keywordflow">switch</span>(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>){
<a name="l02552"></a>02552       <span class="keywordflow">case</span> <span class="stringliteral">&#39;all&#39;</span>:
<a name="l02553"></a>02553         <span class="comment">// then this object is to be added to this page (done in the next block) and </span>
<a name="l02554"></a>02554         <span class="comment">// all future new pages. </span>
<a name="l02555"></a>02555         $this-&gt;addLooseObjects[$id]=<span class="stringliteral">&#39;all&#39;</span>;
<a name="l02556"></a>02556       <span class="keywordflow">case</span> <span class="stringliteral">&#39;add&#39;</span>:
<a name="l02557"></a>02557         <span class="keywordflow">if</span> (isset($this-&gt;objects[$this-&gt;currentContents][<span class="stringliteral">&#39;onPage&#39;</span>])){
<a name="l02558"></a>02558           <span class="comment">// then the destination contents is the primary for the page</span>
<a name="l02559"></a>02559           <span class="comment">// (though this object is actually added to that page)</span>
<a name="l02560"></a>02560           $this-&gt;<a class="code" href="class_cpdf.html#aa8f8c9faae6d2ef10e350675dde97f8d">o_page</a>($this-&gt;objects[$this-&gt;currentContents][<span class="stringliteral">&#39;onPage&#39;</span>],<span class="stringliteral">&#39;content&#39;</span>,$id);
<a name="l02561"></a>02561         }
<a name="l02562"></a>02562         <span class="keywordflow">break</span>;
<a name="l02563"></a>02563       <span class="keywordflow">case</span> <span class="stringliteral">&#39;even&#39;</span>:
<a name="l02564"></a>02564         $this-&gt;addLooseObjects[$id]=<span class="stringliteral">&#39;even&#39;</span>;
<a name="l02565"></a>02565         $pageObjectId=$this-&gt;objects[$this-&gt;currentContents][<span class="stringliteral">&#39;onPage&#39;</span>];
<a name="l02566"></a>02566         <span class="keywordflow">if</span> ($this-&gt;objects[$pageObjectId][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;pageNum&#39;</span>]%2==0){
<a name="l02567"></a>02567           $this-&gt;<a class="code" href="class_cpdf.html#a61fb160b67eb6fae0fa444ba22ecb5e0">addObject</a>($id); <span class="comment">// hacky huh :)</span>
<a name="l02568"></a>02568         }
<a name="l02569"></a>02569         <span class="keywordflow">break</span>;
<a name="l02570"></a>02570       <span class="keywordflow">case</span> <span class="stringliteral">&#39;odd&#39;</span>:
<a name="l02571"></a>02571         $this-&gt;addLooseObjects[$id]=<span class="stringliteral">&#39;odd&#39;</span>;
<a name="l02572"></a>02572         $pageObjectId=$this-&gt;objects[$this-&gt;currentContents][<span class="stringliteral">&#39;onPage&#39;</span>];
<a name="l02573"></a>02573         <span class="keywordflow">if</span> ($this-&gt;objects[$pageObjectId][<span class="stringliteral">&#39;info&#39;</span>][<span class="stringliteral">&#39;pageNum&#39;</span>]%2==1){
<a name="l02574"></a>02574           $this-&gt;<a class="code" href="class_cpdf.html#a61fb160b67eb6fae0fa444ba22ecb5e0">addObject</a>($id); <span class="comment">// hacky huh :)</span>
<a name="l02575"></a>02575         }
<a name="l02576"></a>02576         <span class="keywordflow">break</span>;
<a name="l02577"></a>02577       <span class="keywordflow">case</span> <span class="stringliteral">&#39;next&#39;</span>:
<a name="l02578"></a>02578         $this-&gt;addLooseObjects[$id]=<span class="stringliteral">&#39;all&#39;</span>;
<a name="l02579"></a>02579         <span class="keywordflow">break</span>;
<a name="l02580"></a>02580       <span class="keywordflow">case</span> <span class="stringliteral">&#39;nexteven&#39;</span>:
<a name="l02581"></a>02581         $this-&gt;addLooseObjects[$id]=<span class="stringliteral">&#39;even&#39;</span>;
<a name="l02582"></a>02582         <span class="keywordflow">break</span>;
<a name="l02583"></a>02583       <span class="keywordflow">case</span> <span class="stringliteral">&#39;nextodd&#39;</span>:
<a name="l02584"></a>02584         $this-&gt;addLooseObjects[$id]=<span class="stringliteral">&#39;odd&#39;</span>;
<a name="l02585"></a>02585         <span class="keywordflow">break</span>;
<a name="l02586"></a>02586     }
<a name="l02587"></a>02587   }
<a name="l02588"></a>02588 }
<a name="l02589"></a>02589 
<a name="l02593"></a><a class="code" href="class_cpdf.html#a86a12337c5d465a21d8f8f998d12bf7d">02593</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a86a12337c5d465a21d8f8f998d12bf7d">addInfo</a>($label,$value=0){
<a name="l02594"></a>02594   <span class="comment">// this will only work if the label is one of the valid ones.</span>
<a name="l02595"></a>02595   <span class="comment">// modify this so that arrays can be passed as well.</span>
<a name="l02596"></a>02596   <span class="comment">// if $label is an array then assume that it is key=&gt;value pairs</span>
<a name="l02597"></a>02597   <span class="comment">// else assume that they are both scalar, anything else will probably error</span>
<a name="l02598"></a>02598   <span class="keywordflow">if</span> (is_array($label)){
<a name="l02599"></a>02599     <span class="keywordflow">foreach</span> ($label as $l=&gt;$v){
<a name="l02600"></a>02600       $this-&gt;<a class="code" href="class_cpdf.html#a1b15589e09e12f423f87d8ba3b1b1be4">o_info</a>($this-&gt;infoObject,$l,$v);
<a name="l02601"></a>02601     }
<a name="l02602"></a>02602   } <span class="keywordflow">else</span> {
<a name="l02603"></a>02603     $this-&gt;<a class="code" href="class_cpdf.html#a1b15589e09e12f423f87d8ba3b1b1be4">o_info</a>($this-&gt;infoObject,$label,$value);
<a name="l02604"></a>02604   }
<a name="l02605"></a>02605 }
<a name="l02606"></a>02606 
<a name="l02610"></a><a class="code" href="class_cpdf.html#abfa522165e81ef739cd49cf26ffab7ed">02610</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#abfa522165e81ef739cd49cf26ffab7ed">setPreferences</a>($label,$value=0){
<a name="l02611"></a>02611   <span class="comment">// this will only work if the label is one of the valid ones.</span>
<a name="l02612"></a>02612   <span class="keywordflow">if</span> (is_array($label)){
<a name="l02613"></a>02613     <span class="keywordflow">foreach</span> ($label as $l=&gt;$v){
<a name="l02614"></a>02614       $this-&gt;<a class="code" href="class_cpdf.html#ad5269fc1648ba039f9ab1d372b89aa55">o_catalog</a>($this-&gt;catalogId,<span class="stringliteral">&#39;viewerPreferences&#39;</span>,array($l=&gt;$v));
<a name="l02615"></a>02615     }
<a name="l02616"></a>02616   } <span class="keywordflow">else</span> {
<a name="l02617"></a>02617     $this-&gt;<a class="code" href="class_cpdf.html#ad5269fc1648ba039f9ab1d372b89aa55">o_catalog</a>($this-&gt;catalogId,<span class="stringliteral">&#39;viewerPreferences&#39;</span>,array($label=&gt;$value));
<a name="l02618"></a>02618   }
<a name="l02619"></a>02619 }
<a name="l02620"></a>02620 
<a name="l02626"></a><a class="code" href="class_cpdf.html#a92ee2fbcc0af6cfb8ad13c3ff171747b">02626</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a92ee2fbcc0af6cfb8ad13c3ff171747b">PRVT_getBytes</a>(&amp;<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>,$pos,$num){
<a name="l02627"></a>02627   <span class="comment">// return the integer represented by $num bytes from $pos within $data</span>
<a name="l02628"></a>02628   <a class="code" href="administration_2lists_2data__create_8ejs_8php.html#affd9e3eb0aad0a7ca42912cd925f148c">$ret</a>=0;
<a name="l02629"></a>02629   <span class="keywordflow">for</span> ($i=0;$i&lt;$num;$i++){
<a name="l02630"></a>02630     <a class="code" href="administration_2lists_2data__create_8ejs_8php.html#affd9e3eb0aad0a7ca42912cd925f148c">$ret</a>=<a class="code" href="administration_2lists_2data__create_8ejs_8php.html#affd9e3eb0aad0a7ca42912cd925f148c">$ret</a>*256;
<a name="l02631"></a>02631     <a class="code" href="administration_2lists_2data__create_8ejs_8php.html#affd9e3eb0aad0a7ca42912cd925f148c">$ret</a>+=ord(<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>[$pos+$i]);
<a name="l02632"></a>02632   }
<a name="l02633"></a>02633   <span class="keywordflow">return</span> <a class="code" href="administration_2lists_2data__create_8ejs_8php.html#affd9e3eb0aad0a7ca42912cd925f148c">$ret</a>;
<a name="l02634"></a>02634 }
<a name="l02635"></a>02635 
<a name="l02640"></a><a class="code" href="class_cpdf.html#a14d94ee9d3ce15f6f24b0b8950acf26a">02640</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a14d94ee9d3ce15f6f24b0b8950acf26a">addPngFromFile</a>(<a class="code" href="tokenizer__test_8php.html#aa1bfbd27060176201b271918dff57e8f">$file</a>,$x,$y,$w=0,$h=0){
<a name="l02641"></a>02641   <span class="comment">// read in a png file, interpret it, then add to the system</span>
<a name="l02642"></a>02642   $error=0;
<a name="l02643"></a>02643   $tmp = get_magic_quotes_runtime();
<a name="l02644"></a>02644   set_magic_quotes_runtime(0);
<a name="l02645"></a>02645   $fp = @fopen(<a class="code" href="tokenizer__test_8php.html#aa1bfbd27060176201b271918dff57e8f">$file</a>,<span class="stringliteral">&#39;rb&#39;</span>);
<a name="l02646"></a>02646   <span class="keywordflow">if</span> ($fp){
<a name="l02647"></a>02647     <a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>=<span class="stringliteral">&#39;&#39;</span>;
<a name="l02648"></a>02648     <span class="keywordflow">while</span>(!feof($fp)){
<a name="l02649"></a>02649       <a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a> .= fread($fp,1024);
<a name="l02650"></a>02650     }
<a name="l02651"></a>02651     fclose($fp);
<a name="l02652"></a>02652   } <span class="keywordflow">else</span> {
<a name="l02653"></a>02653     $error = 1;
<a name="l02654"></a>02654     $errormsg = <span class="stringliteral">&#39;trouble opening file: &#39;</span>.$file;
<a name="l02655"></a>02655   }
<a name="l02656"></a>02656   set_magic_quotes_runtime($tmp);
<a name="l02657"></a>02657   
<a name="l02658"></a>02658   <span class="keywordflow">if</span> (!$error){
<a name="l02659"></a>02659     $header = chr(137).chr(80).chr(78).chr(71).chr(13).chr(10).chr(26).chr(10);
<a name="l02660"></a>02660     <span class="keywordflow">if</span> (substr(<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>,0,8)!=$header){
<a name="l02661"></a>02661       $error=1;
<a name="l02662"></a>02662       $errormsg = <span class="stringliteral">&#39;this file does not have a valid header&#39;</span>;
<a name="l02663"></a>02663     }
<a name="l02664"></a>02664   }
<a name="l02665"></a>02665 
<a name="l02666"></a>02666   <span class="keywordflow">if</span> (!$error){
<a name="l02667"></a>02667     <span class="comment">// set pointer</span>
<a name="l02668"></a>02668     $p = 8;
<a name="l02669"></a>02669     $len = strlen(<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>);
<a name="l02670"></a>02670     <span class="comment">// cycle through the file, identifying chunks</span>
<a name="l02671"></a>02671     $haveHeader=0;
<a name="l02672"></a>02672     $info=array();
<a name="l02673"></a>02673     $idata=<span class="stringliteral">&#39;&#39;</span>;
<a name="l02674"></a>02674     $pdata=<span class="stringliteral">&#39;&#39;</span>;
<a name="l02675"></a>02675     <span class="keywordflow">while</span> ($p&lt;$len){
<a name="l02676"></a>02676       $chunkLen = $this-&gt;<a class="code" href="class_cpdf.html#a92ee2fbcc0af6cfb8ad13c3ff171747b">PRVT_getBytes</a>(<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>,$p,4);
<a name="l02677"></a>02677       $chunkType = substr(<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>,$p+4,4);
<a name="l02678"></a>02678 <span class="comment">//      echo $chunkType.&#39; - &#39;.$chunkLen.&#39;&lt;br&gt;&#39;;</span>
<a name="l02679"></a>02679     
<a name="l02680"></a>02680       <span class="keywordflow">switch</span>($chunkType){
<a name="l02681"></a>02681         <span class="keywordflow">case</span> <span class="stringliteral">&#39;IHDR&#39;</span>:
<a name="l02682"></a>02682           <span class="comment">// this is where all the file information comes from</span>
<a name="l02683"></a>02683           $info[<span class="stringliteral">&#39;width&#39;</span>]=$this-&gt;<a class="code" href="class_cpdf.html#a92ee2fbcc0af6cfb8ad13c3ff171747b">PRVT_getBytes</a>(<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>,$p+8,4);
<a name="l02684"></a>02684           $info[<span class="stringliteral">&#39;height&#39;</span>]=$this-&gt;<a class="code" href="class_cpdf.html#a92ee2fbcc0af6cfb8ad13c3ff171747b">PRVT_getBytes</a>(<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>,$p+12,4);
<a name="l02685"></a>02685           $info[<span class="stringliteral">&#39;bitDepth&#39;</span>]=ord(<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>[$p+16]);
<a name="l02686"></a>02686           $info[<span class="stringliteral">&#39;colorType&#39;</span>]=ord(<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>[$p+17]);
<a name="l02687"></a>02687           $info[<span class="stringliteral">&#39;compressionMethod&#39;</span>]=ord(<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>[$p+18]);
<a name="l02688"></a>02688           $info[<span class="stringliteral">&#39;filterMethod&#39;</span>]=ord(<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>[$p+19]);
<a name="l02689"></a>02689           $info[<span class="stringliteral">&#39;interlaceMethod&#39;</span>]=ord(<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>[$p+20]);
<a name="l02690"></a>02690 <span class="comment">//print_r($info);</span>
<a name="l02691"></a>02691           $haveHeader=1;
<a name="l02692"></a>02692           <span class="keywordflow">if</span> ($info[<span class="stringliteral">&#39;compressionMethod&#39;</span>]!=0){
<a name="l02693"></a>02693             $error=1;
<a name="l02694"></a>02694             $errormsg = <span class="stringliteral">&#39;unsupported compression method&#39;</span>;
<a name="l02695"></a>02695           }
<a name="l02696"></a>02696           <span class="keywordflow">if</span> ($info[<span class="stringliteral">&#39;filterMethod&#39;</span>]!=0){
<a name="l02697"></a>02697             $error=1;
<a name="l02698"></a>02698             $errormsg = <span class="stringliteral">&#39;unsupported filter method&#39;</span>;
<a name="l02699"></a>02699           }
<a name="l02700"></a>02700           <span class="keywordflow">break</span>;
<a name="l02701"></a>02701         <span class="keywordflow">case</span> <span class="stringliteral">&#39;PLTE&#39;</span>:
<a name="l02702"></a>02702           $pdata.=substr(<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>,$p+8,$chunkLen);
<a name="l02703"></a>02703           <span class="keywordflow">break</span>;
<a name="l02704"></a>02704         <span class="keywordflow">case</span> <span class="stringliteral">&#39;IDAT&#39;</span>:
<a name="l02705"></a>02705           $idata.=substr(<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>,$p+8,$chunkLen);
<a name="l02706"></a>02706           <span class="keywordflow">break</span>;
<a name="l02707"></a>02707         <span class="keywordflow">case</span> <span class="stringliteral">&#39;tRNS&#39;</span>: 
<a name="l02708"></a>02708           <span class="comment">//this chunk can only occur once and it must occur after the PLTE chunk and before IDAT chunk </span>
<a name="l02709"></a>02709           <span class="comment">//print &quot;tRNS found, color type = &quot;.$info[&#39;colorType&#39;].&quot;&lt;BR&gt;&quot;; </span>
<a name="l02710"></a>02710           $transparency = array();
<a name="l02711"></a>02711           <span class="keywordflow">if</span> ($info[<span class="stringliteral">&#39;colorType&#39;</span>] == 3) { <span class="comment">// indexed color, rbg </span>
<a name="l02712"></a>02712           <span class="comment">/* corresponding to entries in the plte chunk </span>
<a name="l02713"></a>02713 <span class="comment">          Alpha for palette index 0: 1 byte </span>
<a name="l02714"></a>02714 <span class="comment">          Alpha for palette index 1: 1 byte </span>
<a name="l02715"></a>02715 <span class="comment">          ...etc... </span>
<a name="l02716"></a>02716 <span class="comment">          */</span> 
<a name="l02717"></a>02717             <span class="comment">// there will be one entry for each palette entry. up until the last non-opaque entry.</span>
<a name="l02718"></a>02718             <span class="comment">// set up an array, stretching over all palette entries which will be o (opaque) or 1 (transparent)</span>
<a name="l02719"></a>02719             $transparency[<span class="stringliteral">&#39;type&#39;</span>]=<span class="stringliteral">&#39;indexed&#39;</span>;
<a name="l02720"></a>02720             $numPalette = strlen($pdata)/3;
<a name="l02721"></a>02721             $trans=0;
<a name="l02722"></a>02722             <span class="keywordflow">for</span> ($i=$chunkLen;$i&gt;=0;$i--){
<a name="l02723"></a>02723               <span class="keywordflow">if</span> (ord(<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>[$p+8+$i])==0){
<a name="l02724"></a>02724                 $trans=$i;
<a name="l02725"></a>02725               }
<a name="l02726"></a>02726             }
<a name="l02727"></a>02727             $transparency[<span class="stringliteral">&#39;data&#39;</span>] = $trans;
<a name="l02728"></a>02728             
<a name="l02729"></a>02729           } <a class="code" href="php_thumb_8demo_8check_8php.html#af92779326267616cd7c3cdaaa9484bc9">elseif</a>($info[<span class="stringliteral">&#39;colorType&#39;</span>] == 0) { <span class="comment">// grayscale </span>
<a name="l02730"></a>02730           <span class="comment">/* corresponding to entries in the plte chunk </span>
<a name="l02731"></a>02731 <span class="comment">          Gray: 2 bytes, range 0 .. (2^bitdepth)-1 </span>
<a name="l02732"></a>02732 <span class="comment">          */</span> 
<a name="l02733"></a>02733 <span class="comment">//            $transparency[&#39;grayscale&#39;]=$this-&gt;PRVT_getBytes($data,$p+8,2); // g = grayscale </span>
<a name="l02734"></a>02734             $transparency[<span class="stringliteral">&#39;type&#39;</span>]=<span class="stringliteral">&#39;indexed&#39;</span>;
<a name="l02735"></a>02735             $transparency[<span class="stringliteral">&#39;data&#39;</span>] = ord(<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>[$p+8+1]);
<a name="l02736"></a>02736           
<a name="l02737"></a>02737           } <a class="code" href="php_thumb_8demo_8check_8php.html#af92779326267616cd7c3cdaaa9484bc9">elseif</a>($info[<span class="stringliteral">&#39;colorType&#39;</span>] == 2) { <span class="comment">// truecolor </span>
<a name="l02738"></a>02738           <span class="comment">/* corresponding to entries in the plte chunk </span>
<a name="l02739"></a>02739 <span class="comment">          Red: 2 bytes, range 0 .. (2^bitdepth)-1 </span>
<a name="l02740"></a>02740 <span class="comment">          Green: 2 bytes, range 0 .. (2^bitdepth)-1 </span>
<a name="l02741"></a>02741 <span class="comment">          Blue: 2 bytes, range 0 .. (2^bitdepth)-1 </span>
<a name="l02742"></a>02742 <span class="comment">          */</span> 
<a name="l02743"></a>02743             $transparency[<span class="charliteral">&#39;r&#39;</span>]=$this-&gt;<a class="code" href="class_cpdf.html#a92ee2fbcc0af6cfb8ad13c3ff171747b">PRVT_getBytes</a>(<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>,$p+8,2); <span class="comment">// r from truecolor </span>
<a name="l02744"></a>02744             $transparency[<span class="charliteral">&#39;g&#39;</span>]=$this-&gt;<a class="code" href="class_cpdf.html#a92ee2fbcc0af6cfb8ad13c3ff171747b">PRVT_getBytes</a>(<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>,$p+10,2); <span class="comment">// g from truecolor </span>
<a name="l02745"></a>02745             $transparency[<span class="charliteral">&#39;b&#39;</span>]=$this-&gt;<a class="code" href="class_cpdf.html#a92ee2fbcc0af6cfb8ad13c3ff171747b">PRVT_getBytes</a>(<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>,$p+12,2); <span class="comment">// b from truecolor </span>
<a name="l02746"></a>02746           
<a name="l02747"></a>02747           } <span class="keywordflow">else</span> { 
<a name="l02748"></a>02748           <span class="comment">//unsupported transparency type </span>
<a name="l02749"></a>02749           } 
<a name="l02750"></a>02750           <span class="comment">// KS End new code </span>
<a name="l02751"></a>02751           <span class="keywordflow">break</span>; 
<a name="l02752"></a>02752         <span class="keywordflow">default</span>:
<a name="l02753"></a>02753           <span class="keywordflow">break</span>;
<a name="l02754"></a>02754       }
<a name="l02755"></a>02755     
<a name="l02756"></a>02756       $p += $chunkLen+12;
<a name="l02757"></a>02757     }
<a name="l02758"></a>02758     
<a name="l02759"></a>02759     <span class="keywordflow">if</span>(!$haveHeader){
<a name="l02760"></a>02760       $error = 1;
<a name="l02761"></a>02761       $errormsg = <span class="stringliteral">&#39;information header is missing&#39;</span>;
<a name="l02762"></a>02762     }
<a name="l02763"></a>02763     <span class="keywordflow">if</span> (isset($info[<span class="stringliteral">&#39;interlaceMethod&#39;</span>]) &amp;&amp; $info[<span class="stringliteral">&#39;interlaceMethod&#39;</span>]){
<a name="l02764"></a>02764       $error = 1;
<a name="l02765"></a>02765       $errormsg = <span class="stringliteral">&#39;There appears to be no support for interlaced images in pdf.&#39;</span>;
<a name="l02766"></a>02766     }
<a name="l02767"></a>02767   }
<a name="l02768"></a>02768 
<a name="l02769"></a>02769   <span class="keywordflow">if</span> (!$error &amp;&amp; $info[<span class="stringliteral">&#39;bitDepth&#39;</span>] &gt; 8){
<a name="l02770"></a>02770     $error = 1;
<a name="l02771"></a>02771     $errormsg = <span class="stringliteral">&#39;only bit depth of 8 or less is supported&#39;</span>;
<a name="l02772"></a>02772   }
<a name="l02773"></a>02773 
<a name="l02774"></a>02774   <span class="keywordflow">if</span> (!$error){
<a name="l02775"></a>02775     <span class="keywordflow">if</span> ($info[<span class="stringliteral">&#39;colorType&#39;</span>]!=2 &amp;&amp; $info[<span class="stringliteral">&#39;colorType&#39;</span>]!=0 &amp;&amp; $info[<span class="stringliteral">&#39;colorType&#39;</span>]!=3){
<a name="l02776"></a>02776       $error = 1;
<a name="l02777"></a>02777       $errormsg = <span class="stringliteral">&#39;transparancey alpha channel not supported, transparency only supported for palette images.&#39;</span>;
<a name="l02778"></a>02778     } <span class="keywordflow">else</span> {
<a name="l02779"></a>02779       <span class="keywordflow">switch</span> ($info[<span class="stringliteral">&#39;colorType&#39;</span>]){
<a name="l02780"></a>02780         <span class="keywordflow">case</span> 3:
<a name="l02781"></a>02781           $color = <span class="stringliteral">&#39;DeviceRGB&#39;</span>;
<a name="l02782"></a>02782           $ncolor=1;
<a name="l02783"></a>02783           <span class="keywordflow">break</span>;
<a name="l02784"></a>02784         <span class="keywordflow">case</span> 2:
<a name="l02785"></a>02785           $color = <span class="stringliteral">&#39;DeviceRGB&#39;</span>;
<a name="l02786"></a>02786           $ncolor=3;
<a name="l02787"></a>02787           <span class="keywordflow">break</span>;
<a name="l02788"></a>02788         <span class="keywordflow">case</span> 0:
<a name="l02789"></a>02789           $color = <span class="stringliteral">&#39;DeviceGray&#39;</span>;
<a name="l02790"></a>02790           $ncolor=1;
<a name="l02791"></a>02791           <span class="keywordflow">break</span>;
<a name="l02792"></a>02792       }
<a name="l02793"></a>02793     }
<a name="l02794"></a>02794   }
<a name="l02795"></a>02795   <span class="keywordflow">if</span> ($error){
<a name="l02796"></a>02796     $this-&gt;<a class="code" href="class_cpdf.html#a0fe60161c19f81f49f76a2dcb95d48e4">addMessage</a>(<span class="stringliteral">&#39;PNG error - (&#39;</span>.<a class="code" href="tokenizer__test_8php.html#aa1bfbd27060176201b271918dff57e8f">$file</a>.<span class="stringliteral">&#39;) &#39;</span>.$errormsg);
<a name="l02797"></a>02797     <span class="keywordflow">return</span>;
<a name="l02798"></a>02798   }
<a name="l02799"></a>02799   <span class="keywordflow">if</span> ($w==0){
<a name="l02800"></a>02800     $w=$h/$info[<span class="stringliteral">&#39;height&#39;</span>]*$info[<span class="stringliteral">&#39;width&#39;</span>];
<a name="l02801"></a>02801   }
<a name="l02802"></a>02802   <span class="keywordflow">if</span> ($h==0){
<a name="l02803"></a>02803     $h=$w*$info[<span class="stringliteral">&#39;height&#39;</span>]/$info[<span class="stringliteral">&#39;width&#39;</span>];
<a name="l02804"></a>02804   }
<a name="l02805"></a>02805 <span class="comment">//print_r($info);</span>
<a name="l02806"></a>02806   <span class="comment">// so this image is ok... add it in.</span>
<a name="l02807"></a>02807   $this-&gt;numImages++;
<a name="l02808"></a>02808   $im=$this-&gt;numImages;
<a name="l02809"></a>02809   $label=<span class="charliteral">&#39;I&#39;</span>.$im;
<a name="l02810"></a>02810   $this-&gt;numObj++;
<a name="l02811"></a>02811 <span class="comment">//  $this-&gt;o_image($this-&gt;numObj,&#39;new&#39;,array(&#39;label&#39;=&gt;$label,&#39;data&#39;=&gt;$idata,&#39;iw&#39;=&gt;$w,&#39;ih&#39;=&gt;$h,&#39;type&#39;=&gt;&#39;png&#39;,&#39;ic&#39;=&gt;$info[&#39;width&#39;]));</span>
<a name="l02812"></a>02812   <a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a> = array(<span class="stringliteral">&#39;label&#39;</span>=&gt;$label,<span class="stringliteral">&#39;data&#39;</span>=&gt;$idata,<span class="stringliteral">&#39;bitsPerComponent&#39;</span>=&gt;$info[<span class="stringliteral">&#39;bitDepth&#39;</span>],<span class="stringliteral">&#39;pdata&#39;</span>=&gt;$pdata
<a name="l02813"></a>02813                                       ,<span class="stringliteral">&#39;iw&#39;</span>=&gt;$info[<span class="stringliteral">&#39;width&#39;</span>],<span class="stringliteral">&#39;ih&#39;</span>=&gt;$info[<span class="stringliteral">&#39;height&#39;</span>],<span class="stringliteral">&#39;type&#39;</span>=&gt;<span class="stringliteral">&#39;png&#39;</span>,<span class="stringliteral">&#39;color&#39;</span>=&gt;$color,<span class="stringliteral">&#39;ncolor&#39;</span>=&gt;$ncolor);
<a name="l02814"></a>02814   <span class="keywordflow">if</span> (isset($transparency)){
<a name="l02815"></a>02815     <a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;transparency&#39;</span>]=$transparency;
<a name="l02816"></a>02816   }
<a name="l02817"></a>02817   $this-&gt;<a class="code" href="class_cpdf.html#ac2199fd5ae0ff08a49c57dc48cea87be">o_image</a>($this-&gt;numObj,<span class="stringliteral">&#39;new&#39;</span>,<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>);
<a name="l02818"></a>02818 
<a name="l02819"></a>02819   $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&quot;\nq&quot;</span>;
<a name="l02820"></a>02820   $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&quot;\n&quot;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$w).<span class="stringliteral">&quot; 0 0 &quot;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$h).<span class="stringliteral">&quot; &quot;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$x).<span class="stringliteral">&quot; &quot;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$y).<span class="stringliteral">&quot; cm&quot;</span>;
<a name="l02821"></a>02821   $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&quot;\n/&quot;</span>.$label.<span class="stringliteral">&#39; Do&#39;</span>;
<a name="l02822"></a>02822   $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&quot;\nQ&quot;</span>;
<a name="l02823"></a>02823 }
<a name="l02824"></a>02824 
<a name="l02828"></a><a class="code" href="class_cpdf.html#ad14d18b56e5418e5938c36e16aba551d">02828</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#ad14d18b56e5418e5938c36e16aba551d">addJpegFromFile</a>($img,$x,$y,$w=0,$h=0){
<a name="l02829"></a>02829   <span class="comment">// attempt to add a jpeg image straight from a file, using no GD commands</span>
<a name="l02830"></a>02830   <span class="comment">// note that this function is unable to operate on a remote file.</span>
<a name="l02831"></a>02831 
<a name="l02832"></a>02832   <span class="keywordflow">if</span> (!file_exists($img)){
<a name="l02833"></a>02833     <span class="keywordflow">return</span>;
<a name="l02834"></a>02834   }
<a name="l02835"></a>02835 
<a name="l02836"></a>02836   $tmp=getimagesize($img);
<a name="l02837"></a>02837   $imageWidth=$tmp[0];
<a name="l02838"></a>02838   $imageHeight=$tmp[1];
<a name="l02839"></a>02839 
<a name="l02840"></a>02840   <span class="keywordflow">if</span> (isset($tmp[<span class="stringliteral">&#39;channels&#39;</span>])){
<a name="l02841"></a>02841     $channels = $tmp[<span class="stringliteral">&#39;channels&#39;</span>];
<a name="l02842"></a>02842   } <span class="keywordflow">else</span> {
<a name="l02843"></a>02843     $channels = 3;
<a name="l02844"></a>02844   }
<a name="l02845"></a>02845 
<a name="l02846"></a>02846   <span class="keywordflow">if</span> ($w&lt;=0 &amp;&amp; $h&lt;=0){
<a name="l02847"></a>02847     $w=$imageWidth;
<a name="l02848"></a>02848   }
<a name="l02849"></a>02849   <span class="keywordflow">if</span> ($w==0){
<a name="l02850"></a>02850     $w=$h/$imageHeight*$imageWidth;
<a name="l02851"></a>02851   }
<a name="l02852"></a>02852   <span class="keywordflow">if</span> ($h==0){
<a name="l02853"></a>02853     $h=$w*$imageHeight/$imageWidth;
<a name="l02854"></a>02854   }
<a name="l02855"></a>02855 
<a name="l02856"></a>02856   $fp=fopen($img,<span class="stringliteral">&#39;rb&#39;</span>);
<a name="l02857"></a>02857 
<a name="l02858"></a>02858   $tmp = get_magic_quotes_runtime();
<a name="l02859"></a>02859   set_magic_quotes_runtime(0);
<a name="l02860"></a>02860   <a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a> = fread($fp,filesize($img));
<a name="l02861"></a>02861   set_magic_quotes_runtime($tmp);
<a name="l02862"></a>02862   
<a name="l02863"></a>02863   fclose($fp);
<a name="l02864"></a>02864 
<a name="l02865"></a>02865   $this-&gt;<a class="code" href="class_cpdf.html#aa5a35f03011edf15999be9ae1162d8d6">addJpegImage_common</a>(<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>,$x,$y,$w,$h,$imageWidth,$imageHeight,$channels);
<a name="l02866"></a>02866 }
<a name="l02867"></a>02867 
<a name="l02873"></a><a class="code" href="class_cpdf.html#a38148d27bd5f2fdd2b63c382991e03fa">02873</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a38148d27bd5f2fdd2b63c382991e03fa">addImage</a>(&amp;$img,$x,$y,$w=0,$h=0,$quality=75){
<a name="l02874"></a>02874   <span class="comment">// add a new image into the current location, as an external object</span>
<a name="l02875"></a>02875   <span class="comment">// add the image at $x,$y, and with width and height as defined by $w &amp; $h</span>
<a name="l02876"></a>02876   
<a name="l02877"></a>02877   <span class="comment">// note that this will only work with full colour images and makes them jpg images for display</span>
<a name="l02878"></a>02878   <span class="comment">// later versions could present lossless image formats if there is interest.</span>
<a name="l02879"></a>02879   
<a name="l02880"></a>02880   <span class="comment">// there seems to be some problem here in that images that have quality set above 75 do not appear</span>
<a name="l02881"></a>02881   <span class="comment">// not too sure why this is, but in the meantime I have restricted this to 75.  </span>
<a name="l02882"></a>02882   <span class="keywordflow">if</span> ($quality&gt;75){
<a name="l02883"></a>02883     $quality=75;
<a name="l02884"></a>02884   }
<a name="l02885"></a>02885 
<a name="l02886"></a>02886   <span class="comment">// if the width or height are set to zero, then set the other one based on keeping the image</span>
<a name="l02887"></a>02887   <span class="comment">// height/width ratio the same, if they are both zero, then give up :)</span>
<a name="l02888"></a>02888   $imageWidth=imagesx($img);
<a name="l02889"></a>02889   $imageHeight=imagesy($img);
<a name="l02890"></a>02890   
<a name="l02891"></a>02891   <span class="keywordflow">if</span> ($w&lt;=0 &amp;&amp; $h&lt;=0){
<a name="l02892"></a>02892     <span class="keywordflow">return</span>;
<a name="l02893"></a>02893   }
<a name="l02894"></a>02894   <span class="keywordflow">if</span> ($w==0){
<a name="l02895"></a>02895     $w=$h/$imageHeight*$imageWidth;
<a name="l02896"></a>02896   }
<a name="l02897"></a>02897   <span class="keywordflow">if</span> ($h==0){
<a name="l02898"></a>02898     $h=$w*$imageHeight/$imageWidth;
<a name="l02899"></a>02899   }
<a name="l02900"></a>02900   
<a name="l02901"></a>02901   <span class="comment">// gotta get the data out of the img..</span>
<a name="l02902"></a>02902 
<a name="l02903"></a>02903   <span class="comment">// so I write to a temp file, and then read it back.. soo ugly, my apologies.</span>
<a name="l02904"></a>02904   $tmpDir=<span class="stringliteral">&#39;/tmp&#39;</span>;
<a name="l02905"></a>02905   $tmpName=tempnam($tmpDir,<span class="stringliteral">&#39;img&#39;</span>);
<a name="l02906"></a>02906   imagejpeg($img,$tmpName,$quality);
<a name="l02907"></a>02907   $fp=fopen($tmpName,<span class="stringliteral">&#39;rb&#39;</span>);
<a name="l02908"></a>02908 
<a name="l02909"></a>02909   $tmp = get_magic_quotes_runtime();
<a name="l02910"></a>02910   set_magic_quotes_runtime(0);
<a name="l02911"></a>02911   $fp = @fopen($tmpName,<span class="stringliteral">&#39;rb&#39;</span>);
<a name="l02912"></a>02912   <span class="keywordflow">if</span> ($fp){
<a name="l02913"></a>02913     <a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>=<span class="stringliteral">&#39;&#39;</span>;
<a name="l02914"></a>02914     <span class="keywordflow">while</span>(!feof($fp)){
<a name="l02915"></a>02915       <a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a> .= fread($fp,1024);
<a name="l02916"></a>02916     }
<a name="l02917"></a>02917     fclose($fp);
<a name="l02918"></a>02918   } <span class="keywordflow">else</span> {
<a name="l02919"></a>02919     $error = 1;
<a name="l02920"></a>02920     $errormsg = <span class="stringliteral">&#39;trouble opening file&#39;</span>;
<a name="l02921"></a>02921   }
<a name="l02922"></a>02922 <span class="comment">//  $data = fread($fp,filesize($tmpName));</span>
<a name="l02923"></a>02923   set_magic_quotes_runtime($tmp);
<a name="l02924"></a>02924 <span class="comment">//  fclose($fp);</span>
<a name="l02925"></a>02925   unlink($tmpName);
<a name="l02926"></a>02926   $this-&gt;<a class="code" href="class_cpdf.html#aa5a35f03011edf15999be9ae1162d8d6">addJpegImage_common</a>(<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>,$x,$y,$w,$h,$imageWidth,$imageHeight);
<a name="l02927"></a>02927 }
<a name="l02928"></a>02928 
<a name="l02934"></a><a class="code" href="class_cpdf.html#aa5a35f03011edf15999be9ae1162d8d6">02934</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#aa5a35f03011edf15999be9ae1162d8d6">addJpegImage_common</a>(&amp;<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>,$x,$y,$w=0,$h=0,$imageWidth,$imageHeight,$channels=3){
<a name="l02935"></a>02935   <span class="comment">// note that this function is not to be called externally</span>
<a name="l02936"></a>02936   <span class="comment">// it is just the common code between the GD and the file options</span>
<a name="l02937"></a>02937   $this-&gt;numImages++;
<a name="l02938"></a>02938   $im=$this-&gt;numImages;
<a name="l02939"></a>02939   $label=<span class="charliteral">&#39;I&#39;</span>.$im;
<a name="l02940"></a>02940   $this-&gt;numObj++;
<a name="l02941"></a>02941   $this-&gt;<a class="code" href="class_cpdf.html#ac2199fd5ae0ff08a49c57dc48cea87be">o_image</a>($this-&gt;numObj,<span class="stringliteral">&#39;new&#39;</span>,array(<span class="stringliteral">&#39;label&#39;</span>=&gt;$label,<span class="stringliteral">&#39;data&#39;</span>=&gt;<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>,<span class="stringliteral">&#39;iw&#39;</span>=&gt;$imageWidth,<span class="stringliteral">&#39;ih&#39;</span>=&gt;$imageHeight,<span class="stringliteral">&#39;channels&#39;</span>=&gt;$channels));
<a name="l02942"></a>02942 
<a name="l02943"></a>02943   $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&quot;\nq&quot;</span>;
<a name="l02944"></a>02944   $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&quot;\n&quot;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$w).<span class="stringliteral">&quot; 0 0 &quot;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$h).<span class="stringliteral">&quot; &quot;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$x).<span class="stringliteral">&quot; &quot;</span>.sprintf(<span class="stringliteral">&#39;%.3f&#39;</span>,$y).<span class="stringliteral">&quot; cm&quot;</span>;
<a name="l02945"></a>02945   $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&quot;\n/&quot;</span>.$label.<span class="stringliteral">&#39; Do&#39;</span>;
<a name="l02946"></a>02946   $this-&gt;objects[$this-&gt;currentContents][<span class="charliteral">&#39;c&#39;</span>].=<span class="stringliteral">&quot;\nQ&quot;</span>;
<a name="l02947"></a>02947 }
<a name="l02948"></a>02948 
<a name="l02952"></a><a class="code" href="class_cpdf.html#af01751de7cdbbc4b7a2eea6a20cd547b">02952</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#af01751de7cdbbc4b7a2eea6a20cd547b">openHere</a>($style,<a class="code" href="phpdoc_8inc.html#acebf83966ef6d7e5645a6b62ba368f9f">$a</a>=0,$b=0,$c=0){
<a name="l02953"></a>02953   <span class="comment">// this function will open the document at a specified page, in a specified style</span>
<a name="l02954"></a>02954   <span class="comment">// the values for style, and the required paramters are:</span>
<a name="l02955"></a>02955   <span class="comment">// &#39;XYZ&#39;  left, top, zoom</span>
<a name="l02956"></a>02956   <span class="comment">// &#39;Fit&#39;</span>
<a name="l02957"></a>02957   <span class="comment">// &#39;FitH&#39; top</span>
<a name="l02958"></a>02958   <span class="comment">// &#39;FitV&#39; left</span>
<a name="l02959"></a>02959   <span class="comment">// &#39;FitR&#39; left,bottom,right</span>
<a name="l02960"></a>02960   <span class="comment">// &#39;FitB&#39;</span>
<a name="l02961"></a>02961   <span class="comment">// &#39;FitBH&#39; top</span>
<a name="l02962"></a>02962   <span class="comment">// &#39;FitBV&#39; left</span>
<a name="l02963"></a>02963   $this-&gt;numObj++;
<a name="l02964"></a>02964   $this-&gt;<a class="code" href="class_cpdf.html#a2432dc753eab2f8786f3b6c97cfdca59">o_destination</a>($this-&gt;numObj,<span class="stringliteral">&#39;new&#39;</span>,array(<span class="stringliteral">&#39;page&#39;</span>=&gt;$this-&gt;currentPage,<span class="stringliteral">&#39;type&#39;</span>=&gt;$style,<span class="stringliteral">&#39;p1&#39;</span>=&gt;<a class="code" href="phpdoc_8inc.html#acebf83966ef6d7e5645a6b62ba368f9f">$a</a>,<span class="stringliteral">&#39;p2&#39;</span>=&gt;$b,<span class="stringliteral">&#39;p3&#39;</span>=&gt;$c));
<a name="l02965"></a>02965   $id = $this-&gt;catalogId;
<a name="l02966"></a>02966   $this-&gt;<a class="code" href="class_cpdf.html#ad5269fc1648ba039f9ab1d372b89aa55">o_catalog</a>($id,<span class="stringliteral">&#39;openHere&#39;</span>,$this-&gt;numObj);
<a name="l02967"></a>02967 }
<a name="l02968"></a>02968 
<a name="l02972"></a><a class="code" href="class_cpdf.html#aaaf728b2907f43d773302554f8b8448e">02972</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#aaaf728b2907f43d773302554f8b8448e">addDestination</a>($label,$style,<a class="code" href="phpdoc_8inc.html#acebf83966ef6d7e5645a6b62ba368f9f">$a</a>=0,$b=0,$c=0){
<a name="l02973"></a>02973   <span class="comment">// associates the given label with the destination, it is done this way so that a destination can be specified after</span>
<a name="l02974"></a>02974   <span class="comment">// it has been linked to</span>
<a name="l02975"></a>02975   <span class="comment">// styles are the same as the &#39;openHere&#39; function</span>
<a name="l02976"></a>02976   $this-&gt;numObj++;
<a name="l02977"></a>02977   $this-&gt;<a class="code" href="class_cpdf.html#a2432dc753eab2f8786f3b6c97cfdca59">o_destination</a>($this-&gt;numObj,<span class="stringliteral">&#39;new&#39;</span>,array(<span class="stringliteral">&#39;page&#39;</span>=&gt;$this-&gt;currentPage,<span class="stringliteral">&#39;type&#39;</span>=&gt;$style,<span class="stringliteral">&#39;p1&#39;</span>=&gt;<a class="code" href="phpdoc_8inc.html#acebf83966ef6d7e5645a6b62ba368f9f">$a</a>,<span class="stringliteral">&#39;p2&#39;</span>=&gt;$b,<span class="stringliteral">&#39;p3&#39;</span>=&gt;$c));
<a name="l02978"></a>02978   $id = $this-&gt;numObj;
<a name="l02979"></a>02979   <span class="comment">// store the label-&gt;idf relationship, note that this means that labels can be used only once</span>
<a name="l02980"></a>02980   $this-&gt;destinations[<span class="stringliteral">&quot;$label&quot;</span>]=$id;
<a name="l02981"></a>02981 }
<a name="l02982"></a>02982 
<a name="l02988"></a><a class="code" href="class_cpdf.html#a5ddaeab8f233dcdc13d1f3f13fa53367">02988</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a5ddaeab8f233dcdc13d1f3f13fa53367">setFontFamily</a>($family,<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>=<span class="stringliteral">&#39;&#39;</span>){
<a name="l02989"></a>02989   <span class="keywordflow">if</span> (!is_array(<a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>)){
<a name="l02990"></a>02990     <span class="keywordflow">if</span> ($family==<span class="stringliteral">&#39;init&#39;</span>){
<a name="l02991"></a>02991       <span class="comment">// set the known family groups</span>
<a name="l02992"></a>02992       <span class="comment">// these font families will be used to enable bold and italic markers to be included</span>
<a name="l02993"></a>02993       <span class="comment">// within text streams. html forms will be used... &lt;b&gt;&lt;/b&gt; &lt;i&gt;&lt;/i&gt;</span>
<a name="l02994"></a>02994       $this-&gt;fontFamilies[<span class="stringliteral">&#39;Helvetica.afm&#39;</span>]=array(
<a name="l02995"></a>02995          <span class="charliteral">&#39;b&#39;</span>=&gt;<span class="stringliteral">&#39;Helvetica-Bold.afm&#39;</span>
<a name="l02996"></a>02996         ,<span class="charliteral">&#39;i&#39;</span>=&gt;<span class="stringliteral">&#39;Helvetica-Oblique.afm&#39;</span>
<a name="l02997"></a>02997         ,<span class="stringliteral">&#39;bi&#39;</span>=&gt;<span class="stringliteral">&#39;Helvetica-BoldOblique.afm&#39;</span>
<a name="l02998"></a>02998         ,<span class="stringliteral">&#39;ib&#39;</span>=&gt;<span class="stringliteral">&#39;Helvetica-BoldOblique.afm&#39;</span>
<a name="l02999"></a>02999       );
<a name="l03000"></a>03000       $this-&gt;fontFamilies[<span class="stringliteral">&#39;Courier.afm&#39;</span>]=array(
<a name="l03001"></a>03001          <span class="charliteral">&#39;b&#39;</span>=&gt;<span class="stringliteral">&#39;Courier-Bold.afm&#39;</span>
<a name="l03002"></a>03002         ,<span class="charliteral">&#39;i&#39;</span>=&gt;<span class="stringliteral">&#39;Courier-Oblique.afm&#39;</span>
<a name="l03003"></a>03003         ,<span class="stringliteral">&#39;bi&#39;</span>=&gt;<span class="stringliteral">&#39;Courier-BoldOblique.afm&#39;</span>
<a name="l03004"></a>03004         ,<span class="stringliteral">&#39;ib&#39;</span>=&gt;<span class="stringliteral">&#39;Courier-BoldOblique.afm&#39;</span>
<a name="l03005"></a>03005       );
<a name="l03006"></a>03006       $this-&gt;fontFamilies[<span class="stringliteral">&#39;Times-Roman.afm&#39;</span>]=array(
<a name="l03007"></a>03007          <span class="charliteral">&#39;b&#39;</span>=&gt;<span class="stringliteral">&#39;Times-Bold.afm&#39;</span>
<a name="l03008"></a>03008         ,<span class="charliteral">&#39;i&#39;</span>=&gt;<span class="stringliteral">&#39;Times-Italic.afm&#39;</span>
<a name="l03009"></a>03009         ,<span class="stringliteral">&#39;bi&#39;</span>=&gt;<span class="stringliteral">&#39;Times-BoldItalic.afm&#39;</span>
<a name="l03010"></a>03010         ,<span class="stringliteral">&#39;ib&#39;</span>=&gt;<span class="stringliteral">&#39;Times-BoldItalic.afm&#39;</span>
<a name="l03011"></a>03011       );
<a name="l03012"></a>03012     }
<a name="l03013"></a>03013   } <span class="keywordflow">else</span> {
<a name="l03014"></a>03014     <span class="comment">// the user is trying to set a font family</span>
<a name="l03015"></a>03015     <span class="comment">// note that this can also be used to set the base ones to something else</span>
<a name="l03016"></a>03016     <span class="keywordflow">if</span> (strlen($family)){
<a name="l03017"></a>03017       $this-&gt;fontFamilies[$family] = <a class="code" href="class_cpdf.html#a011800c63ece4cbbfa77136a20607023">$options</a>;
<a name="l03018"></a>03018     }
<a name="l03019"></a>03019   }
<a name="l03020"></a>03020 }
<a name="l03021"></a>03021 
<a name="l03025"></a><a class="code" href="class_cpdf.html#a0fe60161c19f81f49f76a2dcb95d48e4">03025</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a0fe60161c19f81f49f76a2dcb95d48e4">addMessage</a>($message){
<a name="l03026"></a>03026   $this-&gt;messages.=$message.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l03027"></a>03027 }
<a name="l03028"></a>03028 
<a name="l03032"></a><a class="code" href="class_cpdf.html#a2b030911f9e13bcb79cf4ec5c7fda100">03032</a> <span class="keyword">function</span> <a class="code" href="class_cpdf.html#a2b030911f9e13bcb79cf4ec5c7fda100">transaction</a>($action){
<a name="l03033"></a>03033   <span class="keywordflow">switch</span> ($action){
<a name="l03034"></a>03034     <span class="keywordflow">case</span> <span class="stringliteral">&#39;start&#39;</span>:
<a name="l03035"></a>03035       <span class="comment">// store all the data away into the checkpoint variable</span>
<a name="l03036"></a>03036       <a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a> = get_object_vars($this);
<a name="l03037"></a>03037       $this-&gt;checkpoint = <a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>;
<a name="l03038"></a>03038       unset(<a class="code" href="administration_2lists_2data_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>);
<a name="l03039"></a>03039       <span class="keywordflow">break</span>;
<a name="l03040"></a>03040     <span class="keywordflow">case</span> <span class="stringliteral">&#39;commit&#39;</span>:
<a name="l03041"></a>03041       <span class="keywordflow">if</span> (is_array($this-&gt;checkpoint) &amp;&amp; isset($this-&gt;checkpoint[<span class="stringliteral">&#39;checkpoint&#39;</span>])){
<a name="l03042"></a>03042         $tmp = $this-&gt;checkpoint[<span class="stringliteral">&#39;checkpoint&#39;</span>];
<a name="l03043"></a>03043         $this-&gt;checkpoint = $tmp;
<a name="l03044"></a>03044         unset($tmp);
<a name="l03045"></a>03045       } <span class="keywordflow">else</span> {
<a name="l03046"></a>03046         $this-&gt;checkpoint=<span class="stringliteral">&#39;&#39;</span>;
<a name="l03047"></a>03047       }
<a name="l03048"></a>03048       <span class="keywordflow">break</span>;
<a name="l03049"></a>03049     <span class="keywordflow">case</span> <span class="stringliteral">&#39;rewind&#39;</span>:
<a name="l03050"></a>03050       <span class="comment">// do not destroy the current checkpoint, but move us back to the state then, so that we can try again</span>
<a name="l03051"></a>03051       <span class="keywordflow">if</span> (is_array($this-&gt;checkpoint)){
<a name="l03052"></a>03052         <span class="comment">// can only abort if were inside a checkpoint</span>
<a name="l03053"></a>03053         $tmp = $this-&gt;checkpoint;
<a name="l03054"></a>03054         <span class="keywordflow">foreach</span> ($tmp as $k=&gt;$v){
<a name="l03055"></a>03055           <span class="keywordflow">if</span> ($k != <span class="stringliteral">&#39;checkpoint&#39;</span>){
<a name="l03056"></a>03056             $this-&gt;$k=$v;
<a name="l03057"></a>03057           }
<a name="l03058"></a>03058         }
<a name="l03059"></a>03059         unset($tmp);
<a name="l03060"></a>03060       }
<a name="l03061"></a>03061       <span class="keywordflow">break</span>;
<a name="l03062"></a>03062     <span class="keywordflow">case</span> <span class="stringliteral">&#39;abort&#39;</span>:
<a name="l03063"></a>03063       <span class="keywordflow">if</span> (is_array($this-&gt;checkpoint)){
<a name="l03064"></a>03064         <span class="comment">// can only abort if were inside a checkpoint</span>
<a name="l03065"></a>03065         $tmp = $this-&gt;checkpoint;
<a name="l03066"></a>03066         <span class="keywordflow">foreach</span> ($tmp as $k=&gt;$v){
<a name="l03067"></a>03067           $this-&gt;$k=$v;
<a name="l03068"></a>03068         }
<a name="l03069"></a>03069         unset($tmp);
<a name="l03070"></a>03070       }
<a name="l03071"></a>03071       <span class="keywordflow">break</span>;
<a name="l03072"></a>03072   }
<a name="l03073"></a>03073 
<a name="l03074"></a>03074 }
<a name="l03075"></a>03075 
<a name="l03076"></a>03076 } <span class="comment">// end of class</span>
<a name="l03077"></a>03077 
<a name="l03078"></a>03078 ?&gt;
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="class_8pdf_8php.html">class.pdf.php</a>      </li>

    <li class="footer">Generated on Mon Feb 6 2012 00:16:20 for MitosEHR by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
