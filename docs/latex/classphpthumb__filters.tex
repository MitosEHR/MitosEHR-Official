\hypertarget{classphpthumb__filters}{\section{phpthumb\-\_\-filters \-Class \-Reference}
\label{classphpthumb__filters}\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}}
}
\subsection*{\-Public \-Member \-Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classphpthumb__filters_afe54edab829027ca0b158c96bdd83ef1}{phpthumb\-\_\-filters} ()
\item 
\hyperlink{classphpthumb__filters_a1d26d503a63b41fe2f6d6c6c22c2f977}{\-Apply\-Mask} (\&\$gdimg\-\_\-mask, \&\$gdimg\-\_\-image)
\item 
\hyperlink{classphpthumb__filters_a868bce98d95b20ca5980df7009b2e97a}{\-Bevel} (\&\$gdimg, \$width, \$hexcolor1, \$hexcolor2)
\item 
\hyperlink{classphpthumb__filters_aaf1d4082bd342e968fb30be03eec2b0c}{\-Blur} (\&\$gdimg, \$radius=0.\-5)
\item 
\hyperlink{classphpthumb__filters_affaf729b5b0bf97eb74d20afe296f93b}{\-Blur\-Gaussian} (\&\$gdimg)
\item 
\hyperlink{classphpthumb__filters_aacd477f983de3a272356a0982a7aa32b}{\-Blur\-Selective} (\&\$gdimg)
\item 
\hyperlink{classphpthumb__filters_a4c5e389a0bf845cbde9c9a2b68235350}{\-Brightness} (\&\$gdimg, \$amount=0)
\item 
\hyperlink{classphpthumb__filters_ab363c0f8552a6dfdd679cb0ce80d36c0}{\-Contrast} (\&\$gdimg, \$amount=0)
\item 
\hyperlink{classphpthumb__filters_a0fd131013d15acb0563517913421f06e}{\-Colorize} (\&\$gdimg, \$amount, \$target\-Color)
\item 
\hyperlink{classphpthumb__filters_a30486e42d7dc5476cc4c8780827f35e5}{\-Crop} (\&\$gdimg, \$left=0, \$right=0, \$top=0, \$bottom=0)
\item 
\hyperlink{classphpthumb__filters_ad3b8f01262de4fbbcfd011e3e5beeb6b}{\-Desaturate} (\&\$gdimg, \$amount, \$color='')
\item 
\hyperlink{classphpthumb__filters_af3f3dbf7cf23ec5a82650733f7aa1a35}{\-Drop\-Shadow} (\&\$gdimg, \$distance, \$width, \$hexcolor, \$angle, \$fade)
\item 
\hyperlink{classphpthumb__filters_af13f740be9d44366c26925374e90b8b9}{\-Edge\-Detect} (\&\$gdimg)
\item 
\hyperlink{classphpthumb__filters_abd40d19047d10673ea2670ce5ae69f6c}{\-Elipse} (\$gdimg)
\item 
\hyperlink{classphpthumb__filters_af56f3a0df7361a69fc4b006f9a0e2f98}{\-Emboss} (\&\$gdimg)
\item 
\hyperlink{classphpthumb__filters_a9361be25a234723bef65039b7d7bb4da}{\-Flip} (\&\$gdimg, \$x=false, \$y=false)
\item 
\hyperlink{classphpthumb__filters_a61bd8c7eadd58f7eff3cfaf5888ce18d}{\-Frame} (\&\$gdimg, \$frame\-\_\-width, \$edge\-\_\-width, \$hexcolor\-\_\-frame, \$hexcolor1, \$hexcolor2)
\item 
\hyperlink{classphpthumb__filters_a8f8fb8f6b7b2aa1ccb9012de29322c89}{\-Gamma} (\&\$gdimg, \$amount)
\item 
\hyperlink{classphpthumb__filters_ac964ed4e79cc312837da27572426e6b6}{\-Grayscale} (\&\$gdimg)
\item 
\hyperlink{classphpthumb__filters_ada0752b5c2e587088c61e8c18ba21514}{\-Histogram\-Analysis} (\&\$gdimg, \$calculate\-Gray=false)
\item 
\hyperlink{classphpthumb__filters_ad49d6352f0a22c3c875fd0c59480ce7f}{\-Histogram\-Stretch} (\&\$gdimg, \$band='$\ast$', \$method=0, \$threshold=0.\-1)
\item 
\hyperlink{classphpthumb__filters_a6419068818fbc8d1a371b6c169faa134}{\-Histogram\-Overlay} (\&\$gdimg, \$bands='$\ast$', \$colors='', \$width=0.\-25, \$height=0.\-25, \$alignment='\-B\-R', \$opacity=50, \$margin\-\_\-x=5, \$margin\-\_\-y=null)
\item 
\hyperlink{classphpthumb__filters_adc2f01e3ad3f01f0204da6f10bad427c}{\-Image\-Border} (\&\$gdimg, \$border\-\_\-width, \$radius\-\_\-x, \$radius\-\_\-y, \$hexcolor\-\_\-border)
\item 
\hyperlink{classphpthumb__filters_aa3a158b5772eeb4fb28f13973a9e82f5}{\-Improved\-Image\-Rotate} (\&\$gdimg\-\_\-source, \$rotate\-\_\-angle=0, \$config\-\_\-background\-\_\-hexcolor='\-F\-F\-F\-F\-F\-F', \$bg=null)
\item 
\hyperlink{classphpthumb__filters_aaf6375de63265e2d032d90ef2d7771df}{\-Mean\-Removal} (\&\$gdimg)
\item 
\hyperlink{classphpthumb__filters_a62cc8b7f2263af3eeefd434659c84ff8}{\-Negative} (\&\$gdimg)
\item 
\hyperlink{classphpthumb__filters_a8425970ef696ae1c8e420cc7718e7c9f}{\-Rounded\-Image\-Corners} (\&\$gdimg, \$radius\-\_\-x, \$radius\-\_\-y)
\item 
\hyperlink{classphpthumb__filters_a861290ddb5fcd73734a327fbd883fa9d}{\-Saturation} (\&\$gdimg, \$amount, \$color='')
\item 
\hyperlink{classphpthumb__filters_aebd2067d17409638a17de18089628f6d}{\-Sepia} (\&\$gdimg, \$amount, \$target\-Color)
\item 
\hyperlink{classphpthumb__filters_a7b9388a8ff19eb5a2b441aba78fabf57}{\-Smooth} (\&\$gdimg, \$amount=6)
\item 
\hyperlink{classphpthumb__filters_ad4c44b13cfa064b7b1adcc14db883745}{\-Source\-Transparent\-Color\-Mask} (\&\$gdimg, \$hexcolor, \$min\-\_\-limit=5, \$max\-\_\-limit=10)
\item 
\hyperlink{classphpthumb__filters_ae3154ed46062f29561e7be86f2559b1c}{\-Threshold} (\&\$gdimg, \$cutoff)
\item 
\hyperlink{classphpthumb__filters_a64db4cefe2b067a8d7b684356b6c7c14}{\-Image\-True\-Color\-To\-Palette2} (\&\$image, \$dither, \$ncolors)
\item 
\hyperlink{classphpthumb__filters_a6a911baba07ff5d63b8f1c6718e0ed28}{\-Reduce\-Color\-Depth} (\&\$gdimg, \$colors=256, \$dither=true)
\item 
\hyperlink{classphpthumb__filters_a825ce270b0defc94f2ccb5baa07e7303}{\-White\-Balance} (\&\$gdimg, \$target\-Color='')
\item 
\hyperlink{classphpthumb__filters_aa7c3c6393587a04c965fca12a81163c6}{\-Watermark\-Text} (\&\$gdimg, \$text, \$size, \$alignment, \$hex\-\_\-color='000000', \$ttffont='', \$opacity=100, \$margin=5, \$angle=0, \$bg\-\_\-color=false, \$bg\-\_\-opacity=0, \$fillextend='')
\item 
\hyperlink{classphpthumb__filters_a31079a470f5697b85aad5855f5c614fc}{\-Watermark\-Overlay} (\&\$gdimg\-\_\-dest, \&\$img\-\_\-watermark, \$alignment='$\ast$', \$opacity=50, \$margin\-\_\-x=5, \$margin\-\_\-y=null)
\item 
\hyperlink{classphpthumb__filters_a31094adc61bf77474247fff1bd98319a}{\-Debug\-Message} (\$message, \$file='', \$line='')
\end{DoxyCompactItemize}
\subsection*{\-Data \-Fields}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classphpthumb__filters_ac10166ea697629d5f86fe09b118abd03}{\$php\-Thumb\-Object} = null
\end{DoxyCompactItemize}


\subsection{\-Detailed \-Description}
php\-Thumb() by \-James \-Heinrich $<$\href{mailto:info@silisoftware.com}{\tt info@silisoftware.\-com}$>$ // 

\-Definition at line 11 of file phpthumb.\-filters.\-php.



\subsection{\-Member \-Function \-Documentation}
\hypertarget{classphpthumb__filters_a1d26d503a63b41fe2f6d6c6c22c2f977}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Apply\-Mask@{\-Apply\-Mask}}
\index{\-Apply\-Mask@{\-Apply\-Mask}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Apply\-Mask}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Apply\-Mask} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg\-\_\-mask, }
\item[{\&\$}]{gdimg\-\_\-image}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_a1d26d503a63b41fe2f6d6c6c22c2f977}


\-Definition at line 19 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                                        {
                if (phpthumb_functions::gd_version() < 2) {
                        $this->DebugMessage('Skipping ApplyMask() because
       gd_version is "'.phpthumb_functions::gd_version().'"', __FILE__, __LINE__);
                        return false;
                }
                if (phpthumb_functions::version_compare_replacement(phpversion(
      ), '4.3.2', '>=')) {

                        $this->DebugMessage('Using alpha ApplyMask() technique'
      , __FILE__, __LINE__);
                        if ($gdimg_mask_resized = 
      phpthumb_functions::ImageCreateFunction(ImageSX($gdimg_image), ImageSY(
      $gdimg_image))) {

                                ImageCopyResampled($gdimg_mask_resized, 
      $gdimg_mask, 0, 0, 0, 0, ImageSX($gdimg_image), ImageSY($gdimg_image), ImageSX(
      $gdimg_mask), ImageSY($gdimg_mask));
                                if ($gdimg_mask_blendtemp = 
      phpthumb_functions::ImageCreateFunction(ImageSX($gdimg_image), ImageSY(
      $gdimg_image))) {

                                        $color_background = ImageColorAllocate(
      $gdimg_mask_blendtemp, 0, 0, 0);
                                        ImageFilledRectangle(
      $gdimg_mask_blendtemp, 0, 0, ImageSX($gdimg_mask_blendtemp), ImageSY($gdimg_mask_blendtemp), 
      $color_background);
                                        ImageAlphaBlending(
      $gdimg_mask_blendtemp, false);
                                        ImageSaveAlpha($gdimg_mask_blendtemp, 
      true);
                                        for ($x = 0; $x < ImageSX($gdimg_image)
      ; $x++) {
                                                for ($y = 0; $y < ImageSY(
      $gdimg_image); $y++) {
                                                        //$RealPixel =
       phpthumb_functions::GetPixelColor($gdimg_mask_blendtemp, $x, $y);
                                                        $RealPixel = 
      phpthumb_functions::GetPixelColor($gdimg_image, $x, $y);
                                                        $MaskPixel = 
      phpthumb_functions::GrayscalePixel(phpthumb_functions::GetPixelColor(
      $gdimg_mask_resized, $x, $y));
                                                        $MaskAlpha = 127 - (
      floor($MaskPixel['red'] / 2) * (1 - ($RealPixel['alpha'] / 127)));
                                                        $newcolor = 
      phpthumb_functions::ImageColorAllocateAlphaSafe($gdimg_mask_blendtemp, 
      $RealPixel['red'], $RealPixel['green'], $RealPixel['blue'], $MaskAlpha);
                                                        ImageSetPixel(
      $gdimg_mask_blendtemp, $x, $y, $newcolor);
                                                }
                                        }
                                        ImageAlphaBlending($gdimg_image, false)
      ;
                                        ImageSaveAlpha($gdimg_image, true);
                                        ImageCopy($gdimg_image, 
      $gdimg_mask_blendtemp, 0, 0, 0, 0, ImageSX($gdimg_mask_blendtemp), ImageSY(
      $gdimg_mask_blendtemp));
                                        ImageDestroy($gdimg_mask_blendtemp);

                                } else {
                                        $this->DebugMessage('
      ImageCreateFunction() failed', __FILE__, __LINE__);
                                }
                                ImageDestroy($gdimg_mask_resized);

                        } else {
                                $this->DebugMessage('ImageCreateFunction()
       failed', __FILE__, __LINE__);
                        }

                } else {
                        // alpha merging requires PHP v4.3.2+
                        $this->DebugMessage('Skipping ApplyMask() technique
       because PHP is v"'.phpversion().'"', __FILE__, __LINE__);
                }
                return true;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_a868bce98d95b20ca5980df7009b2e97a}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Bevel@{\-Bevel}}
\index{\-Bevel@{\-Bevel}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Bevel}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Bevel} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg, }
\item[{\$}]{width, }
\item[{\$}]{hexcolor1, }
\item[{\$}]{hexcolor2}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_a868bce98d95b20ca5980df7009b2e97a}


\-Definition at line 68 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                                            {
        $width     = ($width     ? $width     : 5);
        $hexcolor1 = ($hexcolor1 ? $hexcolor1 : 'FFFFFF');
        $hexcolor2 = ($hexcolor2 ? $hexcolor2 : '000000');

        ImageAlphaBlending($gdimg, true);
        for ($i = 0; $i < $width; $i++) {
            $alpha = round(($i / $width) * 127);
            $color1 = phpthumb_functions::ImageHexColorAllocate($gdimg, 
      $hexcolor1, false, $alpha);
            $color2 = phpthumb_functions::ImageHexColorAllocate($gdimg, 
      $hexcolor2, false, $alpha);

            ImageLine($gdimg,                   $i,                   $i + 1,  
                       $i, ImageSY($gdimg) - $i - 1, $color1); // left
            ImageLine($gdimg,                   $i,                   $i    , 
      ImageSX($gdimg) - $i,                   $i    , $color1); // top
            ImageLine($gdimg, ImageSX($gdimg) - $i, ImageSY($gdimg) - $i - 1, 
      ImageSX($gdimg) - $i,                   $i + 1, $color2); // right
            ImageLine($gdimg, ImageSX($gdimg) - $i, ImageSY($gdimg) - $i    ,  
                       $i, ImageSY($gdimg) - $i    , $color2); // bottom
        }
        return true;
    }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_aaf1d4082bd342e968fb30be03eec2b0c}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Blur@{\-Blur}}
\index{\-Blur@{\-Blur}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Blur}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Blur} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg, }
\item[{\$}]{radius = {\ttfamily 0.5}}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_aaf1d4082bd342e968fb30be03eec2b0c}


\-Definition at line 88 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                            {
                // Taken from Torstein Hønsi's phpUnsharpMask (see
       phpthumb.unsharp.php)

                $radius = round(max(0, min($radius, 50)) * 2);
                if (!$radius) {
                        return false;
                }

                $w = ImageSX($gdimg);
                $h = ImageSY($gdimg);
                if ($imgBlur = ImageCreateTrueColor($w, $h)) {
                        // Gaussian blur matrix:
                        //      1       2       1
                        //      2       4       2
                        //      1       2       1

                        // Move copies of the image around one pixel at the
       time and merge them with weight
                        // according to the matrix. The same matrix is simply
       repeated for higher radii.
                        for ($i = 0; $i < $radius; $i++)        {
                                ImageCopy     ($imgBlur, $gdimg, 0, 0, 1, 1, $w
       - 1, $h - 1);            // up left
                                ImageCopyMerge($imgBlur, $gdimg, 1, 1, 0, 0, $w
      ,     $h,     50.00000);  // down right
                                ImageCopyMerge($imgBlur, $gdimg, 0, 1, 1, 0, $w
       - 1, $h,     33.33333);  // down left
                                ImageCopyMerge($imgBlur, $gdimg, 1, 0, 0, 1, $w
      ,     $h - 1, 25.00000);  // up right
                                ImageCopyMerge($imgBlur, $gdimg, 0, 0, 1, 0, $w
       - 1, $h,     33.33333);  // left
                                ImageCopyMerge($imgBlur, $gdimg, 1, 0, 0, 0, $w
      ,     $h,     25.00000);  // right
                                ImageCopyMerge($imgBlur, $gdimg, 0, 0, 0, 1, $w
      ,     $h - 1, 20.00000);  // up
                                ImageCopyMerge($imgBlur, $gdimg, 0, 1, 0, 0, $w
      ,     $h,     16.666667); // down
                                ImageCopyMerge($imgBlur, $gdimg, 0, 0, 0, 0, $w
      ,     $h,     50.000000); // center
                                ImageCopy     ($gdimg, $imgBlur, 0, 0, 0, 0, $w
      ,     $h);
                        }
                        return true;
                }
                return false;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_affaf729b5b0bf97eb74d20afe296f93b}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Blur\-Gaussian@{\-Blur\-Gaussian}}
\index{\-Blur\-Gaussian@{\-Blur\-Gaussian}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Blur\-Gaussian}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Blur\-Gaussian} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_affaf729b5b0bf97eb74d20afe296f93b}


\-Definition at line 124 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                       {
                if (phpthumb_functions::version_compare_replacement(phpversion(
      ), '5.0.0', '>=') && phpthumb_functions::gd_is_bundled()) {
                        if (ImageFilter($gdimg, IMG_FILTER_GAUSSIAN_BLUR)) {
                                return true;
                        }
                        $this->DebugMessage('FAILED: ImageFilter($gdimg,
       IMG_FILTER_GAUSSIAN_BLUR)', __FILE__, __LINE__);
                        // fall through and try it the hard way
                }
                $this->DebugMessage('FAILED:
       phpthumb_filters::BlurGaussian($gdimg) [using phpthumb_filters::Blur() instead]', __FILE__, __LINE__);
                return phpthumb_filters::Blur($gdimg, 0.5);
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_aacd477f983de3a272356a0982a7aa32b}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Blur\-Selective@{\-Blur\-Selective}}
\index{\-Blur\-Selective@{\-Blur\-Selective}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Blur\-Selective}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Blur\-Selective} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_aacd477f983de3a272356a0982a7aa32b}


\-Definition at line 137 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                        {
                if (phpthumb_functions::version_compare_replacement(phpversion(
      ), '5.0.0', '>=') && phpthumb_functions::gd_is_bundled()) {
                        if (ImageFilter($gdimg, IMG_FILTER_SELECTIVE_BLUR)) {
                                return true;
                        }
                        $this->DebugMessage('FAILED: ImageFilter($gdimg,
       IMG_FILTER_SELECTIVE_BLUR)', __FILE__, __LINE__);
                        // fall through and try it the hard way
                }
                // currently not implemented "the hard way"
                $this->DebugMessage('FAILED:
       phpthumb_filters::BlurSelective($gdimg) [function not implemented]', __FILE__, __LINE__);
                return false;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_a4c5e389a0bf845cbde9c9a2b68235350}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Brightness@{\-Brightness}}
\index{\-Brightness@{\-Brightness}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Brightness}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Brightness} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg, }
\item[{\$}]{amount = {\ttfamily 0}}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_a4c5e389a0bf845cbde9c9a2b68235350}


\-Definition at line 151 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                                {
                if ($amount == 0) {
                        return true;
                }
                $amount = max(-255, min(255, $amount));

                if (phpthumb_functions::version_compare_replacement(phpversion(
      ), '5.0.0', '>=') && phpthumb_functions::gd_is_bundled()) {
                        if (ImageFilter($gdimg, IMG_FILTER_BRIGHTNESS, $amount)
      ) {
                                return true;
                        }
                        $this->DebugMessage('FAILED: ImageFilter($gdimg,
       IMG_FILTER_BRIGHTNESS, '.$amount.')', __FILE__, __LINE__);
                        // fall through and try it the hard way
                }

                $scaling = (255 - abs($amount)) / 255;
                $baseamount = (($amount > 0) ? $amount : 0);
                for ($x = 0; $x < ImageSX($gdimg); $x++) {
                        for ($y = 0; $y < ImageSY($gdimg); $y++) {
                                $OriginalPixel = 
      phpthumb_functions::GetPixelColor($gdimg, $x, $y);
                                foreach ($OriginalPixel as $key => $value) {
                                        $NewPixel[$key] = round($baseamount + (
      $OriginalPixel[$key] * $scaling));
                                }
                                $newColor = ImageColorAllocate($gdimg, 
      $NewPixel['red'], $NewPixel['green'], $NewPixel['blue']);
                                ImageSetPixel($gdimg, $x, $y, $newColor);
                        }
                }
                return true;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_a0fd131013d15acb0563517913421f06e}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Colorize@{\-Colorize}}
\index{\-Colorize@{\-Colorize}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Colorize}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Colorize} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg, }
\item[{\$}]{amount, }
\item[{\$}]{target\-Color}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_a0fd131013d15acb0563517913421f06e}


\-Definition at line 215 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                                          {
                $amount      = (is_numeric($amount)                          ? 
      $amount      : 25);
                $amountPct   = $amount / 100;
                $targetColor = (phpthumb_functions::IsHexColor($targetColor) ? 
      $targetColor : 'gray');

                if ($amount == 0) {
                        return true;
                }

                if (phpthumb_functions::version_compare_replacement(phpversion(
      ), '5.0.0', '>=') && phpthumb_functions::gd_is_bundled()) {
                        if ($targetColor == 'gray') {
                                $targetColor = '808080';
                        }
                        $r = round($amountPct * hexdec(substr($targetColor, 0, 
      2)));
                        $g = round($amountPct * hexdec(substr($targetColor, 2, 
      2)));
                        $b = round($amountPct * hexdec(substr($targetColor, 4, 
      2)));
                        if (ImageFilter($gdimg, IMG_FILTER_COLORIZE, $r, $g, $b
      )) {
                                return true;
                        }
                        $this->DebugMessage('FAILED: ImageFilter($gdimg,
       IMG_FILTER_COLORIZE)', __FILE__, __LINE__);
                        // fall through and try it the hard way
                }

                // overridden below for grayscale
                if ($targetColor != 'gray') {
                        $TargetPixel['red']   = hexdec(substr($targetColor, 0, 
      2));
                        $TargetPixel['green'] = hexdec(substr($targetColor, 2, 
      2));
                        $TargetPixel['blue']  = hexdec(substr($targetColor, 4, 
      2));
                }

                for ($x = 0; $x < ImageSX($gdimg); $x++) {
                        for ($y = 0; $y < ImageSY($gdimg); $y++) {
                                $OriginalPixel = 
      phpthumb_functions::GetPixelColor($gdimg, $x, $y);
                                if ($targetColor == 'gray') {
                                        $TargetPixel = 
      phpthumb_functions::GrayscalePixel($OriginalPixel);
                                }
                                foreach ($TargetPixel as $key => $value) {
                                        $NewPixel[$key] = round(max(0, min(255,
       ($OriginalPixel[$key] * ((100 - $amount) / 100)) + ($TargetPixel[$key] * 
      $amountPct))));
                                }
                                //$newColor =
       phpthumb_functions::ImageColorAllocateAlphaSafe($gdimg, $NewPixel['red'], $NewPixel['green'], $NewPixel['blue'],
       $OriginalPixel['alpha']);
                                $newColor = ImageColorAllocate($gdimg, 
      $NewPixel['red'], $NewPixel['green'], $NewPixel['blue']);
                                ImageSetPixel($gdimg, $x, $y, $newColor);
                        }
                }
                return true;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_ab363c0f8552a6dfdd679cb0ce80d36c0}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Contrast@{\-Contrast}}
\index{\-Contrast@{\-Contrast}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Contrast}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Contrast} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg, }
\item[{\$}]{amount = {\ttfamily 0}}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_ab363c0f8552a6dfdd679cb0ce80d36c0}


\-Definition at line 181 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                              {
                if ($amount == 0) {
                        return true;
                }
                $amount = max(-255, min(255, $amount));

                if (phpthumb_functions::version_compare_replacement(phpversion(
      ), '5.0.0', '>=') && phpthumb_functions::gd_is_bundled()) {
                        // ImageFilter(IMG_FILTER_CONTRAST) has range +100 to
       -100 (positive numbers make it darker!)
                        $amount = ($amount / 255) * -100;
                        if (ImageFilter($gdimg, IMG_FILTER_CONTRAST, $amount)) 
      {
                                return true;
                        }
                        $this->DebugMessage('FAILED: ImageFilter($gdimg,
       IMG_FILTER_CONTRAST, '.$amount.')', __FILE__, __LINE__);
                        // fall through and try it the hard way
                }

                if ($amount > 0) {
                        $scaling = 1 + ($amount / 255);
                } else {
                        $scaling = (255 - abs($amount)) / 255;
                }
                for ($x = 0; $x < ImageSX($gdimg); $x++) {
                        for ($y = 0; $y < ImageSY($gdimg); $y++) {
                                $OriginalPixel = 
      phpthumb_functions::GetPixelColor($gdimg, $x, $y);
                                foreach ($OriginalPixel as $key => $value) {
                                        $NewPixel[$key] = min(255, max(0, round
      ($OriginalPixel[$key] * $scaling)));
                                }
                                $newColor = ImageColorAllocate($gdimg, 
      $NewPixel['red'], $NewPixel['green'], $NewPixel['blue']);
                                ImageSetPixel($gdimg, $x, $y, $newColor);
                        }
                }
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_a30486e42d7dc5476cc4c8780827f35e5}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Crop@{\-Crop}}
\index{\-Crop@{\-Crop}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Crop}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Crop} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg, }
\item[{\$}]{left = {\ttfamily 0}, }
\item[{\$}]{right = {\ttfamily 0}, }
\item[{\$}]{top = {\ttfamily 0}, }
\item[{\$}]{bottom = {\ttfamily 0}}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_a30486e42d7dc5476cc4c8780827f35e5}


\-Definition at line 263 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                                                     {
                if (!$left && !$right && !$top && !$bottom) {
                        return true;
                }
                $oldW = ImageSX($gdimg);
                $oldH = ImageSY($gdimg);
                if (($left   > 0) && ($left   < 1)) { $left   = round($left   *
       $oldW); }
                if (($right  > 0) && ($right  < 1)) { $right  = round($right  *
       $oldW); }
                if (($top    > 0) && ($top    < 1)) { $top    = round($top    *
       $oldH); }
                if (($bottom > 0) && ($bottom < 1)) { $bottom = round($bottom *
       $oldH); }
                $right  = min($oldW - $left - 1, $right);
                $bottom = min($oldH - $top  - 1, $bottom);
                $newW = $oldW - $left - $right;
                $newH = $oldH - $top  - $bottom;

                if ($imgCropped = ImageCreateTrueColor($newW, $newH)) {
                        ImageCopy($imgCropped, $gdimg, 0, 0, $left, $top, $newW
      , $newH);
                        if ($gdimg = ImageCreateTrueColor($newW, $newH)) {
                                ImageCopy($gdimg, $imgCropped, 0, 0, 0, 0, 
      $newW, $newH);
                                ImageDestroy($imgCropped);
                                return true;
                        }
                        ImageDestroy($imgCropped);
                }
                return false;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_a31094adc61bf77474247fff1bd98319a}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Debug\-Message@{\-Debug\-Message}}
\index{\-Debug\-Message@{\-Debug\-Message}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Debug\-Message}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Debug\-Message} (
\begin{DoxyParamCaption}
\item[{\$}]{message, }
\item[{\$}]{file = {\ttfamily ''}, }
\item[{\$}]{line = {\ttfamily ''}}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_a31094adc61bf77474247fff1bd98319a}


\-Definition at line 1529 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                                            {
                if (is_object($this->phpThumbObject)) {
                        return $this->phpThumbObject->DebugMessage($message, 
      $file, $line);
                }
                return false;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_ad3b8f01262de4fbbcfd011e3e5beeb6b}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Desaturate@{\-Desaturate}}
\index{\-Desaturate@{\-Desaturate}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Desaturate}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Desaturate} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg, }
\item[{\$}]{amount, }
\item[{\$}]{color = {\ttfamily ''}}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_ad3b8f01262de4fbbcfd011e3e5beeb6b}


\-Definition at line 291 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                                         {
                if ($amount == 0) {
                        return true;
                }
                return phpthumb_filters::Colorize($gdimg, $amount, (
      phpthumb_functions::IsHexColor($color) ? $color : 'gray'));
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_af3f3dbf7cf23ec5a82650733f7aa1a35}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Drop\-Shadow@{\-Drop\-Shadow}}
\index{\-Drop\-Shadow@{\-Drop\-Shadow}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Drop\-Shadow}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Drop\-Shadow} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg, }
\item[{\$}]{distance, }
\item[{\$}]{width, }
\item[{\$}]{hexcolor, }
\item[{\$}]{angle, }
\item[{\$}]{fade}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_af3f3dbf7cf23ec5a82650733f7aa1a35}


\-Definition at line 299 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                                                               
         {
                if (phpthumb_functions::gd_version() < 2) {
                        return false;
                }
                $distance = ($distance ? $distance : 10);
                $width    = ($width    ? $width    : 10);
                $hexcolor = ($hexcolor ? $hexcolor : '000000');
                $angle    = ($angle    ? $angle    : 225);
                $fade     = ($fade     ? $fade     : 1);

                $width_shadow  = cos(deg2rad($angle)) * ($distance + $width);
                $height_shadow = sin(deg2rad($angle)) * ($distance + $width);

                $scaling = min(ImageSX($gdimg) / (ImageSX($gdimg) + abs(
      $width_shadow)), ImageSY($gdimg) / (ImageSY($gdimg) + abs($height_shadow)));

                for ($i = 0; $i < $width; $i++) {
                        $WidthAlpha[$i] = (abs(($width / 2) - $i) / $width) * 
      $fade;
                        $Offset['x'] = cos(deg2rad($angle)) * ($distance + $i);
                        $Offset['y'] = sin(deg2rad($angle)) * ($distance + $i);
                }

                $tempImageWidth  = ImageSX($gdimg)  + abs($Offset['x']);
                $tempImageHeight = ImageSY($gdimg) + abs($Offset['y']);

                if ($gdimg_dropshadow_temp = 
      phpthumb_functions::ImageCreateFunction($tempImageWidth, $tempImageHeight)) {

                        ImageAlphaBlending($gdimg_dropshadow_temp, false);
                        ImageSaveAlpha($gdimg_dropshadow_temp, true);
                        $transparent1 = 
      phpthumb_functions::ImageColorAllocateAlphaSafe($gdimg_dropshadow_temp, 0, 0, 0
      , 127);
                        ImageFill($gdimg_dropshadow_temp, 0, 0, $transparent1);

                        for ($x = 0; $x < ImageSX($gdimg); $x++) {
                                for ($y = 0; $y < ImageSY($gdimg); $y++) {
                                        $PixelMap[$x][$y] = 
      phpthumb_functions::GetPixelColor($gdimg, $x, $y);
                                }
                        }
                        for ($x = 0; $x < $tempImageWidth; $x++) {
                                for ($y = 0; $y < $tempImageHeight; $y++) {
                                        //for ($i = 0; $i < $width; $i++) {
                                        for ($i = 0; $i < 1; $i++) {
                                                if (!isset($PixelMap[$x][$y]['
      alpha']) || ($PixelMap[$x][$y]['alpha'] > 0)) {
                                                        if (isset($PixelMap[$x 
      + $Offset['x']][$y + $Offset['y']]['alpha']) && ($PixelMap[$x + $Offset['x']][$y
       + $Offset['y']]['alpha'] < 127)) {
                                                                $thisColor = 
      phpthumb_functions::ImageHexColorAllocate($gdimg, $hexcolor, false, $PixelMap[
      $x + $Offset['x']][$y + $Offset['y']]['alpha']);
                                                                ImageSetPixel(
      $gdimg_dropshadow_temp, $x, $y, $thisColor);
                                                        }
                                                }
                                        }
                                }
                        }

                        ImageAlphaBlending($gdimg_dropshadow_temp, true);
                        for ($x = 0; $x < ImageSX($gdimg); $x++) {
                                for ($y = 0; $y < ImageSY($gdimg); $y++) {
                                        if ($PixelMap[$x][$y]['alpha'] < 127) {
                                                $thisColor = 
      phpthumb_functions::ImageColorAllocateAlphaSafe($gdimg_dropshadow_temp, 
      $PixelMap[$x][$y]['red'], $PixelMap[$x][$y]['green'], $PixelMap[$x][$y]['blue'], 
      $PixelMap[$x][$y]['alpha']);
                                                ImageSetPixel(
      $gdimg_dropshadow_temp, $x, $y, $thisColor);
                                        }
                                }
                        }

                        ImageSaveAlpha($gdimg, true);
                        ImageAlphaBlending($gdimg, false);
                        //$this->is_alpha = true;
                        $transparent2 = 
      phpthumb_functions::ImageColorAllocateAlphaSafe($gdimg, 0, 0, 0, 127);
                        ImageFilledRectangle($gdimg, 0, 0, ImageSX($gdimg), 
      ImageSY($gdimg), $transparent2);
                        ImageCopyResampled($gdimg, $gdimg_dropshadow_temp, 0, 0
      , 0, 0, ImageSX($gdimg), ImageSY($gdimg), ImageSX($gdimg_dropshadow_temp), 
      ImageSY($gdimg_dropshadow_temp));

                        ImageDestroy($gdimg_dropshadow_temp);
                }
                return true;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_af13f740be9d44366c26925374e90b8b9}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Edge\-Detect@{\-Edge\-Detect}}
\index{\-Edge\-Detect@{\-Edge\-Detect}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Edge\-Detect}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Edge\-Detect} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_af13f740be9d44366c26925374e90b8b9}


\-Definition at line 372 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                     {
                if (phpthumb_functions::version_compare_replacement(phpversion(
      ), '5.0.0', '>=') && phpthumb_functions::gd_is_bundled()) {
                        if (ImageFilter($gdimg, IMG_FILTER_EDGEDETECT)) {
                                return true;
                        }
                        $this->DebugMessage('FAILED: ImageFilter($gdimg,
       IMG_FILTER_EDGEDETECT)', __FILE__, __LINE__);
                        // fall through and try it the hard way
                }
                // currently not implemented "the hard way"
                $this->DebugMessage('FAILED:
       phpthumb_filters::EdgeDetect($gdimg) [function not implemented]', __FILE__, __LINE__);
                return false;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_abd40d19047d10673ea2670ce5ae69f6c}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Elipse@{\-Elipse}}
\index{\-Elipse@{\-Elipse}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Elipse}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Elipse} (
\begin{DoxyParamCaption}
\item[{\$}]{gdimg}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_abd40d19047d10673ea2670ce5ae69f6c}


\-Definition at line 386 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                {
                if (phpthumb_functions::gd_version() < 2) {
                        return false;
                }
                // generate mask at twice desired resolution and downsample
       afterwards for easy antialiasing
                if ($gdimg_elipsemask_double = 
      phpthumb_functions::ImageCreateFunction(ImageSX($gdimg) * 2, ImageSY($gdimg) * 
      2)) {
                        if ($gdimg_elipsemask = 
      phpthumb_functions::ImageCreateFunction(ImageSX($gdimg), ImageSY($gdimg))) {

                                $color_transparent = ImageColorAllocate(
      $gdimg_elipsemask_double, 255, 255, 255);
                                ImageFilledEllipse($gdimg_elipsemask_double, 
      ImageSX($gdimg), ImageSY($gdimg), (ImageSX($gdimg) - 1) * 2, (ImageSY($gdimg) - 1)
       * 2, $color_transparent);
                                ImageCopyResampled($gdimg_elipsemask, 
      $gdimg_elipsemask_double, 0, 0, 0, 0, ImageSX($gdimg), ImageSY($gdimg), ImageSX($gdimg) *
       2, ImageSY($gdimg) * 2);

                                phpthumb_filters::ApplyMask($gdimg_elipsemask, 
      $gdimg);
                                ImageDestroy($gdimg_elipsemask);
                                return true;

                        } else {
                                $this->DebugMessage('$gdimg_elipsemask =
       phpthumb_functions::ImageCreateFunction() failed', __FILE__, __LINE__);
                        }
                        ImageDestroy($gdimg_elipsemask_double);
                } else {
                        $this->DebugMessage('$gdimg_elipsemask_double =
       phpthumb_functions::ImageCreateFunction() failed', __FILE__, __LINE__);
                }
                return false;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_af56f3a0df7361a69fc4b006f9a0e2f98}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Emboss@{\-Emboss}}
\index{\-Emboss@{\-Emboss}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Emboss}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Emboss} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_af56f3a0df7361a69fc4b006f9a0e2f98}


\-Definition at line 413 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                 {
                if (phpthumb_functions::version_compare_replacement(phpversion(
      ), '5.0.0', '>=') && phpthumb_functions::gd_is_bundled()) {
                        if (ImageFilter($gdimg, IMG_FILTER_EMBOSS)) {
                                return true;
                        }
                        $this->DebugMessage('FAILED: ImageFilter($gdimg,
       IMG_FILTER_EMBOSS)', __FILE__, __LINE__);
                        // fall through and try it the hard way
                }
                // currently not implemented "the hard way"
                $this->DebugMessage('FAILED: phpthumb_filters::Emboss($gdimg)
       [function not implemented]', __FILE__, __LINE__);
                return false;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_a9361be25a234723bef65039b7d7bb4da}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Flip@{\-Flip}}
\index{\-Flip@{\-Flip}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Flip}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Flip} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg, }
\item[{\$}]{x = {\ttfamily false}, }
\item[{\$}]{y = {\ttfamily false}}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_a9361be25a234723bef65039b7d7bb4da}


\-Definition at line 427 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                                   {
                if (!$x && !$y) {
                        return false;
                }
                if ($tempImage = phpthumb_functions::ImageCreateFunction(
      ImageSX($gdimg), ImageSY($gdimg))) {
                        if ($x) {
                                ImageCopy($tempImage, $gdimg, 0, 0, 0, 0, 
      ImageSX($gdimg), ImageSY($gdimg));
                                for ($x = 0; $x < ImageSX($gdimg); $x++) {
                                        ImageCopy($gdimg, $tempImage, ImageSX(
      $gdimg) - 1 - $x, 0, $x, 0, 1, ImageSY($gdimg));
                                }
                        }
                        if ($y) {
                                ImageCopy($tempImage, $gdimg, 0, 0, 0, 0, 
      ImageSX($gdimg), ImageSY($gdimg));
                                for ($y = 0; $y < ImageSY($gdimg); $y++) {
                                        ImageCopy($gdimg, $tempImage, 0, 
      ImageSY($gdimg) - 1 - $y, 0, $y, ImageSX($gdimg), 1);
                                }
                        }
                        ImageDestroy($tempImage);
                }
                return true;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_a61bd8c7eadd58f7eff3cfaf5888ce18d}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Frame@{\-Frame}}
\index{\-Frame@{\-Frame}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Frame}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Frame} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg, }
\item[{\$}]{frame\-\_\-width, }
\item[{\$}]{edge\-\_\-width, }
\item[{\$}]{hexcolor\-\_\-frame, }
\item[{\$}]{hexcolor1, }
\item[{\$}]{hexcolor2}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_a61bd8c7eadd58f7eff3cfaf5888ce18d}


\-Definition at line 450 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                                                               
                           {
                $frame_width    = ($frame_width    ? $frame_width    : 5);
                $edge_width     = ($edge_width     ? $edge_width     : 1);
                $hexcolor_frame = ($hexcolor_frame ? $hexcolor_frame : 'CCCCCC'
      );
                $hexcolor1      = ($hexcolor1      ? $hexcolor1      : 'FFFFFF'
      );
                $hexcolor2      = ($hexcolor2      ? $hexcolor2      : '000000'
      );

                $color_frame = phpthumb_functions::ImageHexColorAllocate($gdimg
      , $hexcolor_frame);
                $color1      = phpthumb_functions::ImageHexColorAllocate($gdimg
      , $hexcolor1);
                $color2      = phpthumb_functions::ImageHexColorAllocate($gdimg
      , $hexcolor2);
                for ($i = 0; $i < $edge_width; $i++) {
                        // outer bevel
                        ImageLine($gdimg,                   $i,                
         $i,                   $i, ImageSY($gdimg) - $i, $color1); // left
                        ImageLine($gdimg,                   $i,                
         $i, ImageSX($gdimg) - $i,                   $i, $color1); // top
                        ImageLine($gdimg, ImageSX($gdimg) - $i, ImageSY($gdimg)
       - $i, ImageSX($gdimg) - $i,                   $i, $color2); // right
                        ImageLine($gdimg, ImageSX($gdimg) - $i, ImageSY($gdimg)
       - $i,                   $i, ImageSY($gdimg) - $i, $color2); // bottom
                }
                for ($i = 0; $i < $frame_width; $i++) {
                        // actual frame
                        ImageRectangle($gdimg, $edge_width + $i, $edge_width + 
      $i, ImageSX($gdimg) - $edge_width - $i, ImageSY($gdimg) - $edge_width - $i, 
      $color_frame);
                }
                for ($i = 0; $i < $edge_width; $i++) {
                        // inner bevel
                        ImageLine($gdimg,                   $frame_width + 
      $edge_width + $i,                   $frame_width + $edge_width + $i,                
         $frame_width + $edge_width + $i, ImageSY($gdimg) - $frame_width - $edge_width
       - $i, $color2); // left
                        ImageLine($gdimg,                   $frame_width + 
      $edge_width + $i,                   $frame_width + $edge_width + $i, ImageSX($gdimg)
       - $frame_width - $edge_width - $i,                   $frame_width + $edge_width
       + $i, $color2); // top
                        ImageLine($gdimg, ImageSX($gdimg) - $frame_width - 
      $edge_width - $i, ImageSY($gdimg) - $frame_width - $edge_width - $i, ImageSX($gdimg)
       - $frame_width - $edge_width - $i,                   $frame_width + $edge_width
       + $i, $color1); // right
                        ImageLine($gdimg, ImageSX($gdimg) - $frame_width - 
      $edge_width - $i, ImageSY($gdimg) - $frame_width - $edge_width - $i,                
         $frame_width + $edge_width + $i, ImageSY($gdimg) - $frame_width - $edge_width
       - $i, $color1); // bottom
                }
                return true;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_a8f8fb8f6b7b2aa1ccb9012de29322c89}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Gamma@{\-Gamma}}
\index{\-Gamma@{\-Gamma}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Gamma}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Gamma} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg, }
\item[{\$}]{amount}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_a8f8fb8f6b7b2aa1ccb9012de29322c89}


\-Definition at line 482 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                         {
                if (number_format($amount, 4) == '1.0000') {
                        return true;
                }
                return ImageGammaCorrect($gdimg, 1.0, $amount);
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_ac964ed4e79cc312837da27572426e6b6}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Grayscale@{\-Grayscale}}
\index{\-Grayscale@{\-Grayscale}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Grayscale}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Grayscale} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_ac964ed4e79cc312837da27572426e6b6}


\-Definition at line 490 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                    {
                if (phpthumb_functions::version_compare_replacement(phpversion(
      ), '5.0.0', '>=') && phpthumb_functions::gd_is_bundled()) {
                        if (ImageFilter($gdimg, IMG_FILTER_GRAYSCALE)) {
                                return true;
                        }
                        $this->DebugMessage('FAILED: ImageFilter($gdimg,
       IMG_FILTER_GRAYSCALE)', __FILE__, __LINE__);
                        // fall through and try it the hard way
                }
                return phpthumb_filters::Colorize($gdimg, 100, 'gray');
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_ada0752b5c2e587088c61e8c18ba21514}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Histogram\-Analysis@{\-Histogram\-Analysis}}
\index{\-Histogram\-Analysis@{\-Histogram\-Analysis}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Histogram\-Analysis}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Histogram\-Analysis} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg, }
\item[{\$}]{calculate\-Gray = {\ttfamily false}}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_ada0752b5c2e587088c61e8c18ba21514}


\-Definition at line 502 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                                                  {
                $ImageSX = ImageSX($gdimg);
                $ImageSY = ImageSY($gdimg);
                for ($x = 0; $x < $ImageSX; $x++) {
                        for ($y = 0; $y < $ImageSY; $y++) {
                                $OriginalPixel = 
      phpthumb_functions::GetPixelColor($gdimg, $x, $y);
                                @$Analysis['red'][$OriginalPixel['red']]++;
                                @$Analysis['green'][$OriginalPixel['green']]++;
                                @$Analysis['blue'][$OriginalPixel['blue']]++;
                                @$Analysis['alpha'][$OriginalPixel['alpha']]++;
                                if ($calculateGray) {
                                        $GrayPixel = 
      phpthumb_functions::GrayscalePixel($OriginalPixel);
                                        @$Analysis['gray'][$GrayPixel['red']]++
      ;
                                }
                        }
                }
                $keys = array('red', 'green', 'blue', 'alpha');
                if ($calculateGray) {
                        $keys[] = 'gray';
                }
                foreach ($keys as $dummy => $key) {
                        ksort($Analysis[$key]);
                }
                return $Analysis;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_a6419068818fbc8d1a371b6c169faa134}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Histogram\-Overlay@{\-Histogram\-Overlay}}
\index{\-Histogram\-Overlay@{\-Histogram\-Overlay}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Histogram\-Overlay}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Histogram\-Overlay} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg, }
\item[{\$}]{bands = {\ttfamily '$\ast$'}, }
\item[{\$}]{colors = {\ttfamily ''}, }
\item[{\$}]{width = {\ttfamily 0.25}, }
\item[{\$}]{height = {\ttfamily 0.25}, }
\item[{\$}]{alignment = {\ttfamily '\-B\-R'}, }
\item[{\$}]{opacity = {\ttfamily 50}, }
\item[{\$}]{margin\-\_\-x = {\ttfamily 5}, }
\item[{\$}]{margin\-\_\-y = {\ttfamily null}}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_a6419068818fbc8d1a371b6c169faa134}


\-Definition at line 610 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                                                               
                                                                                {
                $margin_y = (is_null($margin_y) ? $margin_x : $margin_y);

                $Analysis = phpthumb_filters::HistogramAnalysis($gdimg, true);
                $histW = round(($width > 1) ? min($width, ImageSX($gdimg)) : 
      ImageSX($gdimg) * $width);
                $histH = round(($width > 1) ? min($width, ImageSX($gdimg)) : 
      ImageSX($gdimg) * $width);
                if ($gdHist = ImageCreateTrueColor($histW, $histH)) {
                        $color_back = 
      phpthumb_functions::ImageColorAllocateAlphaSafe($gdHist, 0, 0, 0, 127);
                        ImageFilledRectangle($gdHist, 0, 0, $histW, $histH, 
      $color_back);
                        ImageAlphaBlending($gdHist, false);
                        ImageSaveAlpha($gdHist, true);

                        $HistogramTempWidth  = 256;
                        $HistogramTempHeight = 100;
                        if ($gdHistTemp = ImageCreateTrueColor(
      $HistogramTempWidth, $HistogramTempHeight)) {
                                $color_back_temp = 
      phpthumb_functions::ImageColorAllocateAlphaSafe($gdHistTemp, 255, 0, 255, 127);
                                ImageAlphaBlending($gdHistTemp, false);
                                ImageSaveAlpha($gdHistTemp, true);
                                ImageFilledRectangle($gdHistTemp, 0, 0, ImageSX
      ($gdHistTemp), ImageSY($gdHistTemp), $color_back_temp);

                                $DefaultColors = array('r'=>'FF0000', 'g'=>'
      00FF00', 'b'=>'0000FF', 'a'=>'999999', '*'=>'FFFFFF');
                                $Colors = explode(';', $colors);
                                $BandsToGraph = array_unique(preg_split('//', 
      $bands));
                                $keys = array('r'=>'red', 'g'=>'green', 'b'=>'
      blue', 'a'=>'alpha', '*'=>'gray');
                                foreach ($BandsToGraph as $key => $band) {
                                        if (!isset($keys[$band])) {
                                                continue;
                                        }
                                        $PeakValue = max($Analysis[$keys[$band]
      ]);
                                        $thisColor = 
      phpthumb_functions::ImageHexColorAllocate($gdHistTemp, 
      phpthumb_functions::IsHexColor(@$Colors[$key]) ? $Colors[$key] : $DefaultColors
      [$band]);
                                        for ($x = 0; $x < $HistogramTempWidth; 
      $x++) {
                                                ImageLine($gdHistTemp, $x, 
      $HistogramTempHeight - 1, $x, $HistogramTempHeight - 1 - round(@$Analysis[$keys[
      $band]][$x] / $PeakValue * $HistogramTempHeight), $thisColor);
                                        }
                                        ImageLine($gdHistTemp, 0, 
      $HistogramTempHeight - 1, $HistogramTempWidth - 1, $HistogramTempHeight - 1, $thisColor);
                                        ImageLine($gdHistTemp, 0, 
      $HistogramTempHeight - 2, $HistogramTempWidth - 1, $HistogramTempHeight - 2, $thisColor);
                                }
                                ImageCopyResampled($gdHist, $gdHistTemp, 0, 0, 
      0, 0, ImageSX($gdHist), ImageSY($gdHist), ImageSX($gdHistTemp), ImageSY(
      $gdHistTemp));
                                ImageDestroy($gdHistTemp);
                        } else {
                                return false;
                        }

                        phpthumb_filters::WatermarkOverlay($gdimg, $gdHist, 
      $alignment, $opacity, $margin_x, $margin_y);
                        ImageDestroy($gdHist);
                        return true;
                }
                return false;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_ad49d6352f0a22c3c875fd0c59480ce7f}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Histogram\-Stretch@{\-Histogram\-Stretch}}
\index{\-Histogram\-Stretch@{\-Histogram\-Stretch}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Histogram\-Stretch}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Histogram\-Stretch} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg, }
\item[{\$}]{band = {\ttfamily '$\ast$'}, }
\item[{\$}]{method = {\ttfamily 0}, }
\item[{\$}]{threshold = {\ttfamily 0.1}}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_ad49d6352f0a22c3c875fd0c59480ce7f}


\-Definition at line 529 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                                                               
        {
                // equivalent of "Auto Contrast" in Adobe Photoshop
                // method 0 stretches according to RGB colors. Gives a more
       conservative stretch.
                // method 1 band stretches according to grayscale which is
       color-biased (59% green, 30% red, 11% blue). May give a punchier / more aggressive
       stretch, possibly appearing over-saturated
                $Analysis = phpthumb_filters::HistogramAnalysis($gdimg, true);
                $keys = array('r'=>'red', 'g'=>'green', 'b'=>'blue', 'a'=>'
      alpha', '*'=>(($method == 0) ? 'all' : 'gray'));
                $band = substr($band, 0, 1);
                if (!isset($keys[$band])) {
                        return false;
                }
                $key = $keys[$band];

                // If the absolute brightest and darkest pixels are used then
       one random
                // pixel in the image could throw off the whole system.
       Instead, count up/down
                // from the limit and allow <threshold> (default = 0.1%) of
       brightest/darkest
                // pixels to be clipped to min/max
                $threshold = floatval($threshold) / 100;
                $clip_threshold = ImageSX($gdimg) * ImageSX($gdimg) * 
      $threshold;
                //if ($min >= 0) {
                //      $range_min = min($min, 255);
                //} else {
                        $countsum = 0;
                        for ($i = 0; $i <= 255; $i++) {
                                if ($method == 0) {
                                        $countsum = max(@$Analysis['red'][$i], 
      @$Analysis['green'][$i], @$Analysis['blue'][$i]);
                                } else {
                                        $countsum += @$Analysis[$key][$i];
                                }
                                if ($countsum >= $clip_threshold) {
                                        $range_min = $i - 1;
                                        break;
                                }
                        }
                        $range_min = max($range_min, 0);
                //}
                //if ($max > 0) {
                //      $range_max = max($max, 255);
                //} else {
                        $countsum = 0;
                        for ($i = 255; $i >= 0; $i--) {
                                if ($method == 0) {
                                        $countsum = max(@$Analysis['red'][$i], 
      @$Analysis['green'][$i], @$Analysis['blue'][$i]);
                                } else {
                                        $countsum += @$Analysis[$key][$i];
                                }
                                if ($countsum >= $clip_threshold) {
                                        $range_max = $i + 1;
                                        break;
                                }
                        }
                        $range_max = min($range_max, 255);
                //}
                $range_scale = (($range_max == $range_min) ? 1 : (255 / (
      $range_max - $range_min)));
                if (($range_min == 0) && ($range_max == 255)) {
                        // no adjustment neccesary - don't waste CPU time!
                        return true;
                }

                $ImageSX = ImageSX($gdimg);
                $ImageSY = ImageSY($gdimg);
                for ($x = 0; $x < $ImageSX; $x++) {
                        for ($y = 0; $y < $ImageSY; $y++) {
                                $OriginalPixel = 
      phpthumb_functions::GetPixelColor($gdimg, $x, $y);
                                if ($band == '*') {
                                        $new['red']   = min(255, max(0, (
      $OriginalPixel['red']   - $range_min) * $range_scale));
                                        $new['green'] = min(255, max(0, (
      $OriginalPixel['green'] - $range_min) * $range_scale));
                                        $new['blue']  = min(255, max(0, (
      $OriginalPixel['blue']  - $range_min) * $range_scale));
                                        $new['alpha'] = min(255, max(0, (
      $OriginalPixel['alpha'] - $range_min) * $range_scale));
                                } else {
                                        $new = $OriginalPixel;
                                        $new[$key] = min(255, max(0, (
      $OriginalPixel[$key] - $range_min) * $range_scale));
                                }
                                $newColor = 
      phpthumb_functions::ImageColorAllocateAlphaSafe($gdimg, $new['red'], $new['
      green'], $new['blue'], $new['alpha']);
                                ImageSetPixel($gdimg, $x, $y, $newColor);
                        }
                }

                return true;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_adc2f01e3ad3f01f0204da6f10bad427c}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Image\-Border@{\-Image\-Border}}
\index{\-Image\-Border@{\-Image\-Border}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Image\-Border}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Image\-Border} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg, }
\item[{\$}]{border\-\_\-width, }
\item[{\$}]{radius\-\_\-x, }
\item[{\$}]{radius\-\_\-y, }
\item[{\$}]{hexcolor\-\_\-border}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_adc2f01e3ad3f01f0204da6f10bad427c}


\-Definition at line 660 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                                                               
                    {
                $border_width = ($border_width ? $border_width : 1);
                $radius_x     = ($radius_x     ? $radius_x     : 0);
                $radius_y     = ($radius_y     ? $radius_y     : 0);

                $output_width  = ImageSX($gdimg);
                $output_height = ImageSY($gdimg);

                list($new_width, $new_height) = 
      phpthumb_functions::ProportionalResize($output_width, $output_height, 
      $output_width - max($border_width * 2, $radius_x), $output_height - max($border_width * 2
      , $radius_y));
                $offset_x = ($radius_x ? $output_width  - $new_width  - 
      $radius_x : 0);
                $offset_y = ($radius_y ? $output_height - $new_height - 
      $radius_y : 0);

//header('Content-Type: image/png');
//ImagePNG($gdimg);
//exit;
                if ($gd_border_canvas = phpthumb_functions::ImageCreateFunction
      ($output_width, $output_height)) {

                        ImageSaveAlpha($gd_border_canvas, true);
                        ImageAlphaBlending($gd_border_canvas, false);
                        $color_background = 
      phpthumb_functions::ImageColorAllocateAlphaSafe($gd_border_canvas, 255, 255, 25
      5, 127);
                        ImageFilledRectangle($gd_border_canvas, 0, 0, 
      $output_width, $output_height, $color_background);

                        $color_border = 
      phpthumb_functions::ImageHexColorAllocate($gd_border_canvas, (
      phpthumb_functions::IsHexColor($hexcolor_border) ? $hexcolor_border : '000000')
      );

                        for ($i = 0; $i < $border_width; $i++) {
                                ImageLine($gd_border_canvas,             floor(
      $offset_x / 2) + $radius_x,                      $i, $output_width - $radius_x -
       ceil($offset_x / 2),                         $i, $color_border); // top
                                ImageLine($gd_border_canvas,             floor(
      $offset_x / 2) + $radius_x, $output_height - 1 - $i, $output_width - $radius_x -
       ceil($offset_x / 2),    $output_height - 1 - $i, $color_border); // bottom
                                ImageLine($gd_border_canvas,                   
       floor($offset_x / 2) + $i,               $radius_y,                      floor(
      $offset_x / 2) +  $i, $output_height - $radius_y, $color_border); // left
                                ImageLine($gd_border_canvas, $output_width - 1 
      - $i - ceil($offset_x / 2),               $radius_y,    $output_width - 1 - $i -
       ceil($offset_x / 2), $output_height - $radius_y, $color_border); // right
                        }

                        if ($radius_x && $radius_y) {

                                // PHP bug: ImageArc() with thicknesses > 1
       give bad/undesirable/unpredicatable results
                                // Solution: Draw multiple 1px arcs
       side-by-side.

                                // Problem: parallel arcs give strange/ugly
       antialiasing problems
                                // Solution: draw non-parallel arcs, from one
       side of the line thickness at the start angle
                                //   to the opposite edge of the line thickness
       at the terminating angle
                                for ($thickness_offset = 0; $thickness_offset <
       $border_width; $thickness_offset++) {
                                        ImageArc($gd_border_canvas, floor(
      $offset_x / 2) + 1 +                 $radius_x,              $thickness_offset - 1 + 
      $radius_y, $radius_x * 2, $radius_y * 2, 180, 270, $color_border); // top-left
                                        ImageArc($gd_border_canvas,            
               $output_width - $radius_x - 1 - ceil($offset_x / 2),              
      $thickness_offset - 1 + $radius_y, $radius_x * 2, $radius_y * 2, 270, 360, 
      $color_border); // top-right
                                        ImageArc($gd_border_canvas,            
               $output_width - $radius_x - 1 - ceil($offset_x / 2), $output_height - 
      $thickness_offset - $radius_y, $radius_x * 2, $radius_y * 2,   0,  90, 
      $color_border); // bottom-right
                                        ImageArc($gd_border_canvas, floor(
      $offset_x / 2) + 1 +                 $radius_x, $output_height - $thickness_offset - 
      $radius_y, $radius_x * 2, $radius_y * 2,  90, 180, $color_border); //
       bottom-left
                                }
                                if ($border_width > 1) {
                                        for ($thickness_offset = 0; 
      $thickness_offset < $border_width; $thickness_offset++) {
                                                ImageArc($gd_border_canvas, 
      floor($offset_x / 2) + $thickness_offset + $radius_x,                              
              $radius_y, $radius_x * 2, $radius_y * 2, 180, 270, $color_border); //
       top-left
                                                ImageArc($gd_border_canvas, 
      $output_width - $thickness_offset - $radius_x - 1 - ceil($offset_x / 2),           
                                 $radius_y, $radius_x * 2, $radius_y * 2, 270, 360, 
      $color_border); // top-right
                                                ImageArc($gd_border_canvas, 
      $output_width - $thickness_offset - $radius_x - 1 - ceil($offset_x / 2),           
                $output_height - $radius_y, $radius_x * 2, $radius_y * 2,   0,  90, 
      $color_border); // bottom-right
                                                ImageArc($gd_border_canvas, 
      floor($offset_x / 2) + $thickness_offset + $radius_x,                     
      $output_height - $radius_y, $radius_x * 2, $radius_y * 2,  90, 180, $color_border); //
       bottom-left
                                        }
                                }

                        }
                        $this->phpThumbObject->ImageResizeFunction(
      $gd_border_canvas, $gdimg, floor(($output_width - $new_width) / 2), round(($output_height - 
      $new_height) / 2), 0, 0, $new_width, $new_height, $output_width, $output_height)
      ;

                        ImageDestroy($gdimg);
                        $gdimg = phpthumb_functions::ImageCreateFunction(
      $output_width, $output_height);
                        ImageSaveAlpha($gdimg, true);
                        ImageAlphaBlending($gdimg, false);
                        $gdimg_color_background = 
      phpthumb_functions::ImageColorAllocateAlphaSafe($gdimg, 255, 255, 255, 127);
                        ImageFilledRectangle($gdimg, 0, 0, $output_width, 
      $output_height, $gdimg_color_background);

                        ImageCopy($gdimg, $gd_border_canvas, 0, 0, 0, 0, 
      $output_width, $output_height);
                        //$gdimg = $gd_border_canvas;
                        ImageDestroy($gd_border_canvas);
                        return true;


                } else {
                        $this->DebugMessage('FAILED: $gd_border_canvas =
       phpthumb_functions::ImageCreateFunction('.$output_width.', '.$output_height.')', 
      __FILE__, __LINE__);
                }
                return false;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_a64db4cefe2b067a8d7b684356b6c7c14}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Image\-True\-Color\-To\-Palette2@{\-Image\-True\-Color\-To\-Palette2}}
\index{\-Image\-True\-Color\-To\-Palette2@{\-Image\-True\-Color\-To\-Palette2}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Image\-True\-Color\-To\-Palette2}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Image\-True\-Color\-To\-Palette2} (
\begin{DoxyParamCaption}
\item[{\&\$}]{image, }
\item[{\$}]{dither, }
\item[{\$}]{ncolors}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_a64db4cefe2b067a8d7b684356b6c7c14}


\-Definition at line 1031 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                                                      {
                //
       http://www.php.net/manual/en/function.imagetruecolortopalette.php
                // zmorris at zsculpt dot com (17-Aug-2004 06:58)
                $width  = ImageSX($image);
                $height = ImageSY($image);
                $image_copy = ImageCreateTrueColor($width, $height);
                //ImageCopyMerge($image_copy, $image, 0, 0, 0, 0, $width,
       $height, 100);
                ImageCopy($image_copy, $image, 0, 0, 0, 0, $width, $height);
                ImageTrueColorToPalette($image, $dither, $ncolors);
                ImageColorMatch($image_copy, $image);
                ImageDestroy($image_copy);
                return true;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_aa3a158b5772eeb4fb28f13973a9e82f5}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Improved\-Image\-Rotate@{\-Improved\-Image\-Rotate}}
\index{\-Improved\-Image\-Rotate@{\-Improved\-Image\-Rotate}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Improved\-Image\-Rotate}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Improved\-Image\-Rotate} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg\-\_\-source, }
\item[{\$}]{rotate\-\_\-angle = {\ttfamily 0}, }
\item[{\$}]{config\-\_\-background\-\_\-hexcolor = {\ttfamily '\-F\-F\-F\-F\-F\-F'}, }
\item[{\$}]{bg = {\ttfamily null}}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_aa3a158b5772eeb4fb28f13973a9e82f5}


\-Definition at line 737 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                                                               
                                             {
                while ($rotate_angle < 0) {
                        $rotate_angle += 360;
                }
                $rotate_angle = $rotate_angle % 360;
                if ($rotate_angle != 0) {

                        $background_color = 
      phpthumb_functions::ImageHexColorAllocate($gdimg_source, 
      $config_background_hexcolor);

                        if ((phpthumb_functions::gd_version() >= 2) && !$bg && 
      ($rotate_angle % 90)) {

                                //$this->DebugMessage('Using alpha rotate',
       __FILE__, __LINE__);
                                if ($gdimg_rotate_mask = 
      phpthumb_functions::ImageCreateFunction(ImageSX($gdimg_source), ImageSY(
      $gdimg_source))) {

                                        for ($i = 0; $i <= 255; $i++) {
                                                $color_mask[$i] = 
      ImageColorAllocate($gdimg_rotate_mask, $i, $i, $i);
                                        }
                                        ImageFilledRectangle($gdimg_rotate_mask
      , 0, 0, ImageSX($gdimg_rotate_mask), ImageSY($gdimg_rotate_mask), $color_mask[25
      5]);
                                        $imageX = ImageSX($gdimg_source);
                                        $imageY = ImageSY($gdimg_source);
                                        for ($x = 0; $x < $imageX; $x++) {
                                                for ($y = 0; $y < $imageY; $y++
      ) {
                                                        $pixelcolor = 
      phpthumb_functions::GetPixelColor($gdimg_source, $x, $y);
                                                        ImageSetPixel(
      $gdimg_rotate_mask, $x, $y, $color_mask[255 - round($pixelcolor['alpha'] * 255 / 127)]);
                                                }
                                        }
                                        $gdimg_rotate_mask  = ImageRotate(
      $gdimg_rotate_mask,  $rotate_angle, $color_mask[0]);
                                        $gdimg_source = ImageRotate(
      $gdimg_source, $rotate_angle, $background_color);

                                        ImageAlphaBlending($gdimg_source, false
      );
                                        ImageSaveAlpha($gdimg_source, true);
                                        //$this->is_alpha = true;
                                        $phpThumbFilters = new phpthumb_filters
      ();
                                        $phpThumbFilters->phpThumbObject = 
      $this;
                                        $phpThumbFilters->ApplyMask(
      $gdimg_rotate_mask, $gdimg_source);

                                        ImageDestroy($gdimg_rotate_mask);

                                } else {
                                        //
      $this->DebugMessage('ImageCreateFunction() failed', __FILE__, __LINE__);
                                }

                        } else {

                                if (phpthumb_functions::gd_version() < 2) {
                                        //$this->DebugMessage('Using non-alpha
       rotate because gd_version is "'.phpthumb_functions::gd_version().'"', __FILE__,
       __LINE__);
                                } elseif ($bg) {
                                        //$this->DebugMessage('Using non-alpha
       rotate because $this->bg is "'.$bg.'"', __FILE__, __LINE__);
                                } elseif ($rotate_angle % 90) {
                                        //$this->DebugMessage('Using non-alpha
       rotate because ($rotate_angle % 90) = "'.($rotate_angle % 90).'"', __FILE__,
       __LINE__);
                                } else {
                                        //$this->DebugMessage('Using non-alpha
       rotate because $this->thumbnailFormat is "'.$this->thumbnailFormat.'"',
       __FILE__, __LINE__);
                                }

                                if (ImageColorTransparent($gdimg_source) >= 0) 
      {
                                        // ImageRotate() forgets all about an
       image's transparency and sets the transparent color to black
                                        // To compensate, flood-fill the
       transparent color of the source image with the specified background color first
                                        // then rotate and the colors should
       match

                                        if (!function_exists('ImageIsTrueColor'
      ) || !ImageIsTrueColor($gdimg_source)) {
                                                // convert paletted image to
       true-color before rotating to prevent nasty aliasing artifacts

                                                //$this->source_width  =
       ImageSX($gdimg_source);
                                                //$this->source_height =
       ImageSY($gdimg_source);
                                                $gdimg_newsrc = 
      phpthumb_functions::ImageCreateFunction(ImageSX($gdimg_source), ImageSY(
      $gdimg_source));
                                                $background_color = 
      phpthumb_functions::ImageHexColorAllocate($gdimg_newsrc, 
      $config_background_hexcolor);
                                                ImageFilledRectangle(
      $gdimg_newsrc, 0, 0, ImageSX($gdimg_source), ImageSY($gdimg_source), 
      phpthumb_functions::ImageHexColorAllocate($gdimg_newsrc, 
      $config_background_hexcolor));
                                                ImageCopy($gdimg_newsrc, 
      $gdimg_source, 0, 0, 0, 0, ImageSX($gdimg_source), ImageSY($gdimg_source));
                                                ImageDestroy($gdimg_source);
                                                unset($gdimg_source);
                                                $gdimg_source = $gdimg_newsrc;
                                                unset($gdimg_newsrc);

                                        } else {

                                                ImageColorSet(
                                                        $gdimg_source,
                                                        ImageColorTransparent(
      $gdimg_source),
                                                        hexdec(substr(
      $config_background_hexcolor, 0, 2)),
                                                        hexdec(substr(
      $config_background_hexcolor, 2, 2)),
                                                        hexdec(substr(
      $config_background_hexcolor, 4, 2)));

                                                ImageColorTransparent(
      $gdimg_source, -1);

                                        }
                                }

                                $gdimg_source = ImageRotate($gdimg_source, 
      $rotate_angle, $background_color);

                        }
                }
                return true;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_aaf6375de63265e2d032d90ef2d7771df}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Mean\-Removal@{\-Mean\-Removal}}
\index{\-Mean\-Removal@{\-Mean\-Removal}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Mean\-Removal}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Mean\-Removal} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_aaf6375de63265e2d032d90ef2d7771df}


\-Definition at line 832 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                      {
                if (phpthumb_functions::version_compare_replacement(phpversion(
      ), '5.0.0', '>=') && phpthumb_functions::gd_is_bundled()) {
                        if (ImageFilter($gdimg, IMG_FILTER_MEAN_REMOVAL)) {
                                return true;
                        }
                        $this->DebugMessage('FAILED: ImageFilter($gdimg,
       IMG_FILTER_MEAN_REMOVAL)', __FILE__, __LINE__);
                        // fall through and try it the hard way
                }
                // currently not implemented "the hard way"
                $this->DebugMessage('FAILED:
       phpthumb_filters::MeanRemoval($gdimg) [function not implemented]', __FILE__, __LINE__);
                return false;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_a62cc8b7f2263af3eeefd434659c84ff8}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Negative@{\-Negative}}
\index{\-Negative@{\-Negative}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Negative}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Negative} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_a62cc8b7f2263af3eeefd434659c84ff8}


\-Definition at line 846 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                   {
                if (phpthumb_functions::version_compare_replacement(phpversion(
      ), '5.0.0', '>=') && phpthumb_functions::gd_is_bundled()) {
                        if (ImageFilter($gdimg, IMG_FILTER_NEGATE)) {
                                return true;
                        }
                        $this->DebugMessage('FAILED: ImageFilter($gdimg,
       IMG_FILTER_NEGATE)', __FILE__, __LINE__);
                        // fall through and try it the hard way
                }
                $ImageSX = ImageSX($gdimg);
                $ImageSY = ImageSY($gdimg);
                for ($x = 0; $x < $ImageSX; $x++) {
                        for ($y = 0; $y < $ImageSY; $y++) {
                                $currentPixel = 
      phpthumb_functions::GetPixelColor($gdimg, $x, $y);
                                $newColor = 
      phpthumb_functions::ImageColorAllocateAlphaSafe($gdimg, (~$currentPixel['red'] 
      & 0xFF), (~$currentPixel['green'] & 0xFF), (~$currentPixel['blue'] & 0xFF), 
      $currentPixel['alpha']);
                                ImageSetPixel($gdimg, $x, $y, $newColor);
                        }
                }
                return true;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_afe54edab829027ca0b158c96bdd83ef1}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!phpthumb\-\_\-filters@{phpthumb\-\_\-filters}}
\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{phpthumb\-\_\-filters}]{\setlength{\rightskip}{0pt plus 5cm}{\bf phpthumb\-\_\-filters} (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_afe54edab829027ca0b158c96bdd83ef1}


\-Definition at line 15 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                    {
                return true;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_a6a911baba07ff5d63b8f1c6718e0ed28}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Reduce\-Color\-Depth@{\-Reduce\-Color\-Depth}}
\index{\-Reduce\-Color\-Depth@{\-Reduce\-Color\-Depth}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Reduce\-Color\-Depth}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Reduce\-Color\-Depth} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg, }
\item[{\$}]{colors = {\ttfamily 256}, }
\item[{\$}]{dither = {\ttfamily true}}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_a6a911baba07ff5d63b8f1c6718e0ed28}


\-Definition at line 1045 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                                                      {
                $colors = max(min($colors, 256), 2);
                // ImageTrueColorToPalette usually makes ugly colors, the
       replacement is a bit better
                //ImageTrueColorToPalette($gdimg, $dither, $colors);
                phpthumb_filters::ImageTrueColorToPalette2($gdimg, $dither, 
      $colors);
                return true;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_a8425970ef696ae1c8e420cc7718e7c9f}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Rounded\-Image\-Corners@{\-Rounded\-Image\-Corners}}
\index{\-Rounded\-Image\-Corners@{\-Rounded\-Image\-Corners}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Rounded\-Image\-Corners}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Rounded\-Image\-Corners} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg, }
\item[{\$}]{radius\-\_\-x, }
\item[{\$}]{radius\-\_\-y}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_a8425970ef696ae1c8e420cc7718e7c9f}


\-Definition at line 867 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                                                    {
                // generate mask at twice desired resolution and downsample
       afterwards for easy antialiasing
                // mask is generated as a white double-size elipse on a
       triple-size black background and copy-paste-resampled
                // onto a correct-size mask image as 4 corners due to errors
       when the entire mask is resampled at once (gray edges)
                if ($gdimg_cornermask_triple = 
      phpthumb_functions::ImageCreateFunction($radius_x * 6, $radius_y * 6)) {
                        if ($gdimg_cornermask = 
      phpthumb_functions::ImageCreateFunction(ImageSX($gdimg), ImageSY($gdimg))) {

                                $color_transparent = ImageColorAllocate(
      $gdimg_cornermask_triple, 255, 255, 255);
                                ImageFilledEllipse($gdimg_cornermask_triple, 
      $radius_x * 3, $radius_y * 3, $radius_x * 4, $radius_y * 4, $color_transparent);

                                ImageFilledRectangle($gdimg_cornermask, 0, 0, 
      ImageSX($gdimg), ImageSY($gdimg), $color_transparent);

                                ImageCopyResampled($gdimg_cornermask, 
      $gdimg_cornermask_triple,                           0,                           0,     
      $radius_x,     $radius_y, $radius_x, $radius_y, $radius_x * 2, $radius_y * 2);
                                ImageCopyResampled($gdimg_cornermask, 
      $gdimg_cornermask_triple,                           0, ImageSY($gdimg) - $radius_y,     
      $radius_x, $radius_y * 3, $radius_x, $radius_y, $radius_x * 2, $radius_y * 2);
                                ImageCopyResampled($gdimg_cornermask, 
      $gdimg_cornermask_triple, ImageSX($gdimg) - $radius_x, ImageSY($gdimg) - $radius_y, 
      $radius_x * 3, $radius_y * 3, $radius_x, $radius_y, $radius_x * 2, $radius_y * 2);
                                ImageCopyResampled($gdimg_cornermask, 
      $gdimg_cornermask_triple, ImageSX($gdimg) - $radius_x,                           0, 
      $radius_x * 3,     $radius_y, $radius_x, $radius_y, $radius_x * 2, $radius_y * 2);

                                phpthumb_filters::ApplyMask($gdimg_cornermask, 
      $gdimg);
                                ImageDestroy($gdimg_cornermask);
                                $this->DebugMessage('RoundedImageCorners('.
      $radius_x.', '.$radius_y.') succeeded', __FILE__, __LINE__);
                                return true;

                        } else {
                                $this->DebugMessage('FAILED: $gdimg_cornermask
       = phpthumb_functions::ImageCreateFunction('.ImageSX($gdimg).', '.ImageSY($gdimg)
      .')', __FILE__, __LINE__);
                        }
                        ImageDestroy($gdimg_cornermask_triple);

                } else {
                        $this->DebugMessage('FAILED: $gdimg_cornermask_triple =
       phpthumb_functions::ImageCreateFunction('.($radius_x * 6).', '.($radius_y * 6).
      ')', __FILE__, __LINE__);
                }
                return false;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_a861290ddb5fcd73734a327fbd883fa9d}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Saturation@{\-Saturation}}
\index{\-Saturation@{\-Saturation}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Saturation}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Saturation} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg, }
\item[{\$}]{amount, }
\item[{\$}]{color = {\ttfamily ''}}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_a861290ddb5fcd73734a327fbd883fa9d}


\-Definition at line 901 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                                         {
                if ($amount == 0) {
                        return true;
                } elseif ($amount > 0) {
                        $amount = 0 - $amount;
                } else {
                        $amount = abs($amount);
                }
                return phpthumb_filters::Desaturate($gdimg, $amount, $color);
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_aebd2067d17409638a17de18089628f6d}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Sepia@{\-Sepia}}
\index{\-Sepia@{\-Sepia}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Sepia}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Sepia} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg, }
\item[{\$}]{amount, }
\item[{\$}]{target\-Color}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_aebd2067d17409638a17de18089628f6d}


\-Definition at line 913 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                                       {
                $amount      = (is_numeric($amount) ? max(0, min(100, $amount))
       : 50);
                $amountPct   = $amount / 100;
                $targetColor = (phpthumb_functions::IsHexColor($targetColor) ? 
      $targetColor : 'A28065');

                if ($amount == 0) {
                        return true;
                }

                if (phpthumb_functions::version_compare_replacement(phpversion(
      ), '5.0.0', '>=') && phpthumb_functions::gd_is_bundled()) {
                        if (ImageFilter($gdimg, IMG_FILTER_GRAYSCALE)) {

                                $r = round($amountPct * hexdec(substr(
      $targetColor, 0, 2)));
                                $g = round($amountPct * hexdec(substr(
      $targetColor, 2, 2)));
                                $b = round($amountPct * hexdec(substr(
      $targetColor, 4, 2)));
                                if (ImageFilter($gdimg, IMG_FILTER_COLORIZE, $r
      , $g, $b)) {
                                        return true;
                                }
                                $this->DebugMessage('FAILED:
       ImageFilter($gdimg, IMG_FILTER_COLORIZE)', __FILE__, __LINE__);
                                // fall through and try it the hard way

                        } else {

                                $this->DebugMessage('FAILED:
       ImageFilter($gdimg, IMG_FILTER_GRAYSCALE)', __FILE__, __LINE__);
                                // fall through and try it the hard way

                        }
                }

                $TargetPixel['red']   = hexdec(substr($targetColor, 0, 2));
                $TargetPixel['green'] = hexdec(substr($targetColor, 2, 2));
                $TargetPixel['blue']  = hexdec(substr($targetColor, 4, 2));

                $ImageSX = ImageSX($gdimg);
                $ImageSY = ImageSY($gdimg);
                for ($x = 0; $x < $ImageSX; $x++) {
                        for ($y = 0; $y < $ImageSY; $y++) {
                                $OriginalPixel = 
      phpthumb_functions::GetPixelColor($gdimg, $x, $y);
                                $GrayPixel = phpthumb_functions::GrayscalePixel
      ($OriginalPixel);

                                //
       http://www.gimpguru.org/Tutorials/SepiaToning/
                                // "In the traditional sepia toning process,
       the tinting occurs most in
                                // the mid-tones: the lighter and darker areas
       appear to be closer to B&W."
                                $SepiaAmount = ((128 - abs($GrayPixel['red'] - 
      128)) / 128) * $amountPct;

                                foreach ($TargetPixel as $key => $value) {
                                        $NewPixel[$key] = round(max(0, min(255,
       $GrayPixel[$key] * (1 - $SepiaAmount) + ($TargetPixel[$key] * $SepiaAmount))));
                                }
                                $newColor = 
      phpthumb_functions::ImageColorAllocateAlphaSafe($gdimg, $NewPixel['red'], 
      $NewPixel['green'], $NewPixel['blue'], $OriginalPixel['alpha']);
                                ImageSetPixel($gdimg, $x, $y, $newColor);
                        }
                }
                return true;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_a7b9388a8ff19eb5a2b441aba78fabf57}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Smooth@{\-Smooth}}
\index{\-Smooth@{\-Smooth}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Smooth}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Smooth} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg, }
\item[{\$}]{amount = {\ttfamily 6}}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_a7b9388a8ff19eb5a2b441aba78fabf57}


\-Definition at line 969 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                            {
                $amount = min(25, max(0, $amount));
                if ($amount == 0) {
                        return true;
                }
                if (phpthumb_functions::version_compare_replacement(phpversion(
      ), '5.0.0', '>=') && phpthumb_functions::gd_is_bundled()) {
                        if (ImageFilter($gdimg, IMG_FILTER_SMOOTH, $amount)) {
                                return true;
                        }
                        $this->DebugMessage('FAILED: ImageFilter($gdimg,
       IMG_FILTER_SMOOTH, '.$amount.')', __FILE__, __LINE__);
                        // fall through and try it the hard way
                }
                // currently not implemented "the hard way"
                $this->DebugMessage('FAILED: phpthumb_filters::Smooth($gdimg, '
      .$amount.') [function not implemented]', __FILE__, __LINE__);
                return false;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_ad4c44b13cfa064b7b1adcc14db883745}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Source\-Transparent\-Color\-Mask@{\-Source\-Transparent\-Color\-Mask}}
\index{\-Source\-Transparent\-Color\-Mask@{\-Source\-Transparent\-Color\-Mask}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Source\-Transparent\-Color\-Mask}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Source\-Transparent\-Color\-Mask} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg, }
\item[{\$}]{hexcolor, }
\item[{\$}]{min\-\_\-limit = {\ttfamily 5}, }
\item[{\$}]{max\-\_\-limit = {\ttfamily 10}}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_ad4c44b13cfa064b7b1adcc14db883745}


\-Definition at line 987 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                                                               
                    {
                $width  = ImageSX($gdimg);
                $height = ImageSY($gdimg);
                if ($gdimg_mask = ImageCreateTrueColor($width, $height)) {
                        $R = hexdec(substr($hexcolor, 0, 2));
                        $G = hexdec(substr($hexcolor, 2, 2));
                        $B = hexdec(substr($hexcolor, 4, 2));
                        $targetPixel = array('red'=>$R, 'green'=>$G, 'blue'=>$B
      );
                        $cutoffRange = $max_limit - $min_limit;
                        for ($x = 0; $x < $width; $x++) {
                                for ($y = 0; $y < $height; $y++) {
                                        $currentPixel = 
      phpthumb_functions::GetPixelColor($gdimg, $x, $y);
                                        $colorDiff = 
      phpthumb_functions::PixelColorDifferencePercent($currentPixel, $targetPixel);
                                        $grayLevel = min($cutoffRange, MAX(0, -
      $min_limit + $colorDiff)) * (255 / MAX(1, $cutoffRange));
                                        $newColor = ImageColorAllocate(
      $gdimg_mask, $grayLevel, $grayLevel, $grayLevel);
                                        ImageSetPixel($gdimg_mask, $x, $y, 
      $newColor);
                                }
                        }
                        return $gdimg_mask;
                }
                return false;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_ae3154ed46062f29561e7be86f2559b1c}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Threshold@{\-Threshold}}
\index{\-Threshold@{\-Threshold}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Threshold}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Threshold} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg, }
\item[{\$}]{cutoff}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_ae3154ed46062f29561e7be86f2559b1c}


\-Definition at line 1011 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                             {
                $width  = ImageSX($gdimg);
                $height = ImageSY($gdimg);
                $cutoff = min(255, max(0, ($cutoff ? $cutoff : 128)));
                for ($x = 0; $x < $width; $x++) {
                        for ($y = 0; $y < $height; $y++) {
                                $currentPixel = 
      phpthumb_functions::GetPixelColor($gdimg, $x, $y);
                                $grayPixel = phpthumb_functions::GrayscalePixel
      ($currentPixel);
                                if ($grayPixel['red'] < $cutoff) {
                                        $newColor = 
      phpthumb_functions::ImageColorAllocateAlphaSafe($gdimg, 0x00, 0x00, 0x00, 
      $currentPixel['alpha']);
                                } else {
                                        $newColor = 
      phpthumb_functions::ImageColorAllocateAlphaSafe($gdimg, 0xFF, 0xFF, 0xFF, 
      $currentPixel['alpha']);
                                }
                                ImageSetPixel($gdimg, $x, $y, $newColor);
                        }
                }
                return true;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_a31079a470f5697b85aad5855f5c614fc}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Watermark\-Overlay@{\-Watermark\-Overlay}}
\index{\-Watermark\-Overlay@{\-Watermark\-Overlay}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Watermark\-Overlay}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Watermark\-Overlay} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg\-\_\-dest, }
\item[{\&\$}]{img\-\_\-watermark, }
\item[{\$}]{alignment = {\ttfamily '$\ast$'}, }
\item[{\$}]{opacity = {\ttfamily 50}, }
\item[{\$}]{margin\-\_\-x = {\ttfamily 5}, }
\item[{\$}]{margin\-\_\-y = {\ttfamily null}}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_a31079a470f5697b85aad5855f5c614fc}


\-Definition at line 1403 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                                                               
                                                  {

                if (is_resource($gdimg_dest) && is_resource($img_watermark)) {
                        $watermark_source_x        = 0;
                        $watermark_source_y        = 0;
                        $img_source_width          = ImageSX($gdimg_dest);
                        $img_source_height         = ImageSY($gdimg_dest);
                        $watermark_source_width    = ImageSX($img_watermark);
                        $watermark_source_height   = ImageSY($img_watermark);
                        $watermark_opacity_percent = max(0, min(100, $opacity))
      ;
                        $margin_y = (is_null($margin_y) ? $margin_x : $margin_y
      );
                        $watermark_margin_x = ((($margin_x > 0) && ($margin_x <
       1)) ? round((1 - $margin_x) * $img_source_width)  : $margin_x);
                        $watermark_margin_y = ((($margin_y > 0) && ($margin_y <
       1)) ? round((1 - $margin_y) * $img_source_height) : $margin_y);
                        if (eregi('^([0-9\\.\\-]*)x([0-9\\.\\-]*)$', $alignment
      , $matches)) {
                                $watermark_destination_x = intval($matches[1]);
                                $watermark_destination_y = intval($matches[2]);
                        } else {
                                switch ($alignment) {
                                        case '*':
                                                if ($gdimg_tiledwatermark = 
      phpthumb_functions::ImageCreateFunction($img_source_width, $img_source_height))
       {

                                                        ImageAlphaBlending(
      $gdimg_tiledwatermark, false);
                                                        ImageSaveAlpha(
      $gdimg_tiledwatermark, true);
                                                        $text_color_transparent
       = phpthumb_functions::ImageColorAllocateAlphaSafe($gdimg_tiledwatermark, 255, 0
      , 255, 127);
                                                        ImageFill(
      $gdimg_tiledwatermark, 0, 0, $text_color_transparent);

                                                        // set the tiled image
       transparent color to whatever the untiled image transparency index is
        //                                              
      ImageColorTransparent($gdimg_tiledwatermark, ImageColorTransparent($img_watermark));

                                                        // a "cleaner" way of
       doing it, but can't handle the margin feature :(
        //                                              
      ImageSetTile($gdimg_tiledwatermark, $img_watermark);
        //                                              
      ImageFill($gdimg_tiledwatermark, 0, 0, IMG_COLOR_TILED);
        //                                              break;

        //                                              
      ImageFill($gdimg_tiledwatermark, 0, 0, ImageColorTransparent($gdimg_tiledwatermark));
                                                        // tile the image as
       many times as can fit
                                                        for ($x = 
      $watermark_margin_x; $x < ($img_source_width + $watermark_source_width); $x += (
      $watermark_source_width + $watermark_margin_x)) {
                                                                for ($y = 
      $watermark_margin_y; $y < ($img_source_height + $watermark_source_height); $y += (
      $watermark_source_height + $watermark_margin_y)) {
                                                                        
      ImageCopy(
                                                                                
      $gdimg_tiledwatermark,
                                                                                
      $img_watermark,
                                                                                
      $x,
                                                                                
      $y,
                                                                                
      0,
                                                                                
      0,
                                                                                
      min($watermark_source_width,  $img_source_width  - $x - $watermark_margin_x),
                                                                                
      min($watermark_source_height, $img_source_height - $y - $watermark_margin_y)
                                                                        );
                                                                }
                                                        }

                                                        $watermark_source_width
        = ImageSX($gdimg_tiledwatermark);
                                                        
      $watermark_source_height = ImageSY($gdimg_tiledwatermark);
                                                        
      $watermark_destination_x = 0;
                                                        
      $watermark_destination_y = 0;

                                                        ImageDestroy(
      $img_watermark);
                                                        $img_watermark = 
      $gdimg_tiledwatermark;
                                                }
                                                break;

                                        case 'T':
                                                $watermark_destination_x = 
      round((($img_source_width  / 2) - ($watermark_source_width / 2)) + 
      $watermark_margin_x);
                                                $watermark_destination_y = 
      $watermark_margin_y;
                                                break;

                                        case 'B':
                                                $watermark_destination_x = 
      round((($img_source_width  / 2) - ($watermark_source_width / 2)) + 
      $watermark_margin_x);
                                                $watermark_destination_y = 
      $img_source_height - $watermark_source_height - $watermark_margin_y;
                                                break;

                                        case 'L':
                                                $watermark_destination_x = 
      $watermark_margin_x;
                                                $watermark_destination_y = 
      round((($img_source_height / 2) - ($watermark_source_height / 2)) + 
      $watermark_margin_y);
                                                break;

                                        case 'R':
                                                $watermark_destination_x = 
      $img_source_width - $watermark_source_width - $watermark_margin_x;
                                                $watermark_destination_y = 
      round((($img_source_height / 2) - ($watermark_source_height / 2)) + 
      $watermark_margin_y);
                                                break;

                                        case 'C':
                                                $watermark_destination_x = 
      round(($img_source_width  / 2) - ($watermark_source_width  / 2));
                                                $watermark_destination_y = 
      round(($img_source_height / 2) - ($watermark_source_height / 2));
                                                break;

                                        case 'TL':
                                                $watermark_destination_x = 
      $watermark_margin_x;
                                                $watermark_destination_y = 
      $watermark_margin_y;
                                                break;

                                        case 'TR':
                                                $watermark_destination_x = 
      $img_source_width - $watermark_source_width - $watermark_margin_x;
                                                $watermark_destination_y = 
      $watermark_margin_y;
                                                break;

                                        case 'BL':
        //echo '<pre>';
        //var_dump($watermark_margin_x);
        //var_dump($img_source_height);
        //var_dump($watermark_source_height);
        //var_dump($watermark_margin_y);
                                                $watermark_destination_x = 
      $watermark_margin_x;
                                                $watermark_destination_y = 
      $img_source_height - $watermark_source_height - $watermark_margin_y;
                                                break;

                                        case 'BR':
                                        default:
                                                $watermark_destination_x = 
      $img_source_width  - $watermark_source_width  - $watermark_margin_x;
                                                $watermark_destination_y = 
      $img_source_height - $watermark_source_height - $watermark_margin_y;
                                                break;
                                }
                        }
                        ImageAlphaBlending($gdimg_dest, false);
                        ImageSaveAlpha($gdimg_dest, true);
                        ImageSaveAlpha($img_watermark, true);
                        phpthumb_functions::ImageCopyRespectAlpha($gdimg_dest, 
      $img_watermark, $watermark_destination_x, $watermark_destination_y, 0, 0, 
      $watermark_source_width, $watermark_source_height, $watermark_opacity_percent);

                        return true;
                }
                return false;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_aa7c3c6393587a04c965fca12a81163c6}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-Watermark\-Text@{\-Watermark\-Text}}
\index{\-Watermark\-Text@{\-Watermark\-Text}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-Watermark\-Text}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Watermark\-Text} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg, }
\item[{\$}]{text, }
\item[{\$}]{size, }
\item[{\$}]{alignment, }
\item[{\$}]{hex\-\_\-color = {\ttfamily '000000'}, }
\item[{\$}]{ttffont = {\ttfamily ''}, }
\item[{\$}]{opacity = {\ttfamily 100}, }
\item[{\$}]{margin = {\ttfamily 5}, }
\item[{\$}]{angle = {\ttfamily 0}, }
\item[{\$}]{bg\-\_\-color = {\ttfamily false}, }
\item[{\$}]{bg\-\_\-opacity = {\ttfamily 0}, }
\item[{\$}]{fillextend = {\ttfamily ''}}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_aa7c3c6393587a04c965fca12a81163c6}


\-Definition at line 1091 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                                                               
                                                                                      
                              {
                // text watermark requested
                if (!$text) {
                        return false;
                }
                ImageAlphaBlending($gdimg, true);

                if (eregi('^([0-9\\.\\-]*)x([0-9\\.\\-]*)(@[LCR])?$', 
      $alignment, $matches)) {
                        $originOffsetX = intval($matches[1]);
                        $originOffsetY = intval($matches[2]);
                        $alignment = (@$matches[4] ? $matches[4] : 'L');
                        $margin = 0;
                } else {
                        $originOffsetX = 0;
                        $originOffsetY = 0;
                }

                $metaTextArray = array(
                        '^Fb' =>       $this->phpThumbObject->getimagesizeinfo[
      'filesize'],
                        '^Fk' => round($this->phpThumbObject->getimagesizeinfo[
      'filesize'] / 1024),
                        '^Fm' => round($this->phpThumbObject->getimagesizeinfo[
      'filesize'] / 1048576),
                        '^X'  => $this->phpThumbObject->getimagesizeinfo[0],
                        '^Y'  => $this->phpThumbObject->getimagesizeinfo[1],
                        '^x'  => ImageSX($gdimg),
                        '^y'  => ImageSY($gdimg),
                        '^^'  => '^',
                );
                $text = strtr($text, $metaTextArray);

                $text = str_replace("\r\n", "\n", $text);
                $text = str_replace("\r",   "\n", $text);
                $textlines = explode("\n", $text);
                $this->DebugMessage('Processing '.count($textlines).' lines of
       text', __FILE__, __LINE__);

                if (@is_readable($ttffont) && is_file($ttffont)) {

                        $opacity = 100 - intval(max(min($opacity, 100), 0));
                        $letter_color_text = 
      phpthumb_functions::ImageHexColorAllocate($gdimg, $hex_color, false, $opacity *
       1.27);

                        $this->DebugMessage('Using TTF font "'.$ttffont.'"', 
      __FILE__, __LINE__);

                        $TTFbox = ImageTTFbBox($size, $angle, $ttffont, $text);

                        $min_x = min($TTFbox[0], $TTFbox[2], $TTFbox[4], 
      $TTFbox[6]);
                        $max_x = max($TTFbox[0], $TTFbox[2], $TTFbox[4], 
      $TTFbox[6]);
                        //$text_width = round($max_x - $min_x + ($size * 0.5));
                        $text_width = round($max_x - $min_x);

                        $min_y = min($TTFbox[1], $TTFbox[3], $TTFbox[5], 
      $TTFbox[7]);
                        $max_y = max($TTFbox[1], $TTFbox[3], $TTFbox[5], 
      $TTFbox[7]);
                        //$text_height = round($max_y - $min_y + ($size *
       0.5));
                        $text_height = round($max_y - $min_y);

                        $TTFboxChar = ImageTTFbBox($size, $angle, $ttffont, 'jH
      ');
                        $char_min_y = min($TTFboxChar[1], $TTFboxChar[3], 
      $TTFboxChar[5], $TTFboxChar[7]);
                        $char_max_y = max($TTFboxChar[1], $TTFboxChar[3], 
      $TTFboxChar[5], $TTFboxChar[7]);
                        $char_height = round($char_max_y - $char_min_y);

                        if ($alignment == '*') {

                                $text_origin_y = $char_height + $margin;
                                while (($text_origin_y - $text_height) < 
      ImageSY($gdimg)) {
                                        $text_origin_x = $margin;
                                        while ($text_origin_x < ImageSX($gdimg)
      ) {
                                                ImageTTFtext($gdimg, $size, 
      $angle, $text_origin_x, $text_origin_y, $letter_color_text, $ttffont, $text);
                                                $text_origin_x += ($text_width 
      + $margin);
                                        }
                                        $text_origin_y += ($text_height + 
      $margin);
                                }

                        } else {

                                // this block for background color only

                                switch ($alignment) {
                                        case '*':
                                                // handled separately
                                                break;

                                        case 'T':
                                                $text_origin_x = (
      $originOffsetX ? $originOffsetX - round($text_width / 2) : round((ImageSX($gdimg) - 
      $text_width) / 2));
                                                $text_origin_y = $char_height +
       $margin + $originOffsetY;
                                                break;

                                        case 'B':
                                                $text_origin_x = (
      $originOffsetX ? $originOffsetX - round($text_width / 2) : round((ImageSX($gdimg) - 
      $text_width) / 2));
                                                $text_origin_y = ImageSY($gdimg
      ) + $TTFbox[1] - $margin + $originOffsetY;
                                                break;

                                        case 'L':
                                                $text_origin_x = $margin + 
      $originOffsetX;
                                                $text_origin_y = (
      $originOffsetY ? $originOffsetY : round((ImageSY($gdimg) - $text_height) / 2) + $char_height)
      ;
                                                break;

                                        case 'R':
                                                $text_origin_x = (
      $originOffsetX ? $originOffsetX - $text_width : ImageSX($gdimg) - $text_width  + $TTFbox[0] -
       $min_x + round($size * 0.25) - $margin);
                                                $text_origin_y = (
      $originOffsetY ? $originOffsetY : round((ImageSY($gdimg) - $text_height) / 2) + $char_height)
      ;
                                                break;

                                        case 'C':
                                                $text_origin_x = (
      $originOffsetX ? $originOffsetX - round($text_width / 2) : round((ImageSX($gdimg) - 
      $text_width) / 2));
                                                $text_origin_y = (
      $originOffsetY ? $originOffsetY : round((ImageSY($gdimg) - $text_height) / 2) + $char_height)
      ;
                                                break;

                                        case 'TL':
                                                $text_origin_x = $margin + 
      $originOffsetX;
                                                $text_origin_y = $char_height +
       $margin + $originOffsetY;
                                                break;

                                        case 'TR':
                                                $text_origin_x = (
      $originOffsetX ? $originOffsetX - $text_width : ImageSX($gdimg) - $text_width  + $TTFbox[0] -
       $min_x + round($size * 0.25) - $margin);
                                                $text_origin_y = $char_height +
       $margin + $originOffsetY;
                                                break;

                                        case 'BL':
                                                $text_origin_x = $margin + 
      $originOffsetX;
                                                $text_origin_y = ImageSY($gdimg
      ) + $TTFbox[1] - $margin + $originOffsetY;
                                                break;

                                        case 'BR':
                                        default:
                                                $text_origin_x = (
      $originOffsetX ? $originOffsetX - $text_width : ImageSX($gdimg) - $text_width  + $TTFbox[0] -
       $min_x + round($size * 0.25) - $margin);
                                                $text_origin_y = ImageSY($gdimg
      ) + $TTFbox[1] - $margin + $originOffsetY;
                                                break;
                                }

                                //ImageRectangle($gdimg, $text_origin_x +
       $min_x, $text_origin_y + $TTFbox[1], $text_origin_x + $min_x + $text_width,
       $text_origin_y + $TTFbox[1] - $text_height, $letter_color_text);
                                if (phpthumb_functions::IsHexColor($bg_color)) 
      {
                                        $text_background_alpha = round(127 * ((
      100 - min(max(0, $bg_opacity), 100)) / 100));
                                        $text_color_background = 
      phpthumb_functions::ImageHexColorAllocate($gdimg, $bg_color, false, 
      $text_background_alpha);
                                } else {
                                        $text_color_background = 
      phpthumb_functions::ImageHexColorAllocate($gdimg, 'FFFFFF', false, 127);
                                }
                                $x1 = $text_origin_x + $min_x;
                                $y1 = $text_origin_y + $TTFbox[1];
                                $x2 = $text_origin_x + $min_x + $text_width;
                                $y2 = $text_origin_y + $TTFbox[1] - 
      $text_height;
                                $x_TL = eregi('x', $fillextend) ?              
       0 : min($x1, $x2);
                                $y_TL = eregi('y', $fillextend) ?              
       0 : min($y1, $y2);
                                $x_BR = eregi('x', $fillextend) ? ImageSX(
      $gdimg) : max($x1, $x2);
                                $y_BR = eregi('y', $fillextend) ? ImageSY(
      $gdimg) : max($y1, $y2);
                                //while ($y_BR > ImageSY($gdimg)) {
                                //      $y_TL--;
                                //      $y_BR--;
                                //      $text_origin_y--;
                                //}
                                $this->DebugMessage('WatermarkText() calling
       ImageFilledRectangle($gdimg, '.$x_TL.', '.$y_TL.', '.$x_BR.', '.$y_BR.',
       $text_color_background)', __FILE__, __LINE__);
                                ImageFilledRectangle($gdimg, $x_TL, $y_TL, 
      $x_BR, $y_BR, $text_color_background);

                                // end block for background color only


                                $y_offset = 0;
                                foreach ($textlines as $dummy => $line) {

                                        $TTFboxLine = ImageTTFbBox($size, 
      $angle, $ttffont, $line);
                                        $min_x_line = min($TTFboxLine[0], 
      $TTFboxLine[2], $TTFboxLine[4], $TTFboxLine[6]);
                                        $max_x_line = max($TTFboxLine[0], 
      $TTFboxLine[2], $TTFboxLine[4], $TTFboxLine[6]);
                                        //$text_width = round($max_x - $min_x +
       ($size * 0.5));
                                        $text_width_line = round($max_x_line - 
      $min_x_line);

                                        $min_y_line = min($TTFboxLine[1], 
      $TTFboxLine[3], $TTFboxLine[5], $TTFboxLine[7]);
                                        $max_y_line = max($TTFboxLine[1], 
      $TTFboxLine[3], $TTFboxLine[5], $TTFboxLine[7]);
                                        //$text_height = round($max_y - $min_y
       + ($size * 0.5));
                                        $text_height_line = round($max_y_line -
       $min_y_line);

                                        switch ($alignment) {
                                                // $text_origin_y set above,
       just re-set $text_origin_x here as needed

                                                case 'L':
                                                case 'TL':
                                                case 'BL':
                                                        // no change neccesary
                                                        break;

                                                case 'C':
                                                case 'T':
                                                case 'B':
                                                        $text_origin_x = (
      $originOffsetX ? $originOffsetX - round($text_width_line / 2) : round((ImageSX($gdimg
      ) - $text_width_line) / 2));
                                                        break;

                                                case 'R':
                                                case 'TR':
                                                case 'BR':
                                                        $text_origin_x = (
      $originOffsetX ? $originOffsetX - $text_width_line : ImageSX($gdimg) - 
      $text_width_line  + $TTFbox[0] - $min_x + round($size * 0.25) - $margin);
                                                        break;
                                        }

                                        //ImageTTFtext($gdimg, $size, $angle,
       $text_origin_x, $text_origin_y, $letter_color_text, $ttffont, $text);
                                        $this->DebugMessage('WatermarkText()
       calling ImageTTFtext($gdimg, '.$size.', '.$angle.', '.$text_origin_x.', '.(
      $text_origin_y + $y_offset).', $letter_color_text, '.$ttffont.', '.$line.')', __FILE__,
       __LINE__);
                                        ImageTTFtext($gdimg, $size, $angle, 
      $text_origin_x, $text_origin_y + $y_offset, $letter_color_text, $ttffont, $line);

                                        $y_offset += $char_height;
                                }

                        }
                        return true;

                } else {

                        $size = min(5, max(1, $size));
                        $this->DebugMessage('Using built-in font (size='.$size.
      ') for text watermark'.($ttffont ? ' because $ttffont !is_readable('.$ttffont.
      ')' : ''), __FILE__, __LINE__);

                        $text_width  = 0;
                        $text_height = 0;
                        foreach ($textlines as $dummy => $line) {
                                $text_width   = max($text_width, ImageFontWidth
      ($size) * strlen($line));
                                $text_height += ImageFontHeight($size);
                        }
                        if ($img_watermark = 
      phpthumb_functions::ImageCreateFunction($text_width, $text_height)) {
                                ImageAlphaBlending($img_watermark, false);
                                if (phpthumb_functions::IsHexColor($bg_color)) 
      {
                                        $text_background_alpha = round(127 * ((
      100 - min(max(0, $bg_opacity), 100)) / 100));
                                        $text_color_background = 
      phpthumb_functions::ImageHexColorAllocate($img_watermark, $bg_color, false, 
      $text_background_alpha);
                                } else {
                                        $text_color_background = 
      phpthumb_functions::ImageHexColorAllocate($img_watermark, 'FFFFFF', false, 127)
      ;
                                }
                                $this->DebugMessage('WatermarkText() calling
       ImageFilledRectangle($img_watermark, 0, 0, '.ImageSX($img_watermark).', '.ImageSY(
      $img_watermark).', $text_color_background)', __FILE__, __LINE__);
                                ImageFilledRectangle($img_watermark, 0, 0, 
      ImageSX($img_watermark), ImageSY($img_watermark), $text_color_background);

                                if ($angle && function_exists('ImageRotate')) {
                                        // using $img_watermark_mask is
       pointless if ImageRotate function isn't available
                                        if ($img_watermark_mask = 
      phpthumb_functions::ImageCreateFunction($text_width, $text_height)) {
                                                $mask_color_background = 
      ImageColorAllocate($img_watermark_mask, 0, 0, 0);
                                                ImageAlphaBlending(
      $img_watermark_mask, false);
                                                ImageFilledRectangle(
      $img_watermark_mask, 0, 0, ImageSX($img_watermark_mask), ImageSY($img_watermark_mask), 
      $mask_color_background);
                                                $mask_color_watermark = 
      ImageColorAllocate($img_watermark_mask, 255, 255, 255);
                                        }
                                }

                                $text_color_watermark = 
      phpthumb_functions::ImageHexColorAllocate($img_watermark, $hex_color);
                                foreach ($textlines as $key => $line) {
                                        switch ($alignment) {
                                                case 'C':
                                                        $x_offset = round((
      $text_width - (ImageFontWidth($size) * strlen($line))) / 2);
                                                        $originOffsetX = (
      ImageSX($gdimg) - ImageSX($img_watermark)) / 2;
                                                        $originOffsetY = (
      ImageSY($gdimg) - ImageSY($img_watermark)) / 2;
                                                        break;

                                                case 'T':
                                                        $x_offset = round((
      $text_width - (ImageFontWidth($size) * strlen($line))) / 2);
                                                        $originOffsetX = (
      ImageSX($gdimg) - ImageSX($img_watermark)) / 2;
                                                        $originOffsetY = 
      $margin;
                                                        break;

                                                case 'B':
                                                        $x_offset = round((
      $text_width - (ImageFontWidth($size) * strlen($line))) / 2);
                                                        $originOffsetX = (
      ImageSX($gdimg) - ImageSX($img_watermark)) / 2;
                                                        $originOffsetY = 
      ImageSY($gdimg) - ImageSY($img_watermark) - $margin;
                                                        break;

                                                case 'L':
                                                        $x_offset = 0;
                                                        $originOffsetX = 
      $margin;
                                                        $originOffsetY = (
      ImageSY($gdimg) - ImageSY($img_watermark)) / 2;
                                                        break;

                                                case 'TL':
                                                        $x_offset = 0;
                                                        $originOffsetX = 
      $margin;
                                                        $originOffsetY = 
      $margin;
                                                        break;

                                                case 'BL':
                                                        $x_offset = 0;
                                                        $originOffsetX = 
      $margin;
                                                        $originOffsetY = 
      ImageSY($gdimg) - ImageSY($img_watermark) - $margin;
                                                        break;

                                                case 'R':
                                                        $x_offset = $text_width
       - (ImageFontWidth($size) * strlen($line));
                                                        $originOffsetX = 
      ImageSX($gdimg) - ImageSX($img_watermark) - $margin;
                                                        $originOffsetY = (
      ImageSY($gdimg) - ImageSY($img_watermark)) / 2;
                                                        break;

                                                case 'TR':
                                                        $x_offset = $text_width
       - (ImageFontWidth($size) * strlen($line));
                                                        $originOffsetX = 
      ImageSX($gdimg) - ImageSX($img_watermark) - $margin;
                                                        $originOffsetY = 
      $margin;
                                                        break;

                                                case 'BR':
                                                default:
                                                        $x_offset = $text_width
       - (ImageFontWidth($size) * strlen($line));
                                                        $originOffsetX = 
      ImageSX($gdimg) - ImageSX($img_watermark) - $margin;
                                                        $originOffsetY = 
      ImageSY($gdimg) - ImageSY($img_watermark) - $margin;
                                                        break;
                                        }
                                        $this->DebugMessage('WatermarkText()
       calling ImageString($img_watermark, '.$size.', '.$x_offset.', '.($key * 
      ImageFontHeight($size)).', '.$line.', $text_color_watermark)', __FILE__, __LINE__);
                                        ImageString($img_watermark, $size, 
      $x_offset, $key * ImageFontHeight($size), $line, $text_color_watermark);
                                        if ($angle && $img_watermark_mask) {
                                                $this->DebugMessage('
      WatermarkText() calling ImageString($img_watermark_mask, '.$size.', '.$x_offset.', '.($key
       * ImageFontHeight($size)).', '.$text.', $mask_color_watermark)', __FILE__, 
      __LINE__);
                                                ImageString($img_watermark_mask
      , $size, $x_offset, $key * ImageFontHeight($size), $text, $mask_color_watermark)
      ;
                                        }
                                }
                                if ($angle && $img_watermark_mask) {
                                        $img_watermark      = ImageRotate(
      $img_watermark,      $angle, $text_color_background);
                                        $img_watermark_mask = ImageRotate(
      $img_watermark_mask, $angle, $mask_color_background);
                                        phpthumb_filters::ApplyMask(
      $img_watermark_mask, $img_watermark);
                                }
                                //phpthumb_filters::WatermarkOverlay($gdimg,
       $img_watermark, $alignment, $opacity, $margin);
                                $this->DebugMessage('WatermarkText() calling
       phpthumb_filters::WatermarkOverlay($gdimg, $img_watermark, '.($originOffsetX.'x'.
      $originOffsetY).', '.$opacity.', 0)', __FILE__, __LINE__);
                                phpthumb_filters::WatermarkOverlay($gdimg, 
      $img_watermark, $originOffsetX.'x'.$originOffsetY, $opacity, 0);
                                ImageDestroy($img_watermark);
                                return true;
                        }

                }
                return false;
        }
\end{DoxyCode}
\hypertarget{classphpthumb__filters_a825ce270b0defc94f2ccb5baa07e7303}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\-White\-Balance@{\-White\-Balance}}
\index{\-White\-Balance@{\-White\-Balance}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\-White\-Balance}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-White\-Balance} (
\begin{DoxyParamCaption}
\item[{\&\$}]{gdimg, }
\item[{\$}]{target\-Color = {\ttfamily ''}}
\end{DoxyParamCaption}
)}}\label{classphpthumb__filters_a825ce270b0defc94f2ccb5baa07e7303}


\-Definition at line 1054 of file phpthumb.\-filters.\-php.


\begin{DoxyCode}
                                                        {
                if (phpthumb_functions::IsHexColor($targetColor)) {
                        $targetPixel = array(
                                'red'   => hexdec(substr($targetColor, 0, 2)),
                                'green' => hexdec(substr($targetColor, 2, 2)),
                                'blue'  => hexdec(substr($targetColor, 4, 2))
                        );
                } else {
                        $Analysis = phpthumb_filters::HistogramAnalysis($gdimg,
       false);
                        $targetPixel = array(
                                'red'   => max(array_keys($Analysis['red'])),
                                'green' => max(array_keys($Analysis['green'])),
                                'blue'  => max(array_keys($Analysis['blue']))
                        );
                }
                $grayValue = phpthumb_functions::GrayscaleValue($targetPixel['
      red'], $targetPixel['green'], $targetPixel['blue']);
                $scaleR = $grayValue / $targetPixel['red'];
                $scaleG = $grayValue / $targetPixel['green'];
                $scaleB = $grayValue / $targetPixel['blue'];

                for ($x = 0; $x < ImageSX($gdimg); $x++) {
                        for ($y = 0; $y < ImageSY($gdimg); $y++) {
                                $currentPixel = 
      phpthumb_functions::GetPixelColor($gdimg, $x, $y);
                                $newColor = 
      phpthumb_functions::ImageColorAllocateAlphaSafe(
                                        $gdimg,
                                        max(0, min(255, round($currentPixel['
      red']   * $scaleR))),
                                        max(0, min(255, round($currentPixel['
      green'] * $scaleG))),
                                        max(0, min(255, round($currentPixel['
      blue']  * $scaleB))),
                                        $currentPixel['alpha']
                                );
                                ImageSetPixel($gdimg, $x, $y, $newColor);
                        }
                }
                return true;
        }
\end{DoxyCode}


\subsection{\-Field \-Documentation}
\hypertarget{classphpthumb__filters_ac10166ea697629d5f86fe09b118abd03}{\index{phpthumb\-\_\-filters@{phpthumb\-\_\-filters}!\$php\-Thumb\-Object@{\$php\-Thumb\-Object}}
\index{\$php\-Thumb\-Object@{\$php\-Thumb\-Object}!phpthumb_filters@{phpthumb\-\_\-filters}}
\subsubsection[{\$php\-Thumb\-Object}]{\setlength{\rightskip}{0pt plus 5cm}\$php\-Thumb\-Object = null}}\label{classphpthumb__filters_ac10166ea697629d5f86fe09b118abd03}


\-Definition at line 13 of file phpthumb.\-filters.\-php.



\-The documentation for this class was generated from the following file\-:\begin{DoxyCompactItemize}
\item 
\-C\-:/wamp/www/\-Mitos\-E\-H\-R/lib/php\-Thumbs-\/1.\-7.\-9/\hyperlink{phpthumb_8filters_8php}{phpthumb.\-filters.\-php}\end{DoxyCompactItemize}
