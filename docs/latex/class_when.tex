\hypertarget{class_when}{\section{\-When \-Class \-Reference}
\label{class_when}\index{\-When@{\-When}}
}
\subsection*{\-Public \-Member \-Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{class_when_a095c5d389db211932136b53f25f39685}{\-\_\-\-\_\-construct} ()
\item 
\hyperlink{class_when_a91e158ffabe2df32a0b75cfe0b774899}{recur} (\$start\-\_\-date, \$frequency=\char`\"{}daily\char`\"{})
\item 
\hyperlink{class_when_a352f040efbbf14f4bb985f4d9b077082}{freq} (\$frequency)
\item 
\hyperlink{class_when_a9eb30a36f809180523d364e87fd2a489}{rrule} (\$\hyperlink{class_when_a9eb30a36f809180523d364e87fd2a489}{rrule})
\item 
\hyperlink{class_when_a1060865be49edccc59e80b37cdf622f3}{count} (\$\hyperlink{class_when_a1060865be49edccc59e80b37cdf622f3}{count})
\item 
\hyperlink{class_when_af3b0b324d22a2cd686e44711fc3ff25e}{interval} (\$\hyperlink{class_when_af3b0b324d22a2cd686e44711fc3ff25e}{interval})
\item 
\hyperlink{class_when_a7adc47937eecbbdf1c6190baf4474bda}{wkst} (\$day)
\item 
\hyperlink{class_when_ae66b9c2794ad0a05a02796727406e235}{until} (\$end\-\_\-date)
\item 
\hyperlink{class_when_a53cb6d1f15a1db4469158bc3c5429a14}{bymonth} (\$months)
\item 
\hyperlink{class_when_a15a2ebc4cd881fd6afff1cbddae5c65a}{bymonthday} (\$days)
\item 
\hyperlink{class_when_ac55275c6af64d42b2953e431ab77f832}{byweekno} (\$weeks)
\item 
\hyperlink{class_when_af8ae916a06bad759207662ad7c19ba93}{bysetpos} (\$days)
\item 
\hyperlink{class_when_a5e8d3130e209037324edba07cc2e1d8f}{byday} (\$days)
\item 
\hyperlink{class_when_a853a40aad304a2b25c30d44f57e272f3}{byyearday} (\$days)
\item 
\hyperlink{class_when_acea62048bfee7b3cd80ed446c86fb78a}{next} ()
\end{DoxyCompactItemize}
\subsection*{\-Protected \-Member \-Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{class_when_a048ca113f2564b96b1d5be8f04f119e4}{create\-\_\-suggestions} ()
\item 
\hyperlink{class_when_a253d57a0681be06af755e8f18a793ca6}{valid\-\_\-date} (\$date)
\end{DoxyCompactItemize}
\subsection*{\-Protected \-Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{class_when_ad965d6d26242232a1ea5e810947ee77d}{\$frequency}
\item 
\hyperlink{class_when_a6720ff61744e00a5bbbaa98676e7beb5}{\$start\-\_\-date}
\item 
\hyperlink{class_when_ac726436e39cc7252cd1ca6c0f636f15b}{\$try\-\_\-date}
\item 
\hyperlink{class_when_a2dc978f2a05472c5f99cc7bd2d0b5abd}{\$end\-\_\-date}
\item 
\hyperlink{class_when_aad00c8e2ddca0ca728f5c39abc66ce65}{\$gobymonth}
\item 
\hyperlink{class_when_a2960e64225996b24f544c5f6a82efe59}{\$bymonth}
\item 
\hyperlink{class_when_a58be6c219be700f106377416e3eee8e0}{\$gobyweekno}
\item 
\hyperlink{class_when_af53eb19e3c262d64bcda47bf441dd4ec}{\$byweekno}
\item 
\hyperlink{class_when_a500ec70777161d3066e95f7c7551b7a3}{\$gobyyearday}
\item 
\hyperlink{class_when_ab5b023a775eb407a1acc3a14f775740d}{\$byyearday}
\item 
\hyperlink{class_when_a259b16184aa8390f6becc888d1083c03}{\$gobymonthday}
\item 
\hyperlink{class_when_a4e995a36cbcb603b7c677ebe1b4b466b}{\$bymonthday}
\item 
\hyperlink{class_when_aa7c329dbfbead5deb6b8c405e0619cf2}{\$gobyday}
\item 
\hyperlink{class_when_a7c5b514dc4f18e1acf5d250804163d85}{\$byday}
\item 
\hyperlink{class_when_a9ae818cb1793028259c94c6f5338e7dd}{\$gobysetpos}
\item 
\hyperlink{class_when_a7d5adf3eb4cbd77f0b3890c8ae88d3b7}{\$bysetpos}
\item 
\hyperlink{class_when_a435c7a87a97b0b448a1920488dd592da}{\$suggestions}
\item 
\hyperlink{class_when_af789423037bbc89dc7c850e761177570}{\$count}
\item 
\hyperlink{class_when_adc0a189fac719187ba2e6f01ca0f2466}{\$counter}
\item 
\hyperlink{class_when_a68d1d0dd2c7af0521842477b901d2ce2}{\$goenddate}
\item 
\hyperlink{class_when_a02df6fd14302ba88fecc15b95d513e5b}{\$interval}
\item 
\hyperlink{class_when_a28f081d50521dd1e40a5c50ef3375bad}{\$wkst}
\item 
\hyperlink{class_when_abc38cc338d7a6772a037b000bd3c6fb9}{\$valid\-\_\-week\-\_\-days}
\item 
\hyperlink{class_when_a8cf1751bccbd1e4e79d83d6ced43d055}{\$valid\-\_\-frequency}
\end{DoxyCompactItemize}


\subsection{\-Detailed \-Description}
\-Name\-: \hyperlink{class_when}{\-When} \-Author\-: \-Thomas \-Planer $<$\href{mailto:tplaner@gmail.com}{\tt tplaner@gmail.\-com}$>$ \-Location\-: \href{http://github.com/tplaner/When}{\tt http\-://github.\-com/tplaner/\-When} \-Created\-: \-September 2010 \-Description\-: \-Determines the next date of recursion given an i\-Calendar \char`\"{}rrule\char`\"{} like pattern. \-Requirements\-: \-P\-H\-P 5.\-3+ -\/ makes extensive use of the \-Date and \-Time library (\href{http://us2.php.net/manual/en/book.datetime.php}{\tt http\-://us2.\-php.\-net/manual/en/book.\-datetime.\-php}) 

\-Definition at line 10 of file recur.\-php.



\subsection{\-Constructor \& \-Destructor \-Documentation}
\hypertarget{class_when_a095c5d389db211932136b53f25f39685}{\index{\-When@{\-When}!\-\_\-\-\_\-construct@{\-\_\-\-\_\-construct}}
\index{\-\_\-\-\_\-construct@{\-\_\-\-\_\-construct}!When@{\-When}}
\subsubsection[{\-\_\-\-\_\-construct}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-\_\-\-\_\-construct} (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{class_when_a095c5d389db211932136b53f25f39685}
\-\_\-\-\_\-construct 

\-Definition at line 54 of file recur.\-php.


\begin{DoxyCode}
    {
        $this->frequency = null;
        
        $this->gobymonth = false;
        $this->bymonth = range(1,12);
        
        $this->gobymonthday = false;
        $this->bymonthday = range(1,31);
        
        $this->gobyday = false;
        // setup the valid week days (0 = sunday)
        $this->byday = range(0,6);
        
        $this->gobyyearday = false;
        $this->byyearday = range(0,366);
        
        $this->gobysetpos = false;
        $this->bysetpos = range(1,366);
        
        $this->gobyweekno = false;
        // setup the range for valid weeks
        $this->byweekno = range(0,54);
        
        $this->suggestions = array();
        
        // this will be set if a count() is specified
        $this->count = 0;
        // how many *valid* results we returned
        $this->counter = 0;
        
        // max date we'll return
        $this->end_date = new DateTime('9999-12-31');
        
        // the interval to increase the pattern by
        $this->interval = 1;
        
        // what day does the week start on? (0 = sunday)
        $this->wkst = 0;
        
        $this->valid_week_days = array('SU', 'MO', 'TU', 'WE', 'TH', 'FR', 'SA'
      );
        
        $this->valid_frequency = array('SECONDLY', 'MINUTELY', 'HOURLY', 'DAILY
      ', 'WEEKLY', 'MONTHLY', 'YEARLY');
    }
\end{DoxyCode}


\subsection{\-Member \-Function \-Documentation}
\hypertarget{class_when_a5e8d3130e209037324edba07cc2e1d8f}{\index{\-When@{\-When}!byday@{byday}}
\index{byday@{byday}!When@{\-When}}
\subsubsection[{byday}]{\setlength{\rightskip}{0pt plus 5cm}{\bf byday} (
\begin{DoxyParamCaption}
\item[{\$}]{days}
\end{DoxyParamCaption}
)}}\label{class_when_a5e8d3130e209037324edba07cc2e1d8f}


\-Definition at line 320 of file recur.\-php.


\begin{DoxyCode}
    {       
        $this->gobyday = true;
        
        if(is_array($days))
        {
            $this->byday = array();
            foreach($days as $day)
            {
                $len = strlen($day);
                
                $as = '+';
                
                // 0 mean no occurence is set
                $occ = 0;
                
                if($len == 3)
                {
                    $occ = substr($day, 0, 1);
                }
                if($len == 4)
                {
                    $as = substr($day, 0, 1);
                    $occ = substr($day, 1, 1);
                }
                
                if($as == '-')
                {
                    $occ = '-' . $occ;
                }
                else
                {
                    $occ = '+' . $occ;
                }
                
                $day = substr($day, -2, 2);
                switch($day)
                {
                    case 'SU':
                        $this->byday[] = $occ . 'SU';
                        break;
                    case 'MO':
                        $this->byday[] = $occ . 'MO';
                        break;
                    case 'TU':
                        $this->byday[] = $occ . 'TU';
                        break;
                    case 'WE':
                        $this->byday[] = $occ . 'WE';
                        break;
                    case 'TH':
                        $this->byday[] = $occ . 'TH';
                        break;
                    case 'FR':
                        $this->byday[] = $occ . 'FR';
                        break;
                    case 'SA':
                        $this->byday[] = $occ . 'SA';
                        break;
                }
            }
        }
        
        return $this;
    }
\end{DoxyCode}
\hypertarget{class_when_a53cb6d1f15a1db4469158bc3c5429a14}{\index{\-When@{\-When}!bymonth@{bymonth}}
\index{bymonth@{bymonth}!When@{\-When}}
\subsubsection[{bymonth}]{\setlength{\rightskip}{0pt plus 5cm}{\bf bymonth} (
\begin{DoxyParamCaption}
\item[{\$}]{months}
\end{DoxyParamCaption}
)}}\label{class_when_a53cb6d1f15a1db4469158bc3c5429a14}


\-Definition at line 274 of file recur.\-php.


\begin{DoxyCode}
    {   
        if(is_array($months))
        {
            $this->gobymonth = true;
            $this->bymonth = $months;
        }
        
        return $this;
    }
\end{DoxyCode}
\hypertarget{class_when_a15a2ebc4cd881fd6afff1cbddae5c65a}{\index{\-When@{\-When}!bymonthday@{bymonthday}}
\index{bymonthday@{bymonthday}!When@{\-When}}
\subsubsection[{bymonthday}]{\setlength{\rightskip}{0pt plus 5cm}{\bf bymonthday} (
\begin{DoxyParamCaption}
\item[{\$}]{days}
\end{DoxyParamCaption}
)}}\label{class_when_a15a2ebc4cd881fd6afff1cbddae5c65a}


\-Definition at line 285 of file recur.\-php.


\begin{DoxyCode}
    {   
        if(is_array($days))
        {
            $this->gobymonthday = true;
            $this->bymonthday = $days;
        }
        
        return $this;
    }
\end{DoxyCode}
\hypertarget{class_when_af8ae916a06bad759207662ad7c19ba93}{\index{\-When@{\-When}!bysetpos@{bysetpos}}
\index{bysetpos@{bysetpos}!When@{\-When}}
\subsubsection[{bysetpos}]{\setlength{\rightskip}{0pt plus 5cm}{\bf bysetpos} (
\begin{DoxyParamCaption}
\item[{\$}]{days}
\end{DoxyParamCaption}
)}}\label{class_when_af8ae916a06bad759207662ad7c19ba93}


\-Definition at line 308 of file recur.\-php.


\begin{DoxyCode}
    {
        $this->gobysetpos = true;
        
        if(is_array($days))
        {
            $this->bysetpos = $days;
        }
        
        return $this;
    }
\end{DoxyCode}
\hypertarget{class_when_ac55275c6af64d42b2953e431ab77f832}{\index{\-When@{\-When}!byweekno@{byweekno}}
\index{byweekno@{byweekno}!When@{\-When}}
\subsubsection[{byweekno}]{\setlength{\rightskip}{0pt plus 5cm}{\bf byweekno} (
\begin{DoxyParamCaption}
\item[{\$}]{weeks}
\end{DoxyParamCaption}
)}}\label{class_when_ac55275c6af64d42b2953e431ab77f832}


\-Definition at line 296 of file recur.\-php.


\begin{DoxyCode}
    {
        $this->gobyweekno = true;
        
        if(is_array($weeks))
        {
            $this->byweekno = $weeks;
        }
        
        return $this;
    }
\end{DoxyCode}
\hypertarget{class_when_a853a40aad304a2b25c30d44f57e272f3}{\index{\-When@{\-When}!byyearday@{byyearday}}
\index{byyearday@{byyearday}!When@{\-When}}
\subsubsection[{byyearday}]{\setlength{\rightskip}{0pt plus 5cm}{\bf byyearday} (
\begin{DoxyParamCaption}
\item[{\$}]{days}
\end{DoxyParamCaption}
)}}\label{class_when_a853a40aad304a2b25c30d44f57e272f3}


\-Definition at line 386 of file recur.\-php.


\begin{DoxyCode}
    {
        $this->gobyyearday = true;
        
        if(is_array($days))
        {
            $this->byyearday = $days;
        }
        
        return $this;
    }
\end{DoxyCode}
\hypertarget{class_when_a1060865be49edccc59e80b37cdf622f3}{\index{\-When@{\-When}!count@{count}}
\index{count@{count}!When@{\-When}}
\subsubsection[{count}]{\setlength{\rightskip}{0pt plus 5cm}{\bf count} (
\begin{DoxyParamCaption}
\item[{\$}]{count}
\end{DoxyParamCaption}
)}}\label{class_when_a1060865be49edccc59e80b37cdf622f3}


\-Definition at line 204 of file recur.\-php.


\begin{DoxyCode}
    {
        $this->count = (int)$count;
        
        return $this;
    }
\end{DoxyCode}
\hypertarget{class_when_a048ca113f2564b96b1d5be8f04f119e4}{\index{\-When@{\-When}!create\-\_\-suggestions@{create\-\_\-suggestions}}
\index{create\-\_\-suggestions@{create\-\_\-suggestions}!When@{\-When}}
\subsubsection[{create\-\_\-suggestions}]{\setlength{\rightskip}{0pt plus 5cm}{\bf create\-\_\-suggestions} (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}\label{class_when_a048ca113f2564b96b1d5be8f04f119e4}


\-Definition at line 399 of file recur.\-php.


\begin{DoxyCode}
    {
        switch($this->frequency)
        {
            case "YEARLY":
                $interval = 'year';
                break;
            case "MONTHLY":
                $interval = 'month';
                break;
            case "WEEKLY":
                $interval = 'week';
                break;
            case "DAILY":
                $interval = 'day';
                break;
            case "HOURLY":
                $interval = 'hour';
                break;
            case "MINUTELY":
                $interval = 'minute';
                break;
            case "SECONDLY":
                $interval = 'second';
                break;
        }
                    
        $month_day = $this->try_date->format('j');
        $month = $this->try_date->format('n');
        $year = $this->try_date->format('Y');
        
        $timestamp = $this->try_date->format('H:i:s');
                    
        if($this->gobysetpos)
        {               
            if($this->try_date == $this->start_date)
            {
                $this->suggestions[] = clone $this->try_date;
            }
            else
            {
                if($this->gobyday)
                {
                    foreach($this->bysetpos as $_pos)
                    {
                        $tmp_array = array();
                        $_mdays = range(1, date('t',mktime(0,0,0,$month,1,$year
      )));
                        foreach($_mdays as $_mday)
                        {
                            $date_time = new DateTime($year . '-' . $month . 
      '-' . $_mday . ' ' . $timestamp);
                            
                            $occur = ceil($_mday / 7);
                            
                            $day_of_week = $date_time->format('l');
                            $dow_abr = strtoupper(substr($day_of_week, 0, 2));
                            
                            // set the day of the month + (positive)
                            $occur = '+' . $occur . $dow_abr;
                            $occur_zero = '+0' . $dow_abr;
                            
                            // set the day of the month - (negative)
                            $total_days = $date_time->format('t') - $date_time
      ->format('j');
                            $occur_neg = '-' . ceil(($total_days + 1)/7) . 
      $dow_abr;
                            
                            $day_from_end_of_month = $date_time->format('t') + 
      1 - $_mday;
                            
                            if(in_array($occur, $this->byday) || in_array(
      $occur_zero, $this->byday) || in_array($occur_neg, $this->byday))
                            {                               
                                $tmp_array[] = clone $date_time;
                            }
                        }
                        
                        if($_pos > 0)
                        {
                            $this->suggestions[] = clone $tmp_array[$_pos - 1];
                        }
                        else
                        {
                            $this->suggestions[] = clone $tmp_array[count(
      $tmp_array) + $_pos];
                        }
                        
                    }
                }
            }
        }
        elseif($this->gobyyearday)
        {
            foreach($this->byyearday as $_day)
            {
                if($_day >= 0)
                {
                    $_day--;
                    $this->suggestions[] = DateTime::createFromFormat('Y-z
       H:i:s', $year . '-' . $_day . ' ' . $timestamp); 
                }
                else
                {
                    $year_day_neg = 365 + $_day;
                    $leap_year = $this->try_date->format('L');
                    if($leap_year == 1)
                    {
                        $year_day_neg = 366 + $_day;
                    }
                    $this->suggestions[] = DateTime::createFromFormat('Y-z
       H:i:s', $year . '-' . $year_day_neg . ' ' . $timestamp); 
                }                   
            }
        }
        // special case because for years you need to loop through the months
       too
        elseif($this->gobyday && $interval == "year")
        {
            foreach($this->bymonth as $_month)
            {
                // this creates an array of days of the month
                $_mdays = range(1, date('t',mktime(0,0,0,$_month,1,$year)));
                foreach($_mdays as $_mday)
                {
                    $date_time = new DateTime($year . '-' . $_month . '-' . 
      $_mday . ' ' . $timestamp);
                    
                    // get the week of the month (1, 2, 3, 4, 5, etc)
                    $week = $date_time->format('W');
                    
                    if($date_time >= $this->start_date && in_array($week, 
      $this->byweekno))
                    {
                        $this->suggestions[] = clone $date_time;
                    }
                }
            }
        }
        elseif($interval == "day")
        {
            $this->suggestions[] = clone $this->try_date;
        }
        elseif($interval == "week")
        {
            $this->suggestions[] = clone $this->try_date;
            
            if($this->gobyday)
            {
                $week_day = $this->try_date->format('w');
                
                $days_in_month = $this->try_date->format('t');
                
                $overflow_count = 1;
                $_day = $month_day;
                
                $run = true;
                while($run)
                {
                    $_day++;
                    if($_day <= $days_in_month)
                    {
                        $tmp_date = new DateTime($year . '-' . $month . '-' . 
      $_day . ' ' . $timestamp);
                    }
                    else
                    {
                        $tmp_month = $month+1;
                        $tmp_date = new DateTime($year . '-' . $tmp_month . '-'
       . $overflow_count . ' ' . $timestamp);
                        $overflow_count++;
                    }
                    
                    $week_day = $tmp_date->format('w');
                    
                    if($this->try_date == $this->start_date)
                    {
                        if($week_day == $this->wkst)
                        {
                            $this->try_date = clone $tmp_date;
                            $this->try_date->modify('-7 days');
                            $run = false;
                        }
                    }

                    if($week_day != $this->wkst)
                    {
                        $this->suggestions[] = clone $tmp_date;
                    }
                    else
                    {
                        $run = false;
                    }
                }
            }
        }
        elseif($this->gobyday || $interval == "month")
        {
            $_mdays = range(1, date('t',mktime(0,0,0,$month,1,$year)));
            foreach($_mdays as $_mday)
            {
                $date_time = new DateTime($year . '-' . $month . '-' . $_mday .
       ' ' . $timestamp);
                
                // get the week of the month (1, 2, 3, 4, 5, etc)
                $week = $date_time->format('W');
                
                if($date_time >= $this->start_date && in_array($week, $this->
      byweekno))
                {
                    $this->suggestions[] = clone $date_time;
                }
            }
        }
        elseif($this->gobymonth)
        {
            foreach($this->bymonth as $_month)
            {
                $date_time = new DateTime($year . '-' . $_month . '-' . 
      $month_day . ' ' . $timestamp);
                
                if($date_time >= $this->start_date)
                {
                    $this->suggestions[] = clone $date_time;
                }
            }
        } 
        else 
        {
            $this->suggestions[] = clone $this->try_date;
        }
        
        if($interval == "month")
        {
            $this->try_date->modify('last day of ' . $this->interval . ' ' . 
      $interval);
        }
        else
        {
            $this->try_date->modify($this->interval . ' ' . $interval);
        }
    }
\end{DoxyCode}
\hypertarget{class_when_a352f040efbbf14f4bb985f4d9b077082}{\index{\-When@{\-When}!freq@{freq}}
\index{freq@{freq}!When@{\-When}}
\subsubsection[{freq}]{\setlength{\rightskip}{0pt plus 5cm}{\bf freq} (
\begin{DoxyParamCaption}
\item[{\$}]{frequency}
\end{DoxyParamCaption}
)}}\label{class_when_a352f040efbbf14f4bb985f4d9b077082}


\-Definition at line 130 of file recur.\-php.


\begin{DoxyCode}
    {
        if(in_array(strtoupper($frequency), $this->valid_frequency))
        {
            $this->frequency = strtoupper($frequency);
        }
        else
        {
            throw new InvalidArgumentException('Invalid frequency type.');
        }

        return $this;
    }
\end{DoxyCode}
\hypertarget{class_when_af3b0b324d22a2cd686e44711fc3ff25e}{\index{\-When@{\-When}!interval@{interval}}
\index{interval@{interval}!When@{\-When}}
\subsubsection[{interval}]{\setlength{\rightskip}{0pt plus 5cm}{\bf interval} (
\begin{DoxyParamCaption}
\item[{\$}]{interval}
\end{DoxyParamCaption}
)}}\label{class_when_af3b0b324d22a2cd686e44711fc3ff25e}


\-Definition at line 212 of file recur.\-php.


\begin{DoxyCode}
    {
        $this->interval = (int)$interval;
        
        return $this;
    }
\end{DoxyCode}
\hypertarget{class_when_acea62048bfee7b3cd80ed446c86fb78a}{\index{\-When@{\-When}!next@{next}}
\index{next@{next}!When@{\-When}}
\subsubsection[{next}]{\setlength{\rightskip}{0pt plus 5cm}{\bf next} (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{class_when_acea62048bfee7b3cd80ed446c86fb78a}


\-Definition at line 672 of file recur.\-php.


\begin{DoxyCode}
    {       
        // check the counter is set
        if($this->count !== 0)
        {
            if($this->counter >= $this->count)
            {
                return false;
            }
        }
        
        // create initial set of suggested dates
        if(count($this->suggestions) == 0)
        {
            $this->create_suggestions();
        }
        
        // loop through the suggested dates
        while(count($this->suggestions) > 0)
        {
            // get the first one on the array
            $try_date = array_shift($this->suggestions);
            
            // make sure the date doesn't exceed the max date
            if($try_date > $this->end_date)
            {
                return false;
            }
            
            // make sure it falls within the allowed days
            if($this->valid_date($try_date) === true)
            {
                $this->counter++;
                return $try_date;
            }
            else
            {
                // we might be out of suggested days, so load some more
                if(count($this->suggestions) == 0)
                {
                    $this->create_suggestions();
                }
            }
        }
    }
\end{DoxyCode}
\hypertarget{class_when_a91e158ffabe2df32a0b75cfe0b774899}{\index{\-When@{\-When}!recur@{recur}}
\index{recur@{recur}!When@{\-When}}
\subsubsection[{recur}]{\setlength{\rightskip}{0pt plus 5cm}{\bf recur} (
\begin{DoxyParamCaption}
\item[{\$}]{start\-\_\-date, }
\item[{\$}]{frequency = {\ttfamily \char`\"{}daily\char`\"{}}}
\end{DoxyParamCaption}
)}}\label{class_when_a91e158ffabe2df32a0b75cfe0b774899}

\begin{DoxyParams}[1]{\-Parameters}
\-Date\-Time | string & {\em \$start\-\_\-date} & of the recursion -\/ also is the first return value. \\
\hline
string & {\em \$frequency} & of the recrusion, valid frequencies\-: secondly, minutely, hourly, daily, weekly, monthly, yearly \\
\hline
\end{DoxyParams}


\-Definition at line 103 of file recur.\-php.


\begin{DoxyCode}
    {
        try
        {
            if(is_object($start_date))
            {
                $this->start_date = clone $start_date;
            }
            else
            {
                // timestamps within the RFC have a 'Z' at the end of them,
       remove this.
                $start_date = trim($start_date, 'Z');
                $this->start_date = new DateTime($start_date);
            }
            
            $this->try_date = clone $this->start_date;
        }
        catch(Exception $e)
        {
            throw new InvalidArgumentException('Invalid start date DateTime: ' 
      . $e);
        }
        
        $this->freq($frequency);
        
        return $this;
    }
\end{DoxyCode}
\hypertarget{class_when_a9eb30a36f809180523d364e87fd2a489}{\index{\-When@{\-When}!rrule@{rrule}}
\index{rrule@{rrule}!When@{\-When}}
\subsubsection[{rrule}]{\setlength{\rightskip}{0pt plus 5cm}{\bf rrule} (
\begin{DoxyParamCaption}
\item[{\$}]{rrule}
\end{DoxyParamCaption}
)}}\label{class_when_a9eb30a36f809180523d364e87fd2a489}


\-Definition at line 145 of file recur.\-php.


\begin{DoxyCode}
    {
        $parts = explode(";", $rrule);

        foreach($parts as $part)
        {
            list($rule, $param) = explode("=", $part);

            $rule = strtoupper($rule);
            $param = strtoupper($param);

            switch($rule)
            {
                case "FREQ":
                    $this->frequency = $param;
                    break;
                case "UNTIL":
                    $this->until($param);
                    break;
                case "COUNT":
                    $this->count($param);
                    break;
                case "INTERVAL":
                    $this->interval($param);
                    break;
                case "BYDAY":
                    $params = explode(",", $param);
                    $this->byday($params);
                    break;
                case "BYMONTHDAY":
                    $params = explode(",", $param);
                    $this->bymonthday($params);
                    break;
                case "BYYEARDAY":
                    $params = explode(",", $param);
                    $this->byyearday($params);
                    break;
                case "BYWEEKNO":
                    $params = explode(",", $param);
                    $this->byweekno($params);
                    break;
                case "BYMONTH":
                    $params = explode(",", $param);
                    $this->bymonth($params);
                    break;
                case "BYSETPOS":
                    $params = explode(",", $param);
                    $this->bysetpos($params);
                    break;
                case "WKST":
                    $this->wkst($param);
                    break;
            }
        }

        return $this;
    }
\end{DoxyCode}
\hypertarget{class_when_ae66b9c2794ad0a05a02796727406e235}{\index{\-When@{\-When}!until@{until}}
\index{until@{until}!When@{\-When}}
\subsubsection[{until}]{\setlength{\rightskip}{0pt plus 5cm}{\bf until} (
\begin{DoxyParamCaption}
\item[{\$}]{end\-\_\-date}
\end{DoxyParamCaption}
)}}\label{class_when_ae66b9c2794ad0a05a02796727406e235}


\-Definition at line 251 of file recur.\-php.


\begin{DoxyCode}
    {       
        try
        {
            if(is_object($end_date))
            {
                $this->end_date = clone $end_date;
            }
            else
            {
                // timestamps within the RFC have a 'Z' at the end of them,
       remove this.
                $end_date = trim($end_date, 'Z');
                $this->end_date = new DateTime($end_date);
            }
        }
        catch(Exception $e)
        {
            throw new InvalidArgumentException('Invalid end date DateTime: ' . 
      $e);
        }
        
        return $this;
    }
\end{DoxyCode}
\hypertarget{class_when_a253d57a0681be06af755e8f18a793ca6}{\index{\-When@{\-When}!valid\-\_\-date@{valid\-\_\-date}}
\index{valid\-\_\-date@{valid\-\_\-date}!When@{\-When}}
\subsubsection[{valid\-\_\-date}]{\setlength{\rightskip}{0pt plus 5cm}{\bf valid\-\_\-date} (
\begin{DoxyParamCaption}
\item[{\$}]{date}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}\label{class_when_a253d57a0681be06af755e8f18a793ca6}


\-Definition at line 624 of file recur.\-php.


\begin{DoxyCode}
    {
        $year = $date->format('Y');
        $month = $date->format('n');
        $day = $date->format('j');
        
        $year_day = $date->format('z') + 1;
        
        $year_day_neg = -366 + $year_day;
        $leap_year = $date->format('L');
        if($leap_year == 1)
        {
            $year_day_neg = -367 + $year_day;
        }
        
        // this is the nth occurence of the date
        $occur = ceil($day / 7);
        
        $week = $date->format('W');
        
        $day_of_week = $date->format('l');
        $dow_abr = strtoupper(substr($day_of_week, 0, 2));
        
        // set the day of the month + (positive)
        $occur = '+' . $occur . $dow_abr;
        $occur_zero = '+0' . $dow_abr;
        
        // set the day of the month - (negative)
        $total_days = $date->format('t') - $date->format('j');
        $occur_neg = '-' . ceil(($total_days + 1)/7) . $dow_abr;
        
        $day_from_end_of_month = $date->format('t') + 1 - $day;
        
        if(in_array($month, $this->bymonth) && 
           (in_array($occur, $this->byday) || in_array($occur_zero, $this->byday
      ) || in_array($occur_neg, $this->byday)) && 
           in_array($week, $this->byweekno) &&
           (in_array($day, $this->bymonthday) || in_array(-
      $day_from_end_of_month, $this->bymonthday)) &&
           (in_array($year_day, $this->byyearday) || in_array($year_day_neg, 
      $this->byyearday)))
        {
            return true;
        }
        else
        {
            return false;
        }
    }
\end{DoxyCode}
\hypertarget{class_when_a7adc47937eecbbdf1c6190baf4474bda}{\index{\-When@{\-When}!wkst@{wkst}}
\index{wkst@{wkst}!When@{\-When}}
\subsubsection[{wkst}]{\setlength{\rightskip}{0pt plus 5cm}{\bf wkst} (
\begin{DoxyParamCaption}
\item[{\$}]{day}
\end{DoxyParamCaption}
)}}\label{class_when_a7adc47937eecbbdf1c6190baf4474bda}


\-Definition at line 220 of file recur.\-php.


\begin{DoxyCode}
    {
        switch($day)
        {
            case 'SU':
                $this->wkst = 0;
                break;
            case 'MO':
                $this->wkst = 1;
                break;
            case 'TU':
                $this->wkst = 2;
                break;
            case 'WE':
                $this->wkst = 3;
                break;
            case 'TH':
                $this->wkst = 4;
                break;
            case 'FR':
                $this->wkst = 5;
                break;
            case 'SA':
                $this->wkst = 6;
                break;
        }
        
        return $this;
    }
\end{DoxyCode}


\subsection{\-Field \-Documentation}
\hypertarget{class_when_a7c5b514dc4f18e1acf5d250804163d85}{\index{\-When@{\-When}!\$byday@{\$byday}}
\index{\$byday@{\$byday}!When@{\-When}}
\subsubsection[{\$byday}]{\setlength{\rightskip}{0pt plus 5cm}\${\bf byday}\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}\label{class_when_a7c5b514dc4f18e1acf5d250804163d85}


\-Definition at line 32 of file recur.\-php.

\hypertarget{class_when_a2960e64225996b24f544c5f6a82efe59}{\index{\-When@{\-When}!\$bymonth@{\$bymonth}}
\index{\$bymonth@{\$bymonth}!When@{\-When}}
\subsubsection[{\$bymonth}]{\setlength{\rightskip}{0pt plus 5cm}\${\bf bymonth}\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}\label{class_when_a2960e64225996b24f544c5f6a82efe59}


\-Definition at line 20 of file recur.\-php.

\hypertarget{class_when_a4e995a36cbcb603b7c677ebe1b4b466b}{\index{\-When@{\-When}!\$bymonthday@{\$bymonthday}}
\index{\$bymonthday@{\$bymonthday}!When@{\-When}}
\subsubsection[{\$bymonthday}]{\setlength{\rightskip}{0pt plus 5cm}\${\bf bymonthday}\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}\label{class_when_a4e995a36cbcb603b7c677ebe1b4b466b}


\-Definition at line 29 of file recur.\-php.

\hypertarget{class_when_a7d5adf3eb4cbd77f0b3890c8ae88d3b7}{\index{\-When@{\-When}!\$bysetpos@{\$bysetpos}}
\index{\$bysetpos@{\$bysetpos}!When@{\-When}}
\subsubsection[{\$bysetpos}]{\setlength{\rightskip}{0pt plus 5cm}\${\bf bysetpos}\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}\label{class_when_a7d5adf3eb4cbd77f0b3890c8ae88d3b7}


\-Definition at line 35 of file recur.\-php.

\hypertarget{class_when_af53eb19e3c262d64bcda47bf441dd4ec}{\index{\-When@{\-When}!\$byweekno@{\$byweekno}}
\index{\$byweekno@{\$byweekno}!When@{\-When}}
\subsubsection[{\$byweekno}]{\setlength{\rightskip}{0pt plus 5cm}\${\bf byweekno}\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}\label{class_when_af53eb19e3c262d64bcda47bf441dd4ec}


\-Definition at line 23 of file recur.\-php.

\hypertarget{class_when_ab5b023a775eb407a1acc3a14f775740d}{\index{\-When@{\-When}!\$byyearday@{\$byyearday}}
\index{\$byyearday@{\$byyearday}!When@{\-When}}
\subsubsection[{\$byyearday}]{\setlength{\rightskip}{0pt plus 5cm}\${\bf byyearday}\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}\label{class_when_ab5b023a775eb407a1acc3a14f775740d}


\-Definition at line 26 of file recur.\-php.

\hypertarget{class_when_af789423037bbc89dc7c850e761177570}{\index{\-When@{\-When}!\$count@{\$count}}
\index{\$count@{\$count}!When@{\-When}}
\subsubsection[{\$count}]{\setlength{\rightskip}{0pt plus 5cm}\${\bf count}\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}\label{class_when_af789423037bbc89dc7c850e761177570}


\-Definition at line 39 of file recur.\-php.

\hypertarget{class_when_adc0a189fac719187ba2e6f01ca0f2466}{\index{\-When@{\-When}!\$counter@{\$counter}}
\index{\$counter@{\$counter}!When@{\-When}}
\subsubsection[{\$counter}]{\setlength{\rightskip}{0pt plus 5cm}\$counter\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}\label{class_when_adc0a189fac719187ba2e6f01ca0f2466}


\-Definition at line 40 of file recur.\-php.

\hypertarget{class_when_a2dc978f2a05472c5f99cc7bd2d0b5abd}{\index{\-When@{\-When}!\$end\-\_\-date@{\$end\-\_\-date}}
\index{\$end\-\_\-date@{\$end\-\_\-date}!When@{\-When}}
\subsubsection[{\$end\-\_\-date}]{\setlength{\rightskip}{0pt plus 5cm}\$end\-\_\-date\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}\label{class_when_a2dc978f2a05472c5f99cc7bd2d0b5abd}


\-Definition at line 17 of file recur.\-php.

\hypertarget{class_when_ad965d6d26242232a1ea5e810947ee77d}{\index{\-When@{\-When}!\$frequency@{\$frequency}}
\index{\$frequency@{\$frequency}!When@{\-When}}
\subsubsection[{\$frequency}]{\setlength{\rightskip}{0pt plus 5cm}\$frequency\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}\label{class_when_ad965d6d26242232a1ea5e810947ee77d}


\-Definition at line 12 of file recur.\-php.

\hypertarget{class_when_aa7c329dbfbead5deb6b8c405e0619cf2}{\index{\-When@{\-When}!\$gobyday@{\$gobyday}}
\index{\$gobyday@{\$gobyday}!When@{\-When}}
\subsubsection[{\$gobyday}]{\setlength{\rightskip}{0pt plus 5cm}\$gobyday\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}\label{class_when_aa7c329dbfbead5deb6b8c405e0619cf2}


\-Definition at line 31 of file recur.\-php.

\hypertarget{class_when_aad00c8e2ddca0ca728f5c39abc66ce65}{\index{\-When@{\-When}!\$gobymonth@{\$gobymonth}}
\index{\$gobymonth@{\$gobymonth}!When@{\-When}}
\subsubsection[{\$gobymonth}]{\setlength{\rightskip}{0pt plus 5cm}\$gobymonth\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}\label{class_when_aad00c8e2ddca0ca728f5c39abc66ce65}


\-Definition at line 19 of file recur.\-php.

\hypertarget{class_when_a259b16184aa8390f6becc888d1083c03}{\index{\-When@{\-When}!\$gobymonthday@{\$gobymonthday}}
\index{\$gobymonthday@{\$gobymonthday}!When@{\-When}}
\subsubsection[{\$gobymonthday}]{\setlength{\rightskip}{0pt plus 5cm}\$gobymonthday\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}\label{class_when_a259b16184aa8390f6becc888d1083c03}


\-Definition at line 28 of file recur.\-php.

\hypertarget{class_when_a9ae818cb1793028259c94c6f5338e7dd}{\index{\-When@{\-When}!\$gobysetpos@{\$gobysetpos}}
\index{\$gobysetpos@{\$gobysetpos}!When@{\-When}}
\subsubsection[{\$gobysetpos}]{\setlength{\rightskip}{0pt plus 5cm}\$gobysetpos\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}\label{class_when_a9ae818cb1793028259c94c6f5338e7dd}


\-Definition at line 34 of file recur.\-php.

\hypertarget{class_when_a58be6c219be700f106377416e3eee8e0}{\index{\-When@{\-When}!\$gobyweekno@{\$gobyweekno}}
\index{\$gobyweekno@{\$gobyweekno}!When@{\-When}}
\subsubsection[{\$gobyweekno}]{\setlength{\rightskip}{0pt plus 5cm}\$gobyweekno\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}\label{class_when_a58be6c219be700f106377416e3eee8e0}


\-Definition at line 22 of file recur.\-php.

\hypertarget{class_when_a500ec70777161d3066e95f7c7551b7a3}{\index{\-When@{\-When}!\$gobyyearday@{\$gobyyearday}}
\index{\$gobyyearday@{\$gobyyearday}!When@{\-When}}
\subsubsection[{\$gobyyearday}]{\setlength{\rightskip}{0pt plus 5cm}\$gobyyearday\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}\label{class_when_a500ec70777161d3066e95f7c7551b7a3}


\-Definition at line 25 of file recur.\-php.

\hypertarget{class_when_a68d1d0dd2c7af0521842477b901d2ce2}{\index{\-When@{\-When}!\$goenddate@{\$goenddate}}
\index{\$goenddate@{\$goenddate}!When@{\-When}}
\subsubsection[{\$goenddate}]{\setlength{\rightskip}{0pt plus 5cm}\$goenddate\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}\label{class_when_a68d1d0dd2c7af0521842477b901d2ce2}


\-Definition at line 42 of file recur.\-php.

\hypertarget{class_when_a02df6fd14302ba88fecc15b95d513e5b}{\index{\-When@{\-When}!\$interval@{\$interval}}
\index{\$interval@{\$interval}!When@{\-When}}
\subsubsection[{\$interval}]{\setlength{\rightskip}{0pt plus 5cm}\${\bf interval}\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}\label{class_when_a02df6fd14302ba88fecc15b95d513e5b}


\-Definition at line 44 of file recur.\-php.

\hypertarget{class_when_a6720ff61744e00a5bbbaa98676e7beb5}{\index{\-When@{\-When}!\$start\-\_\-date@{\$start\-\_\-date}}
\index{\$start\-\_\-date@{\$start\-\_\-date}!When@{\-When}}
\subsubsection[{\$start\-\_\-date}]{\setlength{\rightskip}{0pt plus 5cm}\$start\-\_\-date\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}\label{class_when_a6720ff61744e00a5bbbaa98676e7beb5}


\-Definition at line 14 of file recur.\-php.

\hypertarget{class_when_a435c7a87a97b0b448a1920488dd592da}{\index{\-When@{\-When}!\$suggestions@{\$suggestions}}
\index{\$suggestions@{\$suggestions}!When@{\-When}}
\subsubsection[{\$suggestions}]{\setlength{\rightskip}{0pt plus 5cm}\$suggestions\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}\label{class_when_a435c7a87a97b0b448a1920488dd592da}


\-Definition at line 37 of file recur.\-php.

\hypertarget{class_when_ac726436e39cc7252cd1ca6c0f636f15b}{\index{\-When@{\-When}!\$try\-\_\-date@{\$try\-\_\-date}}
\index{\$try\-\_\-date@{\$try\-\_\-date}!When@{\-When}}
\subsubsection[{\$try\-\_\-date}]{\setlength{\rightskip}{0pt plus 5cm}\$try\-\_\-date\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}\label{class_when_ac726436e39cc7252cd1ca6c0f636f15b}


\-Definition at line 15 of file recur.\-php.

\hypertarget{class_when_a8cf1751bccbd1e4e79d83d6ced43d055}{\index{\-When@{\-When}!\$valid\-\_\-frequency@{\$valid\-\_\-frequency}}
\index{\$valid\-\_\-frequency@{\$valid\-\_\-frequency}!When@{\-When}}
\subsubsection[{\$valid\-\_\-frequency}]{\setlength{\rightskip}{0pt plus 5cm}\$valid\-\_\-frequency\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}\label{class_when_a8cf1751bccbd1e4e79d83d6ced43d055}


\-Definition at line 49 of file recur.\-php.

\hypertarget{class_when_abc38cc338d7a6772a037b000bd3c6fb9}{\index{\-When@{\-When}!\$valid\-\_\-week\-\_\-days@{\$valid\-\_\-week\-\_\-days}}
\index{\$valid\-\_\-week\-\_\-days@{\$valid\-\_\-week\-\_\-days}!When@{\-When}}
\subsubsection[{\$valid\-\_\-week\-\_\-days}]{\setlength{\rightskip}{0pt plus 5cm}\$valid\-\_\-week\-\_\-days\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}\label{class_when_abc38cc338d7a6772a037b000bd3c6fb9}


\-Definition at line 48 of file recur.\-php.

\hypertarget{class_when_a28f081d50521dd1e40a5c50ef3375bad}{\index{\-When@{\-When}!\$wkst@{\$wkst}}
\index{\$wkst@{\$wkst}!When@{\-When}}
\subsubsection[{\$wkst}]{\setlength{\rightskip}{0pt plus 5cm}\${\bf wkst}\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}\label{class_when_a28f081d50521dd1e40a5c50ef3375bad}


\-Definition at line 46 of file recur.\-php.



\-The documentation for this class was generated from the following file\-:\begin{DoxyCompactItemize}
\item 
\-C\-:/wamp/www/\-Mitos\-E\-H\-R/lib/extensible-\/1.\-5.\-0/examples/calendar/remote/php/lib/\hyperlink{recur_8php}{recur.\-php}\end{DoxyCompactItemize}
